
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<link href="https://cassmastern.github.io/cass-sandbox/sec_ehealth/smart-fhir-visuals/" rel="canonical"/>
<link href="../quick_ref/" rel="prev"/>
<link href="../gloss_ontario_halo/" rel="next"/>
<link href="../../img/favicon.ico" rel="icon"/>
<meta content="mkdocs-1.6.1, mkdocs-material-9.5.39" name="generator"/>
<title>SMART-on-FHIR and Integration — Visuals - Ler's Sandobx</title>
<link href="../../assets/stylesheets/main.8c3ca2c6.min.css" rel="stylesheet"/>
<link href="../../assets/stylesheets/palette.06af60db.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
<link href="../../css/alphabet.css" rel="stylesheet"/>
<link href="../../css/diagram-common.css" rel="stylesheet"/>
<link href="../../css/diagram-zoom.css" rel="stylesheet"/>
<link href="../../css/cm-logo.css" rel="stylesheet"/>
<link href="../../css/color-vars.css" rel="stylesheet"/>
<link href="../../assets/mkdocs_puml/puml.css" rel="stylesheet"/>
<link href="../../assets/mkdocs_puml/interaction.css" rel="stylesheet"/>
<script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
<script id="__analytics">function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-GD2XWDMP2E"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-GD2XWDMP2E",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-GD2XWDMP2E",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script>
<script>if("undefined"!=typeof __md_analytics){var consent=__md_get("__consent");consent&&consent.analytics&&__md_analytics()}</script>
</head>
<body data-md-color-accent="indigo" data-md-color-primary="indigo" data-md-color-scheme="slate" dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#smart-on-fhir-and-integration-visuals">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header md-header--shadow" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="Ler's Sandobx" class="md-header__button md-logo" data-md-component="logo" href="../.." title="Ler's Sandobx">
<img alt="logo" src="../../img/logo.svg"/>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            Ler's Sandobx
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              SMART-on-FHIR and Integration — Visuals
            
          </span>
</div>
</div>
</div>
<form class="md-header__option" data-md-component="palette">
<input aria-label="Switch to light mode" class="md-option" data-md-color-accent="indigo" data-md-color-media="" data-md-color-primary="indigo" data-md-color-scheme="slate" id="__palette_0" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_1" hidden="" title="Switch to light mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"></path></svg>
</label>
<input aria-label="Switch to dark mode" class="md-option" data-md-color-accent="indigo" data-md-color-media="" data-md-color-primary="indigo" data-md-color-scheme="default" id="__palette_1" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_0" hidden="" title="Switch to dark mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"></path></svg>
</label>
</form>
<script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
</label>
<nav aria-label="Search" class="md-search__options">
<a aria-label="Share" class="md-search__icon md-icon" data-clipboard="" data-clipboard-text="" data-md-component="search-share" href="javascript:void(0)" tabindex="-1" title="Share">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"></path></svg>
</a>
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" title="Clear" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>
</button>
</nav>
<div class="md-search__suggest" data-md-component="search-suggest"></div>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="" tabindex="0">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="Ler's Sandobx" class="md-nav__button md-logo" data-md-component="logo" href="../.." title="Ler's Sandobx">
<img alt="logo" src="../../img/logo.svg"/>
</a>
    Ler's Sandobx
  </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../..">
<span class="md-ellipsis">
    HOME
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_2" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../sec_about/">
<span class="md-ellipsis">
    ABOUT THIS WEBSITE
  </span>
</a>
<label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_2_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_2">
<span class="md-nav__icon md-icon"></span>
            ABOUT THIS WEBSITE
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../sec_about/whatsinhere/">
<span class="md-ellipsis">
    What's in Here?
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../sec_about/about-sitedev/">
<span class="md-ellipsis">
    How This Site Was Developed and Deployed
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../sec_about/about-wf-breakdown/">
<span class="md-ellipsis">
    Detailed Breakdown of My Workflow
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../sec_about/roadmap/">
<span class="md-ellipsis">
    Roadmap &amp; Changelog
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../sec_about/feedback/">
<span class="md-ellipsis">
    Feedback
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_3" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../sec_cloud/">
<span class="md-ellipsis">
    IN THE CLOUDS
  </span>
</a>
<label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_3_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_3">
<span class="md-nav__icon md-icon"></span>
            IN THE CLOUDS
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../sec_cloud/aws-gcp-azure/">
<span class="md-ellipsis">
    Architectures of AWS, GCP, and Azure
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../sec_cloud/aws-gcp-azure_glossary/">
<span class="md-ellipsis">
    Cross-Platform Cloud &amp; DevOps Glossary (AWS, GCP, Azure)
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../sec_cloud/aws-gcp-azure_glossary_enhanced/">
<span class="md-ellipsis">
    Cross-Platform Cloud &amp; DevOps Glossary (AWS, GCP, Azure) — Enhanced
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../sec_cloud/jakarta-ee-azure/">
<span class="md-ellipsis">
    A Jakarta Enterprise Application on Azure
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_4" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../sec_accss/">
<span class="md-ellipsis">
    ACCESSIBILITY
  </span>
</a>
<label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_4_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_4">
<span class="md-nav__icon md-icon"></span>
            ACCESSIBILITY
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../sec_accss/accss_/">
<span class="md-ellipsis">
    Accessibility Reference
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../sec_accss/visuals-for-the-sightless/">
<span class="md-ellipsis">
    Visuals for the Sightless
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../sec_accss/accss_diagram-dilemma/">
<span class="md-ellipsis">
    The Diagramming Dilemma
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../sec_accss/mermaid-beyond-reach/">
<span class="md-ellipsis">
    An Accessible Mermaid Beyond Reach
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../sec_accss/mermaid-captured/">
<span class="md-ellipsis">
    Mermaid Captured
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../sec_accss/mkdocs-mermaid-plantuml-graphviz/">
<span class="md-ellipsis">
    Diagram Accessibility: Current State/Path Forward
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_5" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../sec_freeform/">
<span class="md-ellipsis">
    CONCEPTS, ESSAYS &amp; MORE
  </span>
</a>
<label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_5_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_5">
<span class="md-nav__icon md-icon"></span>
            CONCEPTS, ESSAYS &amp; MORE
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../sec_freeform/ibm-sanfran/">
<span class="md-ellipsis">
    IBM SanFrancisco
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../sec_freeform/ai-accessibility/">
<span class="md-ellipsis">
    Accessibility with AI
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../sec_freeform/ai-accessibility_bus/">
<span class="md-ellipsis">
    Accessibility with AI (Concept Note)
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../sec_freeform/gen-ai-landscape-primer/">
<span class="md-ellipsis">
    GenAI Landscape in 2025
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../sec_freeform/identity/">
<span class="md-ellipsis">
    The Long Arc of Digital Identity
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_6" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../sec_net-sec/">
<span class="md-ellipsis">
    NETWORKS &amp; SECURITY
  </span>
</a>
<label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_6_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_6">
<span class="md-nav__icon md-icon"></span>
            NETWORKS &amp; SECURITY
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../sec_net-sec/network_data_center/">
<span class="md-ellipsis">
    A Hypothetical Data Centre Network
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../sec_net-sec/network_data_center_stride/">
<span class="md-ellipsis">
    Network Security and Threat Modeling — STRIDE
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../sec_net-sec/network_data_center_mitre/">
<span class="md-ellipsis">
    Network Security and Threat Modeling — MITRE ATT&amp;CK
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../sec_net-sec/saml-admin/">
<span class="md-ellipsis">
    Single Sign-On (SSO) Admin Guide — SAML 2.0 Integration
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_7" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../">
<span class="md-ellipsis">
    eHEALTH
  </span>
</a>
<label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="true" aria-labelledby="__nav_7_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_7">
<span class="md-nav__icon md-icon"></span>
            eHEALTH
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../quick_ref/">
<span class="md-ellipsis">
    SMART-on-FHIR and Integration Quick Reference
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
<span class="md-ellipsis">
    SMART-on-FHIR and Integration — Visuals
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
<span class="md-ellipsis">
    SMART-on-FHIR and Integration — Visuals
  </span>
</a>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#smart-on-fhir-ehr-launch-flow">
<span class="md-ellipsis">
      SMART-on-FHIR EHR Launch Flow
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#smart-on-fhir-standalone-launch-flow">
<span class="md-ellipsis">
      SMART-on-FHIR Standalone Launch Flow
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#smart-on-fhir-token-refresh-flow">
<span class="md-ellipsis">
      SMART-on-FHIR Token Refresh Flow
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#pkce-flow">
<span class="md-ellipsis">
      PKCE Flow
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#smart-scope-hierarchy-and-contexts">
<span class="md-ellipsis">
      SMART Scope Hierarchy and Contexts
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#smart-on-fhir-error-handling-patterns">
<span class="md-ellipsis">
      SMART-on-FHIR Error Handling Patterns
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#smart-on-fhir-architecture">
<span class="md-ellipsis">
      SMART-on-FHIR Architecture
    </span>
</a>
<nav aria-label="SMART-on-FHIR Architecture" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#1-smart-on-fhir-architecture-system-context">
<span class="md-ellipsis">
      1. SMART-on-FHIR Architecture, System Context
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#2-smart-on-fhir-architecture-authorization-server-components">
<span class="md-ellipsis">
      2. SMART-on-FHIR Architecture, Authorization Server Components
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#3-smart-on-fhir-architecture-fhir-api-server-components">
<span class="md-ellipsis">
      3. SMART-on-FHIR Architecture, FHIR API Server Components
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#4-smart-on-fhir-architecture-smart-api-request-flow">
<span class="md-ellipsis">
      4. SMART-on-FHIR Architecture, Smart API Request Flow
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#5-smart-on-fhir-architecture-smart-discovery-process">
<span class="md-ellipsis">
      5. SMART-on-FHIR Architecture, SMART Discovery Process
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#halo-smart-integration-architecture">
<span class="md-ellipsis">
      HALO SMART Integration Architecture
    </span>
</a>
<nav aria-label="HALO SMART Integration Architecture" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#1-halo-smart-integration-high-level-architecture-context">
<span class="md-ellipsis">
      1. HALO SMART Integration, High-Level Architecture (Context)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#2-halo-smart-integration-authentication-flow">
<span class="md-ellipsis">
      2. HALO SMART Integration, Authentication Flow
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#3-halo-smart-integration-data-access-flow">
<span class="md-ellipsis">
      3. HALO SMART Integration, Data Access Flow
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#security-best-practices">
<span class="md-ellipsis">
      Security Best Practices
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#smart-on-fhir-data-flow">
<span class="md-ellipsis">
      SMART-on-FHIR Data Flow
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../gloss_ontario_halo/">
<span class="md-ellipsis">
    Ontario eHealth &amp; HALO Integration Glossary
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_7_5" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../sec_deepdive/">
<span class="md-ellipsis">
    Deep Dive into SMART-on-FHIR
  </span>
</a>
<label class="md-nav__link" for="__nav_7_5" id="__nav_7_5_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_7_5_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_7_5">
<span class="md-nav__icon md-icon"></span>
            Deep Dive into SMART-on-FHIR
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_7_5_2" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../sec_deepdive/eh-dd-01-foundations/">
<span class="md-ellipsis">
    Foundations
  </span>
</a>
<label class="md-nav__link" for="__nav_7_5_2" id="__nav_7_5_2_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_7_5_2_label" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_7_5_2">
<span class="md-nav__icon md-icon"></span>
            Foundations
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../sec_deepdive/eh-dd-01-foundations/deepdive-overview/">
<span class="md-ellipsis">
    Overview of SMART-on-FHIR
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../sec_deepdive/eh-dd-01-foundations/deepdive-overview-fhir-arch/">
<span class="md-ellipsis">
    SMART-on-FHIR Architecture Overview
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../sec_deepdive/eh-dd-01-foundations/deepdive-overview-fhir-resources/">
<span class="md-ellipsis">
    Key FHIR Resources
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_7_5_3" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../sec_deepdive/eh-dd-02-fhir-data-fundamentals/">
<span class="md-ellipsis">
    FHIR Data Fundamentals
  </span>
</a>
<label class="md-nav__link" for="__nav_7_5_3" id="__nav_7_5_3_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_7_5_3_label" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_7_5_3">
<span class="md-nav__icon md-icon"></span>
            FHIR Data Fundamentals
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../sec_deepdive/eh-dd-02-fhir-data-fundamentals/deepdive-fhir-data-types/">
<span class="md-ellipsis">
    FHIR Data Types
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../sec_deepdive/eh-dd-02-fhir-data-fundamentals/deepdive-fhir-code-systems/">
<span class="md-ellipsis">
    Common FHIR Code Systems
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../sec_deepdive/eh-dd-02-fhir-data-fundamentals/deepdive-fhir-cardinality/">
<span class="md-ellipsis">
    FHIR Resource Cardinality
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../sec_deepdive/eh-dd-02-fhir-data-fundamentals/deepdive-complete-resource-example/">
<span class="md-ellipsis">
    Complete Example Resource
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_7_5_4" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../sec_deepdive/eh-dd-03-fhir-resource-relationships/">
<span class="md-ellipsis">
    FHIR Resource Relationships
  </span>
</a>
<label class="md-nav__link" for="__nav_7_5_4" id="__nav_7_5_4_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_7_5_4_label" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_7_5_4">
<span class="md-nav__icon md-icon"></span>
            FHIR Resource Relationships
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../sec_deepdive/eh-dd-03-fhir-resource-relationships/deepdive-fhir-resource-relationship/">
<span class="md-ellipsis">
    Deepdive fhir resource relationship
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../sec_deepdive/eh-dd-03-fhir-resource-relationships/deepdive-fhir-resource-relationships-comprehensive/">
<span class="md-ellipsis">
    FHIR Comprehensive Resource Relationships
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../sec_deepdive/eh-dd-03-fhir-resource-relationships/deepdive-fhir-resource-bundles/">
<span class="md-ellipsis">
    FHIR Resource Bundles
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_7_5_5" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../sec_deepdive/eh-dd-04-working-with-fhir-apis/">
<span class="md-ellipsis">
    Working with FHIR Resource APIs
  </span>
</a>
<label class="md-nav__link" for="__nav_7_5_5" id="__nav_7_5_5_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_7_5_5_label" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_7_5_5">
<span class="md-nav__icon md-icon"></span>
            Working with FHIR Resource APIs
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../sec_deepdive/eh-dd-04-working-with-fhir-apis/deepdive-fhir-search-parameters/">
<span class="md-ellipsis">
    FHIR Search Parameters
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../sec_deepdive/eh-dd-04-working-with-fhir-apis/deepdive-fhir-rest-common-ops/">
<span class="md-ellipsis">
    Common FHIR Operations (REST API)
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../sec_deepdive/eh-dd-04-working-with-fhir-apis/deepdive-error-handling/">
<span class="md-ellipsis">
    Error Handling and OperationOutcome
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../sec_deepdive/eh-dd-04-working-with-fhir-apis/deepdive-fhir-validation/">
<span class="md-ellipsis">
    FHIR Validation
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_7_5_6" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../sec_deepdive/eh-dd-05-advanced-fhir-concepts/">
<span class="md-ellipsis">
    Advanced FHIR Concepts
  </span>
</a>
<label class="md-nav__link" for="__nav_7_5_6" id="__nav_7_5_6_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_7_5_6_label" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_7_5_6">
<span class="md-nav__icon md-icon"></span>
            Advanced FHIR Concepts
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../sec_deepdive/eh-dd-05-advanced-fhir-concepts/deepdive-fhir-profiles-and-extensions/">
<span class="md-ellipsis">
    FHIR Profiles and Extensions
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_7_5_7" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../sec_deepdive/eh-dd-06-smart-auth/">
<span class="md-ellipsis">
    SMART Authorization
  </span>
</a>
<label class="md-nav__link" for="__nav_7_5_7" id="__nav_7_5_7_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_7_5_7_label" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_7_5_7">
<span class="md-nav__icon md-icon"></span>
            SMART Authorization
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../sec_deepdive/eh-dd-06-smart-auth/deepdive-oauth-flow/">
<span class="md-ellipsis">
    OAuth 2.0 Flow
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../sec_deepdive/eh-dd-06-smart-auth/deepdive-smart-launch-flow/">
<span class="md-ellipsis">
    SMART Launch Flow
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../sec_deepdive/eh-dd-06-smart-auth/deepdive-smart-scopes-and-auth/">
<span class="md-ellipsis">
    SMART Scopes and Authorization
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../sec_deepdive/eh-dd-06-smart-auth/deepdive-smart-config-discovery/">
<span class="md-ellipsis">
    SMART Configuration Discovery
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../sec_deepdive/eh-dd-06-smart-auth/deepdive-security-and-access-control/">
<span class="md-ellipsis">
    Security and Access Control
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_7_5_8" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../sec_deepdive/eh-dd-07-hands-on-practice/">
<span class="md-ellipsis">
    Hands-On Practice
  </span>
</a>
<label class="md-nav__link" for="__nav_7_5_8" id="__nav_7_5_8_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_7_5_8_label" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_7_5_8">
<span class="md-nav__icon md-icon"></span>
            Hands-On Practice
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../sec_deepdive/eh-dd-07-hands-on-practice/deepdive-smart-health-it-sandbox/">
<span class="md-ellipsis">
    Using the SMART Health IT Sandbox
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../sec_deepdive/eh-dd-07-hands-on-practice/deepdive-smart_client_impl-sample-app/">
<span class="md-ellipsis">
    Practical Example: Building a SMART App
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../sec_deepdive/eh-dd-07-hands-on-practice/deepdive-smart_client_impl/">
<span class="md-ellipsis">
    SMART Client Implementation (Python)
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../sec_deepdive/eh-dd-07-hands-on-practice/deepdive-smart_client_impl-practical-code-examples/">
<span class="md-ellipsis">
    Practical Code Examples
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../sec_deepdive/eh-dd-07-hands-on-practice/deepdive-testing-and-debugging/">
<span class="md-ellipsis">
    Testing and Debugging
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_7_5_9" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../sec_deepdive/eh-dd-08-wrap-up/">
<span class="md-ellipsis">
    Wrap-Up
  </span>
</a>
<label class="md-nav__link" for="__nav_7_5_9" id="__nav_7_5_9_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_7_5_9_label" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_7_5_9">
<span class="md-nav__icon md-icon"></span>
            Wrap-Up
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../sec_deepdive/eh-dd-08-wrap-up/deepdive-key-takeaways/">
<span class="md-ellipsis">
    Deepdive key takeaways
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../sec_deepdive/eh-dd-08-wrap-up/deepdive-summary/">
<span class="md-ellipsis">
    Summary
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_8" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../sec_cheatsheets/">
<span class="md-ellipsis">
    VARIOUS CHEAT SHEETS
  </span>
</a>
<label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_8_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_8">
<span class="md-nav__icon md-icon"></span>
            VARIOUS CHEAT SHEETS
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../sec_cheatsheets/cheatsheet-docker/">
<span class="md-ellipsis">
    Docker Command Cheatsheet
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../sec_cheatsheets/cheatsheet-kubectl/">
<span class="md-ellipsis">
    Kubectl Command Cheat Sheet
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../sec_cheatsheets/cheatsheet_compound-modifiers/">
<span class="md-ellipsis">
    Compound Modifiers Cheat Sheet
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_9" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../sec_gloss/">
<span class="md-ellipsis">
    MISC GLOSSARIES
  </span>
</a>
<label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_9_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_9">
<span class="md-nav__icon md-icon"></span>
            MISC GLOSSARIES
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../sec_gloss/gloss_oss/">
<span class="md-ellipsis">
    Glossary of OSS Terms
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../sec_gloss/gloss_networking/">
<span class="md-ellipsis">
    Glossary of Networking Terms
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../sec_gloss/gloss_kuber/">
<span class="md-ellipsis">
    Glossary of Kubernetes Terms
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../sec_gloss/gloss_cloud-native/">
<span class="md-ellipsis">
    Glossary of Cloud-Native Terms
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#smart-on-fhir-ehr-launch-flow">
<span class="md-ellipsis">
      SMART-on-FHIR EHR Launch Flow
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#smart-on-fhir-standalone-launch-flow">
<span class="md-ellipsis">
      SMART-on-FHIR Standalone Launch Flow
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#smart-on-fhir-token-refresh-flow">
<span class="md-ellipsis">
      SMART-on-FHIR Token Refresh Flow
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#pkce-flow">
<span class="md-ellipsis">
      PKCE Flow
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#smart-scope-hierarchy-and-contexts">
<span class="md-ellipsis">
      SMART Scope Hierarchy and Contexts
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#smart-on-fhir-error-handling-patterns">
<span class="md-ellipsis">
      SMART-on-FHIR Error Handling Patterns
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#smart-on-fhir-architecture">
<span class="md-ellipsis">
      SMART-on-FHIR Architecture
    </span>
</a>
<nav aria-label="SMART-on-FHIR Architecture" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#1-smart-on-fhir-architecture-system-context">
<span class="md-ellipsis">
      1. SMART-on-FHIR Architecture, System Context
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#2-smart-on-fhir-architecture-authorization-server-components">
<span class="md-ellipsis">
      2. SMART-on-FHIR Architecture, Authorization Server Components
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#3-smart-on-fhir-architecture-fhir-api-server-components">
<span class="md-ellipsis">
      3. SMART-on-FHIR Architecture, FHIR API Server Components
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#4-smart-on-fhir-architecture-smart-api-request-flow">
<span class="md-ellipsis">
      4. SMART-on-FHIR Architecture, Smart API Request Flow
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#5-smart-on-fhir-architecture-smart-discovery-process">
<span class="md-ellipsis">
      5. SMART-on-FHIR Architecture, SMART Discovery Process
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#halo-smart-integration-architecture">
<span class="md-ellipsis">
      HALO SMART Integration Architecture
    </span>
</a>
<nav aria-label="HALO SMART Integration Architecture" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#1-halo-smart-integration-high-level-architecture-context">
<span class="md-ellipsis">
      1. HALO SMART Integration, High-Level Architecture (Context)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#2-halo-smart-integration-authentication-flow">
<span class="md-ellipsis">
      2. HALO SMART Integration, Authentication Flow
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#3-halo-smart-integration-data-access-flow">
<span class="md-ellipsis">
      3. HALO SMART Integration, Data Access Flow
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#security-best-practices">
<span class="md-ellipsis">
      Security Best Practices
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#smart-on-fhir-data-flow">
<span class="md-ellipsis">
      SMART-on-FHIR Data Flow
    </span>
</a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<h1 id="smart-on-fhir-and-integration-visuals">SMART-on-FHIR and Integration — Visuals</h1>
<h2 id="smart-on-fhir-ehr-launch-flow">SMART-on-FHIR EHR Launch Flow</h2>
<div class="puml-container"><div class="puml light" style=""><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="SEQUENCE" height="1166px" preserveAspectRatio="xMidYMid meet" style="width:646px;height:1166px;background:#FFFFFF;" version="1.1" viewBox="0 0 646 1166" width="646px" zoomAndPan="magnify" class="diagram"><defs/><g><g><title>EHR System</title><rect fill="#F1F1F1" height="109.5313" style="stroke:#181818;stroke-width:1;" width="10" x="172.125" y="163.6953"/></g><g><title>SMART App</title><rect fill="#F1F1F1" height="291.4609" style="stroke:#181818;stroke-width:1;" width="10" x="330.5864" y="273.2266"/></g><g><title>SMART App</title><rect fill="#F1F1F1" height="311.5938" style="stroke:#181818;stroke-width:1;" width="10" x="330.5864" y="744.6172"/></g><g><title>Authorization</title><rect fill="#F1F1F1" height="179.9297" style="stroke:#181818;stroke-width:1;" width="10" x="467.0894" y="564.6875"/></g><g><title>Authorization</title><rect fill="#F1F1F1" height="63.3984" style="stroke:#181818;stroke-width:1;" width="10" x="467.0894" y="828.0156"/></g><g><title>FHIR API</title><rect fill="#F1F1F1" height="63.3984" style="stroke:#181818;stroke-width:1;" width="10" x="581.4912" y="356.625"/></g><g><title>FHIR API</title><rect fill="#F1F1F1" height="48.2656" style="stroke:#181818;stroke-width:1;" width="10" x="581.4912" y="974.8125"/></g><rect fill="none" height="178.9297" style="stroke:#000000;stroke-width:1.5;" width="389.8979" x="10" y="102.2969"/><rect fill="none" height="132.7969" style="stroke:#000000;stroke-width:1.5;" width="368.7339" x="271.2749" y="295.2266"/><rect fill="none" height="130.6641" style="stroke:#000000;stroke-width:1.5;" width="271.6987" x="271.2749" y="442.0234"/><rect fill="none" height="165.9297" style="stroke:#000000;stroke-width:1.5;" width="532.9736" x="10" y="586.6875"/><rect fill="none" height="132.7969" style="stroke:#000000;stroke-width:1.5;" width="271.6987" x="271.2749" y="766.6172"/><rect fill="none" height="150.7969" style="stroke:#000000;stroke-width:1.5;" width="630.0088" x="10" y="913.4141"/><g><title>Clinician</title><rect fill="#000000" fill-opacity="0.00000" height="995.9141" width="8" x="50.6782" y="85.2969"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="54" x2="54" y1="85.2969" y2="1081.2109"/></g><g><title>EHR System</title><rect fill="#000000" fill-opacity="0.00000" height="995.9141" width="8" x="173.125" y="85.2969"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="176.2466" x2="176.2466" y1="85.2969" y2="1081.2109"/></g><g><title>SMART App</title><rect fill="#000000" fill-opacity="0.00000" height="995.9141" width="8" x="331.5864" y="85.2969"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="335.2749" x2="335.2749" y1="85.2969" y2="1081.2109"/></g><g><title>Authorization</title><rect fill="#000000" fill-opacity="0.00000" height="995.9141" width="8" x="468.0894" y="85.2969"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="471.2051" x2="471.2051" y1="85.2969" y2="1081.2109"/></g><g><title>FHIR API</title><rect fill="#000000" fill-opacity="0.00000" height="995.9141" width="8" x="582.4912" y="85.2969"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="585.9736" x2="585.9736" y1="85.2969" y2="1081.2109"/></g><g class="participant participant-head" data-participant="User"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="59.3564" x="22" y="79.9951">Clinician</text><ellipse cx="54.6782" cy="13.5" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M54.6782,21.5 L54.6782,48.5 M41.6782,29.5 L67.6782,29.5 M54.6782,48.5 L41.6782,63.5 M54.6782,48.5 L67.6782,63.5" fill="none" style="stroke:#181818;stroke-width:0.5;"/></g><g class="participant participant-tail" data-participant="User"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="59.3564" x="22" y="1095.2061">Clinician</text><ellipse cx="54.6782" cy="1109.0078" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M54.6782,1117.0078 L54.6782,1144.0078 M41.6782,1125.0078 L67.6782,1125.0078 M54.6782,1144.0078 L41.6782,1159.0078 M54.6782,1144.0078 L67.6782,1159.0078" fill="none" style="stroke:#181818;stroke-width:0.5;"/></g><g class="participant participant-head" data-participant="EHR"><rect fill="#E2E2F0" height="34.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="103.7568" x="125.2466" y="50"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="85.7568" x="134.2466" y="71.9951">EHR System</text></g><g class="participant participant-tail" data-participant="EHR"><rect fill="#E2E2F0" height="34.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="103.7568" x="125.2466" y="1080.2109"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="85.7568" x="134.2466" y="1102.2061">EHR System</text></g><g class="participant participant-head" data-participant="App"><rect fill="#E2E2F0" height="34.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="98.623" x="286.2749" y="50"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="80.623" x="295.2749" y="71.9951">SMART App</text></g><g class="participant participant-tail" data-participant="App"><rect fill="#E2E2F0" height="34.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="98.623" x="286.2749" y="1080.2109"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="80.623" x="295.2749" y="1102.2061">SMART App</text></g><g class="participant participant-head" data-participant="Auth"><rect fill="#E2E2F0" height="50.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="111.7686" x="416.2051" y="33.7031"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="93.7686" x="425.2051" y="55.6982">Authorization</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="45.9102" x="449.1343" y="71.9951">Server</text></g><g class="participant participant-tail" data-participant="Auth"><rect fill="#E2E2F0" height="50.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="111.7686" x="416.2051" y="1080.2109"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="93.7686" x="425.2051" y="1102.2061">Authorization</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="45.9102" x="449.1343" y="1118.5029">Server</text></g><g class="participant participant-head" data-participant="FHIR"><rect fill="#E2E2F0" height="50.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="77.0352" x="547.9736" y="33.7031"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="59.0352" x="556.9736" y="55.6982">FHIR API</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="45.9102" x="563.5361" y="71.9951">Server</text></g><g class="participant participant-tail" data-participant="FHIR"><rect fill="#E2E2F0" height="50.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="77.0352" x="547.9736" y="1080.2109"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="59.0352" x="556.9736" y="1102.2061">FHIR API</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="45.9102" x="563.5361" y="1118.5029">Server</text></g><g><title>EHR System</title><rect fill="#F1F1F1" height="109.5313" style="stroke:#181818;stroke-width:1;" width="10" x="172.125" y="163.6953"/></g><g><title>SMART App</title><rect fill="#F1F1F1" height="291.4609" style="stroke:#181818;stroke-width:1;" width="10" x="330.5864" y="273.2266"/></g><g><title>SMART App</title><rect fill="#F1F1F1" height="311.5938" style="stroke:#181818;stroke-width:1;" width="10" x="330.5864" y="744.6172"/></g><g><title>Authorization</title><rect fill="#F1F1F1" height="179.9297" style="stroke:#181818;stroke-width:1;" width="10" x="467.0894" y="564.6875"/></g><g><title>Authorization</title><rect fill="#F1F1F1" height="63.3984" style="stroke:#181818;stroke-width:1;" width="10" x="467.0894" y="828.0156"/></g><g><title>FHIR API</title><rect fill="#F1F1F1" height="63.3984" style="stroke:#181818;stroke-width:1;" width="10" x="581.4912" y="356.625"/></g><g><title>FHIR API</title><rect fill="#F1F1F1" height="48.2656" style="stroke:#181818;stroke-width:1;" width="10" x="581.4912" y="974.8125"/></g><path d="M10,102.2969 L111.5269,102.2969 L111.5269,113.4297 L101.5269,123.4297 L10,123.4297 L10,102.2969" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="178.9297" style="stroke:#000000;stroke-width:1.5;" width="389.8979" x="10" y="102.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="52.5269" x="27" y="117.3638">Launch</text><g class="message" data-participant-1="User" data-participant-2="EHR"><polygon fill="#181818" points="160.125,159.6953,170.125,163.6953,160.125,167.6953,164.125,163.6953" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="54.6782" x2="166.125" y1="163.6953" y2="163.6953"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="41.4946" x="63.6782" y="141.4966">Opens</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="105.1729" y="141.4966"> </text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="33.7949" x="109.3052" y="141.4966">chart</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="143.1001" y="141.4966"> </text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="10.8926" x="147.2324" y="141.4966">+</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="35.8198" x="63.6782" y="156.6294">clicks</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="99.498" y="156.6294"> </text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="24.4702" x="103.6304" y="156.6294">app</text></g><g class="message" data-participant-1="EHR" data-participant-2="EHR"><line style="stroke:#181818;stroke-width:1;" x1="182.125" x2="224.125" y1="211.9609" y2="211.9609"/><line style="stroke:#181818;stroke-width:1;" x1="224.125" x2="224.125" y1="211.9609" y2="224.9609"/><line style="stroke:#181818;stroke-width:1;" x1="183.125" x2="224.125" y1="224.9609" y2="224.9609"/><polygon fill="#181818" points="193.125,220.9609,183.125,224.9609,193.125,228.9609,189.125,224.9609" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="60.7153" x="191.125" y="189.7622">Generate</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="43.4434" x="191.125" y="204.895">launch</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="234.5684" y="204.895"> </text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="36.8164" x="238.7007" y="204.895">token</text></g><g class="message" data-participant-1="EHR" data-participant-2="App"><polygon fill="#181818" points="318.5864,269.2266,328.5864,273.2266,318.5864,277.2266,322.5864,273.2266" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="177.125" x2="324.5864" y1="273.2266" y2="273.2266"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="26.2285" x="186.125" y="251.0278">GET</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="125.4614" x="186.125" y="266.1606">/launch?iss&amp;launch</text></g><path d="M271.2749,295.2266 L392.0732,295.2266 L392.0732,306.3594 L382.0732,316.3594 L271.2749,316.3594 L271.2749,295.2266" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="132.7969" style="stroke:#000000;stroke-width:1.5;" width="368.7339" x="271.2749" y="295.2266"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="71.7983" x="288.2749" y="310.2935">Discovery</text><g class="message" data-participant-1="App" data-participant-2="FHIR"><polygon fill="#181818" points="569.4912,352.625,579.4912,356.625,569.4912,360.625,573.4912,356.625" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="340.5864" x2="575.4912" y1="356.625" y2="356.625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="26.2285" x="349.5864" y="334.4263">GET</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="214.7983" x="349.5864" y="349.5591">/.well-known/smart-configuration</text></g><g class="message" data-participant-1="FHIR" data-participant-2="App"><polygon fill="#181818" points="351.5864,416.0234,341.5864,420.0234,351.5864,424.0234,347.5864,420.0234" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="345.5864" x2="585.4912" y1="420.0234" y2="420.0234"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="43.9512" x="359.5864" y="382.6919">Return</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="64.416" x="359.5864" y="397.8247">endpoints</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="424.0024" y="397.8247"> </text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="10.8926" x="428.1348" y="397.8247">+</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="73.8994" x="359.5864" y="412.9575">capabilities</text></g><path d="M271.2749,442.0234 L420.0537,442.0234 L420.0537,453.1563 L410.0537,463.1563 L271.2749,463.1563 L271.2749,442.0234" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="130.6641" style="stroke:#000000;stroke-width:1.5;" width="271.6987" x="271.2749" y="442.0234"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="99.7788" x="288.2749" y="457.0903">Authorization</text><g class="message" data-participant-1="App" data-participant-2="App"><line style="stroke:#181818;stroke-width:1;" x1="340.5864" x2="382.5864" y1="503.4219" y2="503.4219"/><line style="stroke:#181818;stroke-width:1;" x1="382.5864" x2="382.5864" y1="503.4219" y2="516.4219"/><line style="stroke:#181818;stroke-width:1;" x1="341.5864" x2="382.5864" y1="516.4219" y2="516.4219"/><polygon fill="#181818" points="351.5864,512.4219,341.5864,516.4219,351.5864,520.4219,347.5864,516.4219" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="60.7153" x="349.5864" y="481.2231">Generate</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="410.3018" y="481.2231"> </text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="33.6553" x="414.4341" y="481.2231">PKCE</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="10.8926" x="349.5864" y="496.356">+</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="360.479" y="496.356"> </text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="32.9316" x="364.6113" y="496.356">state</text></g><g class="message" data-participant-1="App" data-participant-2="Auth"><polygon fill="#181818" points="455.0894,560.6875,465.0894,564.6875,455.0894,568.6875,459.0894,564.6875" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="335.5864" x2="461.0894" y1="564.6875" y2="564.6875"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="54.4819" x="344.5864" y="542.4888">Redirect</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="399.0684" y="542.4888"> </text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="13.0508" x="403.2007" y="542.4888">to</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="65.6538" x="344.5864" y="557.6216">/authorize</text></g><path d="M10,586.6875 L118.7505,586.6875 L118.7505,597.8203 L108.7505,607.8203 L10,607.8203 L10,586.6875" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="165.9297" style="stroke:#000000;stroke-width:1.5;" width="532.9736" x="10" y="586.6875"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="59.7505" x="27" y="601.7544">Consent</text><g class="message" data-participant-1="Auth" data-participant-2="User"><polygon fill="#181818" points="65.6782,644.0859,55.6782,648.0859,65.6782,652.0859,61.6782,648.0859" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="59.6782" x2="466.0894" y1="648.0859" y2="648.0859"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="35.2993" x="73.6782" y="625.8872">Login</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="108.9775" y="625.8872"> </text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="10.8926" x="113.1099" y="625.8872">+</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="51.4478" x="73.6782" y="641.02">consent</text></g><g class="message" data-participant-1="User" data-participant-2="Auth"><polygon fill="#181818" points="455.0894,692.3516,465.0894,696.3516,455.0894,700.3516,459.0894,696.3516" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="54.6782" x2="461.0894" y1="696.3516" y2="696.3516"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="73.9692" x="63.6782" y="674.1528">Credentials</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="137.6475" y="674.1528"> </text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="10.8926" x="141.7798" y="674.1528">+</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="57.04" x="63.6782" y="689.2856">approval</text></g><g class="message" data-participant-1="Auth" data-participant-2="App"><polygon fill="#181818" points="351.5864,740.6172,341.5864,744.6172,351.5864,748.6172,347.5864,744.6172" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="345.5864" x2="471.0894" y1="744.6172" y2="744.6172"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="54.4819" x="359.5864" y="722.4185">Redirect</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="414.0684" y="722.4185"> </text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="27.5806" x="418.2007" y="722.4185">with</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="31.3511" x="359.5864" y="737.5513">code</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="390.9375" y="737.5513"> </text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="10.8926" x="395.0698" y="737.5513">+</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="405.9624" y="737.5513"> </text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="32.9316" x="410.0947" y="737.5513">state</text></g><path d="M271.2749,766.6172 L439.6934,766.6172 L439.6934,777.75 L429.6934,787.75 L271.2749,787.75 L271.2749,766.6172" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="132.7969" style="stroke:#000000;stroke-width:1.5;" width="271.6987" x="271.2749" y="766.6172"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="119.4185" x="288.2749" y="781.6841">Token Exchange</text><g class="message" data-participant-1="App" data-participant-2="Auth"><polygon fill="#181818" points="455.0894,824.0156,465.0894,828.0156,455.0894,832.0156,459.0894,828.0156" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="340.5864" x2="461.0894" y1="828.0156" y2="828.0156"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="34.2646" x="349.5864" y="805.8169">POST</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="383.8511" y="805.8169"> </text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="41.1963" x="387.9834" y="805.8169">/token</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="27.5806" x="349.5864" y="820.9497">with</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="377.167" y="820.9497"> </text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="46.1792" x="381.2993" y="820.9497">verifier</text></g><g class="message" data-participant-1="Auth" data-participant-2="App"><polygon fill="#181818" points="351.5864,887.4141,341.5864,891.4141,351.5864,895.4141,347.5864,891.4141" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="345.5864" x2="471.0894" y1="891.4141" y2="891.4141"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="43.9512" x="359.5864" y="854.0825">Return</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="87.1216" x="359.5864" y="869.2153">access_token</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="10.8926" x="359.5864" y="884.3481">+</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="370.479" y="884.3481"> </text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="64.6255" x="374.6113" y="884.3481">patient_id</text></g><path d="M10,913.4141 L147.8989,913.4141 L147.8989,924.5469 L137.8989,934.5469 L10,934.5469 L10,913.4141" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="150.7969" style="stroke:#000000;stroke-width:1.5;" width="630.0088" x="10" y="913.4141"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="88.8989" x="27" y="928.481">FHIR Access</text><g class="message" data-participant-1="App" data-participant-2="FHIR"><polygon fill="#181818" points="569.4912,970.8125,579.4912,974.8125,569.4912,978.8125,573.4912,974.8125" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="340.5864" x2="575.4912" y1="974.8125" y2="974.8125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="26.2285" x="349.5864" y="952.6138">GET</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="375.8149" y="952.6138"> </text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="50.229" x="379.9473" y="952.6138">/Patient</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="430.1763" y="952.6138"> </text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="10.8926" x="434.3086" y="952.6138">+</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="83.5415" x="349.5864" y="967.7466">/Observation</text></g><g class="message" data-participant-1="FHIR" data-participant-2="App"><polygon fill="#181818" points="351.5864,1019.0781,341.5864,1023.0781,351.5864,1027.0781,347.5864,1023.0781" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="345.5864" x2="585.4912" y1="1023.0781" y2="1023.0781"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="43.9512" x="359.5864" y="1000.8794">Return</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="403.5376" y="1000.8794"> </text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="46.2617" x="407.6699" y="1000.8794">patient</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="10.8926" x="359.5864" y="1016.0122">+</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="370.479" y="1016.0122"> </text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="83.6558" x="374.6113" y="1016.0122">observations</text></g><g class="message" data-participant-1="App" data-participant-2="User"><polygon fill="#181818" points="65.6782,1052.2109,55.6782,1056.2109,65.6782,1060.2109,61.6782,1056.2109" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="59.6782" x2="334.5864" y1="1056.2109" y2="1056.2109"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="47.9185" x="73.6782" y="1049.145">Display</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="121.5967" y="1049.145"> </text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="29.2817" x="125.729" y="1049.145">data</text></g></g></svg></div><div class="puml dark" style=""><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="SEQUENCE" height="1166px" preserveAspectRatio="xMidYMid meet" style="width:646px;height:1166px;background:#1B1B1B;" version="1.1" viewBox="0 0 646 1166" width="646px" zoomAndPan="magnify" class="diagram"><defs/><g><rect fill="#1B1B1B" height="1166" style="stroke:none;stroke-width:1;" width="646" x="0" y="0"/><g><title>EHR System</title><rect fill="#313139" height="109.5313" style="stroke:#E7E7E7;stroke-width:1;" width="10" x="172.125" y="163.6953"/></g><g><title>SMART App</title><rect fill="#313139" height="291.4609" style="stroke:#E7E7E7;stroke-width:1;" width="10" x="330.5864" y="273.2266"/></g><g><title>SMART App</title><rect fill="#313139" height="311.5938" style="stroke:#E7E7E7;stroke-width:1;" width="10" x="330.5864" y="744.6172"/></g><g><title>Authorization</title><rect fill="#313139" height="179.9297" style="stroke:#E7E7E7;stroke-width:1;" width="10" x="467.0894" y="564.6875"/></g><g><title>Authorization</title><rect fill="#313139" height="63.3984" style="stroke:#E7E7E7;stroke-width:1;" width="10" x="467.0894" y="828.0156"/></g><g><title>FHIR API</title><rect fill="#313139" height="63.3984" style="stroke:#E7E7E7;stroke-width:1;" width="10" x="581.4912" y="356.625"/></g><g><title>FHIR API</title><rect fill="#313139" height="48.2656" style="stroke:#E7E7E7;stroke-width:1;" width="10" x="581.4912" y="974.8125"/></g><rect fill="none" height="178.9297" style="stroke:#FFFFFF;stroke-width:1.5;" width="389.8979" x="10" y="102.2969"/><rect fill="none" height="132.7969" style="stroke:#FFFFFF;stroke-width:1.5;" width="368.7339" x="271.2749" y="295.2266"/><rect fill="none" height="130.6641" style="stroke:#FFFFFF;stroke-width:1.5;" width="271.6987" x="271.2749" y="442.0234"/><rect fill="none" height="165.9297" style="stroke:#FFFFFF;stroke-width:1.5;" width="532.9736" x="10" y="586.6875"/><rect fill="none" height="132.7969" style="stroke:#FFFFFF;stroke-width:1.5;" width="271.6987" x="271.2749" y="766.6172"/><rect fill="none" height="150.7969" style="stroke:#FFFFFF;stroke-width:1.5;" width="630.0088" x="10" y="913.4141"/><g><title>Clinician</title><rect fill="#000000" fill-opacity="0.00000" height="995.9141" width="8" x="50.6782" y="85.2969"/><line style="stroke:#E7E7E7;stroke-width:0.5;stroke-dasharray:5,5;" x1="54" x2="54" y1="85.2969" y2="1081.2109"/></g><g><title>EHR System</title><rect fill="#000000" fill-opacity="0.00000" height="995.9141" width="8" x="173.125" y="85.2969"/><line style="stroke:#E7E7E7;stroke-width:0.5;stroke-dasharray:5,5;" x1="176.2466" x2="176.2466" y1="85.2969" y2="1081.2109"/></g><g><title>SMART App</title><rect fill="#000000" fill-opacity="0.00000" height="995.9141" width="8" x="331.5864" y="85.2969"/><line style="stroke:#E7E7E7;stroke-width:0.5;stroke-dasharray:5,5;" x1="335.2749" x2="335.2749" y1="85.2969" y2="1081.2109"/></g><g><title>Authorization</title><rect fill="#000000" fill-opacity="0.00000" height="995.9141" width="8" x="468.0894" y="85.2969"/><line style="stroke:#E7E7E7;stroke-width:0.5;stroke-dasharray:5,5;" x1="471.2051" x2="471.2051" y1="85.2969" y2="1081.2109"/></g><g><title>FHIR API</title><rect fill="#000000" fill-opacity="0.00000" height="995.9141" width="8" x="582.4912" y="85.2969"/><line style="stroke:#E7E7E7;stroke-width:0.5;stroke-dasharray:5,5;" x1="585.9736" x2="585.9736" y1="85.2969" y2="1081.2109"/></g><g class="participant participant-head" data-participant="User"><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="59.3564" x="22" y="79.9951">Clinician</text><ellipse cx="54.6782" cy="13.5" fill="#222222" rx="8" ry="8" style="stroke:#E7E7E7;stroke-width:0.5;"/><path d="M54.6782,21.5 L54.6782,48.5 M41.6782,29.5 L67.6782,29.5 M54.6782,48.5 L41.6782,63.5 M54.6782,48.5 L67.6782,63.5" fill="none" style="stroke:#E7E7E7;stroke-width:0.5;"/></g><g class="participant participant-tail" data-participant="User"><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="59.3564" x="22" y="1095.2061">Clinician</text><ellipse cx="54.6782" cy="1109.0078" fill="#222222" rx="8" ry="8" style="stroke:#E7E7E7;stroke-width:0.5;"/><path d="M54.6782,1117.0078 L54.6782,1144.0078 M41.6782,1125.0078 L67.6782,1125.0078 M54.6782,1144.0078 L41.6782,1159.0078 M54.6782,1144.0078 L67.6782,1159.0078" fill="none" style="stroke:#E7E7E7;stroke-width:0.5;"/></g><g class="participant participant-head" data-participant="EHR"><rect fill="#222222" height="34.2969" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="103.7568" x="125.2466" y="50"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="85.7568" x="134.2466" y="71.9951">EHR System</text></g><g class="participant participant-tail" data-participant="EHR"><rect fill="#222222" height="34.2969" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="103.7568" x="125.2466" y="1080.2109"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="85.7568" x="134.2466" y="1102.2061">EHR System</text></g><g class="participant participant-head" data-participant="App"><rect fill="#222222" height="34.2969" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="98.623" x="286.2749" y="50"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="80.623" x="295.2749" y="71.9951">SMART App</text></g><g class="participant participant-tail" data-participant="App"><rect fill="#222222" height="34.2969" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="98.623" x="286.2749" y="1080.2109"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="80.623" x="295.2749" y="1102.2061">SMART App</text></g><g class="participant participant-head" data-participant="Auth"><rect fill="#222222" height="50.5938" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="111.7686" x="416.2051" y="33.7031"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="93.7686" x="425.2051" y="55.6982">Authorization</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="45.9102" x="449.1343" y="71.9951">Server</text></g><g class="participant participant-tail" data-participant="Auth"><rect fill="#222222" height="50.5938" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="111.7686" x="416.2051" y="1080.2109"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="93.7686" x="425.2051" y="1102.2061">Authorization</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="45.9102" x="449.1343" y="1118.5029">Server</text></g><g class="participant participant-head" data-participant="FHIR"><rect fill="#222222" height="50.5938" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="77.0352" x="547.9736" y="33.7031"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="59.0352" x="556.9736" y="55.6982">FHIR API</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="45.9102" x="563.5361" y="71.9951">Server</text></g><g class="participant participant-tail" data-participant="FHIR"><rect fill="#222222" height="50.5938" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="77.0352" x="547.9736" y="1080.2109"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="59.0352" x="556.9736" y="1102.2061">FHIR API</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="45.9102" x="563.5361" y="1118.5029">Server</text></g><g><title>EHR System</title><rect fill="#313139" height="109.5313" style="stroke:#E7E7E7;stroke-width:1;" width="10" x="172.125" y="163.6953"/></g><g><title>SMART App</title><rect fill="#313139" height="291.4609" style="stroke:#E7E7E7;stroke-width:1;" width="10" x="330.5864" y="273.2266"/></g><g><title>SMART App</title><rect fill="#313139" height="311.5938" style="stroke:#E7E7E7;stroke-width:1;" width="10" x="330.5864" y="744.6172"/></g><g><title>Authorization</title><rect fill="#313139" height="179.9297" style="stroke:#E7E7E7;stroke-width:1;" width="10" x="467.0894" y="564.6875"/></g><g><title>Authorization</title><rect fill="#313139" height="63.3984" style="stroke:#E7E7E7;stroke-width:1;" width="10" x="467.0894" y="828.0156"/></g><g><title>FHIR API</title><rect fill="#313139" height="63.3984" style="stroke:#E7E7E7;stroke-width:1;" width="10" x="581.4912" y="356.625"/></g><g><title>FHIR API</title><rect fill="#313139" height="48.2656" style="stroke:#E7E7E7;stroke-width:1;" width="10" x="581.4912" y="974.8125"/></g><path d="M10,102.2969 L111.5269,102.2969 L111.5269,113.4297 L101.5269,123.4297 L10,123.4297 L10,102.2969" fill="#555555" style="stroke:#FFFFFF;stroke-width:1.5;"/><rect fill="none" height="178.9297" style="stroke:#FFFFFF;stroke-width:1.5;" width="389.8979" x="10" y="102.2969"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="52.5269" x="27" y="117.3638">Launch</text><g class="message" data-participant-1="User" data-participant-2="EHR"><polygon fill="#E7E7E7" points="160.125,159.6953,170.125,163.6953,160.125,167.6953,164.125,163.6953" style="stroke:#E7E7E7;stroke-width:1;"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="54.6782" x2="166.125" y1="163.6953" y2="163.6953"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="41.4946" x="63.6782" y="141.4966">Opens</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="105.1729" y="141.4966"> </text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="33.7949" x="109.3052" y="141.4966">chart</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="143.1001" y="141.4966"> </text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="10.8926" x="147.2324" y="141.4966">+</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="35.8198" x="63.6782" y="156.6294">clicks</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="99.498" y="156.6294"> </text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="24.4702" x="103.6304" y="156.6294">app</text></g><g class="message" data-participant-1="EHR" data-participant-2="EHR"><line style="stroke:#E7E7E7;stroke-width:1;" x1="182.125" x2="224.125" y1="211.9609" y2="211.9609"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="224.125" x2="224.125" y1="211.9609" y2="224.9609"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="183.125" x2="224.125" y1="224.9609" y2="224.9609"/><polygon fill="#E7E7E7" points="193.125,220.9609,183.125,224.9609,193.125,228.9609,189.125,224.9609" style="stroke:#E7E7E7;stroke-width:1;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="60.7153" x="191.125" y="189.7622">Generate</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="43.4434" x="191.125" y="204.895">launch</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="234.5684" y="204.895"> </text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="36.8164" x="238.7007" y="204.895">token</text></g><g class="message" data-participant-1="EHR" data-participant-2="App"><polygon fill="#E7E7E7" points="318.5864,269.2266,328.5864,273.2266,318.5864,277.2266,322.5864,273.2266" style="stroke:#E7E7E7;stroke-width:1;"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="177.125" x2="324.5864" y1="273.2266" y2="273.2266"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="26.2285" x="186.125" y="251.0278">GET</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="125.4614" x="186.125" y="266.1606">/launch?iss&amp;launch</text></g><path d="M271.2749,295.2266 L392.0732,295.2266 L392.0732,306.3594 L382.0732,316.3594 L271.2749,316.3594 L271.2749,295.2266" fill="#555555" style="stroke:#FFFFFF;stroke-width:1.5;"/><rect fill="none" height="132.7969" style="stroke:#FFFFFF;stroke-width:1.5;" width="368.7339" x="271.2749" y="295.2266"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="71.7983" x="288.2749" y="310.2935">Discovery</text><g class="message" data-participant-1="App" data-participant-2="FHIR"><polygon fill="#E7E7E7" points="569.4912,352.625,579.4912,356.625,569.4912,360.625,573.4912,356.625" style="stroke:#E7E7E7;stroke-width:1;"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="340.5864" x2="575.4912" y1="356.625" y2="356.625"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="26.2285" x="349.5864" y="334.4263">GET</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="214.7983" x="349.5864" y="349.5591">/.well-known/smart-configuration</text></g><g class="message" data-participant-1="FHIR" data-participant-2="App"><polygon fill="#E7E7E7" points="351.5864,416.0234,341.5864,420.0234,351.5864,424.0234,347.5864,420.0234" style="stroke:#E7E7E7;stroke-width:1;"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="345.5864" x2="585.4912" y1="420.0234" y2="420.0234"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="43.9512" x="359.5864" y="382.6919">Return</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="64.416" x="359.5864" y="397.8247">endpoints</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="424.0024" y="397.8247"> </text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="10.8926" x="428.1348" y="397.8247">+</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="73.8994" x="359.5864" y="412.9575">capabilities</text></g><path d="M271.2749,442.0234 L420.0537,442.0234 L420.0537,453.1563 L410.0537,463.1563 L271.2749,463.1563 L271.2749,442.0234" fill="#555555" style="stroke:#FFFFFF;stroke-width:1.5;"/><rect fill="none" height="130.6641" style="stroke:#FFFFFF;stroke-width:1.5;" width="271.6987" x="271.2749" y="442.0234"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="99.7788" x="288.2749" y="457.0903">Authorization</text><g class="message" data-participant-1="App" data-participant-2="App"><line style="stroke:#E7E7E7;stroke-width:1;" x1="340.5864" x2="382.5864" y1="503.4219" y2="503.4219"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="382.5864" x2="382.5864" y1="503.4219" y2="516.4219"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="341.5864" x2="382.5864" y1="516.4219" y2="516.4219"/><polygon fill="#E7E7E7" points="351.5864,512.4219,341.5864,516.4219,351.5864,520.4219,347.5864,516.4219" style="stroke:#E7E7E7;stroke-width:1;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="60.7153" x="349.5864" y="481.2231">Generate</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="410.3018" y="481.2231"> </text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="33.6553" x="414.4341" y="481.2231">PKCE</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="10.8926" x="349.5864" y="496.356">+</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="360.479" y="496.356"> </text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="32.9316" x="364.6113" y="496.356">state</text></g><g class="message" data-participant-1="App" data-participant-2="Auth"><polygon fill="#E7E7E7" points="455.0894,560.6875,465.0894,564.6875,455.0894,568.6875,459.0894,564.6875" style="stroke:#E7E7E7;stroke-width:1;"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="335.5864" x2="461.0894" y1="564.6875" y2="564.6875"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="54.4819" x="344.5864" y="542.4888">Redirect</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="399.0684" y="542.4888"> </text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="13.0508" x="403.2007" y="542.4888">to</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="65.6538" x="344.5864" y="557.6216">/authorize</text></g><path d="M10,586.6875 L118.7505,586.6875 L118.7505,597.8203 L108.7505,607.8203 L10,607.8203 L10,586.6875" fill="#555555" style="stroke:#FFFFFF;stroke-width:1.5;"/><rect fill="none" height="165.9297" style="stroke:#FFFFFF;stroke-width:1.5;" width="532.9736" x="10" y="586.6875"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="59.7505" x="27" y="601.7544">Consent</text><g class="message" data-participant-1="Auth" data-participant-2="User"><polygon fill="#E7E7E7" points="65.6782,644.0859,55.6782,648.0859,65.6782,652.0859,61.6782,648.0859" style="stroke:#E7E7E7;stroke-width:1;"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="59.6782" x2="466.0894" y1="648.0859" y2="648.0859"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="35.2993" x="73.6782" y="625.8872">Login</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="108.9775" y="625.8872"> </text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="10.8926" x="113.1099" y="625.8872">+</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="51.4478" x="73.6782" y="641.02">consent</text></g><g class="message" data-participant-1="User" data-participant-2="Auth"><polygon fill="#E7E7E7" points="455.0894,692.3516,465.0894,696.3516,455.0894,700.3516,459.0894,696.3516" style="stroke:#E7E7E7;stroke-width:1;"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="54.6782" x2="461.0894" y1="696.3516" y2="696.3516"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="73.9692" x="63.6782" y="674.1528">Credentials</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="137.6475" y="674.1528"> </text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="10.8926" x="141.7798" y="674.1528">+</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="57.04" x="63.6782" y="689.2856">approval</text></g><g class="message" data-participant-1="Auth" data-participant-2="App"><polygon fill="#E7E7E7" points="351.5864,740.6172,341.5864,744.6172,351.5864,748.6172,347.5864,744.6172" style="stroke:#E7E7E7;stroke-width:1;"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="345.5864" x2="471.0894" y1="744.6172" y2="744.6172"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="54.4819" x="359.5864" y="722.4185">Redirect</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="414.0684" y="722.4185"> </text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="27.5806" x="418.2007" y="722.4185">with</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="31.3511" x="359.5864" y="737.5513">code</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="390.9375" y="737.5513"> </text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="10.8926" x="395.0698" y="737.5513">+</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="405.9624" y="737.5513"> </text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="32.9316" x="410.0947" y="737.5513">state</text></g><path d="M271.2749,766.6172 L439.6934,766.6172 L439.6934,777.75 L429.6934,787.75 L271.2749,787.75 L271.2749,766.6172" fill="#555555" style="stroke:#FFFFFF;stroke-width:1.5;"/><rect fill="none" height="132.7969" style="stroke:#FFFFFF;stroke-width:1.5;" width="271.6987" x="271.2749" y="766.6172"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="119.4185" x="288.2749" y="781.6841">Token Exchange</text><g class="message" data-participant-1="App" data-participant-2="Auth"><polygon fill="#E7E7E7" points="455.0894,824.0156,465.0894,828.0156,455.0894,832.0156,459.0894,828.0156" style="stroke:#E7E7E7;stroke-width:1;"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="340.5864" x2="461.0894" y1="828.0156" y2="828.0156"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="34.2646" x="349.5864" y="805.8169">POST</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="383.8511" y="805.8169"> </text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="41.1963" x="387.9834" y="805.8169">/token</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="27.5806" x="349.5864" y="820.9497">with</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="377.167" y="820.9497"> </text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="46.1792" x="381.2993" y="820.9497">verifier</text></g><g class="message" data-participant-1="Auth" data-participant-2="App"><polygon fill="#E7E7E7" points="351.5864,887.4141,341.5864,891.4141,351.5864,895.4141,347.5864,891.4141" style="stroke:#E7E7E7;stroke-width:1;"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="345.5864" x2="471.0894" y1="891.4141" y2="891.4141"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="43.9512" x="359.5864" y="854.0825">Return</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="87.1216" x="359.5864" y="869.2153">access_token</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="10.8926" x="359.5864" y="884.3481">+</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="370.479" y="884.3481"> </text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="64.6255" x="374.6113" y="884.3481">patient_id</text></g><path d="M10,913.4141 L147.8989,913.4141 L147.8989,924.5469 L137.8989,934.5469 L10,934.5469 L10,913.4141" fill="#555555" style="stroke:#FFFFFF;stroke-width:1.5;"/><rect fill="none" height="150.7969" style="stroke:#FFFFFF;stroke-width:1.5;" width="630.0088" x="10" y="913.4141"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="88.8989" x="27" y="928.481">FHIR Access</text><g class="message" data-participant-1="App" data-participant-2="FHIR"><polygon fill="#E7E7E7" points="569.4912,970.8125,579.4912,974.8125,569.4912,978.8125,573.4912,974.8125" style="stroke:#E7E7E7;stroke-width:1;"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="340.5864" x2="575.4912" y1="974.8125" y2="974.8125"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="26.2285" x="349.5864" y="952.6138">GET</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="375.8149" y="952.6138"> </text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="50.229" x="379.9473" y="952.6138">/Patient</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="430.1763" y="952.6138"> </text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="10.8926" x="434.3086" y="952.6138">+</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="83.5415" x="349.5864" y="967.7466">/Observation</text></g><g class="message" data-participant-1="FHIR" data-participant-2="App"><polygon fill="#E7E7E7" points="351.5864,1019.0781,341.5864,1023.0781,351.5864,1027.0781,347.5864,1023.0781" style="stroke:#E7E7E7;stroke-width:1;"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="345.5864" x2="585.4912" y1="1023.0781" y2="1023.0781"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="43.9512" x="359.5864" y="1000.8794">Return</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="403.5376" y="1000.8794"> </text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="46.2617" x="407.6699" y="1000.8794">patient</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="10.8926" x="359.5864" y="1016.0122">+</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="370.479" y="1016.0122"> </text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="83.6558" x="374.6113" y="1016.0122">observations</text></g><g class="message" data-participant-1="App" data-participant-2="User"><polygon fill="#E7E7E7" points="65.6782,1052.2109,55.6782,1056.2109,65.6782,1060.2109,61.6782,1056.2109" style="stroke:#E7E7E7;stroke-width:1;"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="59.6782" x2="334.5864" y1="1056.2109" y2="1056.2109"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="47.9185" x="73.6782" y="1049.145">Display</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="121.5967" y="1049.145"> </text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="29.2817" x="125.729" y="1049.145">data</text></g></g></svg></div></div>
<h2 id="smart-on-fhir-standalone-launch-flow">SMART-on-FHIR Standalone Launch Flow</h2>
<div class="puml-container"><div class="puml light" style=""><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="SEQUENCE" height="1257px" preserveAspectRatio="xMidYMid meet" style="width:768px;height:1257px;background:#FFFFFF;" version="1.1" viewBox="0 0 768 1257" width="768px" zoomAndPan="magnify" class="diagram"><title>SMART-on-FHIR Standalone Launch Flow</title><defs/><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="321.2959" x="219.6042" y="27.9951">SMART-on-FHIR Standalone Launch Flow</text><g><title>SMART App</title><rect fill="#F1F1F1" height="470.7891" style="stroke:#181818;stroke-width:1;" width="10" x="199.0801" y="207.9922"/></g><g><title>SMART App</title><rect fill="#F1F1F1" height="262.1953" style="stroke:#181818;stroke-width:1;" width="10" x="199.0801" y="896.8438"/></g><g><title>FHIR Server</title><rect fill="#F1F1F1" height="44.2656" style="stroke:#181818;stroke-width:1;" width="10" x="473.2393" y="353.6563"/></g><g><title>FHIR Server</title><rect fill="#F1F1F1" height="29.1328" style="stroke:#181818;stroke-width:1;" width="10" x="473.2393" y="1100.7734"/></g><g><title>Authorization</title><rect fill="#F1F1F1" height="218.0625" style="stroke:#181818;stroke-width:1;" width="10" x="585.522" y="678.7813"/></g><g><title>Authorization</title><rect fill="#F1F1F1" height="44.2656" style="stroke:#181818;stroke-width:1;" width="10" x="585.522" y="969.1094"/></g><g><title>User</title><rect fill="#000000" fill-opacity="0.00000" height="1058.4453" width="8" x="19.9551" y="118.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="23" x2="23" y1="118.5938" y2="1177.0391"/></g><g><title>SMART App</title><rect fill="#000000" fill-opacity="0.00000" height="1058.4453" width="8" x="200.0801" y="118.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="203.7686" x2="203.7686" y1="118.5938" y2="1177.0391"/></g><g><title>FHIR Server</title><rect fill="#000000" fill-opacity="0.00000" height="1058.4453" width="8" x="474.2393" y="118.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="477.8408" x2="477.8408" y1="118.5938" y2="1177.0391"/></g><g><title>Authorization</title><rect fill="#000000" fill-opacity="0.00000" height="1058.4453" width="8" x="586.522" y="118.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="589.6377" x2="589.6377" y1="118.5938" y2="1177.0391"/></g><g class="participant participant-head" data-participant="User"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="31.9102" x="5" y="115.292">User</text><ellipse cx="23.9551" cy="50.7969" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M23.9551,58.7969 L23.9551,85.7969 M10.9551,66.7969 L36.9551,66.7969 M23.9551,85.7969 L10.9551,100.7969 M23.9551,85.7969 L36.9551,100.7969" fill="none" style="stroke:#181818;stroke-width:0.5;"/></g><g class="participant participant-tail" data-participant="User"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="31.9102" x="5" y="1189.0342">User</text><ellipse cx="23.9551" cy="1200.8359" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M23.9551,1208.8359 L23.9551,1235.8359 M10.9551,1216.8359 L36.9551,1216.8359 M23.9551,1235.8359 L10.9551,1250.8359 M23.9551,1235.8359 L36.9551,1250.8359" fill="none" style="stroke:#181818;stroke-width:0.5;"/></g><g class="participant participant-head" data-participant="App"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="94.623" x="156.7686" y="87.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="80.623" x="163.7686" y="107.292">SMART App</text></g><g class="participant participant-tail" data-participant="App"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="94.623" x="156.7686" y="1176.0391"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="80.623" x="163.7686" y="1196.0342">SMART App</text></g><g class="participant participant-head" data-participant="FHIR"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="96.7969" x="429.8408" y="87.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="82.7969" x="436.8408" y="107.292">FHIR Server</text></g><g class="participant participant-tail" data-participant="FHIR"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="96.7969" x="429.8408" y="1176.0391"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="82.7969" x="436.8408" y="1196.0342">FHIR Server</text></g><g class="participant participant-head" data-participant="Auth"><rect fill="#E2E2F0" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="107.7686" x="536.6377" y="71"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="93.7686" x="543.6377" y="90.9951">Authorization</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="45.9102" x="567.5669" y="107.292">Server</text></g><g class="participant participant-tail" data-participant="Auth"><rect fill="#E2E2F0" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="107.7686" x="536.6377" y="1176.0391"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="93.7686" x="543.6377" y="1196.0342">Authorization</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="45.9102" x="567.5669" y="1212.3311">Server</text></g><g><title>SMART App</title><rect fill="#F1F1F1" height="470.7891" style="stroke:#181818;stroke-width:1;" width="10" x="199.0801" y="207.9922"/></g><g><title>SMART App</title><rect fill="#F1F1F1" height="262.1953" style="stroke:#181818;stroke-width:1;" width="10" x="199.0801" y="896.8438"/></g><g><title>FHIR Server</title><rect fill="#F1F1F1" height="44.2656" style="stroke:#181818;stroke-width:1;" width="10" x="473.2393" y="353.6563"/></g><g><title>FHIR Server</title><rect fill="#F1F1F1" height="29.1328" style="stroke:#181818;stroke-width:1;" width="10" x="473.2393" y="1100.7734"/></g><g><title>Authorization</title><rect fill="#F1F1F1" height="218.0625" style="stroke:#181818;stroke-width:1;" width="10" x="585.522" y="678.7813"/></g><g><title>Authorization</title><rect fill="#F1F1F1" height="44.2656" style="stroke:#181818;stroke-width:1;" width="10" x="585.522" y="969.1094"/></g><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="761.5044" x="0" y="149.1602"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="761.5044" y1="149.1602" y2="149.1602"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="761.5044" y1="152.1602" y2="152.1602"/><rect fill="#EEEEEE" height="23.1328" style="stroke:#000000;stroke-width:2;" width="118.5713" x="321.4666" y="138.5938"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="100.0454" x="327.4666" y="154.6606">App Initiation</text><g class="message" data-participant-1="User" data-participant-2="App"><polygon fill="#181818" points="187.0801,203.9922,197.0801,207.9922,187.0801,211.9922,191.0801,207.9922" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="23.9551" x2="193.0801" y1="207.9922" y2="207.9922"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="122.9858" x="30.9551" y="187.7935">Opens app directly</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="97.2588" x="30.9551" y="202.9263">(not from EHR)</text></g><g class="message" data-participant-1="App" data-participant-2="User"><polygon fill="#181818" points="34.9551,248.2578,24.9551,252.2578,34.9551,256.2578,30.9551,252.2578" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="28.9551" x2="198.0801" y1="252.2578" y2="252.2578"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="103.4097" x="40.9551" y="232.0591">Prompt for FHIR</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="71.0747" x="40.9551" y="247.1919">server URL</text></g><g class="message" data-participant-1="User" data-participant-2="App"><polygon fill="#181818" points="187.0801,277.3906,197.0801,281.3906,187.0801,285.3906,191.0801,281.3906" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="23.9551" x2="193.0801" y1="281.3906" y2="281.3906"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="151.125" x="30.9551" y="276.3247">Enters FHIR server URL</text></g><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="761.5044" x="0" y="309.957"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="761.5044" y1="309.957" y2="309.957"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="761.5044" y1="312.957" y2="312.957"/><rect fill="#EEEEEE" height="23.1328" style="stroke:#000000;stroke-width:2;" width="90.3242" x="335.5901" y="299.3906"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="71.7983" x="341.5901" y="315.4575">Discovery</text><g class="message" data-participant-1="App" data-participant-2="FHIR"><polygon fill="#181818" points="461.2393,349.6563,471.2393,353.6563,461.2393,357.6563,465.2393,353.6563" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="209.0801" x2="467.2393" y1="353.6563" y2="353.6563"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="245.1592" x="216.0801" y="348.5903">GET /.well-known/smart-configuration</text></g><g class="message" data-participant-1="FHIR" data-participant-2="App"><polygon fill="#181818" points="220.0801,393.9219,210.0801,397.9219,220.0801,401.9219,216.0801,397.9219" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="214.0801" x2="477.2393" y1="397.9219" y2="397.9219"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="135.7002" x="226.0801" y="377.7231">SMART configuration</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="166.8608" x="226.0801" y="392.856">(endpoints &amp; capabilities)</text></g><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="761.5044" x="0" y="426.4883"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="761.5044" y1="426.4883" y2="426.4883"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="761.5044" y1="429.4883" y2="429.4883"/><rect fill="#EEEEEE" height="23.1328" style="stroke:#000000;stroke-width:2;" width="118.3047" x="321.5999" y="415.9219"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="99.7788" x="327.5999" y="431.9888">Authorization</text><g class="message" data-participant-1="App" data-participant-2="App"><line style="stroke:#181818;stroke-width:1;" x1="209.0801" x2="251.0801" y1="470.1875" y2="470.1875"/><line style="stroke:#181818;stroke-width:1;" x1="251.0801" x2="251.0801" y1="470.1875" y2="483.1875"/><line style="stroke:#181818;stroke-width:1;" x1="210.0801" x2="251.0801" y1="483.1875" y2="483.1875"/><polygon fill="#181818" points="220.0801,479.1875,210.0801,483.1875,220.0801,487.1875,216.0801,483.1875" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="178.0391" x="216.0801" y="465.1216">Generate PKCE parameters</text></g><g class="message" data-participant-1="App" data-participant-2="Auth"><polygon fill="#181818" points="573.522,674.7813,583.522,678.7813,573.522,682.7813,577.522,678.7813" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="204.0801" x2="579.522" y1="678.7813" y2="678.7813"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="148.3511" x="211.0801" y="507.2544">Redirect to /authorize?</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="148.916" x="211.0801" y="522.3872">• response_type=code</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="105.168" x="211.0801" y="537.52">• client_id={id}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="166.9561" x="211.0801" y="552.6528">• redirect_uri={callback}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="151.6519" x="211.0801" y="567.7856">• scope=patient/*.read</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="99.8423" x="219.3447" y="582.9185">openid fhirUser</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="105.0981" x="211.0801" y="598.0513">• state={state}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="107.3516" x="211.0801" y="613.1841">• aud={fhir-url}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="203.2139" x="211.0801" y="628.3169">• code_challenge={challenge}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="213.3765" x="211.0801" y="643.4497">• code_challenge_method=S256</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="211.0801" y="658.5825"> </text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="187.8525" x="211.0801" y="673.7153">NOTE: No launch parameter!</text></g><g class="message" data-participant-1="Auth" data-participant-2="User"><polygon fill="#181818" points="34.9551,703.9141,24.9551,707.9141,34.9551,711.9141,30.9551,707.9141" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="28.9551" x2="584.522" y1="707.9141" y2="707.9141"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="83.7192" x="40.9551" y="702.8481">Display login</text></g><g class="message" data-participant-1="User" data-participant-2="Auth"><polygon fill="#181818" points="573.522,733.0469,583.522,737.0469,573.522,741.0469,577.522,737.0469" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="23.9551" x2="579.522" y1="737.0469" y2="737.0469"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="83.624" x="30.9551" y="731.981">Authenticate</text></g><g class="message" data-participant-1="Auth" data-participant-2="User"><polygon fill="#181818" points="34.9551,777.3125,24.9551,781.3125,34.9551,785.3125,30.9551,781.3125" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="28.9551" x2="584.522" y1="781.3125" y2="781.3125"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="103.3462" x="40.9551" y="761.1138">Patient Picker</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="154.0005" x="40.9551" y="776.2466">(Select patient context)</text></g><g class="message" data-participant-1="User" data-participant-2="Auth"><polygon fill="#181818" points="573.522,806.4453,583.522,810.4453,573.522,814.4453,577.522,810.4453" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="23.9551" x2="579.522" y1="810.4453" y2="810.4453"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="97.2715" x="30.9551" y="805.3794">Selects patient</text></g><g class="message" data-participant-1="Auth" data-participant-2="Auth"><line style="stroke:#181818;stroke-width:1;" x1="595.522" x2="637.522" y1="854.7109" y2="854.7109"/><line style="stroke:#181818;stroke-width:1;" x1="637.522" x2="637.522" y1="854.7109" y2="867.7109"/><line style="stroke:#181818;stroke-width:1;" x1="596.522" x2="637.522" y1="867.7109" y2="867.7109"/><polygon fill="#181818" points="606.522,863.7109,596.522,867.7109,606.522,871.7109,602.522,867.7109" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="129.873" x="602.522" y="834.5122">Generate auth code</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="136.9824" x="602.522" y="849.645">with selected patient</text></g><g class="message" data-participant-1="Auth" data-participant-2="App"><polygon fill="#181818" points="220.0801,892.8438,210.0801,896.8438,220.0801,900.8438,216.0801,896.8438" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="214.0801" x2="589.522" y1="896.8438" y2="896.8438"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="173.0117" x="226.0801" y="891.7778">Redirect with code &amp; state</text></g><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="761.5044" x="0" y="925.4102"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="761.5044" y1="925.4102" y2="925.4102"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="761.5044" y1="928.4102" y2="928.4102"/><rect fill="#EEEEEE" height="23.1328" style="stroke:#000000;stroke-width:2;" width="137.9443" x="311.78" y="914.8438"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="119.4185" x="317.78" y="930.9106">Token Exchange</text><g class="message" data-participant-1="App" data-participant-2="Auth"><polygon fill="#181818" points="573.522,965.1094,583.522,969.1094,573.522,973.1094,577.522,969.1094" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="209.0801" x2="579.522" y1="969.1094" y2="969.1094"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="192.8862" x="216.0801" y="964.0435">POST /token (exchange code)</text></g><g class="message" data-participant-1="Auth" data-participant-2="App"><polygon fill="#181818" points="220.0801,1009.375,210.0801,1013.375,220.0801,1017.375,216.0801,1013.375" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="214.0801" x2="589.522" y1="1013.375" y2="1013.375"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="102.1465" x="226.0801" y="993.1763">access_token +</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="99.6201" x="226.0801" y="1008.3091">patient context</text></g><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="761.5044" x="0" y="1041.9414"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="761.5044" y1="1041.9414" y2="1041.9414"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="761.5044" y1="1044.9414" y2="1044.9414"/><rect fill="#EEEEEE" height="23.1328" style="stroke:#000000;stroke-width:2;" width="148.2402" x="306.6321" y="1031.375"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="129.7144" x="312.6321" y="1047.4419">Access Resources</text><g class="message" data-participant-1="App" data-participant-2="FHIR"><polygon fill="#181818" points="461.2393,1096.7734,471.2393,1100.7734,461.2393,1104.7734,465.2393,1100.7734" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="209.0801" x2="467.2393" y1="1100.7734" y2="1100.7734"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="115.4258" x="216.0801" y="1080.5747">FHIR API requests</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="118.8345" x="216.0801" y="1095.7075">with access_token</text></g><g class="message" data-participant-1="FHIR" data-participant-2="App"><polygon fill="#181818" points="220.0801,1125.9063,210.0801,1129.9063,220.0801,1133.9063,216.0801,1129.9063" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="214.0801" x2="477.2393" y1="1129.9063" y2="1129.9063"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="97.8237" x="226.0801" y="1124.8403">FHIR resources</text></g><g class="message" data-participant-1="App" data-participant-2="User"><polygon fill="#181818" points="34.9551,1155.0391,24.9551,1159.0391,34.9551,1163.0391,30.9551,1159.0391" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="28.9551" x2="203.0801" y1="1159.0391" y2="1159.0391"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="81.3325" x="40.9551" y="1153.9731">Display data</text></g></g></svg></div><div class="puml dark" style=""><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="SEQUENCE" height="1257px" preserveAspectRatio="xMidYMid meet" style="width:768px;height:1257px;background:#1B1B1B;" version="1.1" viewBox="0 0 768 1257" width="768px" zoomAndPan="magnify" class="diagram"><title>SMART-on-FHIR Standalone Launch Flow</title><defs/><g><rect fill="#1B1B1B" height="1257" style="stroke:none;stroke-width:1;" width="768" x="0" y="0"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="321.2959" x="219.6042" y="27.9951">SMART-on-FHIR Standalone Launch Flow</text><g><title>SMART App</title><rect fill="#313139" height="470.7891" style="stroke:#E7E7E7;stroke-width:1;" width="10" x="199.0801" y="207.9922"/></g><g><title>SMART App</title><rect fill="#313139" height="262.1953" style="stroke:#E7E7E7;stroke-width:1;" width="10" x="199.0801" y="896.8438"/></g><g><title>FHIR Server</title><rect fill="#313139" height="44.2656" style="stroke:#E7E7E7;stroke-width:1;" width="10" x="473.2393" y="353.6563"/></g><g><title>FHIR Server</title><rect fill="#313139" height="29.1328" style="stroke:#E7E7E7;stroke-width:1;" width="10" x="473.2393" y="1100.7734"/></g><g><title>Authorization</title><rect fill="#313139" height="218.0625" style="stroke:#E7E7E7;stroke-width:1;" width="10" x="585.522" y="678.7813"/></g><g><title>Authorization</title><rect fill="#313139" height="44.2656" style="stroke:#E7E7E7;stroke-width:1;" width="10" x="585.522" y="969.1094"/></g><g><title>User</title><rect fill="#000000" fill-opacity="0.00000" height="1058.4453" width="8" x="19.9551" y="118.5938"/><line style="stroke:#E7E7E7;stroke-width:0.5;stroke-dasharray:5,5;" x1="23" x2="23" y1="118.5938" y2="1177.0391"/></g><g><title>SMART App</title><rect fill="#000000" fill-opacity="0.00000" height="1058.4453" width="8" x="200.0801" y="118.5938"/><line style="stroke:#E7E7E7;stroke-width:0.5;stroke-dasharray:5,5;" x1="203.7686" x2="203.7686" y1="118.5938" y2="1177.0391"/></g><g><title>FHIR Server</title><rect fill="#000000" fill-opacity="0.00000" height="1058.4453" width="8" x="474.2393" y="118.5938"/><line style="stroke:#E7E7E7;stroke-width:0.5;stroke-dasharray:5,5;" x1="477.8408" x2="477.8408" y1="118.5938" y2="1177.0391"/></g><g><title>Authorization</title><rect fill="#000000" fill-opacity="0.00000" height="1058.4453" width="8" x="586.522" y="118.5938"/><line style="stroke:#E7E7E7;stroke-width:0.5;stroke-dasharray:5,5;" x1="589.6377" x2="589.6377" y1="118.5938" y2="1177.0391"/></g><g class="participant participant-head" data-participant="User"><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="31.9102" x="5" y="115.292">User</text><ellipse cx="23.9551" cy="50.7969" fill="#222222" rx="8" ry="8" style="stroke:#E7E7E7;stroke-width:0.5;"/><path d="M23.9551,58.7969 L23.9551,85.7969 M10.9551,66.7969 L36.9551,66.7969 M23.9551,85.7969 L10.9551,100.7969 M23.9551,85.7969 L36.9551,100.7969" fill="none" style="stroke:#E7E7E7;stroke-width:0.5;"/></g><g class="participant participant-tail" data-participant="User"><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="31.9102" x="5" y="1189.0342">User</text><ellipse cx="23.9551" cy="1200.8359" fill="#222222" rx="8" ry="8" style="stroke:#E7E7E7;stroke-width:0.5;"/><path d="M23.9551,1208.8359 L23.9551,1235.8359 M10.9551,1216.8359 L36.9551,1216.8359 M23.9551,1235.8359 L10.9551,1250.8359 M23.9551,1235.8359 L36.9551,1250.8359" fill="none" style="stroke:#E7E7E7;stroke-width:0.5;"/></g><g class="participant participant-head" data-participant="App"><rect fill="#222222" height="30.2969" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="94.623" x="156.7686" y="87.2969"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="80.623" x="163.7686" y="107.292">SMART App</text></g><g class="participant participant-tail" data-participant="App"><rect fill="#222222" height="30.2969" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="94.623" x="156.7686" y="1176.0391"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="80.623" x="163.7686" y="1196.0342">SMART App</text></g><g class="participant participant-head" data-participant="FHIR"><rect fill="#222222" height="30.2969" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="96.7969" x="429.8408" y="87.2969"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="82.7969" x="436.8408" y="107.292">FHIR Server</text></g><g class="participant participant-tail" data-participant="FHIR"><rect fill="#222222" height="30.2969" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="96.7969" x="429.8408" y="1176.0391"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="82.7969" x="436.8408" y="1196.0342">FHIR Server</text></g><g class="participant participant-head" data-participant="Auth"><rect fill="#222222" height="46.5938" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="107.7686" x="536.6377" y="71"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="93.7686" x="543.6377" y="90.9951">Authorization</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="45.9102" x="567.5669" y="107.292">Server</text></g><g class="participant participant-tail" data-participant="Auth"><rect fill="#222222" height="46.5938" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="107.7686" x="536.6377" y="1176.0391"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="93.7686" x="543.6377" y="1196.0342">Authorization</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="45.9102" x="567.5669" y="1212.3311">Server</text></g><g><title>SMART App</title><rect fill="#313139" height="470.7891" style="stroke:#E7E7E7;stroke-width:1;" width="10" x="199.0801" y="207.9922"/></g><g><title>SMART App</title><rect fill="#313139" height="262.1953" style="stroke:#E7E7E7;stroke-width:1;" width="10" x="199.0801" y="896.8438"/></g><g><title>FHIR Server</title><rect fill="#313139" height="44.2656" style="stroke:#E7E7E7;stroke-width:1;" width="10" x="473.2393" y="353.6563"/></g><g><title>FHIR Server</title><rect fill="#313139" height="29.1328" style="stroke:#E7E7E7;stroke-width:1;" width="10" x="473.2393" y="1100.7734"/></g><g><title>Authorization</title><rect fill="#313139" height="218.0625" style="stroke:#E7E7E7;stroke-width:1;" width="10" x="585.522" y="678.7813"/></g><g><title>Authorization</title><rect fill="#313139" height="44.2656" style="stroke:#E7E7E7;stroke-width:1;" width="10" x="585.522" y="969.1094"/></g><rect fill="#111111" height="3" style="stroke:#111111;stroke-width:1;" width="761.5044" x="0" y="149.1602"/><line style="stroke:#FFFFFF;stroke-width:1;" x1="0" x2="761.5044" y1="149.1602" y2="149.1602"/><line style="stroke:#FFFFFF;stroke-width:1;" x1="0" x2="761.5044" y1="152.1602" y2="152.1602"/><rect fill="#111111" height="23.1328" style="stroke:#FFFFFF;stroke-width:2;" width="118.5713" x="321.4666" y="138.5938"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="100.0454" x="327.4666" y="154.6606">App Initiation</text><g class="message" data-participant-1="User" data-participant-2="App"><polygon fill="#E7E7E7" points="187.0801,203.9922,197.0801,207.9922,187.0801,211.9922,191.0801,207.9922" style="stroke:#E7E7E7;stroke-width:1;"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="23.9551" x2="193.0801" y1="207.9922" y2="207.9922"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="122.9858" x="30.9551" y="187.7935">Opens app directly</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="97.2588" x="30.9551" y="202.9263">(not from EHR)</text></g><g class="message" data-participant-1="App" data-participant-2="User"><polygon fill="#E7E7E7" points="34.9551,248.2578,24.9551,252.2578,34.9551,256.2578,30.9551,252.2578" style="stroke:#E7E7E7;stroke-width:1;"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="28.9551" x2="198.0801" y1="252.2578" y2="252.2578"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="103.4097" x="40.9551" y="232.0591">Prompt for FHIR</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="71.0747" x="40.9551" y="247.1919">server URL</text></g><g class="message" data-participant-1="User" data-participant-2="App"><polygon fill="#E7E7E7" points="187.0801,277.3906,197.0801,281.3906,187.0801,285.3906,191.0801,281.3906" style="stroke:#E7E7E7;stroke-width:1;"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="23.9551" x2="193.0801" y1="281.3906" y2="281.3906"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="151.125" x="30.9551" y="276.3247">Enters FHIR server URL</text></g><rect fill="#111111" height="3" style="stroke:#111111;stroke-width:1;" width="761.5044" x="0" y="309.957"/><line style="stroke:#FFFFFF;stroke-width:1;" x1="0" x2="761.5044" y1="309.957" y2="309.957"/><line style="stroke:#FFFFFF;stroke-width:1;" x1="0" x2="761.5044" y1="312.957" y2="312.957"/><rect fill="#111111" height="23.1328" style="stroke:#FFFFFF;stroke-width:2;" width="90.3242" x="335.5901" y="299.3906"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="71.7983" x="341.5901" y="315.4575">Discovery</text><g class="message" data-participant-1="App" data-participant-2="FHIR"><polygon fill="#E7E7E7" points="461.2393,349.6563,471.2393,353.6563,461.2393,357.6563,465.2393,353.6563" style="stroke:#E7E7E7;stroke-width:1;"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="209.0801" x2="467.2393" y1="353.6563" y2="353.6563"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="245.1592" x="216.0801" y="348.5903">GET /.well-known/smart-configuration</text></g><g class="message" data-participant-1="FHIR" data-participant-2="App"><polygon fill="#E7E7E7" points="220.0801,393.9219,210.0801,397.9219,220.0801,401.9219,216.0801,397.9219" style="stroke:#E7E7E7;stroke-width:1;"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="214.0801" x2="477.2393" y1="397.9219" y2="397.9219"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="135.7002" x="226.0801" y="377.7231">SMART configuration</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="166.8608" x="226.0801" y="392.856">(endpoints &amp; capabilities)</text></g><rect fill="#111111" height="3" style="stroke:#111111;stroke-width:1;" width="761.5044" x="0" y="426.4883"/><line style="stroke:#FFFFFF;stroke-width:1;" x1="0" x2="761.5044" y1="426.4883" y2="426.4883"/><line style="stroke:#FFFFFF;stroke-width:1;" x1="0" x2="761.5044" y1="429.4883" y2="429.4883"/><rect fill="#111111" height="23.1328" style="stroke:#FFFFFF;stroke-width:2;" width="118.3047" x="321.5999" y="415.9219"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="99.7788" x="327.5999" y="431.9888">Authorization</text><g class="message" data-participant-1="App" data-participant-2="App"><line style="stroke:#E7E7E7;stroke-width:1;" x1="209.0801" x2="251.0801" y1="470.1875" y2="470.1875"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="251.0801" x2="251.0801" y1="470.1875" y2="483.1875"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="210.0801" x2="251.0801" y1="483.1875" y2="483.1875"/><polygon fill="#E7E7E7" points="220.0801,479.1875,210.0801,483.1875,220.0801,487.1875,216.0801,483.1875" style="stroke:#E7E7E7;stroke-width:1;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="178.0391" x="216.0801" y="465.1216">Generate PKCE parameters</text></g><g class="message" data-participant-1="App" data-participant-2="Auth"><polygon fill="#E7E7E7" points="573.522,674.7813,583.522,678.7813,573.522,682.7813,577.522,678.7813" style="stroke:#E7E7E7;stroke-width:1;"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="204.0801" x2="579.522" y1="678.7813" y2="678.7813"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="148.3511" x="211.0801" y="507.2544">Redirect to /authorize?</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="148.916" x="211.0801" y="522.3872">• response_type=code</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="105.168" x="211.0801" y="537.52">• client_id={id}</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="166.9561" x="211.0801" y="552.6528">• redirect_uri={callback}</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="151.6519" x="211.0801" y="567.7856">• scope=patient/*.read</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="99.8423" x="219.3447" y="582.9185">openid fhirUser</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="105.0981" x="211.0801" y="598.0513">• state={state}</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="107.3516" x="211.0801" y="613.1841">• aud={fhir-url}</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="203.2139" x="211.0801" y="628.3169">• code_challenge={challenge}</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="213.3765" x="211.0801" y="643.4497">• code_challenge_method=S256</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="211.0801" y="658.5825"> </text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="187.8525" x="211.0801" y="673.7153">NOTE: No launch parameter!</text></g><g class="message" data-participant-1="Auth" data-participant-2="User"><polygon fill="#E7E7E7" points="34.9551,703.9141,24.9551,707.9141,34.9551,711.9141,30.9551,707.9141" style="stroke:#E7E7E7;stroke-width:1;"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="28.9551" x2="584.522" y1="707.9141" y2="707.9141"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="83.7192" x="40.9551" y="702.8481">Display login</text></g><g class="message" data-participant-1="User" data-participant-2="Auth"><polygon fill="#E7E7E7" points="573.522,733.0469,583.522,737.0469,573.522,741.0469,577.522,737.0469" style="stroke:#E7E7E7;stroke-width:1;"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="23.9551" x2="579.522" y1="737.0469" y2="737.0469"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="83.624" x="30.9551" y="731.981">Authenticate</text></g><g class="message" data-participant-1="Auth" data-participant-2="User"><polygon fill="#E7E7E7" points="34.9551,777.3125,24.9551,781.3125,34.9551,785.3125,30.9551,781.3125" style="stroke:#E7E7E7;stroke-width:1;"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="28.9551" x2="584.522" y1="781.3125" y2="781.3125"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="103.3462" x="40.9551" y="761.1138">Patient Picker</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="154.0005" x="40.9551" y="776.2466">(Select patient context)</text></g><g class="message" data-participant-1="User" data-participant-2="Auth"><polygon fill="#E7E7E7" points="573.522,806.4453,583.522,810.4453,573.522,814.4453,577.522,810.4453" style="stroke:#E7E7E7;stroke-width:1;"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="23.9551" x2="579.522" y1="810.4453" y2="810.4453"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="97.2715" x="30.9551" y="805.3794">Selects patient</text></g><g class="message" data-participant-1="Auth" data-participant-2="Auth"><line style="stroke:#E7E7E7;stroke-width:1;" x1="595.522" x2="637.522" y1="854.7109" y2="854.7109"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="637.522" x2="637.522" y1="854.7109" y2="867.7109"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="596.522" x2="637.522" y1="867.7109" y2="867.7109"/><polygon fill="#E7E7E7" points="606.522,863.7109,596.522,867.7109,606.522,871.7109,602.522,867.7109" style="stroke:#E7E7E7;stroke-width:1;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="129.873" x="602.522" y="834.5122">Generate auth code</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="136.9824" x="602.522" y="849.645">with selected patient</text></g><g class="message" data-participant-1="Auth" data-participant-2="App"><polygon fill="#E7E7E7" points="220.0801,892.8438,210.0801,896.8438,220.0801,900.8438,216.0801,896.8438" style="stroke:#E7E7E7;stroke-width:1;"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="214.0801" x2="589.522" y1="896.8438" y2="896.8438"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="173.0117" x="226.0801" y="891.7778">Redirect with code &amp; state</text></g><rect fill="#111111" height="3" style="stroke:#111111;stroke-width:1;" width="761.5044" x="0" y="925.4102"/><line style="stroke:#FFFFFF;stroke-width:1;" x1="0" x2="761.5044" y1="925.4102" y2="925.4102"/><line style="stroke:#FFFFFF;stroke-width:1;" x1="0" x2="761.5044" y1="928.4102" y2="928.4102"/><rect fill="#111111" height="23.1328" style="stroke:#FFFFFF;stroke-width:2;" width="137.9443" x="311.78" y="914.8438"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="119.4185" x="317.78" y="930.9106">Token Exchange</text><g class="message" data-participant-1="App" data-participant-2="Auth"><polygon fill="#E7E7E7" points="573.522,965.1094,583.522,969.1094,573.522,973.1094,577.522,969.1094" style="stroke:#E7E7E7;stroke-width:1;"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="209.0801" x2="579.522" y1="969.1094" y2="969.1094"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="192.8862" x="216.0801" y="964.0435">POST /token (exchange code)</text></g><g class="message" data-participant-1="Auth" data-participant-2="App"><polygon fill="#E7E7E7" points="220.0801,1009.375,210.0801,1013.375,220.0801,1017.375,216.0801,1013.375" style="stroke:#E7E7E7;stroke-width:1;"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="214.0801" x2="589.522" y1="1013.375" y2="1013.375"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="102.1465" x="226.0801" y="993.1763">access_token +</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="99.6201" x="226.0801" y="1008.3091">patient context</text></g><rect fill="#111111" height="3" style="stroke:#111111;stroke-width:1;" width="761.5044" x="0" y="1041.9414"/><line style="stroke:#FFFFFF;stroke-width:1;" x1="0" x2="761.5044" y1="1041.9414" y2="1041.9414"/><line style="stroke:#FFFFFF;stroke-width:1;" x1="0" x2="761.5044" y1="1044.9414" y2="1044.9414"/><rect fill="#111111" height="23.1328" style="stroke:#FFFFFF;stroke-width:2;" width="148.2402" x="306.6321" y="1031.375"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="129.7144" x="312.6321" y="1047.4419">Access Resources</text><g class="message" data-participant-1="App" data-participant-2="FHIR"><polygon fill="#E7E7E7" points="461.2393,1096.7734,471.2393,1100.7734,461.2393,1104.7734,465.2393,1100.7734" style="stroke:#E7E7E7;stroke-width:1;"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="209.0801" x2="467.2393" y1="1100.7734" y2="1100.7734"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="115.4258" x="216.0801" y="1080.5747">FHIR API requests</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="118.8345" x="216.0801" y="1095.7075">with access_token</text></g><g class="message" data-participant-1="FHIR" data-participant-2="App"><polygon fill="#E7E7E7" points="220.0801,1125.9063,210.0801,1129.9063,220.0801,1133.9063,216.0801,1129.9063" style="stroke:#E7E7E7;stroke-width:1;"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="214.0801" x2="477.2393" y1="1129.9063" y2="1129.9063"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="97.8237" x="226.0801" y="1124.8403">FHIR resources</text></g><g class="message" data-participant-1="App" data-participant-2="User"><polygon fill="#E7E7E7" points="34.9551,1155.0391,24.9551,1159.0391,34.9551,1163.0391,30.9551,1159.0391" style="stroke:#E7E7E7;stroke-width:1;"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="28.9551" x2="203.0801" y1="1159.0391" y2="1159.0391"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="81.3325" x="40.9551" y="1153.9731">Display data</text></g></g></svg></div></div>
<h2 id="smart-on-fhir-token-refresh-flow">SMART-on-FHIR Token Refresh Flow</h2>
<div class="puml-container"><div class="puml light" style=""><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="SEQUENCE" height="741px" preserveAspectRatio="xMidYMid meet" style="width:521px;height:741px;background:#FFFFFF;" version="1.1" viewBox="0 0 521 741" width="521px" zoomAndPan="magnify" class="diagram"><title>SMART-on-FHIR Token Refresh Flow</title><defs/><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="284.1973" x="114.9001" y="27.9951">SMART-on-FHIR Token Refresh Flow</text><g><title>Authorization</title><rect fill="#F1F1F1" height="131.7969" style="stroke:#181818;stroke-width:1;" width="10" x="289.728" y="424.1563"/></g><g><title>FHIR API</title><rect fill="#F1F1F1" height="29.1328" style="stroke:#181818;stroke-width:1;" width="10" x="468.48" y="164.1563"/></g><g><title>FHIR API</title><rect fill="#F1F1F1" height="29.1328" style="stroke:#181818;stroke-width:1;" width="10" x="468.48" y="642.3516"/></g><g><title>SMART App</title><rect fill="#000000" fill-opacity="0.00000" height="111.3984" width="8" x="48.3115" y="89.8906"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="52" x2="52" y1="89.8906" y2="201.2891"/></g><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="52" x2="52" y1="201.2891" y2="242.0938"/><g><title>SMART App</title><rect fill="#000000" fill-opacity="0.00000" height="447.3906" width="8" x="48.3115" y="242.0938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="52" x2="52" y1="242.0938" y2="689.4844"/></g><g><title>Authorization</title><rect fill="#000000" fill-opacity="0.00000" height="111.3984" width="8" x="290.728" y="89.8906"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="293.8438" x2="293.8438" y1="89.8906" y2="201.2891"/></g><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="293.8438" x2="293.8438" y1="201.2891" y2="242.0938"/><g><title>Authorization</title><rect fill="#000000" fill-opacity="0.00000" height="447.3906" width="8" x="290.728" y="242.0938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="293.8438" x2="293.8438" y1="242.0938" y2="689.4844"/></g><g><title>FHIR API</title><rect fill="#000000" fill-opacity="0.00000" height="111.3984" width="8" x="469.48" y="89.8906"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="472.9624" x2="472.9624" y1="89.8906" y2="201.2891"/></g><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="472.9624" x2="472.9624" y1="201.2891" y2="242.0938"/><g><title>FHIR API</title><rect fill="#000000" fill-opacity="0.00000" height="447.3906" width="8" x="469.48" y="242.0938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="472.9624" x2="472.9624" y1="242.0938" y2="689.4844"/></g><g class="participant participant-head" data-participant="App"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="94.623" x="5" y="58.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="80.623" x="12" y="78.5889">SMART App</text></g><g class="participant participant-tail" data-participant="App"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="94.623" x="5" y="688.4844"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="80.623" x="12" y="708.4795">SMART App</text></g><g class="participant participant-head" data-participant="Auth"><rect fill="#E2E2F0" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="107.7686" x="240.8438" y="42.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="93.7686" x="247.8438" y="62.292">Authorization</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="45.9102" x="271.7729" y="78.5889">Server</text></g><g class="participant participant-tail" data-participant="Auth"><rect fill="#E2E2F0" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="107.7686" x="240.8438" y="688.4844"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="93.7686" x="247.8438" y="708.4795">Authorization</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="45.9102" x="271.7729" y="724.7764">Server</text></g><g class="participant participant-head" data-participant="FHIR"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="73.0352" x="436.9624" y="58.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="59.0352" x="443.9624" y="78.5889">FHIR API</text></g><g class="participant participant-tail" data-participant="FHIR"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="73.0352" x="436.9624" y="688.4844"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="59.0352" x="443.9624" y="708.4795">FHIR API</text></g><g><title>Authorization</title><rect fill="#F1F1F1" height="131.7969" style="stroke:#181818;stroke-width:1;" width="10" x="289.728" y="424.1563"/></g><g><title>FHIR API</title><rect fill="#F1F1F1" height="29.1328" style="stroke:#181818;stroke-width:1;" width="10" x="468.48" y="164.1563"/></g><g><title>FHIR API</title><rect fill="#F1F1F1" height="29.1328" style="stroke:#181818;stroke-width:1;" width="10" x="468.48" y="642.3516"/></g><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="514.9976" x="0" y="120.457"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="514.9976" y1="120.457" y2="120.457"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="514.9976" y1="123.457" y2="123.457"/><rect fill="#EEEEEE" height="23.1328" style="stroke:#000000;stroke-width:2;" width="149.2622" x="182.8677" y="109.8906"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="130.7363" x="188.8677" y="125.9575">Normal Operation</text><g class="message" data-participant-1="App" data-participant-2="FHIR"><polygon fill="#181818" points="456.48,160.1563,466.48,164.1563,456.48,168.1563,460.48,164.1563" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="52.3115" x2="462.48" y1="164.1563" y2="164.1563"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="197.3677" x="59.3115" y="159.0903">API request with access_token</text></g><g class="message" data-participant-1="FHIR" data-participant-2="App"><polygon fill="#181818" points="63.3115,189.2891,53.3115,193.2891,63.3115,197.2891,59.3115,193.2891" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="57.3115" x2="472.48" y1="193.2891" y2="193.2891"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="114.3086" x="69.3115" y="188.2231">Success (200 OK)</text></g><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="199.9604" x="162.9155" y="225.4995">Time passes, token nears expiration</text><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="514.9976" x="0" y="262.6602"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="514.9976" y1="262.6602" y2="262.6602"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="514.9976" y1="265.6602" y2="265.6602"/><rect fill="#EEEEEE" height="23.1328" style="stroke:#000000;stroke-width:2;" width="123.1289" x="195.9343" y="252.0938"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="104.603" x="201.9343" y="268.1606">Token Expired</text><g class="message" data-participant-1="App" data-participant-2="App"><line style="stroke:#181818;stroke-width:1;" x1="52.3115" x2="94.3115" y1="321.4922" y2="321.4922"/><line style="stroke:#181818;stroke-width:1;" x1="94.3115" x2="94.3115" y1="321.4922" y2="334.4922"/><line style="stroke:#181818;stroke-width:1;" x1="53.3115" x2="94.3115" y1="334.4922" y2="334.4922"/><polygon fill="#181818" points="63.3115,330.4922,53.3115,334.4922,63.3115,338.4922,59.3115,334.4922" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="125.6646" x="59.3115" y="301.2935">Check token expiry</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="150.4204" x="59.3115" y="316.4263">(expires_in timestamp)</text></g><g class="message" data-participant-1="App" data-participant-2="Auth"><polygon fill="#181818" points="277.728,420.1563,287.728,424.1563,277.728,428.1563,281.728,424.1563" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="52.3115" x2="283.728" y1="424.1563" y2="424.1563"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="79.5933" x="59.3115" y="358.5591">POST /token</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="182.7236" x="59.3115" y="373.6919">• grant_type=refresh_token</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="218.4165" x="59.3115" y="388.8247">• refresh_token={refresh_token}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="147.3735" x="59.3115" y="403.9575">• client_id={client_id}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="177.3472" x="59.3115" y="419.0903">• scope={original_scopes}</text></g><g class="message" data-participant-1="Auth" data-participant-2="Auth"><line style="stroke:#181818;stroke-width:1;" x1="299.728" x2="341.728" y1="453.2891" y2="453.2891"/><line style="stroke:#181818;stroke-width:1;" x1="341.728" x2="341.728" y1="453.2891" y2="466.2891"/><line style="stroke:#181818;stroke-width:1;" x1="300.728" x2="341.728" y1="466.2891" y2="466.2891"/><polygon fill="#181818" points="310.728,462.2891,300.728,466.2891,310.728,470.2891,306.728,466.2891" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="144.752" x="306.728" y="448.2231">Validate refresh token</text></g><g class="message" data-participant-1="Auth" data-participant-2="App"><polygon fill="#181818" points="63.3115,551.9531,53.3115,555.9531,63.3115,559.9531,59.3115,555.9531" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="57.3115" x2="293.728" y1="555.9531" y2="555.9531"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="80.4565" x="69.3115" y="490.356">New tokens:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="98.9219" x="69.3115" y="505.4888">• access_token</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="77.8223" x="69.3115" y="520.6216">• expires_in</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="142.5366" x="69.3115" y="535.7544">• refresh_token (new)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="161.0972" x="69.3115" y="550.8872">• patient (same context)</text></g><g class="message" data-participant-1="App" data-participant-2="App"><line style="stroke:#181818;stroke-width:1;" x1="52.3115" x2="94.3115" y1="585.0859" y2="585.0859"/><line style="stroke:#181818;stroke-width:1;" x1="94.3115" x2="94.3115" y1="585.0859" y2="598.0859"/><line style="stroke:#181818;stroke-width:1;" x1="53.3115" x2="94.3115" y1="598.0859" y2="598.0859"/><polygon fill="#181818" points="63.3115,594.0859,53.3115,598.0859,63.3115,602.0859,59.3115,598.0859" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="140.353" x="59.3115" y="580.02">Update stored tokens</text></g><g class="message" data-participant-1="App" data-participant-2="FHIR"><polygon fill="#181818" points="456.48,638.3516,466.48,642.3516,456.48,646.3516,460.48,642.3516" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="52.3115" x2="462.48" y1="642.3516" y2="642.3516"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="106.1138" x="59.3115" y="622.1528">API request with</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="122.0464" x="59.3115" y="637.2856">NEW access_token</text></g><g class="message" data-participant-1="FHIR" data-participant-2="App"><polygon fill="#181818" points="63.3115,667.4844,53.3115,671.4844,63.3115,675.4844,59.3115,671.4844" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="57.3115" x2="472.48" y1="671.4844" y2="671.4844"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="114.3086" x="69.3115" y="666.4185">Success (200 OK)</text></g></g></svg></div><div class="puml dark" style=""><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="SEQUENCE" height="741px" preserveAspectRatio="xMidYMid meet" style="width:521px;height:741px;background:#1B1B1B;" version="1.1" viewBox="0 0 521 741" width="521px" zoomAndPan="magnify" class="diagram"><title>SMART-on-FHIR Token Refresh Flow</title><defs/><g><rect fill="#1B1B1B" height="741" style="stroke:none;stroke-width:1;" width="521" x="0" y="0"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="284.1973" x="114.9001" y="27.9951">SMART-on-FHIR Token Refresh Flow</text><g><title>Authorization</title><rect fill="#313139" height="131.7969" style="stroke:#E7E7E7;stroke-width:1;" width="10" x="289.728" y="424.1563"/></g><g><title>FHIR API</title><rect fill="#313139" height="29.1328" style="stroke:#E7E7E7;stroke-width:1;" width="10" x="468.48" y="164.1563"/></g><g><title>FHIR API</title><rect fill="#313139" height="29.1328" style="stroke:#E7E7E7;stroke-width:1;" width="10" x="468.48" y="642.3516"/></g><g><title>SMART App</title><rect fill="#000000" fill-opacity="0.00000" height="111.3984" width="8" x="48.3115" y="89.8906"/><line style="stroke:#E7E7E7;stroke-width:0.5;stroke-dasharray:5,5;" x1="52" x2="52" y1="89.8906" y2="201.2891"/></g><line style="stroke:#E7E7E7;stroke-width:0.5;stroke-dasharray:5,5;" x1="52" x2="52" y1="201.2891" y2="242.0938"/><g><title>SMART App</title><rect fill="#000000" fill-opacity="0.00000" height="447.3906" width="8" x="48.3115" y="242.0938"/><line style="stroke:#E7E7E7;stroke-width:0.5;stroke-dasharray:5,5;" x1="52" x2="52" y1="242.0938" y2="689.4844"/></g><g><title>Authorization</title><rect fill="#000000" fill-opacity="0.00000" height="111.3984" width="8" x="290.728" y="89.8906"/><line style="stroke:#E7E7E7;stroke-width:0.5;stroke-dasharray:5,5;" x1="293.8438" x2="293.8438" y1="89.8906" y2="201.2891"/></g><line style="stroke:#E7E7E7;stroke-width:0.5;stroke-dasharray:5,5;" x1="293.8438" x2="293.8438" y1="201.2891" y2="242.0938"/><g><title>Authorization</title><rect fill="#000000" fill-opacity="0.00000" height="447.3906" width="8" x="290.728" y="242.0938"/><line style="stroke:#E7E7E7;stroke-width:0.5;stroke-dasharray:5,5;" x1="293.8438" x2="293.8438" y1="242.0938" y2="689.4844"/></g><g><title>FHIR API</title><rect fill="#000000" fill-opacity="0.00000" height="111.3984" width="8" x="469.48" y="89.8906"/><line style="stroke:#E7E7E7;stroke-width:0.5;stroke-dasharray:5,5;" x1="472.9624" x2="472.9624" y1="89.8906" y2="201.2891"/></g><line style="stroke:#E7E7E7;stroke-width:0.5;stroke-dasharray:5,5;" x1="472.9624" x2="472.9624" y1="201.2891" y2="242.0938"/><g><title>FHIR API</title><rect fill="#000000" fill-opacity="0.00000" height="447.3906" width="8" x="469.48" y="242.0938"/><line style="stroke:#E7E7E7;stroke-width:0.5;stroke-dasharray:5,5;" x1="472.9624" x2="472.9624" y1="242.0938" y2="689.4844"/></g><g class="participant participant-head" data-participant="App"><rect fill="#222222" height="30.2969" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="94.623" x="5" y="58.5938"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="80.623" x="12" y="78.5889">SMART App</text></g><g class="participant participant-tail" data-participant="App"><rect fill="#222222" height="30.2969" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="94.623" x="5" y="688.4844"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="80.623" x="12" y="708.4795">SMART App</text></g><g class="participant participant-head" data-participant="Auth"><rect fill="#222222" height="46.5938" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="107.7686" x="240.8438" y="42.2969"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="93.7686" x="247.8438" y="62.292">Authorization</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="45.9102" x="271.7729" y="78.5889">Server</text></g><g class="participant participant-tail" data-participant="Auth"><rect fill="#222222" height="46.5938" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="107.7686" x="240.8438" y="688.4844"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="93.7686" x="247.8438" y="708.4795">Authorization</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="45.9102" x="271.7729" y="724.7764">Server</text></g><g class="participant participant-head" data-participant="FHIR"><rect fill="#222222" height="30.2969" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="73.0352" x="436.9624" y="58.5938"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="59.0352" x="443.9624" y="78.5889">FHIR API</text></g><g class="participant participant-tail" data-participant="FHIR"><rect fill="#222222" height="30.2969" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="73.0352" x="436.9624" y="688.4844"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="59.0352" x="443.9624" y="708.4795">FHIR API</text></g><g><title>Authorization</title><rect fill="#313139" height="131.7969" style="stroke:#E7E7E7;stroke-width:1;" width="10" x="289.728" y="424.1563"/></g><g><title>FHIR API</title><rect fill="#313139" height="29.1328" style="stroke:#E7E7E7;stroke-width:1;" width="10" x="468.48" y="164.1563"/></g><g><title>FHIR API</title><rect fill="#313139" height="29.1328" style="stroke:#E7E7E7;stroke-width:1;" width="10" x="468.48" y="642.3516"/></g><rect fill="#111111" height="3" style="stroke:#111111;stroke-width:1;" width="514.9976" x="0" y="120.457"/><line style="stroke:#FFFFFF;stroke-width:1;" x1="0" x2="514.9976" y1="120.457" y2="120.457"/><line style="stroke:#FFFFFF;stroke-width:1;" x1="0" x2="514.9976" y1="123.457" y2="123.457"/><rect fill="#111111" height="23.1328" style="stroke:#FFFFFF;stroke-width:2;" width="149.2622" x="182.8677" y="109.8906"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="130.7363" x="188.8677" y="125.9575">Normal Operation</text><g class="message" data-participant-1="App" data-participant-2="FHIR"><polygon fill="#E7E7E7" points="456.48,160.1563,466.48,164.1563,456.48,168.1563,460.48,164.1563" style="stroke:#E7E7E7;stroke-width:1;"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="52.3115" x2="462.48" y1="164.1563" y2="164.1563"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="197.3677" x="59.3115" y="159.0903">API request with access_token</text></g><g class="message" data-participant-1="FHIR" data-participant-2="App"><polygon fill="#E7E7E7" points="63.3115,189.2891,53.3115,193.2891,63.3115,197.2891,59.3115,193.2891" style="stroke:#E7E7E7;stroke-width:1;"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="57.3115" x2="472.48" y1="193.2891" y2="193.2891"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="114.3086" x="69.3115" y="188.2231">Success (200 OK)</text></g><text fill="#FFFFFF" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="199.9604" x="162.9155" y="225.4995">Time passes, token nears expiration</text><rect fill="#111111" height="3" style="stroke:#111111;stroke-width:1;" width="514.9976" x="0" y="262.6602"/><line style="stroke:#FFFFFF;stroke-width:1;" x1="0" x2="514.9976" y1="262.6602" y2="262.6602"/><line style="stroke:#FFFFFF;stroke-width:1;" x1="0" x2="514.9976" y1="265.6602" y2="265.6602"/><rect fill="#111111" height="23.1328" style="stroke:#FFFFFF;stroke-width:2;" width="123.1289" x="195.9343" y="252.0938"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="104.603" x="201.9343" y="268.1606">Token Expired</text><g class="message" data-participant-1="App" data-participant-2="App"><line style="stroke:#E7E7E7;stroke-width:1;" x1="52.3115" x2="94.3115" y1="321.4922" y2="321.4922"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="94.3115" x2="94.3115" y1="321.4922" y2="334.4922"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="53.3115" x2="94.3115" y1="334.4922" y2="334.4922"/><polygon fill="#E7E7E7" points="63.3115,330.4922,53.3115,334.4922,63.3115,338.4922,59.3115,334.4922" style="stroke:#E7E7E7;stroke-width:1;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="125.6646" x="59.3115" y="301.2935">Check token expiry</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="150.4204" x="59.3115" y="316.4263">(expires_in timestamp)</text></g><g class="message" data-participant-1="App" data-participant-2="Auth"><polygon fill="#E7E7E7" points="277.728,420.1563,287.728,424.1563,277.728,428.1563,281.728,424.1563" style="stroke:#E7E7E7;stroke-width:1;"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="52.3115" x2="283.728" y1="424.1563" y2="424.1563"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="79.5933" x="59.3115" y="358.5591">POST /token</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="182.7236" x="59.3115" y="373.6919">• grant_type=refresh_token</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="218.4165" x="59.3115" y="388.8247">• refresh_token={refresh_token}</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="147.3735" x="59.3115" y="403.9575">• client_id={client_id}</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="177.3472" x="59.3115" y="419.0903">• scope={original_scopes}</text></g><g class="message" data-participant-1="Auth" data-participant-2="Auth"><line style="stroke:#E7E7E7;stroke-width:1;" x1="299.728" x2="341.728" y1="453.2891" y2="453.2891"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="341.728" x2="341.728" y1="453.2891" y2="466.2891"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="300.728" x2="341.728" y1="466.2891" y2="466.2891"/><polygon fill="#E7E7E7" points="310.728,462.2891,300.728,466.2891,310.728,470.2891,306.728,466.2891" style="stroke:#E7E7E7;stroke-width:1;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="144.752" x="306.728" y="448.2231">Validate refresh token</text></g><g class="message" data-participant-1="Auth" data-participant-2="App"><polygon fill="#E7E7E7" points="63.3115,551.9531,53.3115,555.9531,63.3115,559.9531,59.3115,555.9531" style="stroke:#E7E7E7;stroke-width:1;"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="57.3115" x2="293.728" y1="555.9531" y2="555.9531"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="80.4565" x="69.3115" y="490.356">New tokens:</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="98.9219" x="69.3115" y="505.4888">• access_token</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="77.8223" x="69.3115" y="520.6216">• expires_in</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="142.5366" x="69.3115" y="535.7544">• refresh_token (new)</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="161.0972" x="69.3115" y="550.8872">• patient (same context)</text></g><g class="message" data-participant-1="App" data-participant-2="App"><line style="stroke:#E7E7E7;stroke-width:1;" x1="52.3115" x2="94.3115" y1="585.0859" y2="585.0859"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="94.3115" x2="94.3115" y1="585.0859" y2="598.0859"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="53.3115" x2="94.3115" y1="598.0859" y2="598.0859"/><polygon fill="#E7E7E7" points="63.3115,594.0859,53.3115,598.0859,63.3115,602.0859,59.3115,598.0859" style="stroke:#E7E7E7;stroke-width:1;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="140.353" x="59.3115" y="580.02">Update stored tokens</text></g><g class="message" data-participant-1="App" data-participant-2="FHIR"><polygon fill="#E7E7E7" points="456.48,638.3516,466.48,642.3516,456.48,646.3516,460.48,642.3516" style="stroke:#E7E7E7;stroke-width:1;"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="52.3115" x2="462.48" y1="642.3516" y2="642.3516"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="106.1138" x="59.3115" y="622.1528">API request with</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="122.0464" x="59.3115" y="637.2856">NEW access_token</text></g><g class="message" data-participant-1="FHIR" data-participant-2="App"><polygon fill="#E7E7E7" points="63.3115,667.4844,53.3115,671.4844,63.3115,675.4844,59.3115,671.4844" style="stroke:#E7E7E7;stroke-width:1;"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="57.3115" x2="472.48" y1="671.4844" y2="671.4844"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="114.3086" x="69.3115" y="666.4185">Success (200 OK)</text></g></g></svg></div></div>
<h2 id="pkce-flow">PKCE Flow</h2>
<p>The following diagram shows the PKCE (Proof Key for Code Exchange) flow.</p>
<div class="puml-container"><div class="puml light" style=""><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="SEQUENCE" height="957px" preserveAspectRatio="xMidYMid meet" style="width:837px;height:957px;background:#FFFFFF;" version="1.1" viewBox="0 0 837 957" width="837px" zoomAndPan="magnify" class="diagram"><title>PKCE (Proof Key for Code Exchange) Flow</title><defs/><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="329.6768" x="249.8596" y="27.9951">PKCE (Proof Key for Code Exchange) Flow</text><g><title>Authorization</title><rect fill="#F1F1F1" height="86.3984" style="stroke:#181818;stroke-width:1;" width="10" x="559.021" y="384.6172"/></g><g><title>Authorization</title><rect fill="#F1F1F1" height="211.6016" style="stroke:#181818;stroke-width:1;" width="10" x="559.021" y="573.5469"/></g><rect fill="none" height="90.2031" style="stroke:#000000;stroke-width:1.5;" width="617.9053" x="10" y="687.9453"/><g><title>App .Client.</title><rect fill="#000000" fill-opacity="0.00000" height="816.0547" width="8" x="64.6274" y="89.8906"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="68" x2="68" y1="89.8906" y2="905.9453"/></g><g><title>Authorization</title><rect fill="#000000" fill-opacity="0.00000" height="816.0547" width="8" x="560.021" y="89.8906"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="563.1367" x2="563.1367" y1="89.8906" y2="905.9453"/></g><g class="participant participant-head" data-participant="App"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="97.2549" x="20" y="58.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="83.2549" x="27" y="78.5889">App (Client)</text></g><g class="participant participant-tail" data-participant="App"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="97.2549" x="20" y="904.9453"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="83.2549" x="27" y="924.9404">App (Client)</text></g><g class="participant participant-head" data-participant="Auth"><rect fill="#E2E2F0" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="107.7686" x="510.1367" y="42.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="93.7686" x="517.1367" y="62.292">Authorization</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="45.9102" x="541.0659" y="78.5889">Server</text></g><g class="participant participant-tail" data-participant="Auth"><rect fill="#E2E2F0" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="107.7686" x="510.1367" y="904.9453"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="93.7686" x="517.1367" y="924.9404">Authorization</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="45.9102" x="541.0659" y="941.2373">Server</text></g><g><title>Authorization</title><rect fill="#F1F1F1" height="86.3984" style="stroke:#181818;stroke-width:1;" width="10" x="559.021" y="384.6172"/></g><g><title>Authorization</title><rect fill="#F1F1F1" height="211.6016" style="stroke:#181818;stroke-width:1;" width="10" x="559.021" y="573.5469"/></g><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="830.396" x="0" y="120.457"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="830.396" y1="120.457" y2="120.457"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="830.396" y1="123.457" y2="123.457"/><rect fill="#EEEEEE" height="23.1328" style="stroke:#000000;stroke-width:2;" width="171.3711" x="329.5125" y="109.8906"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="152.8452" x="335.5125" y="125.9575">Before Authorization</text><g class="message" data-participant-1="App" data-participant-2="App"><line style="stroke:#181818;stroke-width:1;" x1="68.6274" x2="110.6274" y1="209.5547" y2="209.5547"/><line style="stroke:#181818;stroke-width:1;" x1="110.6274" x2="110.6274" y1="209.5547" y2="222.5547"/><line style="stroke:#181818;stroke-width:1;" x1="69.6274" x2="110.6274" y1="222.5547" y2="222.5547"/><polygon fill="#181818" points="79.6274,218.5547,69.6274,222.5547,79.6274,226.5547,75.6274,222.5547" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="173.2529" x="75.6274" y="159.0903">1. Generate random string</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="162.7222" x="75.6274" y="174.2231">code_verifier (128 chars)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="75.6274" y="189.356"> </text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="420.5703" x="75.6274" y="204.4888">Example: &quot;dBjftJeZ4CVP-mB92K27uhbUJU1p1r_wW1gFWFOEjXk&quot;</text></g><g class="message" data-participant-1="App" data-participant-2="App"><line style="stroke:#181818;stroke-width:1;" x1="68.6274" x2="110.6274" y1="312.2188" y2="312.2188"/><line style="stroke:#181818;stroke-width:1;" x1="110.6274" x2="110.6274" y1="312.2188" y2="325.2188"/><line style="stroke:#181818;stroke-width:1;" x1="69.6274" x2="110.6274" y1="325.2188" y2="325.2188"/><polygon fill="#181818" points="79.6274,321.2188,69.6274,325.2188,79.6274,329.2188,75.6274,325.2188" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="165.0645" x="75.6274" y="246.6216">2. Create code_challenge</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="145.9072" x="75.6274" y="261.7544">SHA256(code_verifier)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="159.415" x="75.6274" y="276.8872">then Base64URL encode</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="75.6274" y="292.02"> </text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="481.3936" x="75.6274" y="307.1528">code_challenge = &quot;E9Melhoa2OwvFrEMTJguCHaoeK1t8URWbuGJSstw-cM&quot;</text></g><g class="message" data-participant-1="App" data-participant-2="Auth"><polygon fill="#181818" points="547.021,380.6172,557.021,384.6172,547.021,388.6172,551.021,384.6172" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="68.6274" x2="553.021" y1="384.6172" y2="384.6172"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="193.5337" x="75.6274" y="349.2856">3. Authorization request with:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="112.7153" x="75.6274" y="364.4185">• code_challenge</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="213.3765" x="75.6274" y="379.5513">• code_challenge_method=S256</text></g><g class="message" data-participant-1="Auth" data-participant-2="Auth"><line style="stroke:#181818;stroke-width:1;" x1="569.021" x2="611.021" y1="428.8828" y2="428.8828"/><line style="stroke:#181818;stroke-width:1;" x1="611.021" x2="611.021" y1="428.8828" y2="441.8828"/><line style="stroke:#181818;stroke-width:1;" x1="570.021" x2="611.021" y1="441.8828" y2="441.8828"/><polygon fill="#181818" points="580.021,437.8828,570.021,441.8828,580.021,445.8828,576.021,441.8828" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="139.6929" x="576.021" y="408.6841">Store code_challenge</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="96.7383" x="576.021" y="423.8169">with auth code</text></g><g class="message" data-participant-1="Auth" data-participant-2="App"><polygon fill="#181818" points="79.6274,467.0156,69.6274,471.0156,79.6274,475.0156,75.6274,471.0156" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="73.6274" x2="563.021" y1="471.0156" y2="471.0156"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="176.4839" x="85.6274" y="465.9497">Returns authorization code</text></g><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="830.396" x="0" y="499.582"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="830.396" y1="499.582" y2="499.582"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="830.396" y1="502.582" y2="502.582"/><rect fill="#EEEEEE" height="23.1328" style="stroke:#000000;stroke-width:2;" width="137.9443" x="346.2258" y="489.0156"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="119.4185" x="352.2258" y="505.0825">Token Exchange</text><g class="message" data-participant-1="App" data-participant-2="Auth"><polygon fill="#181818" points="547.021,569.5469,557.021,573.5469,547.021,577.5469,551.021,573.5469" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="68.6274" x2="553.021" y1="573.5469" y2="573.5469"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="146.123" x="75.6274" y="538.2153">4. Token request with:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="133.4277" x="75.6274" y="553.3481">• authorization code</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="158.6978" x="75.6274" y="568.481">• code_verifier (original)</text></g><g class="message" data-participant-1="Auth" data-participant-2="Auth"><line style="stroke:#181818;stroke-width:1;" x1="569.021" x2="611.021" y1="617.8125" y2="617.8125"/><line style="stroke:#181818;stroke-width:1;" x1="611.021" x2="611.021" y1="617.8125" y2="630.8125"/><line style="stroke:#181818;stroke-width:1;" x1="570.021" x2="611.021" y1="630.8125" y2="630.8125"/><polygon fill="#181818" points="580.021,626.8125,570.021,630.8125,580.021,634.8125,576.021,630.8125" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="232.375" x="576.021" y="597.6138">5. Compute challenge from verifier:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="170.5996" x="576.021" y="612.7466">SHA256(received_verifier)</text></g><g class="message" data-participant-1="Auth" data-participant-2="Auth"><line style="stroke:#181818;stroke-width:1;" x1="569.021" x2="611.021" y1="659.9453" y2="659.9453"/><line style="stroke:#181818;stroke-width:1;" x1="611.021" x2="611.021" y1="659.9453" y2="672.9453"/><line style="stroke:#181818;stroke-width:1;" x1="570.021" x2="611.021" y1="672.9453" y2="672.9453"/><polygon fill="#181818" points="580.021,668.9453,570.021,672.9453,580.021,676.9453,576.021,672.9453" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="220.251" x="576.021" y="654.8794">6. Compare with stored challenge</text></g><path d="M10,687.9453 L74.4429,687.9453 L74.4429,695.0781 L64.4429,705.0781 L10,705.0781 L10,687.9453" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="90.2031" style="stroke:#000000;stroke-width:1.5;" width="617.9053" x="10" y="687.9453"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19.4429" x="25" y="701.0122">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="119.9043" x="89.4429" y="700.1558">[Challenges Match]</text><g class="message" data-participant-1="Auth" data-participant-2="App"><polygon fill="#181818" points="79.6274,722.2109,69.6274,726.2109,79.6274,730.2109,75.6274,726.2109" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="73.6274" x2="558.021" y1="726.2109" y2="726.2109"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="137.5283" x="85.6274" y="721.145">✓ Issue access token</text></g><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2,2;" x1="10" x2="627.9053" y1="735.2109" y2="735.2109"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="156.8789" x="15" y="745.4214">[Challenges Don't Match]</text><g class="message" data-participant-1="Auth" data-participant-2="App"><polygon fill="#181818" points="79.6274,766.1484,69.6274,770.1484,79.6274,774.1484,75.6274,770.1484" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="73.6274" x2="558.021" y1="770.1484" y2="770.1484"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="140.1245" x="85.6274" y="765.0825">✗ Error: invalid_grant</text></g><path d="M569,790.1484 L569,890.1484 L790,890.1484 L790,800.1484 L780,790.1484 L569,790.1484" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M780,790.1484 L780,800.1484 L790,800.1484 L780,790.1484" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="82.1577" x="575" y="807.2153">Why PKCE?</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="195.5649" x="575" y="822.3481">Protects against authorization</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="169.9141" x="575" y="837.481">code interception attacks.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="200.6812" x="575" y="852.6138">Even if code is stolen, attacker</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="178.1533" x="575" y="867.7466">cannot exchange it without</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="166.353" x="575" y="882.8794">the original code_verifier.</text></g></svg></div><div class="puml dark" style=""><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="SEQUENCE" height="957px" preserveAspectRatio="xMidYMid meet" style="width:837px;height:957px;background:#1B1B1B;" version="1.1" viewBox="0 0 837 957" width="837px" zoomAndPan="magnify" class="diagram"><title>PKCE (Proof Key for Code Exchange) Flow</title><defs/><g><rect fill="#1B1B1B" height="957" style="stroke:none;stroke-width:1;" width="837" x="0" y="0"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="329.6768" x="249.8596" y="27.9951">PKCE (Proof Key for Code Exchange) Flow</text><g><title>Authorization</title><rect fill="#313139" height="86.3984" style="stroke:#E7E7E7;stroke-width:1;" width="10" x="559.021" y="384.6172"/></g><g><title>Authorization</title><rect fill="#313139" height="211.6016" style="stroke:#E7E7E7;stroke-width:1;" width="10" x="559.021" y="573.5469"/></g><rect fill="none" height="90.2031" style="stroke:#FFFFFF;stroke-width:1.5;" width="617.9053" x="10" y="687.9453"/><g><title>App .Client.</title><rect fill="#000000" fill-opacity="0.00000" height="816.0547" width="8" x="64.6274" y="89.8906"/><line style="stroke:#E7E7E7;stroke-width:0.5;stroke-dasharray:5,5;" x1="68" x2="68" y1="89.8906" y2="905.9453"/></g><g><title>Authorization</title><rect fill="#000000" fill-opacity="0.00000" height="816.0547" width="8" x="560.021" y="89.8906"/><line style="stroke:#E7E7E7;stroke-width:0.5;stroke-dasharray:5,5;" x1="563.1367" x2="563.1367" y1="89.8906" y2="905.9453"/></g><g class="participant participant-head" data-participant="App"><rect fill="#222222" height="30.2969" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="97.2549" x="20" y="58.5938"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="83.2549" x="27" y="78.5889">App (Client)</text></g><g class="participant participant-tail" data-participant="App"><rect fill="#222222" height="30.2969" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="97.2549" x="20" y="904.9453"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="83.2549" x="27" y="924.9404">App (Client)</text></g><g class="participant participant-head" data-participant="Auth"><rect fill="#222222" height="46.5938" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="107.7686" x="510.1367" y="42.2969"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="93.7686" x="517.1367" y="62.292">Authorization</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="45.9102" x="541.0659" y="78.5889">Server</text></g><g class="participant participant-tail" data-participant="Auth"><rect fill="#222222" height="46.5938" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="107.7686" x="510.1367" y="904.9453"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="93.7686" x="517.1367" y="924.9404">Authorization</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="45.9102" x="541.0659" y="941.2373">Server</text></g><g><title>Authorization</title><rect fill="#313139" height="86.3984" style="stroke:#E7E7E7;stroke-width:1;" width="10" x="559.021" y="384.6172"/></g><g><title>Authorization</title><rect fill="#313139" height="211.6016" style="stroke:#E7E7E7;stroke-width:1;" width="10" x="559.021" y="573.5469"/></g><rect fill="#111111" height="3" style="stroke:#111111;stroke-width:1;" width="830.396" x="0" y="120.457"/><line style="stroke:#FFFFFF;stroke-width:1;" x1="0" x2="830.396" y1="120.457" y2="120.457"/><line style="stroke:#FFFFFF;stroke-width:1;" x1="0" x2="830.396" y1="123.457" y2="123.457"/><rect fill="#111111" height="23.1328" style="stroke:#FFFFFF;stroke-width:2;" width="171.3711" x="329.5125" y="109.8906"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="152.8452" x="335.5125" y="125.9575">Before Authorization</text><g class="message" data-participant-1="App" data-participant-2="App"><line style="stroke:#E7E7E7;stroke-width:1;" x1="68.6274" x2="110.6274" y1="209.5547" y2="209.5547"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="110.6274" x2="110.6274" y1="209.5547" y2="222.5547"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="69.6274" x2="110.6274" y1="222.5547" y2="222.5547"/><polygon fill="#E7E7E7" points="79.6274,218.5547,69.6274,222.5547,79.6274,226.5547,75.6274,222.5547" style="stroke:#E7E7E7;stroke-width:1;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="173.2529" x="75.6274" y="159.0903">1. Generate random string</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="162.7222" x="75.6274" y="174.2231">code_verifier (128 chars)</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="75.6274" y="189.356"> </text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="420.5703" x="75.6274" y="204.4888">Example: &quot;dBjftJeZ4CVP-mB92K27uhbUJU1p1r_wW1gFWFOEjXk&quot;</text></g><g class="message" data-participant-1="App" data-participant-2="App"><line style="stroke:#E7E7E7;stroke-width:1;" x1="68.6274" x2="110.6274" y1="312.2188" y2="312.2188"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="110.6274" x2="110.6274" y1="312.2188" y2="325.2188"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="69.6274" x2="110.6274" y1="325.2188" y2="325.2188"/><polygon fill="#E7E7E7" points="79.6274,321.2188,69.6274,325.2188,79.6274,329.2188,75.6274,325.2188" style="stroke:#E7E7E7;stroke-width:1;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="165.0645" x="75.6274" y="246.6216">2. Create code_challenge</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="145.9072" x="75.6274" y="261.7544">SHA256(code_verifier)</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="159.415" x="75.6274" y="276.8872">then Base64URL encode</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="75.6274" y="292.02"> </text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="481.3936" x="75.6274" y="307.1528">code_challenge = &quot;E9Melhoa2OwvFrEMTJguCHaoeK1t8URWbuGJSstw-cM&quot;</text></g><g class="message" data-participant-1="App" data-participant-2="Auth"><polygon fill="#E7E7E7" points="547.021,380.6172,557.021,384.6172,547.021,388.6172,551.021,384.6172" style="stroke:#E7E7E7;stroke-width:1;"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="68.6274" x2="553.021" y1="384.6172" y2="384.6172"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="193.5337" x="75.6274" y="349.2856">3. Authorization request with:</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="112.7153" x="75.6274" y="364.4185">• code_challenge</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="213.3765" x="75.6274" y="379.5513">• code_challenge_method=S256</text></g><g class="message" data-participant-1="Auth" data-participant-2="Auth"><line style="stroke:#E7E7E7;stroke-width:1;" x1="569.021" x2="611.021" y1="428.8828" y2="428.8828"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="611.021" x2="611.021" y1="428.8828" y2="441.8828"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="570.021" x2="611.021" y1="441.8828" y2="441.8828"/><polygon fill="#E7E7E7" points="580.021,437.8828,570.021,441.8828,580.021,445.8828,576.021,441.8828" style="stroke:#E7E7E7;stroke-width:1;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="139.6929" x="576.021" y="408.6841">Store code_challenge</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="96.7383" x="576.021" y="423.8169">with auth code</text></g><g class="message" data-participant-1="Auth" data-participant-2="App"><polygon fill="#E7E7E7" points="79.6274,467.0156,69.6274,471.0156,79.6274,475.0156,75.6274,471.0156" style="stroke:#E7E7E7;stroke-width:1;"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="73.6274" x2="563.021" y1="471.0156" y2="471.0156"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="176.4839" x="85.6274" y="465.9497">Returns authorization code</text></g><rect fill="#111111" height="3" style="stroke:#111111;stroke-width:1;" width="830.396" x="0" y="499.582"/><line style="stroke:#FFFFFF;stroke-width:1;" x1="0" x2="830.396" y1="499.582" y2="499.582"/><line style="stroke:#FFFFFF;stroke-width:1;" x1="0" x2="830.396" y1="502.582" y2="502.582"/><rect fill="#111111" height="23.1328" style="stroke:#FFFFFF;stroke-width:2;" width="137.9443" x="346.2258" y="489.0156"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="119.4185" x="352.2258" y="505.0825">Token Exchange</text><g class="message" data-participant-1="App" data-participant-2="Auth"><polygon fill="#E7E7E7" points="547.021,569.5469,557.021,573.5469,547.021,577.5469,551.021,573.5469" style="stroke:#E7E7E7;stroke-width:1;"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="68.6274" x2="553.021" y1="573.5469" y2="573.5469"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="146.123" x="75.6274" y="538.2153">4. Token request with:</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="133.4277" x="75.6274" y="553.3481">• authorization code</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="158.6978" x="75.6274" y="568.481">• code_verifier (original)</text></g><g class="message" data-participant-1="Auth" data-participant-2="Auth"><line style="stroke:#E7E7E7;stroke-width:1;" x1="569.021" x2="611.021" y1="617.8125" y2="617.8125"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="611.021" x2="611.021" y1="617.8125" y2="630.8125"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="570.021" x2="611.021" y1="630.8125" y2="630.8125"/><polygon fill="#E7E7E7" points="580.021,626.8125,570.021,630.8125,580.021,634.8125,576.021,630.8125" style="stroke:#E7E7E7;stroke-width:1;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="232.375" x="576.021" y="597.6138">5. Compute challenge from verifier:</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="170.5996" x="576.021" y="612.7466">SHA256(received_verifier)</text></g><g class="message" data-participant-1="Auth" data-participant-2="Auth"><line style="stroke:#E7E7E7;stroke-width:1;" x1="569.021" x2="611.021" y1="659.9453" y2="659.9453"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="611.021" x2="611.021" y1="659.9453" y2="672.9453"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="570.021" x2="611.021" y1="672.9453" y2="672.9453"/><polygon fill="#E7E7E7" points="580.021,668.9453,570.021,672.9453,580.021,676.9453,576.021,672.9453" style="stroke:#E7E7E7;stroke-width:1;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="220.251" x="576.021" y="654.8794">6. Compare with stored challenge</text></g><path d="M10,687.9453 L74.4429,687.9453 L74.4429,695.0781 L64.4429,705.0781 L10,705.0781 L10,687.9453" fill="#555555" style="stroke:#FFFFFF;stroke-width:1.5;"/><rect fill="none" height="90.2031" style="stroke:#FFFFFF;stroke-width:1.5;" width="617.9053" x="10" y="687.9453"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19.4429" x="25" y="701.0122">alt</text><text fill="#FFFFFF" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="119.9043" x="89.4429" y="700.1558">[Challenges Match]</text><g class="message" data-participant-1="Auth" data-participant-2="App"><polygon fill="#E7E7E7" points="79.6274,722.2109,69.6274,726.2109,79.6274,730.2109,75.6274,726.2109" style="stroke:#E7E7E7;stroke-width:1;"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="73.6274" x2="558.021" y1="726.2109" y2="726.2109"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="137.5283" x="85.6274" y="721.145">✓ Issue access token</text></g><line style="stroke:#FFFFFF;stroke-width:1;stroke-dasharray:2,2;" x1="10" x2="627.9053" y1="735.2109" y2="735.2109"/><text fill="#FFFFFF" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="156.8789" x="15" y="745.4214">[Challenges Don't Match]</text><g class="message" data-participant-1="Auth" data-participant-2="App"><polygon fill="#E7E7E7" points="79.6274,766.1484,69.6274,770.1484,79.6274,774.1484,75.6274,770.1484" style="stroke:#E7E7E7;stroke-width:1;"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="73.6274" x2="558.021" y1="770.1484" y2="770.1484"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="140.1245" x="85.6274" y="765.0825">✗ Error: invalid_grant</text></g><path d="M569,790.1484 L569,890.1484 L790,890.1484 L790,800.1484 L780,790.1484 L569,790.1484" fill="#714137" style="stroke:#E7E7E7;stroke-width:0.5;"/><path d="M780,790.1484 L780,800.1484 L790,800.1484 L780,790.1484" fill="#714137" style="stroke:#E7E7E7;stroke-width:0.5;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="82.1577" x="575" y="807.2153">Why PKCE?</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="195.5649" x="575" y="822.3481">Protects against authorization</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="169.9141" x="575" y="837.481">code interception attacks.</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="200.6812" x="575" y="852.6138">Even if code is stolen, attacker</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="178.1533" x="575" y="867.7466">cannot exchange it without</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="166.353" x="575" y="882.8794">the original code_verifier.</text></g></svg></div></div>
<h2 id="smart-scope-hierarchy-and-contexts">SMART Scope Hierarchy and Contexts</h2>
<div class="puml-container"><div class="puml light" style=""><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="DESCRIPTION" height="965px" preserveAspectRatio="xMidYMid meet" style="width:1052px;height:965px;background:#FFFFFF;" version="1.1" viewBox="0 0 1052 965" width="1052px" zoomAndPan="magnify" class="diagram"><title>SMART Scope Hierarchy and Contexts</title><defs/><g><g class="title" data-source-line="3"><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="298.3887" x="370.0507" y="22.9951">SMART Scope Hierarchy and Contexts</text></g><g class="cluster" data-entity="Context Scopes" data-source-line="7" data-uid="ent0002" id="cluster_Context Scopes"><rect fill="none" height="259" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:1;" width="493.75" x="24.39" y="700.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="122.4932" x="27.39" y="715.292">Context Scopes</text></g><g class="cluster" data-entity="Patient-Specific Scopes" data-source-line="17" data-uid="ent0009" id="cluster_Patient-Specific Scopes"><rect fill="none" height="178" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:1;" width="1039.49" x="7" y="498.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="185.7734" x="10" y="513.292">Patient-Specific Scopes</text></g><g class="cluster" data-entity="User Scopes" data-source-line="34" data-uid="ent0021" id="cluster_User Scopes"><rect fill="none" height="107" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:1;" width="997.71" x="46.55" y="367.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="96.8242" x="49.55" y="382.292">User Scopes</text></g><g class="cluster" data-entity="System Scopes" data-source-line="48" data-uid="ent0030" id="cluster_System Scopes"><rect fill="none" height="97" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:1;" width="776.11" x="36.51" y="246.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="119.041" x="39.51" y="261.292">System Scopes</text></g><g class="cluster" data-entity="Special Scopes" data-source-line="58" data-uid="ent0037" id="cluster_Special Scopes"><rect fill="none" height="178" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:1;" width="760.43" x="36.88" y="44.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="117.667" x="39.88" y="59.292">Special Scopes</text></g><g class="entity" data-entity="LP" data-source-line="8" data-uid="ent0003" id="entity_LP"><rect fill="#F1F1F1" height="46.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="141.3223" x="51.15" y="897.1469"/><rect fill="#F1F1F1" height="10" style="stroke:#181818;stroke-width:0.5;" width="15" x="172.4723" y="902.1469"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="170.4723" y="904.1469"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="170.4723" y="908.1469"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="101.3223" x="66.15" y="930.142">launch/patient</text></g><g class="entity" data-entity="LE" data-source-line="9" data-uid="ent0004" id="entity_LE"><rect fill="#F1F1F1" height="46.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="162.8555" x="40.39" y="816.1469"/><rect fill="#F1F1F1" height="10" style="stroke:#181818;stroke-width:0.5;" width="15" x="183.2455" y="821.1469"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="181.2455" y="823.1469"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="181.2455" y="827.1469"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="122.8555" x="55.39" y="849.142">launch/encounter</text></g><g class="entity" data-entity="L" data-source-line="10" data-uid="ent0005" id="entity_L"><rect fill="#F1F1F1" height="46.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="86.7852" x="78.42" y="735.1469"/><rect fill="#F1F1F1" height="10" style="stroke:#181818;stroke-width:0.5;" width="15" x="145.2052" y="740.1469"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="143.2052" y="742.1469"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="143.2052" y="746.1469"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="46.7852" x="93.42" y="768.142">launch</text></g><g class="entity" data-entity="GMN6" data-source-line="12" data-uid="ent0007" id="entity_GMN6"><path d="M324,738.1669 L324,754.2969 L165.5,758.2969 L324,762.2969 L324,778.4325 A0,0 0 0 0 324,778.4325 L502.1426,778.4325 A0,0 0 0 0 502.1426,778.4325 L502.1426,748.1669 L492.1426,738.1669 L324,738.1669 A0,0 0 0 0 324,738.1669" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M492.1426,738.1669 L492.1426,748.1669 L502.1426,748.1669 L492.1426,738.1669" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="157.1426" x="330" y="755.2338">Request patient context</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="109.2686" x="330" y="770.3666">from EHR launch</text></g><g class="entity" data-entity="PR" data-source-line="19" data-uid="ent0010" id="entity_PR"><rect fill="#F1F1F1" height="46.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="137.8223" x="52.9" y="614.1469"/><rect fill="#F1F1F1" height="10" style="stroke:#181818;stroke-width:0.5;" width="15" x="170.7223" y="619.1469"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="168.7223" y="621.1469"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="168.7223" y="625.1469"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="97.8223" x="67.9" y="647.142">patient/*.read</text></g><g class="entity" data-entity="PW" data-source-line="20" data-uid="ent0011" id="entity_PW"><rect fill="#F1F1F1" height="46.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="141.1855" x="342.48" y="614.1469"/><rect fill="#F1F1F1" height="10" style="stroke:#181818;stroke-width:0.5;" width="15" x="463.6655" y="619.1469"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="461.6655" y="621.1469"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="461.6655" y="625.1469"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="101.1855" x="357.48" y="647.142">patient/*.write</text></g><g class="entity" data-entity="POR" data-source-line="21" data-uid="ent0012" id="entity_POR"><rect fill="#F1F1F1" height="46.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="216.0732" x="605.51" y="614.1469"/><rect fill="#F1F1F1" height="10" style="stroke:#181818;stroke-width:0.5;" width="15" x="801.5832" y="619.1469"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="799.5832" y="621.1469"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="799.5832" y="625.1469"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="176.0732" x="620.51" y="647.142">patient/Observation.read</text></g><g class="entity" data-entity="GMN13" data-source-line="23" data-uid="ent0014" id="entity_GMN13"><path d="M881.58,617.1669 L881.58,633.2969 L821.78,637.2969 L881.58,641.2969 L881.58,657.4325 A0,0 0 0 0 881.58,657.4325 L1030.4853,657.4325 A0,0 0 0 0 1030.4853,657.4325 L1030.4853,627.1669 L1020.4853,617.1669 L881.58,617.1669 A0,0 0 0 0 881.58,617.1669" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1020.4853,617.1669 L1020.4853,627.1669 L1030.4853,627.1669 L1020.4853,617.1669" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="127.9053" x="887.58" y="634.2338">Access only current</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="90.0225" x="887.58" y="649.3666">patient's data</text></g><g class="entity" data-entity="PCR" data-source-line="29" data-uid="ent0018" id="entity_PCR"><rect fill="#F1F1F1" height="46.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="197.6299" x="23" y="533.1469"/><rect fill="#F1F1F1" height="10" style="stroke:#181818;stroke-width:0.5;" width="15" x="200.6299" y="538.1469"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="198.6299" y="540.1469"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="198.6299" y="544.1469"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="157.6299" x="38" y="566.142">patient/Condition.read</text></g><g class="entity" data-entity="PMR" data-source-line="30" data-uid="ent0019" id="entity_PMR"><rect fill="#F1F1F1" height="46.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="264.8818" x="280.63" y="533.1469"/><rect fill="#F1F1F1" height="10" style="stroke:#181818;stroke-width:0.5;" width="15" x="525.5118" y="538.1469"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="523.5118" y="540.1469"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="523.5118" y="544.1469"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="224.8818" x="295.63" y="566.142">patient/MedicationRequest.read</text></g><g class="entity" data-entity="UR" data-source-line="36" data-uid="ent0022" id="entity_UR"><rect fill="#F1F1F1" height="46.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="118.5381" x="62.55" y="407.1469"/><rect fill="#F1F1F1" height="10" style="stroke:#181818;stroke-width:0.5;" width="15" x="161.0881" y="412.1469"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="159.0881" y="414.1469"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="159.0881" y="418.1469"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="78.5381" x="77.55" y="440.142">user/*.read</text></g><g class="entity" data-entity="UW" data-source-line="37" data-uid="ent0023" id="entity_UW"><rect fill="#F1F1F1" height="46.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="121.9014" x="352.12" y="407.1469"/><rect fill="#F1F1F1" height="10" style="stroke:#181818;stroke-width:0.5;" width="15" x="454.0214" y="412.1469"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="452.0214" y="414.1469"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="452.0214" y="418.1469"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="81.9014" x="367.12" y="440.142">user/*.write</text></g><g class="entity" data-entity="UPR" data-source-line="38" data-uid="ent0024" id="entity_UPR"><rect fill="#F1F1F1" height="46.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="192.5781" x="617.26" y="407.1469"/><rect fill="#F1F1F1" height="10" style="stroke:#181818;stroke-width:0.5;" width="15" x="789.8381" y="412.1469"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="787.8381" y="414.1469"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="787.8381" y="418.1469"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="152.5781" x="632.26" y="440.142">user/Practitioner.read</text></g><g class="entity" data-entity="GMN25" data-source-line="40" data-uid="ent0026" id="entity_GMN25"><path d="M883.82,402.5969 L883.82,426.2969 L810.29,430.2969 L883.82,434.2969 L883.82,457.9953 A0,0 0 0 0 883.82,457.9953 L1028.2565,457.9953 A0,0 0 0 0 1028.2565,457.9953 L1028.2565,412.5969 L1018.2565,402.5969 L883.82,402.5969 A0,0 0 0 0 883.82,402.5969" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1018.2565,402.5969 L1018.2565,412.5969 L1028.2565,412.5969 L1018.2565,402.5969" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="122.9351" x="889.82" y="419.6638">Access all data the</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="123.4365" x="889.82" y="434.7966">authenticated user</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="71.2905" x="889.82" y="449.9294">can access</text></g><g class="entity" data-entity="SR" data-source-line="49" data-uid="ent0031" id="entity_SR"><rect fill="#F1F1F1" height="46.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="138.6152" x="52.51" y="281.1469"/><rect fill="#F1F1F1" height="10" style="stroke:#181818;stroke-width:0.5;" width="15" x="171.1252" y="286.1469"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="169.1252" y="288.1469"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="169.1252" y="292.1469"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="98.6152" x="67.51" y="314.142">system/*.read</text></g><g class="entity" data-entity="SW" data-source-line="50" data-uid="ent0032" id="entity_SW"><rect fill="#F1F1F1" height="46.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="141.9785" x="342.08" y="281.1469"/><rect fill="#F1F1F1" height="10" style="stroke:#181818;stroke-width:0.5;" width="15" x="464.0585" y="286.1469"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="462.0585" y="288.1469"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="462.0585" y="292.1469"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="101.9785" x="357.08" y="314.142">system/*.write</text></g><g class="entity" data-entity="GMN33" data-source-line="52" data-uid="ent0034" id="entity_GMN33"><path d="M630.47,284.1669 L630.47,300.2969 L484.43,304.2969 L630.47,308.2969 L630.47,324.4325 A0,0 0 0 0 630.47,324.4325 L796.6219,324.4325 A0,0 0 0 0 796.6219,324.4325 L796.6219,294.1669 L786.6219,284.1669 L630.47,284.1669 A0,0 0 0 0 630.47,284.1669" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M786.6219,284.1669 L786.6219,294.1669 L796.6219,294.1669 L786.6219,284.1669" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="145.1519" x="636.47" y="301.2338">Backend services only</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="103.5239" x="636.47" y="316.3666">No user context</text></g><g class="entity" data-entity="OID" data-source-line="60" data-uid="ent0038" id="entity_OID"><rect fill="#F1F1F1" height="46.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="87.7148" x="77.96" y="160.1469"/><rect fill="#F1F1F1" height="10" style="stroke:#181818;stroke-width:0.5;" width="15" x="145.6748" y="165.1469"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="143.6748" y="167.1469"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="143.6748" y="171.1469"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="47.7148" x="92.96" y="193.142">openid</text></g><g class="entity" data-entity="FU" data-source-line="61" data-uid="ent0039" id="entity_FU"><rect fill="#F1F1F1" height="46.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="95.3574" x="365.39" y="160.1469"/><rect fill="#F1F1F1" height="10" style="stroke:#181818;stroke-width:0.5;" width="15" x="440.7474" y="165.1469"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="438.7474" y="167.1469"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="438.7474" y="171.1469"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="55.3574" x="380.39" y="193.142">fhirUser</text></g><g class="entity" data-entity="GMN40" data-source-line="63" data-uid="ent0041" id="entity_GMN40"><path d="M649.82,163.1669 L649.82,179.2969 L461.04,183.2969 L649.82,187.2969 L649.82,203.4325 A0,0 0 0 0 649.82,203.4325 L777.2702,203.4325 A0,0 0 0 0 777.2702,203.4325 L777.2702,173.1669 L767.2702,163.1669 L649.82,163.1669 A0,0 0 0 0 649.82,163.1669" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M767.2702,163.1669 L767.2702,173.1669 L777.2702,173.1669 L767.2702,163.1669" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="106.4502" x="655.82" y="180.2338">OpenID Connect</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="94.5039" x="655.82" y="195.3666">authentication</text></g><g class="entity" data-entity="OA" data-source-line="68" data-uid="ent0044" id="entity_OA"><rect fill="#F1F1F1" height="46.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="137.8633" x="52.88" y="79.1469"/><rect fill="#F1F1F1" height="10" style="stroke:#181818;stroke-width:0.5;" width="15" x="170.7433" y="84.1469"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="168.7433" y="86.1469"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="168.7433" y="90.1469"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="97.8633" x="67.88" y="112.142">offline_access</text></g><g class="entity" data-entity="ONA" data-source-line="69" data-uid="ent0045" id="entity_ONA"><rect fill="#F1F1F1" height="46.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="136.8789" x="344.63" y="79.1469"/><rect fill="#F1F1F1" height="10" style="stroke:#181818;stroke-width:0.5;" width="15" x="461.5089" y="84.1469"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="459.5089" y="86.1469"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="459.5089" y="90.1469"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="96.8789" x="359.63" y="112.142">online_access</text></g><g class="entity" data-entity="GMN46" data-source-line="71" data-uid="ent0047" id="entity_GMN46"><path d="M645.79,82.1669 L645.79,98.2969 L481.8,102.2969 L645.79,106.2969 L645.79,122.4325 A0,0 0 0 0 645.79,122.4325 L781.3144,122.4325 A0,0 0 0 0 781.3144,122.4325 L781.3144,92.1669 L771.3144,82.1669 L645.79,82.1669 A0,0 0 0 0 645.79,82.1669" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M771.3144,82.1669 L771.3144,92.1669 L781.3144,92.1669 L771.3144,82.1669" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="114.5244" x="651.79" y="99.2338">Get refresh token</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="110.5127" x="651.79" y="114.3666">for offline access</text></g></g></svg></div><div class="puml dark" style=""><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="DESCRIPTION" height="965px" preserveAspectRatio="xMidYMid meet" style="width:1052px;height:965px;background:#1B1B1B;" version="1.1" viewBox="0 0 1052 965" width="1052px" zoomAndPan="magnify" class="diagram"><title>SMART Scope Hierarchy and Contexts</title><defs/><g><rect fill="#1B1B1B" height="965" style="stroke:none;stroke-width:1;" width="1052" x="0" y="0"/><g class="title" data-source-line="3"><text fill="#FFFFFF" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="298.3887" x="370.0507" y="22.9951">SMART Scope Hierarchy and Contexts</text></g><g class="cluster" data-entity="Context Scopes" data-source-line="7" data-uid="ent0002" id="cluster_Context Scopes"><rect fill="none" height="259" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:1;" width="493.75" x="24.39" y="700.2969"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="122.4932" x="27.39" y="715.292">Context Scopes</text></g><g class="cluster" data-entity="Patient-Specific Scopes" data-source-line="17" data-uid="ent0009" id="cluster_Patient-Specific Scopes"><rect fill="none" height="178" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:1;" width="1039.49" x="7" y="498.2969"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="185.7734" x="10" y="513.292">Patient-Specific Scopes</text></g><g class="cluster" data-entity="User Scopes" data-source-line="34" data-uid="ent0021" id="cluster_User Scopes"><rect fill="none" height="107" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:1;" width="997.71" x="46.55" y="367.2969"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="96.8242" x="49.55" y="382.292">User Scopes</text></g><g class="cluster" data-entity="System Scopes" data-source-line="48" data-uid="ent0030" id="cluster_System Scopes"><rect fill="none" height="97" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:1;" width="776.11" x="36.51" y="246.2969"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="119.041" x="39.51" y="261.292">System Scopes</text></g><g class="cluster" data-entity="Special Scopes" data-source-line="58" data-uid="ent0037" id="cluster_Special Scopes"><rect fill="none" height="178" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:1;" width="760.43" x="36.88" y="44.2969"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="117.667" x="39.88" y="59.292">Special Scopes</text></g><g class="entity" data-entity="LP" data-source-line="8" data-uid="ent0003" id="entity_LP"><rect fill="#313139" height="46.2969" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="141.3223" x="51.15" y="897.1469"/><rect fill="#313139" height="10" style="stroke:#E7E7E7;stroke-width:0.5;" width="15" x="172.4723" y="902.1469"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="170.4723" y="904.1469"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="170.4723" y="908.1469"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="101.3223" x="66.15" y="930.142">launch/patient</text></g><g class="entity" data-entity="LE" data-source-line="9" data-uid="ent0004" id="entity_LE"><rect fill="#313139" height="46.2969" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="162.8555" x="40.39" y="816.1469"/><rect fill="#313139" height="10" style="stroke:#E7E7E7;stroke-width:0.5;" width="15" x="183.2455" y="821.1469"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="181.2455" y="823.1469"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="181.2455" y="827.1469"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="122.8555" x="55.39" y="849.142">launch/encounter</text></g><g class="entity" data-entity="L" data-source-line="10" data-uid="ent0005" id="entity_L"><rect fill="#313139" height="46.2969" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="86.7852" x="78.42" y="735.1469"/><rect fill="#313139" height="10" style="stroke:#E7E7E7;stroke-width:0.5;" width="15" x="145.2052" y="740.1469"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="143.2052" y="742.1469"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="143.2052" y="746.1469"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="46.7852" x="93.42" y="768.142">launch</text></g><g class="entity" data-entity="GMN6" data-source-line="12" data-uid="ent0007" id="entity_GMN6"><path d="M324,738.1669 L324,754.2969 L165.5,758.2969 L324,762.2969 L324,778.4325 A0,0 0 0 0 324,778.4325 L502.1426,778.4325 A0,0 0 0 0 502.1426,778.4325 L502.1426,748.1669 L492.1426,738.1669 L324,738.1669 A0,0 0 0 0 324,738.1669" fill="#714137" style="stroke:#E7E7E7;stroke-width:0.5;"/><path d="M492.1426,738.1669 L492.1426,748.1669 L502.1426,748.1669 L492.1426,738.1669" fill="#714137" style="stroke:#E7E7E7;stroke-width:0.5;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="157.1426" x="330" y="755.2338">Request patient context</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="109.2686" x="330" y="770.3666">from EHR launch</text></g><g class="entity" data-entity="PR" data-source-line="19" data-uid="ent0010" id="entity_PR"><rect fill="#313139" height="46.2969" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="137.8223" x="52.9" y="614.1469"/><rect fill="#313139" height="10" style="stroke:#E7E7E7;stroke-width:0.5;" width="15" x="170.7223" y="619.1469"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="168.7223" y="621.1469"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="168.7223" y="625.1469"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="97.8223" x="67.9" y="647.142">patient/*.read</text></g><g class="entity" data-entity="PW" data-source-line="20" data-uid="ent0011" id="entity_PW"><rect fill="#313139" height="46.2969" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="141.1855" x="342.48" y="614.1469"/><rect fill="#313139" height="10" style="stroke:#E7E7E7;stroke-width:0.5;" width="15" x="463.6655" y="619.1469"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="461.6655" y="621.1469"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="461.6655" y="625.1469"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="101.1855" x="357.48" y="647.142">patient/*.write</text></g><g class="entity" data-entity="POR" data-source-line="21" data-uid="ent0012" id="entity_POR"><rect fill="#313139" height="46.2969" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="216.0732" x="605.51" y="614.1469"/><rect fill="#313139" height="10" style="stroke:#E7E7E7;stroke-width:0.5;" width="15" x="801.5832" y="619.1469"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="799.5832" y="621.1469"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="799.5832" y="625.1469"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="176.0732" x="620.51" y="647.142">patient/Observation.read</text></g><g class="entity" data-entity="GMN13" data-source-line="23" data-uid="ent0014" id="entity_GMN13"><path d="M881.58,617.1669 L881.58,633.2969 L821.78,637.2969 L881.58,641.2969 L881.58,657.4325 A0,0 0 0 0 881.58,657.4325 L1030.4853,657.4325 A0,0 0 0 0 1030.4853,657.4325 L1030.4853,627.1669 L1020.4853,617.1669 L881.58,617.1669 A0,0 0 0 0 881.58,617.1669" fill="#714137" style="stroke:#E7E7E7;stroke-width:0.5;"/><path d="M1020.4853,617.1669 L1020.4853,627.1669 L1030.4853,627.1669 L1020.4853,617.1669" fill="#714137" style="stroke:#E7E7E7;stroke-width:0.5;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="127.9053" x="887.58" y="634.2338">Access only current</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="90.0225" x="887.58" y="649.3666">patient's data</text></g><g class="entity" data-entity="PCR" data-source-line="29" data-uid="ent0018" id="entity_PCR"><rect fill="#313139" height="46.2969" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="197.6299" x="23" y="533.1469"/><rect fill="#313139" height="10" style="stroke:#E7E7E7;stroke-width:0.5;" width="15" x="200.6299" y="538.1469"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="198.6299" y="540.1469"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="198.6299" y="544.1469"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="157.6299" x="38" y="566.142">patient/Condition.read</text></g><g class="entity" data-entity="PMR" data-source-line="30" data-uid="ent0019" id="entity_PMR"><rect fill="#313139" height="46.2969" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="264.8818" x="280.63" y="533.1469"/><rect fill="#313139" height="10" style="stroke:#E7E7E7;stroke-width:0.5;" width="15" x="525.5118" y="538.1469"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="523.5118" y="540.1469"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="523.5118" y="544.1469"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="224.8818" x="295.63" y="566.142">patient/MedicationRequest.read</text></g><g class="entity" data-entity="UR" data-source-line="36" data-uid="ent0022" id="entity_UR"><rect fill="#313139" height="46.2969" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="118.5381" x="62.55" y="407.1469"/><rect fill="#313139" height="10" style="stroke:#E7E7E7;stroke-width:0.5;" width="15" x="161.0881" y="412.1469"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="159.0881" y="414.1469"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="159.0881" y="418.1469"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="78.5381" x="77.55" y="440.142">user/*.read</text></g><g class="entity" data-entity="UW" data-source-line="37" data-uid="ent0023" id="entity_UW"><rect fill="#313139" height="46.2969" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="121.9014" x="352.12" y="407.1469"/><rect fill="#313139" height="10" style="stroke:#E7E7E7;stroke-width:0.5;" width="15" x="454.0214" y="412.1469"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="452.0214" y="414.1469"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="452.0214" y="418.1469"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="81.9014" x="367.12" y="440.142">user/*.write</text></g><g class="entity" data-entity="UPR" data-source-line="38" data-uid="ent0024" id="entity_UPR"><rect fill="#313139" height="46.2969" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="192.5781" x="617.26" y="407.1469"/><rect fill="#313139" height="10" style="stroke:#E7E7E7;stroke-width:0.5;" width="15" x="789.8381" y="412.1469"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="787.8381" y="414.1469"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="787.8381" y="418.1469"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="152.5781" x="632.26" y="440.142">user/Practitioner.read</text></g><g class="entity" data-entity="GMN25" data-source-line="40" data-uid="ent0026" id="entity_GMN25"><path d="M883.82,402.5969 L883.82,426.2969 L810.29,430.2969 L883.82,434.2969 L883.82,457.9953 A0,0 0 0 0 883.82,457.9953 L1028.2565,457.9953 A0,0 0 0 0 1028.2565,457.9953 L1028.2565,412.5969 L1018.2565,402.5969 L883.82,402.5969 A0,0 0 0 0 883.82,402.5969" fill="#714137" style="stroke:#E7E7E7;stroke-width:0.5;"/><path d="M1018.2565,402.5969 L1018.2565,412.5969 L1028.2565,412.5969 L1018.2565,402.5969" fill="#714137" style="stroke:#E7E7E7;stroke-width:0.5;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="122.9351" x="889.82" y="419.6638">Access all data the</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="123.4365" x="889.82" y="434.7966">authenticated user</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="71.2905" x="889.82" y="449.9294">can access</text></g><g class="entity" data-entity="SR" data-source-line="49" data-uid="ent0031" id="entity_SR"><rect fill="#313139" height="46.2969" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="138.6152" x="52.51" y="281.1469"/><rect fill="#313139" height="10" style="stroke:#E7E7E7;stroke-width:0.5;" width="15" x="171.1252" y="286.1469"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="169.1252" y="288.1469"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="169.1252" y="292.1469"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="98.6152" x="67.51" y="314.142">system/*.read</text></g><g class="entity" data-entity="SW" data-source-line="50" data-uid="ent0032" id="entity_SW"><rect fill="#313139" height="46.2969" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="141.9785" x="342.08" y="281.1469"/><rect fill="#313139" height="10" style="stroke:#E7E7E7;stroke-width:0.5;" width="15" x="464.0585" y="286.1469"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="462.0585" y="288.1469"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="462.0585" y="292.1469"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="101.9785" x="357.08" y="314.142">system/*.write</text></g><g class="entity" data-entity="GMN33" data-source-line="52" data-uid="ent0034" id="entity_GMN33"><path d="M630.47,284.1669 L630.47,300.2969 L484.43,304.2969 L630.47,308.2969 L630.47,324.4325 A0,0 0 0 0 630.47,324.4325 L796.6219,324.4325 A0,0 0 0 0 796.6219,324.4325 L796.6219,294.1669 L786.6219,284.1669 L630.47,284.1669 A0,0 0 0 0 630.47,284.1669" fill="#714137" style="stroke:#E7E7E7;stroke-width:0.5;"/><path d="M786.6219,284.1669 L786.6219,294.1669 L796.6219,294.1669 L786.6219,284.1669" fill="#714137" style="stroke:#E7E7E7;stroke-width:0.5;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="145.1519" x="636.47" y="301.2338">Backend services only</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="103.5239" x="636.47" y="316.3666">No user context</text></g><g class="entity" data-entity="OID" data-source-line="60" data-uid="ent0038" id="entity_OID"><rect fill="#313139" height="46.2969" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="87.7148" x="77.96" y="160.1469"/><rect fill="#313139" height="10" style="stroke:#E7E7E7;stroke-width:0.5;" width="15" x="145.6748" y="165.1469"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="143.6748" y="167.1469"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="143.6748" y="171.1469"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="47.7148" x="92.96" y="193.142">openid</text></g><g class="entity" data-entity="FU" data-source-line="61" data-uid="ent0039" id="entity_FU"><rect fill="#313139" height="46.2969" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="95.3574" x="365.39" y="160.1469"/><rect fill="#313139" height="10" style="stroke:#E7E7E7;stroke-width:0.5;" width="15" x="440.7474" y="165.1469"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="438.7474" y="167.1469"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="438.7474" y="171.1469"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="55.3574" x="380.39" y="193.142">fhirUser</text></g><g class="entity" data-entity="GMN40" data-source-line="63" data-uid="ent0041" id="entity_GMN40"><path d="M649.82,163.1669 L649.82,179.2969 L461.04,183.2969 L649.82,187.2969 L649.82,203.4325 A0,0 0 0 0 649.82,203.4325 L777.2702,203.4325 A0,0 0 0 0 777.2702,203.4325 L777.2702,173.1669 L767.2702,163.1669 L649.82,163.1669 A0,0 0 0 0 649.82,163.1669" fill="#714137" style="stroke:#E7E7E7;stroke-width:0.5;"/><path d="M767.2702,163.1669 L767.2702,173.1669 L777.2702,173.1669 L767.2702,163.1669" fill="#714137" style="stroke:#E7E7E7;stroke-width:0.5;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="106.4502" x="655.82" y="180.2338">OpenID Connect</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="94.5039" x="655.82" y="195.3666">authentication</text></g><g class="entity" data-entity="OA" data-source-line="68" data-uid="ent0044" id="entity_OA"><rect fill="#313139" height="46.2969" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="137.8633" x="52.88" y="79.1469"/><rect fill="#313139" height="10" style="stroke:#E7E7E7;stroke-width:0.5;" width="15" x="170.7433" y="84.1469"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="168.7433" y="86.1469"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="168.7433" y="90.1469"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="97.8633" x="67.88" y="112.142">offline_access</text></g><g class="entity" data-entity="ONA" data-source-line="69" data-uid="ent0045" id="entity_ONA"><rect fill="#313139" height="46.2969" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="136.8789" x="344.63" y="79.1469"/><rect fill="#313139" height="10" style="stroke:#E7E7E7;stroke-width:0.5;" width="15" x="461.5089" y="84.1469"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="459.5089" y="86.1469"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="459.5089" y="90.1469"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="96.8789" x="359.63" y="112.142">online_access</text></g><g class="entity" data-entity="GMN46" data-source-line="71" data-uid="ent0047" id="entity_GMN46"><path d="M645.79,82.1669 L645.79,98.2969 L481.8,102.2969 L645.79,106.2969 L645.79,122.4325 A0,0 0 0 0 645.79,122.4325 L781.3144,122.4325 A0,0 0 0 0 781.3144,122.4325 L781.3144,92.1669 L771.3144,82.1669 L645.79,82.1669 A0,0 0 0 0 645.79,82.1669" fill="#714137" style="stroke:#E7E7E7;stroke-width:0.5;"/><path d="M771.3144,82.1669 L771.3144,92.1669 L781.3144,92.1669 L771.3144,82.1669" fill="#714137" style="stroke:#E7E7E7;stroke-width:0.5;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="114.5244" x="651.79" y="99.2338">Get refresh token</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="110.5127" x="651.79" y="114.3666">for offline access</text></g></g></svg></div></div>
<h2 id="smart-on-fhir-error-handling-patterns">SMART-on-FHIR Error Handling Patterns</h2>
<div class="puml-container"><div class="puml light" style=""><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="SEQUENCE" height="1742px" preserveAspectRatio="xMidYMid meet" style="width:485px;height:1742px;background:#FFFFFF;" version="1.1" viewBox="0 0 485 1742" width="485px" zoomAndPan="magnify" class="diagram"><title>SMART-on-FHIR Error Handling Patterns</title><defs/><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="316.7021" x="80.1904" y="27.9951">SMART-on-FHIR Error Handling Patterns</text><rect fill="none" height="190.6016" style="stroke:#000000;stroke-width:1.5;" width="458.083" x="10" y="675.7813"/><g><title>App</title><rect fill="#000000" fill-opacity="0.00000" height="1633.8359" width="8" x="36.6753" y="73.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="40" x2="40" y1="73.5938" y2="1707.4297"/></g><g><title>Auth Server</title><rect fill="#000000" fill-opacity="0.00000" height="1633.8359" width="8" x="298.6997" y="73.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="302.1133" x2="302.1133" y1="73.5938" y2="1707.4297"/></g><g><title>FHIR Server</title><rect fill="#000000" fill-opacity="0.00000" height="1633.8359" width="8" x="405.6846" y="73.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="409.2861" x2="409.2861" y1="73.5938" y2="1707.4297"/></g><g class="participant participant-head" data-participant="App"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="41.3506" x="20" y="42.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="27.3506" x="27" y="62.292">App</text></g><g class="participant participant-tail" data-participant="App"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="41.3506" x="20" y="1706.4297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="27.3506" x="27" y="1726.4248">App</text></g><g class="participant participant-head" data-participant="Auth"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="97.1729" x="254.1133" y="42.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="83.1729" x="261.1133" y="62.292">Auth Server</text></g><g class="participant participant-tail" data-participant="Auth"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="97.1729" x="254.1133" y="1706.4297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="83.1729" x="261.1133" y="1726.4248">Auth Server</text></g><g class="participant participant-head" data-participant="FHIR"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="96.7969" x="361.2861" y="42.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="82.7969" x="368.2861" y="62.292">FHIR Server</text></g><g class="participant participant-tail" data-participant="FHIR"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="96.7969" x="361.2861" y="1706.4297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="82.7969" x="368.2861" y="1726.4248">FHIR Server</text></g><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="478.083" x="0" y="104.1602"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="478.083" y1="104.1602" y2="104.1602"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="478.083" y1="107.1602" y2="107.1602"/><rect fill="#EEEEEE" height="23.1328" style="stroke:#000000;stroke-width:2;" width="167.6133" x="155.2349" y="93.5938"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="149.0874" x="161.2349" y="109.6606">Authorization Errors</text><g class="message" data-participant-1="App" data-participant-2="Auth"><polygon fill="#181818" points="290.6997,143.8594,300.6997,147.8594,290.6997,151.8594,294.6997,147.8594" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="40.6753" x2="296.6997" y1="147.8594" y2="147.8594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="140.9053" x="47.6753" y="142.7935">Authorization request</text></g><g class="message" data-participant-1="Auth" data-participant-2="App"><polygon fill="#181818" points="51.6753,203.2578,41.6753,207.2578,51.6753,211.2578,47.6753,207.2578" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="45.6753" x2="301.6997" y1="207.2578" y2="207.2578"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="91.5078" x="57.6753" y="171.9263">Error redirect:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="144.4346" x="57.6753" y="187.0591">?error=access_denied</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="209.9106" x="57.6753" y="202.1919">&amp;error_description=User denied</text></g><g class="message" data-participant-1="App" data-participant-2="App"><line style="stroke:#181818;stroke-width:1;" x1="40.6753" x2="82.6753" y1="281.7891" y2="281.7891"/><line style="stroke:#181818;stroke-width:1;" x1="82.6753" x2="82.6753" y1="281.7891" y2="294.7891"/><line style="stroke:#181818;stroke-width:1;" x1="41.6753" x2="82.6753" y1="294.7891" y2="294.7891"/><polygon fill="#181818" points="51.6753,290.7891,41.6753,294.7891,51.6753,298.7891,47.6753,294.7891" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="86.3408" x="47.6753" y="231.3247">Handle error:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="71.3667" x="47.6753" y="246.4575">• Log error</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="141.9209" x="47.6753" y="261.5903">• Show user message</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="124.4521" x="47.6753" y="276.7231">• Redirect to home</text></g><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="478.083" x="0" y="323.3555"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="478.083" y1="323.3555" y2="323.3555"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="478.083" y1="326.3555" y2="326.3555"/><rect fill="#EEEEEE" height="23.1328" style="stroke:#000000;stroke-width:2;" width="187.2529" x="145.415" y="312.7891"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="168.7271" x="151.415" y="328.856">Token Exchange Errors</text><g class="message" data-participant-1="App" data-participant-2="Auth"><polygon fill="#181818" points="290.6997,363.0547,300.6997,367.0547,290.6997,371.0547,294.6997,367.0547" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="40.6753" x2="296.6997" y1="367.0547" y2="367.0547"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="193.9082" x="47.6753" y="361.9888">POST /token with invalid code</text></g><g class="message" data-participant-1="Auth" data-participant-2="App"><polygon fill="#181818" points="51.6753,452.7188,41.6753,456.7188,51.6753,460.7188,47.6753,456.7188" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="45.6753" x2="301.6997" y1="456.7188" y2="456.7188"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="111.6045" x="57.6753" y="391.1216">400 Bad Request</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8.271" x="57.6753" y="406.2544">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="152.9341" x="65.9399" y="421.3872">&quot;error&quot;: &quot;invalid_grant&quot;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="229.7598" x="65.9399" y="436.52">&quot;error_description&quot;: &quot;Code expired&quot;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8.271" x="57.6753" y="451.6528">}</text></g><g class="message" data-participant-1="App" data-participant-2="App"><line style="stroke:#181818;stroke-width:1;" x1="40.6753" x2="82.6753" y1="516.1172" y2="516.1172"/><line style="stroke:#181818;stroke-width:1;" x1="82.6753" x2="82.6753" y1="516.1172" y2="529.1172"/><line style="stroke:#181818;stroke-width:1;" x1="41.6753" x2="82.6753" y1="529.1172" y2="529.1172"/><polygon fill="#181818" points="51.6753,525.1172,41.6753,529.1172,51.6753,533.1172,47.6753,529.1172" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="86.3408" x="47.6753" y="480.7856">Handle error:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="98.0522" x="47.6753" y="495.9185">• Clear session</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="123.6904" x="47.6753" y="511.0513">• Restart auth flow</text></g><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="478.083" x="0" y="557.6836"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="478.083" y1="557.6836" y2="557.6836"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="478.083" y1="560.6836" y2="560.6836"/><rect fill="#EEEEEE" height="23.1328" style="stroke:#000000;stroke-width:2;" width="123.1289" x="177.4771" y="547.1172"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="104.603" x="183.4771" y="563.1841">Expired Token</text><g class="message" data-participant-1="App" data-participant-2="FHIR"><polygon fill="#181818" points="397.6846,597.3828,407.6846,601.3828,397.6846,605.3828,401.6846,601.3828" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="40.6753" x2="403.6846" y1="601.3828" y2="601.3828"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="200.3447" x="47.6753" y="596.3169">API request with expired token</text></g><g class="message" data-participant-1="FHIR" data-participant-2="App"><polygon fill="#181818" points="51.6753,656.7813,41.6753,660.7813,51.6753,664.7813,47.6753,660.7813" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="45.6753" x2="408.6846" y1="660.7813" y2="660.7813"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="116.2256" x="57.6753" y="625.4497">401 Unauthorized</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="178.9595" x="57.6753" y="640.5825">WWW-Authenticate: Bearer</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="141.1401" x="65.9399" y="655.7153">error=&quot;invalid_token&quot;</text></g><path d="M10,675.7813 L74.4429,675.7813 L74.4429,682.9141 L64.4429,692.9141 L10,692.9141 L10,675.7813" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="190.6016" style="stroke:#000000;stroke-width:1.5;" width="458.083" x="10" y="675.7813"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19.4429" x="25" y="688.8481">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="126.5376" x="89.4429" y="687.9917">[Has Refresh Token]</text><g class="message" data-participant-1="App" data-participant-2="Auth"><polygon fill="#181818" points="290.6997,710.0469,300.6997,714.0469,290.6997,718.0469,294.6997,714.0469" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="40.6753" x2="296.6997" y1="714.0469" y2="714.0469"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="144.7456" x="47.6753" y="708.981">Refresh token request</text></g><g class="message" data-participant-1="Auth" data-participant-2="App"><polygon fill="#181818" points="51.6753,739.1797,41.6753,743.1797,51.6753,747.1797,47.6753,743.1797" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="45.6753" x2="301.6997" y1="743.1797" y2="743.1797"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="117.2412" x="57.6753" y="738.1138">New access token</text></g><g class="message" data-participant-1="App" data-participant-2="FHIR"><polygon fill="#181818" points="397.6846,768.3125,407.6846,772.3125,397.6846,776.3125,401.6846,772.3125" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="40.6753" x2="403.6846" y1="772.3125" y2="772.3125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="138.8296" x="47.6753" y="767.2466">Retry with new token</text></g><g class="message" data-participant-1="FHIR" data-participant-2="App"><polygon fill="#181818" points="51.6753,797.4453,41.6753,801.4453,51.6753,805.4453,47.6753,801.4453" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="45.6753" x2="408.6846" y1="801.4453" y2="801.4453"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="52.3301" x="57.6753" y="796.3794">Success</text></g><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2,2;" x1="10" x2="468.083" y1="810.4453" y2="810.4453"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="120.1245" x="15" y="820.6558">[No Refresh Token]</text><g class="message" data-participant-1="App" data-participant-2="App"><line style="stroke:#181818;stroke-width:1;" x1="40.6753" x2="82.6753" y1="845.3828" y2="845.3828"/><line style="stroke:#181818;stroke-width:1;" x1="82.6753" x2="82.6753" y1="845.3828" y2="858.3828"/><line style="stroke:#181818;stroke-width:1;" x1="41.6753" x2="82.6753" y1="858.3828" y2="858.3828"/><polygon fill="#181818" points="51.6753,854.3828,41.6753,858.3828,51.6753,862.3828,47.6753,858.3828" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="155.105" x="47.6753" y="840.3169">Redirect to re-authorize</text></g><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="478.083" x="0" y="893.9492"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="478.083" y1="893.9492" y2="893.9492"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="478.083" y1="896.9492" y2="896.9492"/><rect fill="#EEEEEE" height="23.1328" style="stroke:#000000;stroke-width:2;" width="150.4746" x="163.8042" y="883.3828"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="131.9487" x="169.8042" y="899.4497">Insufficient Scope</text><g class="message" data-participant-1="App" data-participant-2="FHIR"><polygon fill="#181818" points="397.6846,933.6484,407.6846,937.6484,397.6846,941.6484,401.6846,937.6484" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="40.6753" x2="403.6846" y1="937.6484" y2="937.6484"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88.7402" x="47.6753" y="932.5825">Write request</text></g><g class="message" data-participant-1="FHIR" data-participant-2="App"><polygon fill="#181818" points="51.6753,1083.8438,41.6753,1087.8438,51.6753,1091.8438,47.6753,1087.8438" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="45.6753" x2="408.6846" y1="1087.8438" y2="1087.8438"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="94.3262" x="57.6753" y="961.7153">403 Forbidden</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8.271" x="57.6753" y="976.8481">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="249.2725" x="65.9399" y="991.981">&quot;resourceType&quot;: &quot;OperationOutcome&quot;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="67.209" x="65.9399" y="1007.1138">&quot;issue&quot;: [{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="120.7578" x="74.2046" y="1022.2466">&quot;severity&quot;: &quot;error&quot;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="130.3936" x="74.2046" y="1037.3794">&quot;code&quot;: &quot;forbidden&quot;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="220.3081" x="74.2046" y="1052.5122">&quot;diagnostics&quot;: &quot;Insufficient scope&quot;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="13.3428" x="65.9399" y="1067.645">}]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8.271" x="57.6753" y="1082.7778">}</text></g><g class="message" data-participant-1="App" data-participant-2="App"><line style="stroke:#181818;stroke-width:1;" x1="40.6753" x2="82.6753" y1="1162.375" y2="1162.375"/><line style="stroke:#181818;stroke-width:1;" x1="82.6753" x2="82.6753" y1="1162.375" y2="1175.375"/><line style="stroke:#181818;stroke-width:1;" x1="41.6753" x2="82.6753" y1="1175.375" y2="1175.375"/><polygon fill="#181818" points="51.6753,1171.375,41.6753,1175.375,51.6753,1179.375,47.6753,1175.375" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="86.3408" x="47.6753" y="1111.9106">Handle error:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="189.6045" x="47.6753" y="1127.0435">• Show appropriate message</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="182.9141" x="47.6753" y="1142.1763">• Request additional scopes</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="61.0581" x="55.9399" y="1157.3091">if needed</text></g><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="478.083" x="0" y="1203.9414"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="478.083" y1="1203.9414" y2="1203.9414"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="478.083" y1="1206.9414" y2="1206.9414"/><rect fill="#EEEEEE" height="23.1328" style="stroke:#000000;stroke-width:2;" width="116.8384" x="180.6223" y="1193.375"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="98.3125" x="186.6223" y="1209.4419">Rate Limiting</text><g class="message" data-participant-1="App" data-participant-2="FHIR"><polygon fill="#181818" points="397.6846,1243.6406,407.6846,1247.6406,397.6846,1251.6406,401.6846,1247.6406" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="40.6753" x2="403.6846" y1="1247.6406" y2="1247.6406"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="149.8047" x="47.6753" y="1242.5747">Multiple rapid requests</text></g><g class="message" data-participant-1="FHIR" data-participant-2="App"><polygon fill="#181818" points="51.6753,1287.9063,41.6753,1291.9063,51.6753,1295.9063,47.6753,1291.9063" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="45.6753" x2="408.6846" y1="1291.9063" y2="1291.9063"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="156.3364" x="57.6753" y="1271.7075">429 Too Many Requests</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="96.8208" x="57.6753" y="1286.8403">Retry-After: 60</text></g><g class="message" data-participant-1="App" data-participant-2="App"><line style="stroke:#181818;stroke-width:1;" x1="40.6753" x2="82.6753" y1="1366.4375" y2="1366.4375"/><line style="stroke:#181818;stroke-width:1;" x1="82.6753" x2="82.6753" y1="1366.4375" y2="1379.4375"/><line style="stroke:#181818;stroke-width:1;" x1="41.6753" x2="82.6753" y1="1379.4375" y2="1379.4375"/><polygon fill="#181818" points="51.6753,1375.4375,41.6753,1379.4375,51.6753,1383.4375,47.6753,1379.4375" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="126.8706" x="47.6753" y="1315.9731">Implement backoff:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="137.1855" x="47.6753" y="1331.106">• Wait specified time</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="100.8008" x="47.6753" y="1346.2388">• Retry request</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="183.8218" x="47.6753" y="1361.3716">• Consider request batching</text></g><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="478.083" x="0" y="1408.0039"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="478.083" y1="1408.0039" y2="1408.0039"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="478.083" y1="1411.0039" y2="1411.0039"/><rect fill="#EEEEEE" height="23.1328" style="stroke:#000000;stroke-width:2;" width="181.6479" x="148.2175" y="1397.4375"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="163.1221" x="154.2175" y="1413.5044">FHIR Validation Errors</text><g class="message" data-participant-1="App" data-participant-2="FHIR"><polygon fill="#181818" points="397.6846,1447.7031,407.6846,1451.7031,397.6846,1455.7031,401.6846,1451.7031" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="40.6753" x2="403.6846" y1="1451.7031" y2="1451.7031"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="142.3145" x="47.6753" y="1446.6372">POST invalid resource</text></g><g class="message" data-participant-1="FHIR" data-participant-2="App"><polygon fill="#181818" points="51.6753,1597.8984,41.6753,1601.8984,51.6753,1605.8984,47.6753,1601.8984" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="45.6753" x2="408.6846" y1="1601.8984" y2="1601.8984"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="111.6045" x="57.6753" y="1475.77">400 Bad Request</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8.271" x="57.6753" y="1490.9028">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="249.2725" x="65.9399" y="1506.0356">&quot;resourceType&quot;: &quot;OperationOutcome&quot;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="67.209" x="65.9399" y="1521.1685">&quot;issue&quot;: [{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="120.7578" x="74.2046" y="1536.3013">&quot;severity&quot;: &quot;error&quot;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="110.8999" x="74.2046" y="1551.4341">&quot;code&quot;: &quot;invalid&quot;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="245.9399" x="74.2046" y="1566.5669">&quot;diagnostics&quot;: &quot;Missing required field&quot;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="13.3428" x="65.9399" y="1581.6997">}]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8.271" x="57.6753" y="1596.8325">}</text></g><g class="message" data-participant-1="App" data-participant-2="App"><line style="stroke:#181818;stroke-width:1;" x1="40.6753" x2="82.6753" y1="1676.4297" y2="1676.4297"/><line style="stroke:#181818;stroke-width:1;" x1="82.6753" x2="82.6753" y1="1676.4297" y2="1689.4297"/><line style="stroke:#181818;stroke-width:1;" x1="41.6753" x2="82.6753" y1="1689.4297" y2="1689.4297"/><polygon fill="#181818" points="51.6753,1685.4297,41.6753,1689.4297,51.6753,1693.4297,47.6753,1689.4297" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="168.4604" x="47.6753" y="1625.9653">Parse OperationOutcome:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="136.1699" x="47.6753" y="1641.0981">• Extract diagnostics</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="143.019" x="47.6753" y="1656.231">• Fix validation issues</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="139.458" x="47.6753" y="1671.3638">• Retry if appropriate</text></g></g></svg></div><div class="puml dark" style=""><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="SEQUENCE" height="1742px" preserveAspectRatio="xMidYMid meet" style="width:485px;height:1742px;background:#1B1B1B;" version="1.1" viewBox="0 0 485 1742" width="485px" zoomAndPan="magnify" class="diagram"><title>SMART-on-FHIR Error Handling Patterns</title><defs/><g><rect fill="#1B1B1B" height="1742" style="stroke:none;stroke-width:1;" width="485" x="0" y="0"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="316.7021" x="80.1904" y="27.9951">SMART-on-FHIR Error Handling Patterns</text><rect fill="none" height="190.6016" style="stroke:#FFFFFF;stroke-width:1.5;" width="458.083" x="10" y="675.7813"/><g><title>App</title><rect fill="#000000" fill-opacity="0.00000" height="1633.8359" width="8" x="36.6753" y="73.5938"/><line style="stroke:#E7E7E7;stroke-width:0.5;stroke-dasharray:5,5;" x1="40" x2="40" y1="73.5938" y2="1707.4297"/></g><g><title>Auth Server</title><rect fill="#000000" fill-opacity="0.00000" height="1633.8359" width="8" x="298.6997" y="73.5938"/><line style="stroke:#E7E7E7;stroke-width:0.5;stroke-dasharray:5,5;" x1="302.1133" x2="302.1133" y1="73.5938" y2="1707.4297"/></g><g><title>FHIR Server</title><rect fill="#000000" fill-opacity="0.00000" height="1633.8359" width="8" x="405.6846" y="73.5938"/><line style="stroke:#E7E7E7;stroke-width:0.5;stroke-dasharray:5,5;" x1="409.2861" x2="409.2861" y1="73.5938" y2="1707.4297"/></g><g class="participant participant-head" data-participant="App"><rect fill="#222222" height="30.2969" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="41.3506" x="20" y="42.2969"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="27.3506" x="27" y="62.292">App</text></g><g class="participant participant-tail" data-participant="App"><rect fill="#222222" height="30.2969" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="41.3506" x="20" y="1706.4297"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="27.3506" x="27" y="1726.4248">App</text></g><g class="participant participant-head" data-participant="Auth"><rect fill="#222222" height="30.2969" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="97.1729" x="254.1133" y="42.2969"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="83.1729" x="261.1133" y="62.292">Auth Server</text></g><g class="participant participant-tail" data-participant="Auth"><rect fill="#222222" height="30.2969" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="97.1729" x="254.1133" y="1706.4297"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="83.1729" x="261.1133" y="1726.4248">Auth Server</text></g><g class="participant participant-head" data-participant="FHIR"><rect fill="#222222" height="30.2969" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="96.7969" x="361.2861" y="42.2969"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="82.7969" x="368.2861" y="62.292">FHIR Server</text></g><g class="participant participant-tail" data-participant="FHIR"><rect fill="#222222" height="30.2969" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="96.7969" x="361.2861" y="1706.4297"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="82.7969" x="368.2861" y="1726.4248">FHIR Server</text></g><rect fill="#111111" height="3" style="stroke:#111111;stroke-width:1;" width="478.083" x="0" y="104.1602"/><line style="stroke:#FFFFFF;stroke-width:1;" x1="0" x2="478.083" y1="104.1602" y2="104.1602"/><line style="stroke:#FFFFFF;stroke-width:1;" x1="0" x2="478.083" y1="107.1602" y2="107.1602"/><rect fill="#111111" height="23.1328" style="stroke:#FFFFFF;stroke-width:2;" width="167.6133" x="155.2349" y="93.5938"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="149.0874" x="161.2349" y="109.6606">Authorization Errors</text><g class="message" data-participant-1="App" data-participant-2="Auth"><polygon fill="#E7E7E7" points="290.6997,143.8594,300.6997,147.8594,290.6997,151.8594,294.6997,147.8594" style="stroke:#E7E7E7;stroke-width:1;"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="40.6753" x2="296.6997" y1="147.8594" y2="147.8594"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="140.9053" x="47.6753" y="142.7935">Authorization request</text></g><g class="message" data-participant-1="Auth" data-participant-2="App"><polygon fill="#E7E7E7" points="51.6753,203.2578,41.6753,207.2578,51.6753,211.2578,47.6753,207.2578" style="stroke:#E7E7E7;stroke-width:1;"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="45.6753" x2="301.6997" y1="207.2578" y2="207.2578"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="91.5078" x="57.6753" y="171.9263">Error redirect:</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="144.4346" x="57.6753" y="187.0591">?error=access_denied</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="209.9106" x="57.6753" y="202.1919">&amp;error_description=User denied</text></g><g class="message" data-participant-1="App" data-participant-2="App"><line style="stroke:#E7E7E7;stroke-width:1;" x1="40.6753" x2="82.6753" y1="281.7891" y2="281.7891"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="82.6753" x2="82.6753" y1="281.7891" y2="294.7891"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="41.6753" x2="82.6753" y1="294.7891" y2="294.7891"/><polygon fill="#E7E7E7" points="51.6753,290.7891,41.6753,294.7891,51.6753,298.7891,47.6753,294.7891" style="stroke:#E7E7E7;stroke-width:1;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="86.3408" x="47.6753" y="231.3247">Handle error:</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="71.3667" x="47.6753" y="246.4575">• Log error</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="141.9209" x="47.6753" y="261.5903">• Show user message</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="124.4521" x="47.6753" y="276.7231">• Redirect to home</text></g><rect fill="#111111" height="3" style="stroke:#111111;stroke-width:1;" width="478.083" x="0" y="323.3555"/><line style="stroke:#FFFFFF;stroke-width:1;" x1="0" x2="478.083" y1="323.3555" y2="323.3555"/><line style="stroke:#FFFFFF;stroke-width:1;" x1="0" x2="478.083" y1="326.3555" y2="326.3555"/><rect fill="#111111" height="23.1328" style="stroke:#FFFFFF;stroke-width:2;" width="187.2529" x="145.415" y="312.7891"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="168.7271" x="151.415" y="328.856">Token Exchange Errors</text><g class="message" data-participant-1="App" data-participant-2="Auth"><polygon fill="#E7E7E7" points="290.6997,363.0547,300.6997,367.0547,290.6997,371.0547,294.6997,367.0547" style="stroke:#E7E7E7;stroke-width:1;"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="40.6753" x2="296.6997" y1="367.0547" y2="367.0547"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="193.9082" x="47.6753" y="361.9888">POST /token with invalid code</text></g><g class="message" data-participant-1="Auth" data-participant-2="App"><polygon fill="#E7E7E7" points="51.6753,452.7188,41.6753,456.7188,51.6753,460.7188,47.6753,456.7188" style="stroke:#E7E7E7;stroke-width:1;"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="45.6753" x2="301.6997" y1="456.7188" y2="456.7188"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="111.6045" x="57.6753" y="391.1216">400 Bad Request</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8.271" x="57.6753" y="406.2544">{</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="152.9341" x="65.9399" y="421.3872">&quot;error&quot;: &quot;invalid_grant&quot;,</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="229.7598" x="65.9399" y="436.52">&quot;error_description&quot;: &quot;Code expired&quot;</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8.271" x="57.6753" y="451.6528">}</text></g><g class="message" data-participant-1="App" data-participant-2="App"><line style="stroke:#E7E7E7;stroke-width:1;" x1="40.6753" x2="82.6753" y1="516.1172" y2="516.1172"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="82.6753" x2="82.6753" y1="516.1172" y2="529.1172"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="41.6753" x2="82.6753" y1="529.1172" y2="529.1172"/><polygon fill="#E7E7E7" points="51.6753,525.1172,41.6753,529.1172,51.6753,533.1172,47.6753,529.1172" style="stroke:#E7E7E7;stroke-width:1;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="86.3408" x="47.6753" y="480.7856">Handle error:</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="98.0522" x="47.6753" y="495.9185">• Clear session</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="123.6904" x="47.6753" y="511.0513">• Restart auth flow</text></g><rect fill="#111111" height="3" style="stroke:#111111;stroke-width:1;" width="478.083" x="0" y="557.6836"/><line style="stroke:#FFFFFF;stroke-width:1;" x1="0" x2="478.083" y1="557.6836" y2="557.6836"/><line style="stroke:#FFFFFF;stroke-width:1;" x1="0" x2="478.083" y1="560.6836" y2="560.6836"/><rect fill="#111111" height="23.1328" style="stroke:#FFFFFF;stroke-width:2;" width="123.1289" x="177.4771" y="547.1172"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="104.603" x="183.4771" y="563.1841">Expired Token</text><g class="message" data-participant-1="App" data-participant-2="FHIR"><polygon fill="#E7E7E7" points="397.6846,597.3828,407.6846,601.3828,397.6846,605.3828,401.6846,601.3828" style="stroke:#E7E7E7;stroke-width:1;"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="40.6753" x2="403.6846" y1="601.3828" y2="601.3828"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="200.3447" x="47.6753" y="596.3169">API request with expired token</text></g><g class="message" data-participant-1="FHIR" data-participant-2="App"><polygon fill="#E7E7E7" points="51.6753,656.7813,41.6753,660.7813,51.6753,664.7813,47.6753,660.7813" style="stroke:#E7E7E7;stroke-width:1;"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="45.6753" x2="408.6846" y1="660.7813" y2="660.7813"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="116.2256" x="57.6753" y="625.4497">401 Unauthorized</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="178.9595" x="57.6753" y="640.5825">WWW-Authenticate: Bearer</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="141.1401" x="65.9399" y="655.7153">error=&quot;invalid_token&quot;</text></g><path d="M10,675.7813 L74.4429,675.7813 L74.4429,682.9141 L64.4429,692.9141 L10,692.9141 L10,675.7813" fill="#555555" style="stroke:#FFFFFF;stroke-width:1.5;"/><rect fill="none" height="190.6016" style="stroke:#FFFFFF;stroke-width:1.5;" width="458.083" x="10" y="675.7813"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19.4429" x="25" y="688.8481">alt</text><text fill="#FFFFFF" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="126.5376" x="89.4429" y="687.9917">[Has Refresh Token]</text><g class="message" data-participant-1="App" data-participant-2="Auth"><polygon fill="#E7E7E7" points="290.6997,710.0469,300.6997,714.0469,290.6997,718.0469,294.6997,714.0469" style="stroke:#E7E7E7;stroke-width:1;"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="40.6753" x2="296.6997" y1="714.0469" y2="714.0469"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="144.7456" x="47.6753" y="708.981">Refresh token request</text></g><g class="message" data-participant-1="Auth" data-participant-2="App"><polygon fill="#E7E7E7" points="51.6753,739.1797,41.6753,743.1797,51.6753,747.1797,47.6753,743.1797" style="stroke:#E7E7E7;stroke-width:1;"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="45.6753" x2="301.6997" y1="743.1797" y2="743.1797"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="117.2412" x="57.6753" y="738.1138">New access token</text></g><g class="message" data-participant-1="App" data-participant-2="FHIR"><polygon fill="#E7E7E7" points="397.6846,768.3125,407.6846,772.3125,397.6846,776.3125,401.6846,772.3125" style="stroke:#E7E7E7;stroke-width:1;"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="40.6753" x2="403.6846" y1="772.3125" y2="772.3125"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="138.8296" x="47.6753" y="767.2466">Retry with new token</text></g><g class="message" data-participant-1="FHIR" data-participant-2="App"><polygon fill="#E7E7E7" points="51.6753,797.4453,41.6753,801.4453,51.6753,805.4453,47.6753,801.4453" style="stroke:#E7E7E7;stroke-width:1;"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="45.6753" x2="408.6846" y1="801.4453" y2="801.4453"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="52.3301" x="57.6753" y="796.3794">Success</text></g><line style="stroke:#FFFFFF;stroke-width:1;stroke-dasharray:2,2;" x1="10" x2="468.083" y1="810.4453" y2="810.4453"/><text fill="#FFFFFF" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="120.1245" x="15" y="820.6558">[No Refresh Token]</text><g class="message" data-participant-1="App" data-participant-2="App"><line style="stroke:#E7E7E7;stroke-width:1;" x1="40.6753" x2="82.6753" y1="845.3828" y2="845.3828"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="82.6753" x2="82.6753" y1="845.3828" y2="858.3828"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="41.6753" x2="82.6753" y1="858.3828" y2="858.3828"/><polygon fill="#E7E7E7" points="51.6753,854.3828,41.6753,858.3828,51.6753,862.3828,47.6753,858.3828" style="stroke:#E7E7E7;stroke-width:1;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="155.105" x="47.6753" y="840.3169">Redirect to re-authorize</text></g><rect fill="#111111" height="3" style="stroke:#111111;stroke-width:1;" width="478.083" x="0" y="893.9492"/><line style="stroke:#FFFFFF;stroke-width:1;" x1="0" x2="478.083" y1="893.9492" y2="893.9492"/><line style="stroke:#FFFFFF;stroke-width:1;" x1="0" x2="478.083" y1="896.9492" y2="896.9492"/><rect fill="#111111" height="23.1328" style="stroke:#FFFFFF;stroke-width:2;" width="150.4746" x="163.8042" y="883.3828"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="131.9487" x="169.8042" y="899.4497">Insufficient Scope</text><g class="message" data-participant-1="App" data-participant-2="FHIR"><polygon fill="#E7E7E7" points="397.6846,933.6484,407.6846,937.6484,397.6846,941.6484,401.6846,937.6484" style="stroke:#E7E7E7;stroke-width:1;"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="40.6753" x2="403.6846" y1="937.6484" y2="937.6484"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88.7402" x="47.6753" y="932.5825">Write request</text></g><g class="message" data-participant-1="FHIR" data-participant-2="App"><polygon fill="#E7E7E7" points="51.6753,1083.8438,41.6753,1087.8438,51.6753,1091.8438,47.6753,1087.8438" style="stroke:#E7E7E7;stroke-width:1;"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="45.6753" x2="408.6846" y1="1087.8438" y2="1087.8438"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="94.3262" x="57.6753" y="961.7153">403 Forbidden</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8.271" x="57.6753" y="976.8481">{</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="249.2725" x="65.9399" y="991.981">&quot;resourceType&quot;: &quot;OperationOutcome&quot;,</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="67.209" x="65.9399" y="1007.1138">&quot;issue&quot;: [{</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="120.7578" x="74.2046" y="1022.2466">&quot;severity&quot;: &quot;error&quot;,</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="130.3936" x="74.2046" y="1037.3794">&quot;code&quot;: &quot;forbidden&quot;,</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="220.3081" x="74.2046" y="1052.5122">&quot;diagnostics&quot;: &quot;Insufficient scope&quot;</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="13.3428" x="65.9399" y="1067.645">}]</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8.271" x="57.6753" y="1082.7778">}</text></g><g class="message" data-participant-1="App" data-participant-2="App"><line style="stroke:#E7E7E7;stroke-width:1;" x1="40.6753" x2="82.6753" y1="1162.375" y2="1162.375"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="82.6753" x2="82.6753" y1="1162.375" y2="1175.375"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="41.6753" x2="82.6753" y1="1175.375" y2="1175.375"/><polygon fill="#E7E7E7" points="51.6753,1171.375,41.6753,1175.375,51.6753,1179.375,47.6753,1175.375" style="stroke:#E7E7E7;stroke-width:1;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="86.3408" x="47.6753" y="1111.9106">Handle error:</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="189.6045" x="47.6753" y="1127.0435">• Show appropriate message</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="182.9141" x="47.6753" y="1142.1763">• Request additional scopes</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="61.0581" x="55.9399" y="1157.3091">if needed</text></g><rect fill="#111111" height="3" style="stroke:#111111;stroke-width:1;" width="478.083" x="0" y="1203.9414"/><line style="stroke:#FFFFFF;stroke-width:1;" x1="0" x2="478.083" y1="1203.9414" y2="1203.9414"/><line style="stroke:#FFFFFF;stroke-width:1;" x1="0" x2="478.083" y1="1206.9414" y2="1206.9414"/><rect fill="#111111" height="23.1328" style="stroke:#FFFFFF;stroke-width:2;" width="116.8384" x="180.6223" y="1193.375"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="98.3125" x="186.6223" y="1209.4419">Rate Limiting</text><g class="message" data-participant-1="App" data-participant-2="FHIR"><polygon fill="#E7E7E7" points="397.6846,1243.6406,407.6846,1247.6406,397.6846,1251.6406,401.6846,1247.6406" style="stroke:#E7E7E7;stroke-width:1;"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="40.6753" x2="403.6846" y1="1247.6406" y2="1247.6406"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="149.8047" x="47.6753" y="1242.5747">Multiple rapid requests</text></g><g class="message" data-participant-1="FHIR" data-participant-2="App"><polygon fill="#E7E7E7" points="51.6753,1287.9063,41.6753,1291.9063,51.6753,1295.9063,47.6753,1291.9063" style="stroke:#E7E7E7;stroke-width:1;"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="45.6753" x2="408.6846" y1="1291.9063" y2="1291.9063"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="156.3364" x="57.6753" y="1271.7075">429 Too Many Requests</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="96.8208" x="57.6753" y="1286.8403">Retry-After: 60</text></g><g class="message" data-participant-1="App" data-participant-2="App"><line style="stroke:#E7E7E7;stroke-width:1;" x1="40.6753" x2="82.6753" y1="1366.4375" y2="1366.4375"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="82.6753" x2="82.6753" y1="1366.4375" y2="1379.4375"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="41.6753" x2="82.6753" y1="1379.4375" y2="1379.4375"/><polygon fill="#E7E7E7" points="51.6753,1375.4375,41.6753,1379.4375,51.6753,1383.4375,47.6753,1379.4375" style="stroke:#E7E7E7;stroke-width:1;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="126.8706" x="47.6753" y="1315.9731">Implement backoff:</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="137.1855" x="47.6753" y="1331.106">• Wait specified time</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="100.8008" x="47.6753" y="1346.2388">• Retry request</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="183.8218" x="47.6753" y="1361.3716">• Consider request batching</text></g><rect fill="#111111" height="3" style="stroke:#111111;stroke-width:1;" width="478.083" x="0" y="1408.0039"/><line style="stroke:#FFFFFF;stroke-width:1;" x1="0" x2="478.083" y1="1408.0039" y2="1408.0039"/><line style="stroke:#FFFFFF;stroke-width:1;" x1="0" x2="478.083" y1="1411.0039" y2="1411.0039"/><rect fill="#111111" height="23.1328" style="stroke:#FFFFFF;stroke-width:2;" width="181.6479" x="148.2175" y="1397.4375"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="163.1221" x="154.2175" y="1413.5044">FHIR Validation Errors</text><g class="message" data-participant-1="App" data-participant-2="FHIR"><polygon fill="#E7E7E7" points="397.6846,1447.7031,407.6846,1451.7031,397.6846,1455.7031,401.6846,1451.7031" style="stroke:#E7E7E7;stroke-width:1;"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="40.6753" x2="403.6846" y1="1451.7031" y2="1451.7031"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="142.3145" x="47.6753" y="1446.6372">POST invalid resource</text></g><g class="message" data-participant-1="FHIR" data-participant-2="App"><polygon fill="#E7E7E7" points="51.6753,1597.8984,41.6753,1601.8984,51.6753,1605.8984,47.6753,1601.8984" style="stroke:#E7E7E7;stroke-width:1;"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="45.6753" x2="408.6846" y1="1601.8984" y2="1601.8984"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="111.6045" x="57.6753" y="1475.77">400 Bad Request</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8.271" x="57.6753" y="1490.9028">{</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="249.2725" x="65.9399" y="1506.0356">&quot;resourceType&quot;: &quot;OperationOutcome&quot;,</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="67.209" x="65.9399" y="1521.1685">&quot;issue&quot;: [{</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="120.7578" x="74.2046" y="1536.3013">&quot;severity&quot;: &quot;error&quot;,</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="110.8999" x="74.2046" y="1551.4341">&quot;code&quot;: &quot;invalid&quot;,</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="245.9399" x="74.2046" y="1566.5669">&quot;diagnostics&quot;: &quot;Missing required field&quot;</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="13.3428" x="65.9399" y="1581.6997">}]</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8.271" x="57.6753" y="1596.8325">}</text></g><g class="message" data-participant-1="App" data-participant-2="App"><line style="stroke:#E7E7E7;stroke-width:1;" x1="40.6753" x2="82.6753" y1="1676.4297" y2="1676.4297"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="82.6753" x2="82.6753" y1="1676.4297" y2="1689.4297"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="41.6753" x2="82.6753" y1="1689.4297" y2="1689.4297"/><polygon fill="#E7E7E7" points="51.6753,1685.4297,41.6753,1689.4297,51.6753,1693.4297,47.6753,1689.4297" style="stroke:#E7E7E7;stroke-width:1;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="168.4604" x="47.6753" y="1625.9653">Parse OperationOutcome:</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="136.1699" x="47.6753" y="1641.0981">• Extract diagnostics</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="143.019" x="47.6753" y="1656.231">• Fix validation issues</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="139.458" x="47.6753" y="1671.3638">• Retry if appropriate</text></g></g></svg></div></div>
<h2 id="smart-on-fhir-architecture">SMART-on-FHIR Architecture</h2>
<h3 id="1-smart-on-fhir-architecture-system-context">1. SMART-on-FHIR Architecture, System Context</h3>
<div class="puml-container"><div class="puml light" style=""><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="DESCRIPTION" height="551px" preserveAspectRatio="xMidYMid meet" style="width:1172px;height:551px;background:#FFFFFF;" version="1.1" viewBox="0 0 1172 551" width="1172px" zoomAndPan="magnify" class="diagram"><title>SMART-on-FHIR - System Context</title><defs/><g><g class="title" data-source-line="3"><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="264.1748" x="447.1191" y="22.9951">SMART-on-FHIR - System Context</text></g><g class="cluster" data-entity="Client Applications" data-source-line="7" data-uid="ent0002" id="cluster_Client Applications"><path d="M8.5,59.1269 L158.0313,59.1269 A3.75,3.75 0 0 1 160.5313,61.6269 L167.5313,81.4238 L192.05,81.4238 A2.5,2.5 0 0 1 194.55,83.9238 L194.55,315.6269 A2.5,2.5 0 0 1 192.05,318.1269 L8.5,318.1269 A2.5,2.5 0 0 1 6,315.6269 L6,61.6269 A2.5,2.5 0 0 1 8.5,59.1269" fill="none" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="6" x2="167.5313" y1="81.4238" y2="81.4238"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="148.5313" x="10" y="74.122">Client Applications</text></g><g class="cluster" data-entity="SMART Client SDK" data-source-line="13" data-uid="ent0006" id="cluster_SMART Client SDK"><path d="M238.05,104.1269 L382.5568,104.1269 A3.75,3.75 0 0 1 385.0568,106.6269 L392.0568,126.4238 L414.82,126.4238 A2.5,2.5 0 0 1 417.32,128.9238 L417.32,446.6269 A2.5,2.5 0 0 1 414.82,449.1269 L238.05,449.1269 A2.5,2.5 0 0 1 235.55,446.6269 L235.55,106.6269 A2.5,2.5 0 0 1 238.05,104.1269" fill="none" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="235.55" x2="392.0568" y1="126.4238" y2="126.4238"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="143.5068" x="239.55" y="119.122">SMART Client SDK</text></g><g class="cluster" data-entity="EHR System" data-source-line="19" data-uid="ent0010" id="cluster_EHR System"><path d="M643.71,230.1269 L739.962,230.1269 A3.75,3.75 0 0 1 742.462,232.6269 L749.462,252.4238 L1139.61,252.4238 A2.5,2.5 0 0 1 1142.11,254.9238 L1142.11,438.6269 A2.5,2.5 0 0 1 1139.61,441.1269 L643.71,441.1269 A2.5,2.5 0 0 1 641.21,438.6269 L641.21,232.6269 A2.5,2.5 0 0 1 643.71,230.1269" fill="none" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="641.21" x2="749.462" y1="252.4238" y2="252.4238"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="95.252" x="645.21" y="245.122">EHR System</text></g><g class="entity" data-entity="Web App" data-source-line="8" data-uid="ent0003" id="entity_Web App"><rect fill="#F1F1F1" height="46.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="103.1436" x="48.7" y="93.9769"/><rect fill="#F1F1F1" height="10" style="stroke:#181818;stroke-width:0.5;" width="15" x="131.8436" y="98.9769"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="129.8436" y="100.9769"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="129.8436" y="104.9769"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="63.1436" x="63.7" y="126.972">Web App</text></g><g class="entity" data-entity="Mobile App" data-source-line="9" data-uid="ent0004" id="entity_Mobile App"><rect fill="#F1F1F1" height="46.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="117.7246" x="41.41" y="174.9769"/><rect fill="#F1F1F1" height="10" style="stroke:#181818;stroke-width:0.5;" width="15" x="139.1346" y="179.9769"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="137.1346" y="181.9769"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="137.1346" y="185.9769"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="77.7246" x="56.41" y="207.972">Mobile App</text></g><g class="entity" data-entity="Backend Service" data-source-line="10" data-uid="ent0005" id="entity_Backend Service"><rect fill="#F1F1F1" height="46.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="156.5527" x="22" y="255.9769"/><rect fill="#F1F1F1" height="10" style="stroke:#181818;stroke-width:0.5;" width="15" x="158.5527" y="260.9769"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="156.5527" y="262.9769"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="156.5527" y="266.9769"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="116.5527" x="37" y="288.972">Backend Service</text></g><g class="entity" data-entity="Authorization.nHandler" data-source-line="14" data-uid="ent0007" id="entity_Authorization.nHandler"><rect fill="#F1F1F1" height="62.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="133.7686" x="259.55" y="166.8269"/><rect fill="#F1F1F1" height="10" style="stroke:#181818;stroke-width:0.5;" width="15" x="373.3186" y="171.8269"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="371.3186" y="173.8269"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="371.3186" y="177.8269"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="93.7686" x="274.55" y="199.822">Authorization</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="55.125" x="274.55" y="216.1189">Handler</text></g><g class="entity" data-entity="Token.nManager" data-source-line="15" data-uid="ent0008" id="entity_Token.nManager"><rect fill="#F1F1F1" height="62.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="101.3662" x="275.75" y="264.8269"/><rect fill="#F1F1F1" height="10" style="stroke:#181818;stroke-width:0.5;" width="15" x="357.1162" y="269.8269"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="355.1162" y="271.8269"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="355.1162" y="275.8269"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="42.7109" x="290.75" y="297.822">Token</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="61.3662" x="290.75" y="314.1189">Manager</text></g><g class="entity" data-entity="FHIR.nClient" data-source-line="16" data-uid="ent0009" id="entity_FHIR.nClient"><rect fill="#F1F1F1" height="62.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="80.5303" x="286.17" y="362.8269"/><rect fill="#F1F1F1" height="10" style="stroke:#181818;stroke-width:0.5;" width="15" x="346.7003" y="367.8269"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="344.7003" y="369.8269"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="344.7003" y="373.8269"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="32.4365" x="301.17" y="395.822">FHIR</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="40.5303" x="301.17" y="412.1189">Client</text></g><g class="entity" data-entity="Auth" data-source-line="20" data-uid="ent0011" id="entity_Auth"><rect fill="#F1F1F1" height="62.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="133.7686" x="657.21" y="264.8269"/><rect fill="#F1F1F1" height="10" style="stroke:#181818;stroke-width:0.5;" width="15" x="770.9786" y="269.8269"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="768.9786" y="271.8269"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="768.9786" y="275.8269"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="93.7686" x="672.21" y="297.822">Authorization</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="45.9102" x="672.21" y="314.1189">Server</text></g><g class="entity" data-entity="API" data-source-line="21" data-uid="ent0012" id="entity_API"><rect fill="#F1F1F1" height="62.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="99.0352" x="674.58" y="362.8269"/><rect fill="#F1F1F1" height="10" style="stroke:#181818;stroke-width:0.5;" width="15" x="753.6152" y="367.8269"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="751.6152" y="369.8269"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="751.6152" y="373.8269"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="59.0352" x="689.58" y="395.822">FHIR API</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="45.9102" x="689.58" y="412.1189">Server</text></g><g class="entity" data-entity="DB" data-source-line="22" data-uid="ent0013" id="entity_DB"><path d="M1033.74,372.3269 C1033.74,362.3269 1077.1404,362.3269 1077.1404,362.3269 C1077.1404,362.3269 1120.5408,362.3269 1120.5408,372.3269 L1120.5408,413.9206 C1120.5408,423.9206 1077.1404,423.9206 1077.1404,423.9206 C1077.1404,423.9206 1033.74,423.9206 1033.74,413.9206 L1033.74,372.3269" fill="#F1F1F1" style="stroke:#181818;stroke-width:0.5;"/><path d="M1033.74,372.3269 C1033.74,382.3269 1077.1404,382.3269 1077.1404,382.3269 C1077.1404,382.3269 1120.5408,382.3269 1120.5408,372.3269" fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="50.4834" x="1043.74" y="399.322">Clinical</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="66.8008" x="1043.74" y="415.6189">Database</text></g><g class="entity" data-entity="Reg" data-source-line="23" data-uid="ent0014" id="entity_Reg"><rect fill="#F1F1F1" height="62.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="97.9414" x="1028.17" y="264.8269"/><rect fill="#F1F1F1" height="10" style="stroke:#181818;stroke-width:0.5;" width="15" x="1106.1114" y="269.8269"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="1104.1114" y="271.8269"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="1104.1114" y="275.8269"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="27.3506" x="1043.17" y="297.822">App</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="57.9414" x="1043.17" y="314.1189">Registry</text></g><g class="entity" data-entity="Disc" data-source-line="26" data-uid="ent0015" id="entity_Disc"><path d="M683.4598,172.8923 C686.3974,165.4814 693.2798,165.3728 697.4409,171.6419 C701.0638,165.8019 705.8298,165.4357 710.3255,170.622 C714.9398,163.3076 720.6688,163.3765 725.6216,170.2571 C729.6696,164.2399 734.3854,164.9408 738.1791,170.5322 C743.5294,163.8754 748.2656,164.4457 752.2555,171.8902 C757.2109,164.8554 764.1323,167.2904 767.0804,174.0477 C775.0848,176.4543 778.0046,182.0166 772.3307,189.1716 C777.8055,195.3708 776.4617,202.9209 767.2328,204.0983 C763.2725,211.1764 757.72,212.1702 752.9744,204.8774 C748.5564,211.3976 742.9783,211.2517 738.0844,205.4527 C735.1337,212.1474 730.0343,213.9389 724.944,207.6117 C719.9465,213.3849 715.4915,213.1588 711.3427,206.6703 C706.3059,212.1591 700.4731,211.9278 697.8886,204.1781 C693.3952,211.6409 686.605,210.4188 682.7666,203.49 C674.7182,198.8152 674.9249,193.5186 680.9264,187.2516 C674.274,181.3539 675.4898,176.2102 683.4598,172.8923" fill="#F1F1F1" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="69.166" x="689.51" y="191.972">Discovery</text></g><g class="entity" data-entity="GMN25" data-source-line="40" data-uid="ent0026" id="entity_GMN25"><path d="M614.32,43.2969 L614.32,128.9609 L833.8683,128.9609 L833.8683,53.2969 L823.8683,43.2969 L614.32,43.2969" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M823.8683,43.2969 L823.8683,53.2969 L833.8683,53.2969 L823.8683,43.2969" fill="#FEFFDD" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="155.1431" x="620.32" y="60.3638">SMART Client Library</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="198.5483" x="620.32" y="75.4966">• Handles OAuth 2.0 + SMART</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="168.689" x="620.32" y="90.6294">• Manages token lifecycle</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="141.356" x="620.32" y="105.7622">• Provides FHIR client</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="172.123" x="620.32" y="120.895">• Handles launch contexts</text></g><g class="entity" data-entity="GMN28" data-source-line="48" data-uid="ent0029" id="entity_GMN28"><path d="M988.87,459.2969 L988.87,544.9609 L1165.413,544.9609 L1165.413,469.2969 L1155.413,459.2969 L988.87,459.2969" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1155.413,459.2969 L1155.413,469.2969 L1165.413,469.2969 L1155.413,459.2969" fill="#FEFFDD" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="155.543" x="994.87" y="476.3638">SMART Authorization</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="130.1206" x="994.87" y="491.4966">• OAuth 2.0 + PKCE</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="119.0059" x="994.87" y="506.6294">• Launch contexts</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="143.2729" x="994.87" y="521.7622">• Scope-based access</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="97.0112" x="994.87" y="536.895">• User consent</text></g><g class="link" data-entity-1="Web App" data-entity-2="Authorization.nHandler" data-source-line="28" data-uid="lnk16" id="link_Web App_Authorization.nHandler"><path d="M152.29,137.6269 C173.07,145.8069 197.37,155.1469 219.55,163.1269 C232.31,167.7069 240.3092,170.5056 253.4792,174.9056" fill="none" id="Web App-to-Authorization\nHandler" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="259.17,176.8069,251.9013,170.1611,254.4277,175.2225,249.3663,177.7489,259.17,176.8069" style="stroke:#181818;stroke-width:1;"/></g><g class="link" data-entity-1="Mobile App" data-entity-2="Authorization.nHandler" data-source-line="29" data-uid="lnk17" id="link_Mobile App_Authorization.nHandler"><path d="M159.59,198.1269 C190.07,198.1269 221.51,198.1269 253.1,198.1269" fill="none" id="Mobile App-to-Authorization\nHandler" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="259.1,198.1269,250.1,194.1269,254.1,198.1269,250.1,202.1269,259.1,198.1269" style="stroke:#181818;stroke-width:1;"/></g><g class="link" data-entity-1="Backend Service" data-entity-2="Authorization.nHandler" data-source-line="30" data-uid="lnk18" id="link_Backend Service_Authorization.nHandler"><path d="M166.72,255.4769 C195.79,244.9769 224.3175,234.6669 253.4975,224.1169" fill="none" id="Backend Service-to-Authorization\nHandler" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="259.14,222.0769,249.3162,221.3753,254.4379,223.7769,252.0362,228.8986,259.14,222.0769" style="stroke:#181818;stroke-width:1;"/></g><g class="link" data-entity-1="Authorization.nHandler" data-entity-2="Disc" data-source-line="32" data-uid="lnk19" id="link_Authorization.nHandler_Disc"><path d="M393.66,196.2869 C472.86,194.0869 597.5523,190.6133 668.1723,188.6533" fill="none" id="Authorization\nHandler-to-Disc" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="674.17,188.4869,665.0625,184.7381,669.1719,188.6256,665.2844,192.735,674.17,188.4869" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="141.6162" x="442.32" y="187.0638">1. Discover endpoints</text></g><g class="link" data-entity-1="Authorization.nHandler" data-entity-2="Auth" data-source-line="33" data-uid="lnk20" id="link_Authorization.nHandler_Auth"><path d="M393.66,214.5269 C466.81,232.6469 578.0558,260.205 651.1658,278.305" fill="none" id="Authorization\nHandler-to-Auth" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="656.99,279.7469,649.215,273.7012,652.1365,278.5453,647.2925,281.4668,656.99,279.7469" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="100.1597" x="462.82" y="223.1538">2. Authenticate</text></g><g class="link" data-entity-1="Token.nManager" data-entity-2="Auth" data-source-line="34" data-uid="lnk21" id="link_Token.nManager_Auth"><path d="M383.5529,300.8592 C403.3929,302.3592 420.42,303.3869 441.32,304.1269 C504.84,306.3569 520.79,305.9569 584.32,304.1269 C607.96,303.4469 633.84,302.1169 656.78,300.7269" fill="none" id="Token\nManager-backto-Auth" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="377.57,300.4069,386.2428,305.074,382.5558,300.7838,386.8459,297.0968,377.57,300.4069" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="97.8745" x="464.32" y="300.1938">3. Issue tokens</text></g><g class="link" data-entity-1="FHIR.nClient" data-entity-2="API" data-source-line="35" data-uid="lnk22" id="link_FHIR.nClient_API"><path d="M367.19,394.1269 C440.08,394.1269 588.93,394.1269 668.17,394.1269" fill="none" id="FHIR\nClient-to-API" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="674.17,394.1269,665.17,390.1269,669.17,394.1269,665.17,398.1269,674.17,394.1269" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="107.2627" x="459.32" y="390.1938">4. FHIR requests</text></g><g class="link" data-entity-1="API" data-entity-2="DB" data-source-line="36" data-uid="lnk23" id="link_API_DB"><path d="M773.91,393.9869 C842.86,393.7869 961.67,393.4543 1027.25,393.2643" fill="none" id="API-to-DB" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="1033.25,393.2469,1024.2384,389.273,1028.25,393.2614,1024.2616,397.2729,1033.25,393.2469" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="72.9219" x="875.37" y="389.5438">Query data</text></g><g class="link" data-entity-1="Auth" data-entity-2="Reg" data-source-line="37" data-uid="lnk24" id="link_Auth_Reg"><path d="M791.12,296.1269 C860.04,296.1269 960.46,296.1269 1021.89,296.1269" fill="none" id="Auth-to-Reg" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="1027.89,296.1269,1018.89,292.1269,1022.89,296.1269,1018.89,300.1269,1027.89,296.1269" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="93.2344" x="864.87" y="292.1938">Validate client</text></g><g class="link" data-entity-1="SMART Client SDK" data-entity-2="GMN25" data-source-line="40" data-uid="lnk27" id="link_SMART Client SDK_GMN25"><path d="M418.3129,143.0879 C474.9317,136.6492 555.965,105.1369 613.82,98.5569" fill="none" id="SMART Client SDK-GMN25" style="stroke:#181818;stroke-width:1;stroke-dasharray:7,7;"/></g><g class="link" data-entity-1="Auth" data-entity-2="GMN28" data-source-line="48" data-uid="lnk30" id="link_Auth_GMN28"><path d="M791.24,317.5269 C806.46,324.6169 821.72,333.6969 833.87,345.1269 C854.72,364.7369 843.18,382.3369 863.87,402.1269 C898.75,435.4969 946.82,459.3969 988.4,475.4469" fill="none" id="Auth-GMN28" style="stroke:#181818;stroke-width:1;stroke-dasharray:7,7;"/></g></g></svg></div><div class="puml dark" style=""><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="DESCRIPTION" height="551px" preserveAspectRatio="xMidYMid meet" style="width:1172px;height:551px;background:#1B1B1B;" version="1.1" viewBox="0 0 1172 551" width="1172px" zoomAndPan="magnify" class="diagram"><title>SMART-on-FHIR - System Context</title><defs/><g><rect fill="#1B1B1B" height="551" style="stroke:none;stroke-width:1;" width="1172" x="0" y="0"/><g class="title" data-source-line="3"><text fill="#FFFFFF" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="264.1748" x="447.1191" y="22.9951">SMART-on-FHIR - System Context</text></g><g class="cluster" data-entity="Client Applications" data-source-line="7" data-uid="ent0002" id="cluster_Client Applications"><path d="M8.5,59.1269 L158.0313,59.1269 A3.75,3.75 0 0 1 160.5313,61.6269 L167.5313,81.4238 L192.05,81.4238 A2.5,2.5 0 0 1 194.55,83.9238 L194.55,315.6269 A2.5,2.5 0 0 1 192.05,318.1269 L8.5,318.1269 A2.5,2.5 0 0 1 6,315.6269 L6,61.6269 A2.5,2.5 0 0 1 8.5,59.1269" fill="none" style="stroke:#FFFFFF;stroke-width:1.5;"/><line style="stroke:#FFFFFF;stroke-width:1.5;" x1="6" x2="167.5313" y1="81.4238" y2="81.4238"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="148.5313" x="10" y="74.122">Client Applications</text></g><g class="cluster" data-entity="SMART Client SDK" data-source-line="13" data-uid="ent0006" id="cluster_SMART Client SDK"><path d="M238.05,104.1269 L382.5568,104.1269 A3.75,3.75 0 0 1 385.0568,106.6269 L392.0568,126.4238 L414.82,126.4238 A2.5,2.5 0 0 1 417.32,128.9238 L417.32,446.6269 A2.5,2.5 0 0 1 414.82,449.1269 L238.05,449.1269 A2.5,2.5 0 0 1 235.55,446.6269 L235.55,106.6269 A2.5,2.5 0 0 1 238.05,104.1269" fill="none" style="stroke:#FFFFFF;stroke-width:1.5;"/><line style="stroke:#FFFFFF;stroke-width:1.5;" x1="235.55" x2="392.0568" y1="126.4238" y2="126.4238"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="143.5068" x="239.55" y="119.122">SMART Client SDK</text></g><g class="cluster" data-entity="EHR System" data-source-line="19" data-uid="ent0010" id="cluster_EHR System"><path d="M643.71,230.1269 L739.962,230.1269 A3.75,3.75 0 0 1 742.462,232.6269 L749.462,252.4238 L1139.61,252.4238 A2.5,2.5 0 0 1 1142.11,254.9238 L1142.11,438.6269 A2.5,2.5 0 0 1 1139.61,441.1269 L643.71,441.1269 A2.5,2.5 0 0 1 641.21,438.6269 L641.21,232.6269 A2.5,2.5 0 0 1 643.71,230.1269" fill="none" style="stroke:#FFFFFF;stroke-width:1.5;"/><line style="stroke:#FFFFFF;stroke-width:1.5;" x1="641.21" x2="749.462" y1="252.4238" y2="252.4238"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="95.252" x="645.21" y="245.122">EHR System</text></g><g class="entity" data-entity="Web App" data-source-line="8" data-uid="ent0003" id="entity_Web App"><rect fill="#313139" height="46.2969" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="103.1436" x="48.7" y="93.9769"/><rect fill="#313139" height="10" style="stroke:#E7E7E7;stroke-width:0.5;" width="15" x="131.8436" y="98.9769"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="129.8436" y="100.9769"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="129.8436" y="104.9769"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="63.1436" x="63.7" y="126.972">Web App</text></g><g class="entity" data-entity="Mobile App" data-source-line="9" data-uid="ent0004" id="entity_Mobile App"><rect fill="#313139" height="46.2969" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="117.7246" x="41.41" y="174.9769"/><rect fill="#313139" height="10" style="stroke:#E7E7E7;stroke-width:0.5;" width="15" x="139.1346" y="179.9769"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="137.1346" y="181.9769"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="137.1346" y="185.9769"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="77.7246" x="56.41" y="207.972">Mobile App</text></g><g class="entity" data-entity="Backend Service" data-source-line="10" data-uid="ent0005" id="entity_Backend Service"><rect fill="#313139" height="46.2969" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="156.5527" x="22" y="255.9769"/><rect fill="#313139" height="10" style="stroke:#E7E7E7;stroke-width:0.5;" width="15" x="158.5527" y="260.9769"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="156.5527" y="262.9769"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="156.5527" y="266.9769"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="116.5527" x="37" y="288.972">Backend Service</text></g><g class="entity" data-entity="Authorization.nHandler" data-source-line="14" data-uid="ent0007" id="entity_Authorization.nHandler"><rect fill="#313139" height="62.5938" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="133.7686" x="259.55" y="166.8269"/><rect fill="#313139" height="10" style="stroke:#E7E7E7;stroke-width:0.5;" width="15" x="373.3186" y="171.8269"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="371.3186" y="173.8269"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="371.3186" y="177.8269"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="93.7686" x="274.55" y="199.822">Authorization</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="55.125" x="274.55" y="216.1189">Handler</text></g><g class="entity" data-entity="Token.nManager" data-source-line="15" data-uid="ent0008" id="entity_Token.nManager"><rect fill="#313139" height="62.5938" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="101.3662" x="275.75" y="264.8269"/><rect fill="#313139" height="10" style="stroke:#E7E7E7;stroke-width:0.5;" width="15" x="357.1162" y="269.8269"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="355.1162" y="271.8269"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="355.1162" y="275.8269"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="42.7109" x="290.75" y="297.822">Token</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="61.3662" x="290.75" y="314.1189">Manager</text></g><g class="entity" data-entity="FHIR.nClient" data-source-line="16" data-uid="ent0009" id="entity_FHIR.nClient"><rect fill="#313139" height="62.5938" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="80.5303" x="286.17" y="362.8269"/><rect fill="#313139" height="10" style="stroke:#E7E7E7;stroke-width:0.5;" width="15" x="346.7003" y="367.8269"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="344.7003" y="369.8269"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="344.7003" y="373.8269"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="32.4365" x="301.17" y="395.822">FHIR</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="40.5303" x="301.17" y="412.1189">Client</text></g><g class="entity" data-entity="Auth" data-source-line="20" data-uid="ent0011" id="entity_Auth"><rect fill="#313139" height="62.5938" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="133.7686" x="657.21" y="264.8269"/><rect fill="#313139" height="10" style="stroke:#E7E7E7;stroke-width:0.5;" width="15" x="770.9786" y="269.8269"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="768.9786" y="271.8269"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="768.9786" y="275.8269"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="93.7686" x="672.21" y="297.822">Authorization</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="45.9102" x="672.21" y="314.1189">Server</text></g><g class="entity" data-entity="API" data-source-line="21" data-uid="ent0012" id="entity_API"><rect fill="#313139" height="62.5938" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="99.0352" x="674.58" y="362.8269"/><rect fill="#313139" height="10" style="stroke:#E7E7E7;stroke-width:0.5;" width="15" x="753.6152" y="367.8269"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="751.6152" y="369.8269"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="751.6152" y="373.8269"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="59.0352" x="689.58" y="395.822">FHIR API</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="45.9102" x="689.58" y="412.1189">Server</text></g><g class="entity" data-entity="DB" data-source-line="22" data-uid="ent0013" id="entity_DB"><path d="M1033.74,372.3269 C1033.74,362.3269 1077.1404,362.3269 1077.1404,362.3269 C1077.1404,362.3269 1120.5408,362.3269 1120.5408,372.3269 L1120.5408,413.9206 C1120.5408,423.9206 1077.1404,423.9206 1077.1404,423.9206 C1077.1404,423.9206 1033.74,423.9206 1033.74,413.9206 L1033.74,372.3269" fill="#313139" style="stroke:#E7E7E7;stroke-width:0.5;"/><path d="M1033.74,372.3269 C1033.74,382.3269 1077.1404,382.3269 1077.1404,382.3269 C1077.1404,382.3269 1120.5408,382.3269 1120.5408,372.3269" fill="none" style="stroke:#E7E7E7;stroke-width:0.5;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="50.4834" x="1043.74" y="399.322">Clinical</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="66.8008" x="1043.74" y="415.6189">Database</text></g><g class="entity" data-entity="Reg" data-source-line="23" data-uid="ent0014" id="entity_Reg"><rect fill="#313139" height="62.5938" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="97.9414" x="1028.17" y="264.8269"/><rect fill="#313139" height="10" style="stroke:#E7E7E7;stroke-width:0.5;" width="15" x="1106.1114" y="269.8269"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="1104.1114" y="271.8269"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="1104.1114" y="275.8269"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="27.3506" x="1043.17" y="297.822">App</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="57.9414" x="1043.17" y="314.1189">Registry</text></g><g class="entity" data-entity="Disc" data-source-line="26" data-uid="ent0015" id="entity_Disc"><path d="M683.4598,172.8923 C686.3974,165.4814 693.2798,165.3728 697.4409,171.6419 C701.0638,165.8019 705.8298,165.4357 710.3255,170.622 C714.9398,163.3076 720.6688,163.3765 725.6216,170.2571 C729.6696,164.2399 734.3854,164.9408 738.1791,170.5322 C743.5294,163.8754 748.2656,164.4457 752.2555,171.8902 C757.2109,164.8554 764.1323,167.2904 767.0804,174.0477 C775.0848,176.4543 778.0046,182.0166 772.3307,189.1716 C777.8055,195.3708 776.4617,202.9209 767.2328,204.0983 C763.2725,211.1764 757.72,212.1702 752.9744,204.8774 C748.5564,211.3976 742.9783,211.2517 738.0844,205.4527 C735.1337,212.1474 730.0343,213.9389 724.944,207.6117 C719.9465,213.3849 715.4915,213.1588 711.3427,206.6703 C706.3059,212.1591 700.4731,211.9278 697.8886,204.1781 C693.3952,211.6409 686.605,210.4188 682.7666,203.49 C674.7182,198.8152 674.9249,193.5186 680.9264,187.2516 C674.274,181.3539 675.4898,176.2102 683.4598,172.8923" fill="#313139" style="stroke:#E7E7E7;stroke-width:0.5;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="69.166" x="689.51" y="191.972">Discovery</text></g><g class="entity" data-entity="GMN25" data-source-line="40" data-uid="ent0026" id="entity_GMN25"><path d="M614.32,43.2969 L614.32,128.9609 L833.8683,128.9609 L833.8683,53.2969 L823.8683,43.2969 L614.32,43.2969" fill="#714137" style="stroke:#E7E7E7;stroke-width:0.5;"/><path d="M823.8683,43.2969 L823.8683,53.2969 L833.8683,53.2969 L823.8683,43.2969" fill="#714137" style="stroke:#E7E7E7;stroke-width:1;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="155.1431" x="620.32" y="60.3638">SMART Client Library</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="198.5483" x="620.32" y="75.4966">• Handles OAuth 2.0 + SMART</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="168.689" x="620.32" y="90.6294">• Manages token lifecycle</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="141.356" x="620.32" y="105.7622">• Provides FHIR client</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="172.123" x="620.32" y="120.895">• Handles launch contexts</text></g><g class="entity" data-entity="GMN28" data-source-line="48" data-uid="ent0029" id="entity_GMN28"><path d="M988.87,459.2969 L988.87,544.9609 L1165.413,544.9609 L1165.413,469.2969 L1155.413,459.2969 L988.87,459.2969" fill="#714137" style="stroke:#E7E7E7;stroke-width:0.5;"/><path d="M1155.413,459.2969 L1155.413,469.2969 L1165.413,469.2969 L1155.413,459.2969" fill="#714137" style="stroke:#E7E7E7;stroke-width:1;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="155.543" x="994.87" y="476.3638">SMART Authorization</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="130.1206" x="994.87" y="491.4966">• OAuth 2.0 + PKCE</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="119.0059" x="994.87" y="506.6294">• Launch contexts</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="143.2729" x="994.87" y="521.7622">• Scope-based access</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="97.0112" x="994.87" y="536.895">• User consent</text></g><g class="link" data-entity-1="Web App" data-entity-2="Authorization.nHandler" data-source-line="28" data-uid="lnk16" id="link_Web App_Authorization.nHandler"><path d="M152.29,137.6269 C173.07,145.8069 197.37,155.1469 219.55,163.1269 C232.31,167.7069 240.3092,170.5056 253.4792,174.9056" fill="none" id="Web App-to-Authorization\nHandler" style="stroke:#E7E7E7;stroke-width:1;"/><polygon fill="#E7E7E7" points="259.17,176.8069,251.9013,170.1611,254.4277,175.2225,249.3663,177.7489,259.17,176.8069" style="stroke:#E7E7E7;stroke-width:1;"/></g><g class="link" data-entity-1="Mobile App" data-entity-2="Authorization.nHandler" data-source-line="29" data-uid="lnk17" id="link_Mobile App_Authorization.nHandler"><path d="M159.59,198.1269 C190.07,198.1269 221.51,198.1269 253.1,198.1269" fill="none" id="Mobile App-to-Authorization\nHandler" style="stroke:#E7E7E7;stroke-width:1;"/><polygon fill="#E7E7E7" points="259.1,198.1269,250.1,194.1269,254.1,198.1269,250.1,202.1269,259.1,198.1269" style="stroke:#E7E7E7;stroke-width:1;"/></g><g class="link" data-entity-1="Backend Service" data-entity-2="Authorization.nHandler" data-source-line="30" data-uid="lnk18" id="link_Backend Service_Authorization.nHandler"><path d="M166.72,255.4769 C195.79,244.9769 224.3175,234.6669 253.4975,224.1169" fill="none" id="Backend Service-to-Authorization\nHandler" style="stroke:#E7E7E7;stroke-width:1;"/><polygon fill="#E7E7E7" points="259.14,222.0769,249.3162,221.3753,254.4379,223.7769,252.0362,228.8986,259.14,222.0769" style="stroke:#E7E7E7;stroke-width:1;"/></g><g class="link" data-entity-1="Authorization.nHandler" data-entity-2="Disc" data-source-line="32" data-uid="lnk19" id="link_Authorization.nHandler_Disc"><path d="M393.66,196.2869 C472.86,194.0869 597.5523,190.6133 668.1723,188.6533" fill="none" id="Authorization\nHandler-to-Disc" style="stroke:#E7E7E7;stroke-width:1;"/><polygon fill="#E7E7E7" points="674.17,188.4869,665.0625,184.7381,669.1719,188.6256,665.2844,192.735,674.17,188.4869" style="stroke:#E7E7E7;stroke-width:1;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="141.6162" x="442.32" y="187.0638">1. Discover endpoints</text></g><g class="link" data-entity-1="Authorization.nHandler" data-entity-2="Auth" data-source-line="33" data-uid="lnk20" id="link_Authorization.nHandler_Auth"><path d="M393.66,214.5269 C466.81,232.6469 578.0558,260.205 651.1658,278.305" fill="none" id="Authorization\nHandler-to-Auth" style="stroke:#E7E7E7;stroke-width:1;"/><polygon fill="#E7E7E7" points="656.99,279.7469,649.215,273.7012,652.1365,278.5453,647.2925,281.4668,656.99,279.7469" style="stroke:#E7E7E7;stroke-width:1;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="100.1597" x="462.82" y="223.1538">2. Authenticate</text></g><g class="link" data-entity-1="Token.nManager" data-entity-2="Auth" data-source-line="34" data-uid="lnk21" id="link_Token.nManager_Auth"><path d="M383.5529,300.8592 C403.3929,302.3592 420.42,303.3869 441.32,304.1269 C504.84,306.3569 520.79,305.9569 584.32,304.1269 C607.96,303.4469 633.84,302.1169 656.78,300.7269" fill="none" id="Token\nManager-backto-Auth" style="stroke:#E7E7E7;stroke-width:1;"/><polygon fill="#E7E7E7" points="377.57,300.4069,386.2428,305.074,382.5558,300.7838,386.8459,297.0968,377.57,300.4069" style="stroke:#E7E7E7;stroke-width:1;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="97.8745" x="464.32" y="300.1938">3. Issue tokens</text></g><g class="link" data-entity-1="FHIR.nClient" data-entity-2="API" data-source-line="35" data-uid="lnk22" id="link_FHIR.nClient_API"><path d="M367.19,394.1269 C440.08,394.1269 588.93,394.1269 668.17,394.1269" fill="none" id="FHIR\nClient-to-API" style="stroke:#E7E7E7;stroke-width:1;"/><polygon fill="#E7E7E7" points="674.17,394.1269,665.17,390.1269,669.17,394.1269,665.17,398.1269,674.17,394.1269" style="stroke:#E7E7E7;stroke-width:1;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="107.2627" x="459.32" y="390.1938">4. FHIR requests</text></g><g class="link" data-entity-1="API" data-entity-2="DB" data-source-line="36" data-uid="lnk23" id="link_API_DB"><path d="M773.91,393.9869 C842.86,393.7869 961.67,393.4543 1027.25,393.2643" fill="none" id="API-to-DB" style="stroke:#E7E7E7;stroke-width:1;"/><polygon fill="#E7E7E7" points="1033.25,393.2469,1024.2384,389.273,1028.25,393.2614,1024.2616,397.2729,1033.25,393.2469" style="stroke:#E7E7E7;stroke-width:1;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="72.9219" x="875.37" y="389.5438">Query data</text></g><g class="link" data-entity-1="Auth" data-entity-2="Reg" data-source-line="37" data-uid="lnk24" id="link_Auth_Reg"><path d="M791.12,296.1269 C860.04,296.1269 960.46,296.1269 1021.89,296.1269" fill="none" id="Auth-to-Reg" style="stroke:#E7E7E7;stroke-width:1;"/><polygon fill="#E7E7E7" points="1027.89,296.1269,1018.89,292.1269,1022.89,296.1269,1018.89,300.1269,1027.89,296.1269" style="stroke:#E7E7E7;stroke-width:1;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="93.2344" x="864.87" y="292.1938">Validate client</text></g><g class="link" data-entity-1="SMART Client SDK" data-entity-2="GMN25" data-source-line="40" data-uid="lnk27" id="link_SMART Client SDK_GMN25"><path d="M418.3129,143.0879 C474.9317,136.6492 555.965,105.1369 613.82,98.5569" fill="none" id="SMART Client SDK-GMN25" style="stroke:#E7E7E7;stroke-width:1;stroke-dasharray:7,7;"/></g><g class="link" data-entity-1="Auth" data-entity-2="GMN28" data-source-line="48" data-uid="lnk30" id="link_Auth_GMN28"><path d="M791.24,317.5269 C806.46,324.6169 821.72,333.6969 833.87,345.1269 C854.72,364.7369 843.18,382.3369 863.87,402.1269 C898.75,435.4969 946.82,459.3969 988.4,475.4469" fill="none" id="Auth-GMN28" style="stroke:#E7E7E7;stroke-width:1;stroke-dasharray:7,7;"/></g></g></svg></div></div>
<h3 id="2-smart-on-fhir-architecture-authorization-server-components">2. SMART-on-FHIR Architecture, Authorization Server Components</h3>
<div class="puml-container"><div class="puml light" style=""><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="DESCRIPTION" height="1101px" preserveAspectRatio="xMidYMid meet" style="width:1947px;height:1101px;background:#FFFFFF;" version="1.1" viewBox="0 0 1947 1101" width="1947px" zoomAndPan="magnify" class="diagram"><title>SMART Authorization Server - Internal Components</title><defs/><g><g class="title" data-source-line="3"><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="405.877" x="763.6615" y="22.9951">SMART Authorization Server - Internal Components</text></g><g class="cluster" data-entity="Authorization Server" data-source-line="7" data-uid="ent0002" id="cluster_Authorization Server"><path d="M8.5,805.2969 L173.8359,805.2969 A3.75,3.75 0 0 1 176.3359,807.7969 L183.3359,827.5938 L1240.52,827.5938 A2.5,2.5 0 0 1 1243.02,830.0938 L1243.02,915.7969 A2.5,2.5 0 0 1 1240.52,918.2969 L8.5,918.2969 A2.5,2.5 0 0 1 6,915.7969 L6,807.7969 A2.5,2.5 0 0 1 8.5,805.2969" fill="none" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="6" x2="183.3359" y1="827.5938" y2="827.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="164.3359" x="10" y="820.292">Authorization Server</text></g><g class="cluster" data-entity="Supporting Services" data-source-line="18" data-uid="ent0010" id="cluster_Supporting Services"><path d="M688.01,43.2969 L848.5129,43.2969 A3.75,3.75 0 0 1 851.0129,45.7969 L858.0129,65.5938 L1929.7,65.5938 A2.5,2.5 0 0 1 1932.2,68.0938 L1932.2,621.7969 A2.5,2.5 0 0 1 1929.7,624.2969 L688.01,624.2969 A2.5,2.5 0 0 1 685.51,621.7969 L685.51,45.7969 A2.5,2.5 0 0 1 688.01,43.2969" fill="none" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="685.51" x2="858.0129" y1="65.5938" y2="65.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="159.5029" x="689.51" y="58.292">Supporting Services</text></g><g class="cluster" data-entity="Registry" data-source-line="19" data-uid="ent0011" id="cluster_Registry"><path d="M717.51,104.2969 C717.51,94.2969 1000.905,94.2969 1000.905,94.2969 C1000.905,94.2969 1284.3,94.2969 1284.3,104.2969 L1284.3,313.2969 C1284.3,323.2969 1000.905,323.2969 1000.905,323.2969 C1000.905,323.2969 717.51,323.2969 717.51,313.2969 L717.51,104.2969" fill="none" style="stroke:#181818;stroke-width:1;"/><path d="M717.51,104.2969 C717.51,114.2969 1000.905,114.2969 1000.905,114.2969 C1000.905,114.2969 1284.3,114.2969 1284.3,104.2969" fill="none" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="101.9033" x="949.9533" y="129.292">App Registry</text></g><g class="cluster" data-entity="UserDir" data-source-line="25" data-uid="ent0015" id="cluster_UserDir"><path d="M729.61,373.2969 C729.61,363.2969 1000.525,363.2969 1000.525,363.2969 C1000.525,363.2969 1271.44,363.2969 1271.44,373.2969 L1271.44,582.2969 C1271.44,592.2969 1000.525,592.2969 1000.525,592.2969 C1000.525,592.2969 729.61,592.2969 729.61,582.2969 L729.61,373.2969" fill="none" style="stroke:#181818;stroke-width:1;"/><path d="M729.61,373.2969 C729.61,383.2969 1000.525,383.2969 1000.525,383.2969 C1000.525,383.2969 1271.44,383.2969 1271.44,373.2969" fill="none" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="114.4336" x="943.3082" y="398.292">User Directory</text></g><g class="cluster" data-entity="Sessions" data-source-line="31" data-uid="ent0019" id="cluster_Sessions"><path d="M1493.19,373.2969 C1493.19,363.2969 1696.695,363.2969 1696.695,363.2969 C1696.695,363.2969 1900.2,363.2969 1900.2,373.2969 L1900.2,582.2969 C1900.2,592.2969 1696.695,592.2969 1696.695,592.2969 C1696.695,592.2969 1493.19,592.2969 1493.19,582.2969 L1493.19,373.2969" fill="none" style="stroke:#181818;stroke-width:1;"/><path d="M1493.19,373.2969 C1493.19,383.2969 1696.695,383.2969 1696.695,383.2969 C1696.695,383.2969 1900.2,383.2969 1900.2,373.2969" fill="none" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="108.2949" x="1642.5475" y="398.292">Session Store</text></g><g class="entity" data-entity="OAuth" data-source-line="8" data-uid="ent0003" id="entity_OAuth"><rect fill="#F1F1F1" height="62.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="110.5469" x="22" y="839.9969"/><rect fill="#F1F1F1" height="10" style="stroke:#181818;stroke-width:0.5;" width="15" x="112.5469" y="844.9969"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="110.5469" y="846.9969"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="110.5469" y="850.9969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="70.5469" x="37" y="872.992">OAuth 2.0</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="47.9814" x="37" y="889.2889">Engine</text></g><g class="entity" data-entity="UserAuth" data-source-line="9" data-uid="ent0004" id="entity_UserAuth"><rect fill="#F1F1F1" height="62.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="142.7715" x="333.64" y="839.9969"/><rect fill="#F1F1F1" height="10" style="stroke:#181818;stroke-width:0.5;" width="15" x="456.4115" y="844.9969"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="454.4115" y="846.9969"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="454.4115" y="850.9969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="31.9102" x="348.64" y="872.992">User</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="102.7715" x="348.64" y="889.2889">Authentication</text></g><g class="entity" data-entity="Consent" data-source-line="10" data-uid="ent0005" id="entity_Consent"><rect fill="#F1F1F1" height="62.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="132.2236" x="757.71" y="839.9969"/><rect fill="#F1F1F1" height="10" style="stroke:#181818;stroke-width:0.5;" width="15" x="869.9336" y="844.9969"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="867.9336" y="846.9969"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="867.9336" y="850.9969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="57.4834" x="772.71" y="872.992">Consent</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="92.2236" x="772.71" y="889.2889">Management</text></g><g class="entity" data-entity="TokenIssuer" data-source-line="11" data-uid="ent0006" id="entity_TokenIssuer"><rect fill="#F1F1F1" height="62.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="82.7109" x="1144.31" y="839.9969"/><rect fill="#F1F1F1" height="10" style="stroke:#181818;stroke-width:0.5;" width="15" x="1207.0209" y="844.9969"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="1205.0209" y="846.9969"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="1205.0209" y="850.9969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="42.7109" x="1159.31" y="872.992">Token</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="41.959" x="1159.31" y="889.2889">Issuer</text></g><g class="entity" data-entity="Client Credentials" data-source-line="20" data-uid="ent0012" id="entity_Client Credentials"><rect fill="#F1F1F1" height="46.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="164.6396" x="741.51" y="253.1469"/><rect fill="#F1F1F1" height="10" style="stroke:#181818;stroke-width:0.5;" width="15" x="886.1496" y="258.1469"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="884.1496" y="260.1469"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="884.1496" y="264.1469"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="124.6396" x="756.51" y="286.142">Client Credentials</text></g><g class="entity" data-entity="Redirect URIs" data-source-line="21" data-uid="ent0013" id="entity_Redirect URIs"><rect fill="#F1F1F1" height="46.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="134.5205" x="756.57" y="172.1469"/><rect fill="#F1F1F1" height="10" style="stroke:#181818;stroke-width:0.5;" width="15" x="871.0905" y="177.1469"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="869.0905" y="179.1469"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="869.0905" y="183.1469"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="94.5205" x="771.57" y="205.142">Redirect URIs</text></g><g class="entity" data-entity="Allowed Scopes" data-source-line="22" data-uid="ent0014" id="entity_Allowed Scopes"><rect fill="#F1F1F1" height="46.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="149.2656" x="1111.03" y="253.1469"/><rect fill="#F1F1F1" height="10" style="stroke:#181818;stroke-width:0.5;" width="15" x="1240.2956" y="258.1469"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="1238.2956" y="260.1469"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="1238.2956" y="264.1469"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="109.2656" x="1126.03" y="286.142">Allowed Scopes</text></g><g class="entity" data-entity="User Accounts" data-source-line="26" data-uid="ent0016" id="entity_User Accounts"><rect fill="#F1F1F1" height="46.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="140.4268" x="753.61" y="522.1469"/><rect fill="#F1F1F1" height="10" style="stroke:#181818;stroke-width:0.5;" width="15" x="874.0368" y="527.1469"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="872.0368" y="529.1469"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="872.0368" y="533.1469"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="100.4268" x="768.61" y="555.142">User Accounts</text></g><g class="entity" data-entity="Roles" data-source-line="27" data-uid="ent0017" id="entity_Roles"><rect fill="#F1F1F1" height="46.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="78.0898" x="784.78" y="441.1469"/><rect fill="#F1F1F1" height="10" style="stroke:#181818;stroke-width:0.5;" width="15" x="842.8698" y="446.1469"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="840.8698" y="448.1469"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="840.8698" y="452.1469"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="38.0898" x="799.78" y="474.142">Roles</text></g><g class="entity" data-entity="Permissions" data-source-line="28" data-uid="ent0018" id="entity_Permissions"><rect fill="#F1F1F1" height="46.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="123.5488" x="1123.89" y="522.1469"/><rect fill="#F1F1F1" height="10" style="stroke:#181818;stroke-width:0.5;" width="15" x="1227.4388" y="527.1469"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="1225.4388" y="529.1469"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="1225.4388" y="533.1469"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="83.5488" x="1138.89" y="555.142">Permissions</text></g><g class="entity" data-entity="Active Sessions" data-source-line="32" data-uid="ent0020" id="entity_Active Sessions"><rect fill="#F1F1F1" height="46.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="148.7119" x="1522.07" y="502.1469"/><rect fill="#F1F1F1" height="10" style="stroke:#181818;stroke-width:0.5;" width="15" x="1650.7819" y="507.1469"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="1648.7819" y="509.1469"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="1648.7819" y="513.1469"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="108.7119" x="1537.07" y="535.142">Active Sessions</text></g><g class="entity" data-entity="Consent Records" data-source-line="33" data-uid="ent0021" id="entity_Consent Records"><rect fill="#F1F1F1" height="46.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="158.4736" x="1517.19" y="421.1469"/><rect fill="#F1F1F1" height="10" style="stroke:#181818;stroke-width:0.5;" width="15" x="1655.6636" y="426.1469"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="1653.6636" y="428.1469"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="1653.6636" y="432.1469"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="118.4736" x="1532.19" y="454.142">Consent Records</text></g><g class="entity" data-entity="Issued Tokens" data-source-line="34" data-uid="ent0022" id="entity_Issued Tokens"><rect fill="#F1F1F1" height="46.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="139.5449" x="1736.66" y="502.1469"/><rect fill="#F1F1F1" height="10" style="stroke:#181818;stroke-width:0.5;" width="15" x="1856.2049" y="507.1469"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="1854.2049" y="509.1469"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="1854.2049" y="513.1469"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="99.5449" x="1751.66" y="535.142">Issued Tokens</text></g><g class="entity" data-entity="SMART Client" data-source-line="38" data-uid="ent0023" id="entity_SMART Client"><rect fill="#F1F1F1" height="46.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="133.8027" x="1529.52" y="890.1469"/><rect fill="#F1F1F1" height="10" style="stroke:#181818;stroke-width:0.5;" width="15" x="1643.3227" y="895.1469"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="1641.3227" y="897.1469"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="1641.3227" y="901.1469"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="93.8027" x="1544.52" y="923.142">SMART Client</text></g><g class="entity" data-entity="GMN33" data-source-line="49" data-uid="ent0034" id="entity_GMN33"><path d="M310.55,1008.4669 L310.55,1094.1309 L499.509,1094.1309 L499.509,1018.4669 L489.509,1008.4669 L310.55,1008.4669" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M489.509,1008.4669 L489.509,1018.4669 L499.509,1018.4669 L489.509,1008.4669" fill="#FEFFDD" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="144.5742" x="316.55" y="1025.5338">OAuth 2.0 + SMART</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="167.1909" x="316.55" y="1040.6666">• Authorization Code flow</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="132.8438" x="316.55" y="1055.7994">• PKCE enforcement</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="167.959" x="316.55" y="1070.9322">• Launch token validation</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="161.167" x="316.55" y="1086.065">• State parameter check</text></g><g class="entity" data-entity="GMN36" data-source-line="57" data-uid="ent0037" id="entity_GMN36"><path d="M1076.15,703.4669 L1076.15,780.1269 L890.41,848.5169 L1076.15,788.1269 L1076.15,789.1309 A0,0 0 0 0 1076.15,789.1309 L1295.1905,789.1309 A0,0 0 0 0 1295.1905,789.1309 L1295.1905,713.4669 L1285.1905,703.4669 L1076.15,703.4669 A0,0 0 0 0 1076.15,703.4669" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1285.1905,703.4669 L1285.1905,713.4669 L1295.1905,713.4669 L1285.1905,703.4669" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="159.9673" x="1082.15" y="720.5338">Consent Management</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="178.8325" x="1082.15" y="735.6666">• Display requested scopes</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="198.0405" x="1082.15" y="750.7994">• Remember user preferences</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="182.4697" x="1082.15" y="765.9322">• Support scope downgrade</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="165.9658" x="1082.15" y="781.065">• Audit consent decisions</text></g><g class="link" data-entity-1="OAuth" data-entity-2="UserAuth" data-source-line="40" data-uid="lnk26" id="link_OAuth_UserAuth"><path d="M132.8,871.2969 C187.86,871.2969 267.15,871.2969 327.37,871.2969" fill="none" id="OAuth-to-UserAuth-1" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="333.37,871.2969,324.37,867.2969,328.37,871.2969,324.37,875.2969,333.37,871.2969" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="116.1113" x="163.55" y="867.3638">Authenticate user</text></g><g class="link" data-entity-1="UserAuth" data-entity-2="Consent" data-source-line="42" data-uid="lnk28" id="link_UserAuth_Consent"><path d="M476.73,871.2969 C555.23,871.2969 674.92,871.2969 751.28,871.2969" fill="none" id="UserAuth-to-Consent-1" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="757.28,871.2969,748.28,867.2969,752.28,871.2969,748.28,875.2969,757.28,871.2969" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="138.29" x="530.51" y="867.3638">Show consent screen</text></g><g class="link" data-entity-1="Consent" data-entity-2="TokenIssuer" data-source-line="44" data-uid="lnk30" id="link_Consent_TokenIssuer"><path d="M890.41,871.2969 C964.3,871.2969 1076.12,871.2969 1137.87,871.2969" fill="none" id="Consent-to-TokenIssuer-1" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="1143.87,871.2969,1134.87,867.2969,1138.87,871.2969,1134.87,875.2969,1143.87,871.2969" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="108.437" x="937.15" y="867.3638">Generate tokens</text></g><g class="link" data-entity-1="SMART Client" data-entity-2="OAuth" data-source-line="38" data-uid="lnk24" id="link_SMART Client_OAuth"><path d="M1529.09,924.3269 C1448.4,936.7769 1307.94,955.2969 1186.67,955.2969 C1940.2,1052.2969 1940.2,1052.2969 404.03,955.2969 C294.51,955.2969 267.27,938.3369 162.55,906.2969 C152.85,903.3269 148.3203,901.8614 138.6003,898.0214" fill="none" id="SMART Client-to-OAuth" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="133.02,895.8169,139.9208,902.8439,137.6703,897.654,142.8602,895.4035,133.02,895.8169" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="140.9053" x="753.83" y="951.3638">Authorization request</text></g><g class="link" data-entity-1="OAuth" data-entity-2="Registry" data-source-line="39" data-uid="lnk25" id="link_OAuth_Registry"><path d="M93.74,839.6069 C151.73,724.5869 368.86,326.9269 677.51,156.2969 C684.53,152.4156 692.0227,149.1867 699.7654,146.5084 C703.6367,145.1692 707.5706,143.9677 711.5391,142.8911 C712.5312,142.6219 713.5255,142.3606 714.5216,142.1068 C715.0196,141.98 715.518,141.855 716.0169,141.7319 C716.2663,141.6704 710.6852,143.0251 710.9348,142.9645" fill="none" id="OAuth-to-Registry" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="716.7654,141.5487,707.0757,139.7854,711.9066,142.7285,708.9634,147.5594,716.7654,141.5487" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="111.5981" x="349.53" y="284.4538">Validate client_id</text></g><g class="link" data-entity-1="UserAuth" data-entity-2="UserDir" data-source-line="41" data-uid="lnk27" id="link_UserAuth_UserDir"><path d="M414.9,839.5369 C440.13,755.7369 520.78,528.0669 677.51,425.2969 C690.925,416.4994 706.5381,410.8206 722.455,407.2584 C724.4446,406.8132 726.439,406.401 728.4344,406.0199 C728.6838,405.9722 723.0356,407.0284 723.285,406.9818" fill="none" id="UserAuth-to-UserDir" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="729.1827,405.8784,719.6006,403.6017,724.268,406.7979,721.0717,411.4652,729.1827,405.8784" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="114.2896" x="542.51" y="429.2238">Verify credentials</text></g><g class="link" data-entity-1="Consent" data-entity-2="Sessions" data-source-line="43" data-uid="lnk29" id="link_Consent_Sessions"><path d="M857.51,839.5669 C902.74,797.5869 988.76,724.4569 1076.15,686.2969 C1183.075,639.5919 1311.7075,614.1244 1414.195,600.3169 C1439.8169,596.865 1463.8047,594.1419 1485.4107,591.9979 C1486.7611,591.8639 1488.1022,591.7321 1489.4338,591.6026 C1490.0996,591.5378 1484.7906,592.0487 1485.4517,591.9851" fill="none" id="Consent-to-Sessions" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="1491.424,591.41,1482.0821,588.291,1486.447,591.8892,1482.8488,596.2542,1491.424,591.41" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="101.3086" x="1135.17" y="615.6138">Record consent</text></g><g class="link" data-entity-1="TokenIssuer" data-entity-2="Sessions" data-source-line="45" data-uid="lnk31" id="link_TokenIssuer_Sessions"><path d="M1227.37,849.6369 C1249.36,837.5269 1276.76,821.7969 1300.3,806.2969 C1367.77,761.8719 1440.3175,707.3969 1496.6,663.5269 C1524.7413,641.5919 1548.8163,622.3081 1566.1572,608.2575 C1570.4924,604.7448 1574.4068,601.5593 1577.8586,598.7411 C1579.5845,597.332 1581.1947,596.0148 1582.6841,594.7944 C1583.4288,594.1843 1584.1433,593.5983 1584.8269,593.0372 C1584.9978,592.8969 1580.5297,596.5658 1580.6968,596.4286" fill="none" id="TokenIssuer-to-Sessions" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="1585.3339,592.6211,1575.8399,595.241,1581.4696,595.794,1580.9166,601.4238,1585.3339,592.6211" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="142.7334" x="1326.19" y="685.2238">Store token metadata</text></g><g class="link" data-entity-1="TokenIssuer" data-entity-2="SMART Client" data-source-line="46" data-uid="lnk32" id="link_TokenIssuer_SMART Client"><path d="M1227.35,875.4769 C1297.93,882.7269 1437.6915,897.0832 1523.0915,905.8632" fill="none" id="TokenIssuer-to-SMART Client" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="1529.06,906.4769,1520.5163,901.5774,1524.0862,905.9655,1519.6981,909.5355,1529.06,906.4769" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="91.6729" x="1351.69" y="882.1438">Return tokens</text></g><g class="link" data-entity-1="OAuth" data-entity-2="GMN33" data-source-line="49" data-uid="lnk35" id="link_OAuth_GMN33"><path d="M95.07,903.0369 C109.74,927.8069 133.25,961.2669 162.55,981.2969 C206.24,1011.1569 262.71,1028.4369 310.06,1038.3569" fill="none" id="OAuth-GMN33" style="stroke:#181818;stroke-width:1;stroke-dasharray:7,7;"/></g></g></svg></div><div class="puml dark" style=""><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="DESCRIPTION" height="1101px" preserveAspectRatio="xMidYMid meet" style="width:1947px;height:1101px;background:#1B1B1B;" version="1.1" viewBox="0 0 1947 1101" width="1947px" zoomAndPan="magnify" class="diagram"><title>SMART Authorization Server - Internal Components</title><defs/><g><rect fill="#1B1B1B" height="1101" style="stroke:none;stroke-width:1;" width="1947" x="0" y="0"/><g class="title" data-source-line="3"><text fill="#FFFFFF" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="405.877" x="763.6615" y="22.9951">SMART Authorization Server - Internal Components</text></g><g class="cluster" data-entity="Authorization Server" data-source-line="7" data-uid="ent0002" id="cluster_Authorization Server"><path d="M8.5,805.2969 L173.8359,805.2969 A3.75,3.75 0 0 1 176.3359,807.7969 L183.3359,827.5938 L1240.52,827.5938 A2.5,2.5 0 0 1 1243.02,830.0938 L1243.02,915.7969 A2.5,2.5 0 0 1 1240.52,918.2969 L8.5,918.2969 A2.5,2.5 0 0 1 6,915.7969 L6,807.7969 A2.5,2.5 0 0 1 8.5,805.2969" fill="none" style="stroke:#FFFFFF;stroke-width:1.5;"/><line style="stroke:#FFFFFF;stroke-width:1.5;" x1="6" x2="183.3359" y1="827.5938" y2="827.5938"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="164.3359" x="10" y="820.292">Authorization Server</text></g><g class="cluster" data-entity="Supporting Services" data-source-line="18" data-uid="ent0010" id="cluster_Supporting Services"><path d="M688.01,43.2969 L848.5129,43.2969 A3.75,3.75 0 0 1 851.0129,45.7969 L858.0129,65.5938 L1929.7,65.5938 A2.5,2.5 0 0 1 1932.2,68.0938 L1932.2,621.7969 A2.5,2.5 0 0 1 1929.7,624.2969 L688.01,624.2969 A2.5,2.5 0 0 1 685.51,621.7969 L685.51,45.7969 A2.5,2.5 0 0 1 688.01,43.2969" fill="none" style="stroke:#FFFFFF;stroke-width:1.5;"/><line style="stroke:#FFFFFF;stroke-width:1.5;" x1="685.51" x2="858.0129" y1="65.5938" y2="65.5938"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="159.5029" x="689.51" y="58.292">Supporting Services</text></g><g class="cluster" data-entity="Registry" data-source-line="19" data-uid="ent0011" id="cluster_Registry"><path d="M717.51,104.2969 C717.51,94.2969 1000.905,94.2969 1000.905,94.2969 C1000.905,94.2969 1284.3,94.2969 1284.3,104.2969 L1284.3,313.2969 C1284.3,323.2969 1000.905,323.2969 1000.905,323.2969 C1000.905,323.2969 717.51,323.2969 717.51,313.2969 L717.51,104.2969" fill="none" style="stroke:#E7E7E7;stroke-width:1;"/><path d="M717.51,104.2969 C717.51,114.2969 1000.905,114.2969 1000.905,114.2969 C1000.905,114.2969 1284.3,114.2969 1284.3,104.2969" fill="none" style="stroke:#E7E7E7;stroke-width:1;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="101.9033" x="949.9533" y="129.292">App Registry</text></g><g class="cluster" data-entity="UserDir" data-source-line="25" data-uid="ent0015" id="cluster_UserDir"><path d="M729.61,373.2969 C729.61,363.2969 1000.525,363.2969 1000.525,363.2969 C1000.525,363.2969 1271.44,363.2969 1271.44,373.2969 L1271.44,582.2969 C1271.44,592.2969 1000.525,592.2969 1000.525,592.2969 C1000.525,592.2969 729.61,592.2969 729.61,582.2969 L729.61,373.2969" fill="none" style="stroke:#E7E7E7;stroke-width:1;"/><path d="M729.61,373.2969 C729.61,383.2969 1000.525,383.2969 1000.525,383.2969 C1000.525,383.2969 1271.44,383.2969 1271.44,373.2969" fill="none" style="stroke:#E7E7E7;stroke-width:1;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="114.4336" x="943.3082" y="398.292">User Directory</text></g><g class="cluster" data-entity="Sessions" data-source-line="31" data-uid="ent0019" id="cluster_Sessions"><path d="M1493.19,373.2969 C1493.19,363.2969 1696.695,363.2969 1696.695,363.2969 C1696.695,363.2969 1900.2,363.2969 1900.2,373.2969 L1900.2,582.2969 C1900.2,592.2969 1696.695,592.2969 1696.695,592.2969 C1696.695,592.2969 1493.19,592.2969 1493.19,582.2969 L1493.19,373.2969" fill="none" style="stroke:#E7E7E7;stroke-width:1;"/><path d="M1493.19,373.2969 C1493.19,383.2969 1696.695,383.2969 1696.695,383.2969 C1696.695,383.2969 1900.2,383.2969 1900.2,373.2969" fill="none" style="stroke:#E7E7E7;stroke-width:1;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="108.2949" x="1642.5475" y="398.292">Session Store</text></g><g class="entity" data-entity="OAuth" data-source-line="8" data-uid="ent0003" id="entity_OAuth"><rect fill="#313139" height="62.5938" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="110.5469" x="22" y="839.9969"/><rect fill="#313139" height="10" style="stroke:#E7E7E7;stroke-width:0.5;" width="15" x="112.5469" y="844.9969"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="110.5469" y="846.9969"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="110.5469" y="850.9969"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="70.5469" x="37" y="872.992">OAuth 2.0</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="47.9814" x="37" y="889.2889">Engine</text></g><g class="entity" data-entity="UserAuth" data-source-line="9" data-uid="ent0004" id="entity_UserAuth"><rect fill="#313139" height="62.5938" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="142.7715" x="333.64" y="839.9969"/><rect fill="#313139" height="10" style="stroke:#E7E7E7;stroke-width:0.5;" width="15" x="456.4115" y="844.9969"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="454.4115" y="846.9969"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="454.4115" y="850.9969"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="31.9102" x="348.64" y="872.992">User</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="102.7715" x="348.64" y="889.2889">Authentication</text></g><g class="entity" data-entity="Consent" data-source-line="10" data-uid="ent0005" id="entity_Consent"><rect fill="#313139" height="62.5938" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="132.2236" x="757.71" y="839.9969"/><rect fill="#313139" height="10" style="stroke:#E7E7E7;stroke-width:0.5;" width="15" x="869.9336" y="844.9969"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="867.9336" y="846.9969"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="867.9336" y="850.9969"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="57.4834" x="772.71" y="872.992">Consent</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="92.2236" x="772.71" y="889.2889">Management</text></g><g class="entity" data-entity="TokenIssuer" data-source-line="11" data-uid="ent0006" id="entity_TokenIssuer"><rect fill="#313139" height="62.5938" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="82.7109" x="1144.31" y="839.9969"/><rect fill="#313139" height="10" style="stroke:#E7E7E7;stroke-width:0.5;" width="15" x="1207.0209" y="844.9969"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="1205.0209" y="846.9969"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="1205.0209" y="850.9969"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="42.7109" x="1159.31" y="872.992">Token</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="41.959" x="1159.31" y="889.2889">Issuer</text></g><g class="entity" data-entity="Client Credentials" data-source-line="20" data-uid="ent0012" id="entity_Client Credentials"><rect fill="#313139" height="46.2969" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="164.6396" x="741.51" y="253.1469"/><rect fill="#313139" height="10" style="stroke:#E7E7E7;stroke-width:0.5;" width="15" x="886.1496" y="258.1469"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="884.1496" y="260.1469"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="884.1496" y="264.1469"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="124.6396" x="756.51" y="286.142">Client Credentials</text></g><g class="entity" data-entity="Redirect URIs" data-source-line="21" data-uid="ent0013" id="entity_Redirect URIs"><rect fill="#313139" height="46.2969" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="134.5205" x="756.57" y="172.1469"/><rect fill="#313139" height="10" style="stroke:#E7E7E7;stroke-width:0.5;" width="15" x="871.0905" y="177.1469"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="869.0905" y="179.1469"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="869.0905" y="183.1469"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="94.5205" x="771.57" y="205.142">Redirect URIs</text></g><g class="entity" data-entity="Allowed Scopes" data-source-line="22" data-uid="ent0014" id="entity_Allowed Scopes"><rect fill="#313139" height="46.2969" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="149.2656" x="1111.03" y="253.1469"/><rect fill="#313139" height="10" style="stroke:#E7E7E7;stroke-width:0.5;" width="15" x="1240.2956" y="258.1469"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="1238.2956" y="260.1469"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="1238.2956" y="264.1469"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="109.2656" x="1126.03" y="286.142">Allowed Scopes</text></g><g class="entity" data-entity="User Accounts" data-source-line="26" data-uid="ent0016" id="entity_User Accounts"><rect fill="#313139" height="46.2969" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="140.4268" x="753.61" y="522.1469"/><rect fill="#313139" height="10" style="stroke:#E7E7E7;stroke-width:0.5;" width="15" x="874.0368" y="527.1469"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="872.0368" y="529.1469"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="872.0368" y="533.1469"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="100.4268" x="768.61" y="555.142">User Accounts</text></g><g class="entity" data-entity="Roles" data-source-line="27" data-uid="ent0017" id="entity_Roles"><rect fill="#313139" height="46.2969" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="78.0898" x="784.78" y="441.1469"/><rect fill="#313139" height="10" style="stroke:#E7E7E7;stroke-width:0.5;" width="15" x="842.8698" y="446.1469"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="840.8698" y="448.1469"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="840.8698" y="452.1469"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="38.0898" x="799.78" y="474.142">Roles</text></g><g class="entity" data-entity="Permissions" data-source-line="28" data-uid="ent0018" id="entity_Permissions"><rect fill="#313139" height="46.2969" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="123.5488" x="1123.89" y="522.1469"/><rect fill="#313139" height="10" style="stroke:#E7E7E7;stroke-width:0.5;" width="15" x="1227.4388" y="527.1469"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="1225.4388" y="529.1469"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="1225.4388" y="533.1469"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="83.5488" x="1138.89" y="555.142">Permissions</text></g><g class="entity" data-entity="Active Sessions" data-source-line="32" data-uid="ent0020" id="entity_Active Sessions"><rect fill="#313139" height="46.2969" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="148.7119" x="1522.07" y="502.1469"/><rect fill="#313139" height="10" style="stroke:#E7E7E7;stroke-width:0.5;" width="15" x="1650.7819" y="507.1469"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="1648.7819" y="509.1469"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="1648.7819" y="513.1469"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="108.7119" x="1537.07" y="535.142">Active Sessions</text></g><g class="entity" data-entity="Consent Records" data-source-line="33" data-uid="ent0021" id="entity_Consent Records"><rect fill="#313139" height="46.2969" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="158.4736" x="1517.19" y="421.1469"/><rect fill="#313139" height="10" style="stroke:#E7E7E7;stroke-width:0.5;" width="15" x="1655.6636" y="426.1469"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="1653.6636" y="428.1469"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="1653.6636" y="432.1469"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="118.4736" x="1532.19" y="454.142">Consent Records</text></g><g class="entity" data-entity="Issued Tokens" data-source-line="34" data-uid="ent0022" id="entity_Issued Tokens"><rect fill="#313139" height="46.2969" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="139.5449" x="1736.66" y="502.1469"/><rect fill="#313139" height="10" style="stroke:#E7E7E7;stroke-width:0.5;" width="15" x="1856.2049" y="507.1469"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="1854.2049" y="509.1469"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="1854.2049" y="513.1469"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="99.5449" x="1751.66" y="535.142">Issued Tokens</text></g><g class="entity" data-entity="SMART Client" data-source-line="38" data-uid="ent0023" id="entity_SMART Client"><rect fill="#313139" height="46.2969" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="133.8027" x="1529.52" y="890.1469"/><rect fill="#313139" height="10" style="stroke:#E7E7E7;stroke-width:0.5;" width="15" x="1643.3227" y="895.1469"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="1641.3227" y="897.1469"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="1641.3227" y="901.1469"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="93.8027" x="1544.52" y="923.142">SMART Client</text></g><g class="entity" data-entity="GMN33" data-source-line="49" data-uid="ent0034" id="entity_GMN33"><path d="M310.55,1008.4669 L310.55,1094.1309 L499.509,1094.1309 L499.509,1018.4669 L489.509,1008.4669 L310.55,1008.4669" fill="#714137" style="stroke:#E7E7E7;stroke-width:0.5;"/><path d="M489.509,1008.4669 L489.509,1018.4669 L499.509,1018.4669 L489.509,1008.4669" fill="#714137" style="stroke:#E7E7E7;stroke-width:1;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="144.5742" x="316.55" y="1025.5338">OAuth 2.0 + SMART</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="167.1909" x="316.55" y="1040.6666">• Authorization Code flow</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="132.8438" x="316.55" y="1055.7994">• PKCE enforcement</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="167.959" x="316.55" y="1070.9322">• Launch token validation</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="161.167" x="316.55" y="1086.065">• State parameter check</text></g><g class="entity" data-entity="GMN36" data-source-line="57" data-uid="ent0037" id="entity_GMN36"><path d="M1076.15,703.4669 L1076.15,780.1269 L890.41,848.5169 L1076.15,788.1269 L1076.15,789.1309 A0,0 0 0 0 1076.15,789.1309 L1295.1905,789.1309 A0,0 0 0 0 1295.1905,789.1309 L1295.1905,713.4669 L1285.1905,703.4669 L1076.15,703.4669 A0,0 0 0 0 1076.15,703.4669" fill="#714137" style="stroke:#E7E7E7;stroke-width:0.5;"/><path d="M1285.1905,703.4669 L1285.1905,713.4669 L1295.1905,713.4669 L1285.1905,703.4669" fill="#714137" style="stroke:#E7E7E7;stroke-width:0.5;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="159.9673" x="1082.15" y="720.5338">Consent Management</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="178.8325" x="1082.15" y="735.6666">• Display requested scopes</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="198.0405" x="1082.15" y="750.7994">• Remember user preferences</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="182.4697" x="1082.15" y="765.9322">• Support scope downgrade</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="165.9658" x="1082.15" y="781.065">• Audit consent decisions</text></g><g class="link" data-entity-1="OAuth" data-entity-2="UserAuth" data-source-line="40" data-uid="lnk26" id="link_OAuth_UserAuth"><path d="M132.8,871.2969 C187.86,871.2969 267.15,871.2969 327.37,871.2969" fill="none" id="OAuth-to-UserAuth-1" style="stroke:#E7E7E7;stroke-width:1;"/><polygon fill="#E7E7E7" points="333.37,871.2969,324.37,867.2969,328.37,871.2969,324.37,875.2969,333.37,871.2969" style="stroke:#E7E7E7;stroke-width:1;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="116.1113" x="163.55" y="867.3638">Authenticate user</text></g><g class="link" data-entity-1="UserAuth" data-entity-2="Consent" data-source-line="42" data-uid="lnk28" id="link_UserAuth_Consent"><path d="M476.73,871.2969 C555.23,871.2969 674.92,871.2969 751.28,871.2969" fill="none" id="UserAuth-to-Consent-1" style="stroke:#E7E7E7;stroke-width:1;"/><polygon fill="#E7E7E7" points="757.28,871.2969,748.28,867.2969,752.28,871.2969,748.28,875.2969,757.28,871.2969" style="stroke:#E7E7E7;stroke-width:1;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="138.29" x="530.51" y="867.3638">Show consent screen</text></g><g class="link" data-entity-1="Consent" data-entity-2="TokenIssuer" data-source-line="44" data-uid="lnk30" id="link_Consent_TokenIssuer"><path d="M890.41,871.2969 C964.3,871.2969 1076.12,871.2969 1137.87,871.2969" fill="none" id="Consent-to-TokenIssuer-1" style="stroke:#E7E7E7;stroke-width:1;"/><polygon fill="#E7E7E7" points="1143.87,871.2969,1134.87,867.2969,1138.87,871.2969,1134.87,875.2969,1143.87,871.2969" style="stroke:#E7E7E7;stroke-width:1;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="108.437" x="937.15" y="867.3638">Generate tokens</text></g><g class="link" data-entity-1="SMART Client" data-entity-2="OAuth" data-source-line="38" data-uid="lnk24" id="link_SMART Client_OAuth"><path d="M1529.09,924.3269 C1448.4,936.7769 1307.94,955.2969 1186.67,955.2969 C1940.2,1052.2969 1940.2,1052.2969 404.03,955.2969 C294.51,955.2969 267.27,938.3369 162.55,906.2969 C152.85,903.3269 148.3203,901.8614 138.6003,898.0214" fill="none" id="SMART Client-to-OAuth" style="stroke:#E7E7E7;stroke-width:1;"/><polygon fill="#E7E7E7" points="133.02,895.8169,139.9208,902.8439,137.6703,897.654,142.8602,895.4035,133.02,895.8169" style="stroke:#E7E7E7;stroke-width:1;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="140.9053" x="753.83" y="951.3638">Authorization request</text></g><g class="link" data-entity-1="OAuth" data-entity-2="Registry" data-source-line="39" data-uid="lnk25" id="link_OAuth_Registry"><path d="M93.74,839.6069 C151.73,724.5869 368.86,326.9269 677.51,156.2969 C684.53,152.4156 692.0227,149.1867 699.7654,146.5084 C703.6367,145.1692 707.5706,143.9677 711.5391,142.8911 C712.5312,142.6219 713.5255,142.3606 714.5216,142.1068 C715.0196,141.98 715.518,141.855 716.0169,141.7319 C716.2663,141.6704 710.6852,143.0251 710.9348,142.9645" fill="none" id="OAuth-to-Registry" style="stroke:#E7E7E7;stroke-width:1;"/><polygon fill="#E7E7E7" points="716.7654,141.5487,707.0757,139.7854,711.9066,142.7285,708.9634,147.5594,716.7654,141.5487" style="stroke:#E7E7E7;stroke-width:1;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="111.5981" x="349.53" y="284.4538">Validate client_id</text></g><g class="link" data-entity-1="UserAuth" data-entity-2="UserDir" data-source-line="41" data-uid="lnk27" id="link_UserAuth_UserDir"><path d="M414.9,839.5369 C440.13,755.7369 520.78,528.0669 677.51,425.2969 C690.925,416.4994 706.5381,410.8206 722.455,407.2584 C724.4446,406.8132 726.439,406.401 728.4344,406.0199 C728.6838,405.9722 723.0356,407.0284 723.285,406.9818" fill="none" id="UserAuth-to-UserDir" style="stroke:#E7E7E7;stroke-width:1;"/><polygon fill="#E7E7E7" points="729.1827,405.8784,719.6006,403.6017,724.268,406.7979,721.0717,411.4652,729.1827,405.8784" style="stroke:#E7E7E7;stroke-width:1;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="114.2896" x="542.51" y="429.2238">Verify credentials</text></g><g class="link" data-entity-1="Consent" data-entity-2="Sessions" data-source-line="43" data-uid="lnk29" id="link_Consent_Sessions"><path d="M857.51,839.5669 C902.74,797.5869 988.76,724.4569 1076.15,686.2969 C1183.075,639.5919 1311.7075,614.1244 1414.195,600.3169 C1439.8169,596.865 1463.8047,594.1419 1485.4107,591.9979 C1486.7611,591.8639 1488.1022,591.7321 1489.4338,591.6026 C1490.0996,591.5378 1484.7906,592.0487 1485.4517,591.9851" fill="none" id="Consent-to-Sessions" style="stroke:#E7E7E7;stroke-width:1;"/><polygon fill="#E7E7E7" points="1491.424,591.41,1482.0821,588.291,1486.447,591.8892,1482.8488,596.2542,1491.424,591.41" style="stroke:#E7E7E7;stroke-width:1;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="101.3086" x="1135.17" y="615.6138">Record consent</text></g><g class="link" data-entity-1="TokenIssuer" data-entity-2="Sessions" data-source-line="45" data-uid="lnk31" id="link_TokenIssuer_Sessions"><path d="M1227.37,849.6369 C1249.36,837.5269 1276.76,821.7969 1300.3,806.2969 C1367.77,761.8719 1440.3175,707.3969 1496.6,663.5269 C1524.7413,641.5919 1548.8163,622.3081 1566.1572,608.2575 C1570.4924,604.7448 1574.4068,601.5593 1577.8586,598.7411 C1579.5845,597.332 1581.1947,596.0148 1582.6841,594.7944 C1583.4288,594.1843 1584.1433,593.5983 1584.8269,593.0372 C1584.9978,592.8969 1580.5297,596.5658 1580.6968,596.4286" fill="none" id="TokenIssuer-to-Sessions" style="stroke:#E7E7E7;stroke-width:1;"/><polygon fill="#E7E7E7" points="1585.3339,592.6211,1575.8399,595.241,1581.4696,595.794,1580.9166,601.4238,1585.3339,592.6211" style="stroke:#E7E7E7;stroke-width:1;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="142.7334" x="1326.19" y="685.2238">Store token metadata</text></g><g class="link" data-entity-1="TokenIssuer" data-entity-2="SMART Client" data-source-line="46" data-uid="lnk32" id="link_TokenIssuer_SMART Client"><path d="M1227.35,875.4769 C1297.93,882.7269 1437.6915,897.0832 1523.0915,905.8632" fill="none" id="TokenIssuer-to-SMART Client" style="stroke:#E7E7E7;stroke-width:1;"/><polygon fill="#E7E7E7" points="1529.06,906.4769,1520.5163,901.5774,1524.0862,905.9655,1519.6981,909.5355,1529.06,906.4769" style="stroke:#E7E7E7;stroke-width:1;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="91.6729" x="1351.69" y="882.1438">Return tokens</text></g><g class="link" data-entity-1="OAuth" data-entity-2="GMN33" data-source-line="49" data-uid="lnk35" id="link_OAuth_GMN33"><path d="M95.07,903.0369 C109.74,927.8069 133.25,961.2669 162.55,981.2969 C206.24,1011.1569 262.71,1028.4369 310.06,1038.3569" fill="none" id="OAuth-GMN33" style="stroke:#E7E7E7;stroke-width:1;stroke-dasharray:7,7;"/></g></g></svg></div></div>
<h3 id="3-smart-on-fhir-architecture-fhir-api-server-components">3. SMART-on-FHIR Architecture, FHIR API Server Components</h3>
<div class="puml-container"><div class="puml light" style=""><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="DESCRIPTION" height="542px" preserveAspectRatio="xMidYMid meet" style="width:2558px;height:542px;background:#FFFFFF;" version="1.1" viewBox="0 0 2558 542" width="2558px" zoomAndPan="magnify" class="diagram"><title>FHIR API Server - Internal Components</title><defs/><g><g class="title" data-source-line="3"><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="306.8174" x="1118.8963" y="22.9951">FHIR API Server - Internal Components</text></g><g class="cluster" data-entity="FHIR API Server" data-source-line="7" data-uid="ent0002" id="cluster_FHIR API Server"><path d="M300.3,209.1269 L426.6301,209.1269 A3.75,3.75 0 0 1 429.1301,211.6269 L436.1301,231.4237 L1483.07,231.4237 A2.5,2.5 0 0 1 1485.57,233.9237 L1485.57,319.6269 A2.5,2.5 0 0 1 1483.07,322.1269 L300.3,322.1269 A2.5,2.5 0 0 1 297.8,319.6269 L297.8,211.6269 A2.5,2.5 0 0 1 300.3,209.1269" fill="none" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="297.8" x2="436.1301" y1="231.4237" y2="231.4237"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="125.3301" x="301.8" y="224.122">FHIR API Server</text></g><g class="cluster" data-entity="Data Layer" data-source-line="18" data-uid="ent0010" id="cluster_Data Layer"><path d="M1749.19,145.1269 L1836.1656,145.1269 A3.75,3.75 0 0 1 1838.6656,147.6269 L1845.6656,167.4237 L2541.11,167.4237 A2.5,2.5 0 0 1 2543.61,169.9237 L2543.61,524.6269 A2.5,2.5 0 0 1 2541.11,527.1269 L1749.19,527.1269 A2.5,2.5 0 0 1 1746.69,524.6269 L1746.69,147.6269 A2.5,2.5 0 0 1 1749.19,145.1269" fill="none" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="1746.69" x2="1845.6656" y1="167.4237" y2="167.4237"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="85.9756" x="1750.69" y="160.122">Data Layer</text></g><g class="cluster" data-entity="DB" data-source-line="19" data-uid="ent0011" id="cluster_DB"><path d="M2066.38,206.1269 C2066.38,196.1269 2288.995,196.1269 2288.995,196.1269 C2288.995,196.1269 2511.61,196.1269 2511.61,206.1269 L2511.61,415.1269 C2511.61,425.1269 2288.995,425.1269 2288.995,425.1269 C2288.995,425.1269 2066.38,425.1269 2066.38,415.1269 L2066.38,206.1269" fill="none" style="stroke:#181818;stroke-width:1;"/><path d="M2066.38,206.1269 C2066.38,216.1269 2288.995,216.1269 2288.995,216.1269 C2288.995,216.1269 2511.61,216.1269 2511.61,206.1269" fill="none" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="136.5615" x="2220.7142" y="231.122">Clinical Database</text></g><g class="entity" data-entity="REST" data-source-line="8" data-uid="ent0003" id="entity_REST"><rect fill="#F1F1F1" height="62.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="112.8984" x="313.8" y="243.8269"/><rect fill="#F1F1F1" height="10" style="stroke:#181818;stroke-width:0.5;" width="15" x="406.6984" y="248.8269"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="404.6984" y="250.8269"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="404.6984" y="254.8269"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="72.8984" x="328.8" y="276.822">FHIR REST</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="22.1484" x="328.8" y="293.1189">API</text></g><g class="entity" data-entity="Validator" data-source-line="9" data-uid="ent0004" id="entity_Validator"><rect fill="#F1F1F1" height="62.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="103.2119" x="630.7" y="243.8269"/><rect fill="#F1F1F1" height="10" style="stroke:#181818;stroke-width:0.5;" width="15" x="713.9119" y="248.8269"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="711.9119" y="250.8269"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="711.9119" y="254.8269"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="42.7109" x="645.7" y="276.822">Token</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="63.2119" x="645.7" y="293.1189">Validator</text></g><g class="entity" data-entity="Scopes" data-source-line="10" data-uid="ent0005" id="entity_Scopes"><rect fill="#F1F1F1" height="62.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="99.0352" x="923.13" y="243.8269"/><rect fill="#F1F1F1" height="10" style="stroke:#181818;stroke-width:0.5;" width="15" x="1002.1652" y="248.8269"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="1000.1652" y="250.8269"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="1000.1652" y="254.8269"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="42.6494" x="938.13" y="276.822">Scope</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="59.0352" x="938.13" y="293.1189">Enforcer</text></g><g class="entity" data-entity="RAC" data-source-line="11" data-uid="ent0006" id="entity_RAC"><rect fill="#F1F1F1" height="62.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="157.7627" x="1311.81" y="243.8269"/><rect fill="#F1F1F1" height="10" style="stroke:#181818;stroke-width:0.5;" width="15" x="1449.5727" y="248.8269"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="1447.5727" y="250.8269"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="1447.5727" y="254.8269"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="117.7627" x="1326.81" y="276.822">Resource Access</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="50.9141" x="1326.81" y="293.1189">Control</text></g><g class="entity" data-entity="Query" data-source-line="26" data-uid="ent0016" id="entity_Query"><rect fill="#F1F1F1" height="62.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="87.9814" x="1762.69" y="296.8269"/><rect fill="#F1F1F1" height="10" style="stroke:#181818;stroke-width:0.5;" width="15" x="1830.6714" y="301.8269"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="1828.6714" y="303.8269"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="1828.6714" y="307.8269"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="42.5469" x="1777.69" y="329.822">Query</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="47.9814" x="1777.69" y="346.1189">Engine</text></g><g class="entity" data-entity="Serializer" data-source-line="27" data-uid="ent0017" id="entity_Serializer"><rect fill="#F1F1F1" height="62.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="105.2217" x="2373.07" y="448.8269"/><rect fill="#F1F1F1" height="10" style="stroke:#181818;stroke-width:0.5;" width="15" x="2458.2917" y="453.8269"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="2456.2917" y="455.8269"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="2456.2917" y="459.8269"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="32.4365" x="2388.07" y="481.822">FHIR</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="65.2217" x="2388.07" y="498.1189">Serializer</text></g><g class="entity" data-entity="Patient Records" data-source-line="20" data-uid="ent0012" id="entity_Patient Records"><rect fill="#F1F1F1" height="46.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="150.3662" x="2090.38" y="334.9769"/><rect fill="#F1F1F1" height="10" style="stroke:#181818;stroke-width:0.5;" width="15" x="2220.7462" y="339.9769"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="2218.7462" y="341.9769"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="2218.7462" y="345.9769"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="110.3662" x="2105.38" y="367.972">Patient Records</text></g><g class="entity" data-entity="Observations" data-source-line="21" data-uid="ent0013" id="entity_Observations"><rect fill="#F1F1F1" height="46.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="132.5449" x="2099.29" y="253.9769"/><rect fill="#F1F1F1" height="10" style="stroke:#181818;stroke-width:0.5;" width="15" x="2211.8349" y="258.9769"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="2209.8349" y="260.9769"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="2209.8349" y="264.9769"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="92.5449" x="2114.29" y="286.972">Observations</text></g><g class="entity" data-entity="Medications" data-source-line="22" data-uid="ent0014" id="entity_Medications"><rect fill="#F1F1F1" height="46.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="123.8564" x="2363.75" y="334.9769"/><rect fill="#F1F1F1" height="10" style="stroke:#181818;stroke-width:0.5;" width="15" x="2467.6064" y="339.9769"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="2465.6064" y="341.9769"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="2465.6064" y="345.9769"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="83.8564" x="2378.75" y="367.972">Medications</text></g><g class="entity" data-entity="Encounters" data-source-line="23" data-uid="ent0015" id="entity_Encounters"><rect fill="#F1F1F1" height="46.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="118.8799" x="2366.24" y="253.9769"/><rect fill="#F1F1F1" height="10" style="stroke:#181818;stroke-width:0.5;" width="15" x="2465.1199" y="258.9769"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="2463.1199" y="260.9769"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="2463.1199" y="264.9769"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="78.8799" x="2381.24" y="286.972">Encounters</text></g><g class="entity" data-entity="SMART Client" data-source-line="30" data-uid="ent0018" id="entity_SMART Client"><rect fill="#F1F1F1" height="46.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="133.8027" x="7" y="252.9769"/><rect fill="#F1F1F1" height="10" style="stroke:#181818;stroke-width:0.5;" width="15" x="120.8027" y="257.9769"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="118.8027" y="259.9769"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="118.8027" y="263.9769"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="93.8027" x="22" y="285.972">SMART Client</text></g><g class="entity" data-entity="GMN28" data-source-line="41" data-uid="ent0029" id="entity_GMN28"><path d="M884.91,341.2969 L884.91,426.9609 L1060.3866,426.9609 L1060.3866,351.2969 L1050.3866,341.2969 L884.91,341.2969" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1050.3866,341.2969 L1050.3866,351.2969 L1060.3866,351.2969 L1050.3866,341.2969" fill="#FEFFDD" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="123.7222" x="890.91" y="358.3638">Token Validation</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="154.4766" x="890.91" y="373.4966">• Verify signature (JWT)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="121.6909" x="890.91" y="388.6294">• Check expiration</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="128.7813" x="890.91" y="403.7622">• Validate audience</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="145.5898" x="890.91" y="418.895">• Confirm not revoked</text></g><g class="entity" data-entity="GMN31" data-source-line="49" data-uid="ent0032" id="entity_GMN31"><path d="M1270.39,341.2969 L1270.39,426.9609 L1510.9872,426.9609 L1510.9872,351.2969 L1500.9872,341.2969 L1270.39,341.2969" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1500.9872,341.2969 L1500.9872,351.2969 L1510.9872,351.2969 L1500.9872,341.2969" fill="#FEFFDD" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="142.1367" x="1276.39" y="358.3638">Scope Enforcement</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="219.5972" x="1276.39" y="373.4966">• patient/*.read → current patient</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="199.7544" x="1276.39" y="388.6294">• user/*.read → user's patients</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="162.3667" x="1276.39" y="403.7622">• Resource-level filtering</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="144.0981" x="1276.39" y="418.895">• Field-level redaction</text></g><g class="entity" data-entity="GMN34" data-source-line="57" data-uid="ent0035" id="entity_GMN34"><path d="M1696.99,43.2969 L1696.99,128.9609 A0,0 0 0 0 1696.99,128.9609 L1706.93,128.9609 L1460.98,243.4969 L1714.93,128.9609 L1916.386,128.9609 A0,0 0 0 0 1916.386,128.9609 L1916.386,53.2969 L1906.386,43.2969 L1696.99,43.2969 A0,0 0 0 0 1696.99,43.2969" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1906.386,43.2969 L1906.386,53.2969 L1916.386,53.2969 L1906.386,43.2969" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="108.0308" x="1702.99" y="60.3638">Access Control</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="198.396" x="1702.99" y="75.4966">• Patient context enforcement</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="138.6074" x="1702.99" y="90.6294">• User role validation</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="194.0225" x="1702.99" y="105.7622">• Compartment-based access</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="98.1982" x="1702.99" y="120.895">• Audit logging</text></g><g class="link" data-entity-1="REST" data-entity-2="Validator" data-source-line="31" data-uid="lnk20" id="link_REST_Validator"><path d="M427.04,275.1269 C484.84,275.1269 568.38,275.1269 624.33,275.1269" fill="none" id="REST-to-Validator-1" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="630.33,275.1269,621.33,271.1269,625.33,275.1269,621.33,279.1269,630.33,275.1269" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="142.0479" x="457.7" y="271.1938">Validate Bearer token</text></g><g class="link" data-entity-1="Validator" data-entity-2="Scopes" data-source-line="32" data-uid="lnk21" id="link_Validator_Scopes"><path d="M734.19,275.1269 C787.38,275.1269 864.26,275.1269 916.72,275.1269" fill="none" id="Validator-to-Scopes-1" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="922.72,275.1269,913.72,271.1269,917.72,275.1269,913.72,279.1269,922.72,275.1269" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="89.0195" x="764.91" y="271.1938">Check scopes</text></g><g class="link" data-entity-1="Scopes" data-entity-2="RAC" data-source-line="33" data-uid="lnk22" id="link_Scopes_RAC"><path d="M1022.6,275.1269 C1093.8,275.1269 1220.69,275.1269 1305.54,275.1269" fill="none" id="Scopes-to-RAC-1" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="1311.54,275.1269,1302.54,271.1269,1306.54,275.1269,1302.54,279.1269,1311.54,275.1269" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="148.8589" x="1091.39" y="271.1938">Check resource access</text></g><g class="link" data-entity-1="SMART Client" data-entity-2="REST" data-source-line="30" data-uid="lnk19" id="link_SMART Client_REST"><path d="M140.96,275.9069 C192.83,275.7269 258.24,275.5077 307.31,275.3377" fill="none" id="SMART Client-to-REST" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="313.31,275.3169,304.2962,271.3481,308.31,275.3342,304.3239,279.348,313.31,275.3169" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="109.7827" x="171.8" y="271.5138">GET /Patient/123</text></g><g class="link" data-entity-1="REST" data-entity-2="SMART Client" data-source-line="38" data-uid="lnk27" id="link_REST_SMART Client"><path d="M313.34,294.3469 C302.97,297.1669 292.15,299.6169 281.8,301.1269 C232.98,308.2269 219.74,307.3969 170.8,301.1269 C161.16,299.8869 156.951,299.3156 147.131,297.0856" fill="none" id="REST-to-SMART Client" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="141.28,295.7569,149.1707,301.6506,146.1559,296.8641,150.9423,293.8492,141.28,295.7569" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="91.0508" x="180.8" y="297.1938">FHIR resource</text></g><g class="link" data-entity-1="RAC" data-entity-2="Query" data-source-line="34" data-uid="lnk23" id="link_RAC_Query"><path d="M1470.04,285.1569 C1556.66,296.2469 1687.1186,312.9451 1756.3386,321.8051" fill="none" id="RAC-to-Query" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="1762.29,322.5669,1753.8707,317.4566,1757.3305,321.9321,1752.855,325.3918,1762.29,322.5669" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="124.9155" x="1541.99" y="291.3838">Build filtered query</text></g><g class="link" data-entity-1="Query" data-entity-2="DB" data-source-line="35" data-uid="lnk24" id="link_Query_DB"><path d="M1850.74,341.8269 C1898.99,356.8469 1979.72,380.9369 2050.38,397.1269 C2053.47,397.8344 2056.612,398.5305 2059.7879,399.214 C2061.3758,399.5557 2062.9722,399.8943 2064.5749,400.2296 C2064.9755,400.3134 2059.502,399.1765 2059.9034,399.2599" fill="none" id="Query-to-DB" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="2065.778,400.4804,2057.7799,394.7332,2060.8825,399.4633,2056.1525,402.566,2065.778,400.4804" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="94.0469" x="1947.38" y="367.2438">Execute query</text></g><g class="link" data-entity-1="DB" data-entity-2="Serializer" data-source-line="36" data-uid="lnk25" id="link_DB_Serializer"><path d="M2260.2319,425.1281 C2260.9594,425.2919 2261.6873,425.4574 2262.4156,425.6243 C2263.8723,425.9583 2265.3305,426.2986 2266.7896,426.6447 C2269.7079,427.337 2272.6302,428.0529 2275.5519,428.7897 C2287.2388,431.7369 2298.9175,435.0181 2310.305,438.4569 C2333.08,445.3344 2349.0627,450.7603 2367.2427,457.4853" fill="none" id="DB-to-Serializer" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="2372.87,459.5669,2365.8167,452.6929,2368.1806,457.8322,2363.0413,460.196,2372.87,459.5669" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="61.0454" x="2271.75" y="423.8738">Raw data</text></g><g class="link" data-entity-1="Serializer" data-entity-2="REST" data-source-line="37" data-uid="lnk26" id="link_Serializer_REST"><path d="M2372.77,480.1269 C2320.65,480.1269 2238.04,480.1269 2166.57,480.1269 C2551.61,535.1269 2551.61,535.1269 681.31,480.1269 C557.09,480.1269 448.2278,368.8122 399.9478,311.3022" fill="none" id="Serializer-to-REST" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="396.09,306.7069,398.8132,316.1718,399.3049,310.5363,404.9403,311.028,396.09,306.7069" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="98.0396" x="1341.69" y="476.1938">FHIR JSON/XML</text></g><g class="link" data-entity-1="Validator" data-entity-2="GMN28" data-source-line="41" data-uid="lnk30" id="link_Validator_GMN28"><path d="M734.26,297.8669 C744.05,302.0669 754.26,306.3169 763.91,310.1269 C803.18,325.6269 847.15,341.4969 884.49,354.5469" fill="none" id="Validator-GMN28" style="stroke:#181818;stroke-width:1;stroke-dasharray:7,7;"/></g><g class="link" data-entity-1="Scopes" data-entity-2="GMN31" data-source-line="49" data-uid="lnk33" id="link_Scopes_GMN31"><path d="M1022.55,291.4769 C1043.36,298.2069 1067.96,305.8869 1090.39,312.1269 C1149.21,328.5069 1215.14,344.5969 1270.12,357.4069" fill="none" id="Scopes-GMN31" style="stroke:#181818;stroke-width:1;stroke-dasharray:7,7;"/></g></g></svg></div><div class="puml dark" style=""><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="DESCRIPTION" height="542px" preserveAspectRatio="xMidYMid meet" style="width:2558px;height:542px;background:#1B1B1B;" version="1.1" viewBox="0 0 2558 542" width="2558px" zoomAndPan="magnify" class="diagram"><title>FHIR API Server - Internal Components</title><defs/><g><rect fill="#1B1B1B" height="542" style="stroke:none;stroke-width:1;" width="2558" x="0" y="0"/><g class="title" data-source-line="3"><text fill="#FFFFFF" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="306.8174" x="1118.8963" y="22.9951">FHIR API Server - Internal Components</text></g><g class="cluster" data-entity="FHIR API Server" data-source-line="7" data-uid="ent0002" id="cluster_FHIR API Server"><path d="M300.3,209.1269 L426.6301,209.1269 A3.75,3.75 0 0 1 429.1301,211.6269 L436.1301,231.4237 L1483.07,231.4237 A2.5,2.5 0 0 1 1485.57,233.9237 L1485.57,319.6269 A2.5,2.5 0 0 1 1483.07,322.1269 L300.3,322.1269 A2.5,2.5 0 0 1 297.8,319.6269 L297.8,211.6269 A2.5,2.5 0 0 1 300.3,209.1269" fill="none" style="stroke:#FFFFFF;stroke-width:1.5;"/><line style="stroke:#FFFFFF;stroke-width:1.5;" x1="297.8" x2="436.1301" y1="231.4237" y2="231.4237"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="125.3301" x="301.8" y="224.122">FHIR API Server</text></g><g class="cluster" data-entity="Data Layer" data-source-line="18" data-uid="ent0010" id="cluster_Data Layer"><path d="M1749.19,145.1269 L1836.1656,145.1269 A3.75,3.75 0 0 1 1838.6656,147.6269 L1845.6656,167.4237 L2541.11,167.4237 A2.5,2.5 0 0 1 2543.61,169.9237 L2543.61,524.6269 A2.5,2.5 0 0 1 2541.11,527.1269 L1749.19,527.1269 A2.5,2.5 0 0 1 1746.69,524.6269 L1746.69,147.6269 A2.5,2.5 0 0 1 1749.19,145.1269" fill="none" style="stroke:#FFFFFF;stroke-width:1.5;"/><line style="stroke:#FFFFFF;stroke-width:1.5;" x1="1746.69" x2="1845.6656" y1="167.4237" y2="167.4237"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="85.9756" x="1750.69" y="160.122">Data Layer</text></g><g class="cluster" data-entity="DB" data-source-line="19" data-uid="ent0011" id="cluster_DB"><path d="M2066.38,206.1269 C2066.38,196.1269 2288.995,196.1269 2288.995,196.1269 C2288.995,196.1269 2511.61,196.1269 2511.61,206.1269 L2511.61,415.1269 C2511.61,425.1269 2288.995,425.1269 2288.995,425.1269 C2288.995,425.1269 2066.38,425.1269 2066.38,415.1269 L2066.38,206.1269" fill="none" style="stroke:#E7E7E7;stroke-width:1;"/><path d="M2066.38,206.1269 C2066.38,216.1269 2288.995,216.1269 2288.995,216.1269 C2288.995,216.1269 2511.61,216.1269 2511.61,206.1269" fill="none" style="stroke:#E7E7E7;stroke-width:1;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="136.5615" x="2220.7142" y="231.122">Clinical Database</text></g><g class="entity" data-entity="REST" data-source-line="8" data-uid="ent0003" id="entity_REST"><rect fill="#313139" height="62.5938" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="112.8984" x="313.8" y="243.8269"/><rect fill="#313139" height="10" style="stroke:#E7E7E7;stroke-width:0.5;" width="15" x="406.6984" y="248.8269"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="404.6984" y="250.8269"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="404.6984" y="254.8269"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="72.8984" x="328.8" y="276.822">FHIR REST</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="22.1484" x="328.8" y="293.1189">API</text></g><g class="entity" data-entity="Validator" data-source-line="9" data-uid="ent0004" id="entity_Validator"><rect fill="#313139" height="62.5938" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="103.2119" x="630.7" y="243.8269"/><rect fill="#313139" height="10" style="stroke:#E7E7E7;stroke-width:0.5;" width="15" x="713.9119" y="248.8269"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="711.9119" y="250.8269"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="711.9119" y="254.8269"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="42.7109" x="645.7" y="276.822">Token</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="63.2119" x="645.7" y="293.1189">Validator</text></g><g class="entity" data-entity="Scopes" data-source-line="10" data-uid="ent0005" id="entity_Scopes"><rect fill="#313139" height="62.5938" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="99.0352" x="923.13" y="243.8269"/><rect fill="#313139" height="10" style="stroke:#E7E7E7;stroke-width:0.5;" width="15" x="1002.1652" y="248.8269"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="1000.1652" y="250.8269"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="1000.1652" y="254.8269"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="42.6494" x="938.13" y="276.822">Scope</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="59.0352" x="938.13" y="293.1189">Enforcer</text></g><g class="entity" data-entity="RAC" data-source-line="11" data-uid="ent0006" id="entity_RAC"><rect fill="#313139" height="62.5938" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="157.7627" x="1311.81" y="243.8269"/><rect fill="#313139" height="10" style="stroke:#E7E7E7;stroke-width:0.5;" width="15" x="1449.5727" y="248.8269"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="1447.5727" y="250.8269"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="1447.5727" y="254.8269"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="117.7627" x="1326.81" y="276.822">Resource Access</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="50.9141" x="1326.81" y="293.1189">Control</text></g><g class="entity" data-entity="Query" data-source-line="26" data-uid="ent0016" id="entity_Query"><rect fill="#313139" height="62.5938" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="87.9814" x="1762.69" y="296.8269"/><rect fill="#313139" height="10" style="stroke:#E7E7E7;stroke-width:0.5;" width="15" x="1830.6714" y="301.8269"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="1828.6714" y="303.8269"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="1828.6714" y="307.8269"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="42.5469" x="1777.69" y="329.822">Query</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="47.9814" x="1777.69" y="346.1189">Engine</text></g><g class="entity" data-entity="Serializer" data-source-line="27" data-uid="ent0017" id="entity_Serializer"><rect fill="#313139" height="62.5938" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="105.2217" x="2373.07" y="448.8269"/><rect fill="#313139" height="10" style="stroke:#E7E7E7;stroke-width:0.5;" width="15" x="2458.2917" y="453.8269"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="2456.2917" y="455.8269"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="2456.2917" y="459.8269"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="32.4365" x="2388.07" y="481.822">FHIR</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="65.2217" x="2388.07" y="498.1189">Serializer</text></g><g class="entity" data-entity="Patient Records" data-source-line="20" data-uid="ent0012" id="entity_Patient Records"><rect fill="#313139" height="46.2969" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="150.3662" x="2090.38" y="334.9769"/><rect fill="#313139" height="10" style="stroke:#E7E7E7;stroke-width:0.5;" width="15" x="2220.7462" y="339.9769"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="2218.7462" y="341.9769"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="2218.7462" y="345.9769"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="110.3662" x="2105.38" y="367.972">Patient Records</text></g><g class="entity" data-entity="Observations" data-source-line="21" data-uid="ent0013" id="entity_Observations"><rect fill="#313139" height="46.2969" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="132.5449" x="2099.29" y="253.9769"/><rect fill="#313139" height="10" style="stroke:#E7E7E7;stroke-width:0.5;" width="15" x="2211.8349" y="258.9769"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="2209.8349" y="260.9769"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="2209.8349" y="264.9769"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="92.5449" x="2114.29" y="286.972">Observations</text></g><g class="entity" data-entity="Medications" data-source-line="22" data-uid="ent0014" id="entity_Medications"><rect fill="#313139" height="46.2969" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="123.8564" x="2363.75" y="334.9769"/><rect fill="#313139" height="10" style="stroke:#E7E7E7;stroke-width:0.5;" width="15" x="2467.6064" y="339.9769"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="2465.6064" y="341.9769"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="2465.6064" y="345.9769"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="83.8564" x="2378.75" y="367.972">Medications</text></g><g class="entity" data-entity="Encounters" data-source-line="23" data-uid="ent0015" id="entity_Encounters"><rect fill="#313139" height="46.2969" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="118.8799" x="2366.24" y="253.9769"/><rect fill="#313139" height="10" style="stroke:#E7E7E7;stroke-width:0.5;" width="15" x="2465.1199" y="258.9769"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="2463.1199" y="260.9769"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="2463.1199" y="264.9769"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="78.8799" x="2381.24" y="286.972">Encounters</text></g><g class="entity" data-entity="SMART Client" data-source-line="30" data-uid="ent0018" id="entity_SMART Client"><rect fill="#313139" height="46.2969" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="133.8027" x="7" y="252.9769"/><rect fill="#313139" height="10" style="stroke:#E7E7E7;stroke-width:0.5;" width="15" x="120.8027" y="257.9769"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="118.8027" y="259.9769"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="118.8027" y="263.9769"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="93.8027" x="22" y="285.972">SMART Client</text></g><g class="entity" data-entity="GMN28" data-source-line="41" data-uid="ent0029" id="entity_GMN28"><path d="M884.91,341.2969 L884.91,426.9609 L1060.3866,426.9609 L1060.3866,351.2969 L1050.3866,341.2969 L884.91,341.2969" fill="#714137" style="stroke:#E7E7E7;stroke-width:0.5;"/><path d="M1050.3866,341.2969 L1050.3866,351.2969 L1060.3866,351.2969 L1050.3866,341.2969" fill="#714137" style="stroke:#E7E7E7;stroke-width:1;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="123.7222" x="890.91" y="358.3638">Token Validation</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="154.4766" x="890.91" y="373.4966">• Verify signature (JWT)</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="121.6909" x="890.91" y="388.6294">• Check expiration</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="128.7813" x="890.91" y="403.7622">• Validate audience</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="145.5898" x="890.91" y="418.895">• Confirm not revoked</text></g><g class="entity" data-entity="GMN31" data-source-line="49" data-uid="ent0032" id="entity_GMN31"><path d="M1270.39,341.2969 L1270.39,426.9609 L1510.9872,426.9609 L1510.9872,351.2969 L1500.9872,341.2969 L1270.39,341.2969" fill="#714137" style="stroke:#E7E7E7;stroke-width:0.5;"/><path d="M1500.9872,341.2969 L1500.9872,351.2969 L1510.9872,351.2969 L1500.9872,341.2969" fill="#714137" style="stroke:#E7E7E7;stroke-width:1;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="142.1367" x="1276.39" y="358.3638">Scope Enforcement</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="219.5972" x="1276.39" y="373.4966">• patient/*.read → current patient</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="199.7544" x="1276.39" y="388.6294">• user/*.read → user's patients</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="162.3667" x="1276.39" y="403.7622">• Resource-level filtering</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="144.0981" x="1276.39" y="418.895">• Field-level redaction</text></g><g class="entity" data-entity="GMN34" data-source-line="57" data-uid="ent0035" id="entity_GMN34"><path d="M1696.99,43.2969 L1696.99,128.9609 A0,0 0 0 0 1696.99,128.9609 L1706.93,128.9609 L1460.98,243.4969 L1714.93,128.9609 L1916.386,128.9609 A0,0 0 0 0 1916.386,128.9609 L1916.386,53.2969 L1906.386,43.2969 L1696.99,43.2969 A0,0 0 0 0 1696.99,43.2969" fill="#714137" style="stroke:#E7E7E7;stroke-width:0.5;"/><path d="M1906.386,43.2969 L1906.386,53.2969 L1916.386,53.2969 L1906.386,43.2969" fill="#714137" style="stroke:#E7E7E7;stroke-width:0.5;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="108.0308" x="1702.99" y="60.3638">Access Control</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="198.396" x="1702.99" y="75.4966">• Patient context enforcement</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="138.6074" x="1702.99" y="90.6294">• User role validation</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="194.0225" x="1702.99" y="105.7622">• Compartment-based access</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="98.1982" x="1702.99" y="120.895">• Audit logging</text></g><g class="link" data-entity-1="REST" data-entity-2="Validator" data-source-line="31" data-uid="lnk20" id="link_REST_Validator"><path d="M427.04,275.1269 C484.84,275.1269 568.38,275.1269 624.33,275.1269" fill="none" id="REST-to-Validator-1" style="stroke:#E7E7E7;stroke-width:1;"/><polygon fill="#E7E7E7" points="630.33,275.1269,621.33,271.1269,625.33,275.1269,621.33,279.1269,630.33,275.1269" style="stroke:#E7E7E7;stroke-width:1;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="142.0479" x="457.7" y="271.1938">Validate Bearer token</text></g><g class="link" data-entity-1="Validator" data-entity-2="Scopes" data-source-line="32" data-uid="lnk21" id="link_Validator_Scopes"><path d="M734.19,275.1269 C787.38,275.1269 864.26,275.1269 916.72,275.1269" fill="none" id="Validator-to-Scopes-1" style="stroke:#E7E7E7;stroke-width:1;"/><polygon fill="#E7E7E7" points="922.72,275.1269,913.72,271.1269,917.72,275.1269,913.72,279.1269,922.72,275.1269" style="stroke:#E7E7E7;stroke-width:1;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="89.0195" x="764.91" y="271.1938">Check scopes</text></g><g class="link" data-entity-1="Scopes" data-entity-2="RAC" data-source-line="33" data-uid="lnk22" id="link_Scopes_RAC"><path d="M1022.6,275.1269 C1093.8,275.1269 1220.69,275.1269 1305.54,275.1269" fill="none" id="Scopes-to-RAC-1" style="stroke:#E7E7E7;stroke-width:1;"/><polygon fill="#E7E7E7" points="1311.54,275.1269,1302.54,271.1269,1306.54,275.1269,1302.54,279.1269,1311.54,275.1269" style="stroke:#E7E7E7;stroke-width:1;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="148.8589" x="1091.39" y="271.1938">Check resource access</text></g><g class="link" data-entity-1="SMART Client" data-entity-2="REST" data-source-line="30" data-uid="lnk19" id="link_SMART Client_REST"><path d="M140.96,275.9069 C192.83,275.7269 258.24,275.5077 307.31,275.3377" fill="none" id="SMART Client-to-REST" style="stroke:#E7E7E7;stroke-width:1;"/><polygon fill="#E7E7E7" points="313.31,275.3169,304.2962,271.3481,308.31,275.3342,304.3239,279.348,313.31,275.3169" style="stroke:#E7E7E7;stroke-width:1;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="109.7827" x="171.8" y="271.5138">GET /Patient/123</text></g><g class="link" data-entity-1="REST" data-entity-2="SMART Client" data-source-line="38" data-uid="lnk27" id="link_REST_SMART Client"><path d="M313.34,294.3469 C302.97,297.1669 292.15,299.6169 281.8,301.1269 C232.98,308.2269 219.74,307.3969 170.8,301.1269 C161.16,299.8869 156.951,299.3156 147.131,297.0856" fill="none" id="REST-to-SMART Client" style="stroke:#E7E7E7;stroke-width:1;"/><polygon fill="#E7E7E7" points="141.28,295.7569,149.1707,301.6506,146.1559,296.8641,150.9423,293.8492,141.28,295.7569" style="stroke:#E7E7E7;stroke-width:1;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="91.0508" x="180.8" y="297.1938">FHIR resource</text></g><g class="link" data-entity-1="RAC" data-entity-2="Query" data-source-line="34" data-uid="lnk23" id="link_RAC_Query"><path d="M1470.04,285.1569 C1556.66,296.2469 1687.1186,312.9451 1756.3386,321.8051" fill="none" id="RAC-to-Query" style="stroke:#E7E7E7;stroke-width:1;"/><polygon fill="#E7E7E7" points="1762.29,322.5669,1753.8707,317.4566,1757.3305,321.9321,1752.855,325.3918,1762.29,322.5669" style="stroke:#E7E7E7;stroke-width:1;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="124.9155" x="1541.99" y="291.3838">Build filtered query</text></g><g class="link" data-entity-1="Query" data-entity-2="DB" data-source-line="35" data-uid="lnk24" id="link_Query_DB"><path d="M1850.74,341.8269 C1898.99,356.8469 1979.72,380.9369 2050.38,397.1269 C2053.47,397.8344 2056.612,398.5305 2059.7879,399.214 C2061.3758,399.5557 2062.9722,399.8943 2064.5749,400.2296 C2064.9755,400.3134 2059.502,399.1765 2059.9034,399.2599" fill="none" id="Query-to-DB" style="stroke:#E7E7E7;stroke-width:1;"/><polygon fill="#E7E7E7" points="2065.778,400.4804,2057.7799,394.7332,2060.8825,399.4633,2056.1525,402.566,2065.778,400.4804" style="stroke:#E7E7E7;stroke-width:1;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="94.0469" x="1947.38" y="367.2438">Execute query</text></g><g class="link" data-entity-1="DB" data-entity-2="Serializer" data-source-line="36" data-uid="lnk25" id="link_DB_Serializer"><path d="M2260.2319,425.1281 C2260.9594,425.2919 2261.6873,425.4574 2262.4156,425.6243 C2263.8723,425.9583 2265.3305,426.2986 2266.7896,426.6447 C2269.7079,427.337 2272.6302,428.0529 2275.5519,428.7897 C2287.2388,431.7369 2298.9175,435.0181 2310.305,438.4569 C2333.08,445.3344 2349.0627,450.7603 2367.2427,457.4853" fill="none" id="DB-to-Serializer" style="stroke:#E7E7E7;stroke-width:1;"/><polygon fill="#E7E7E7" points="2372.87,459.5669,2365.8167,452.6929,2368.1806,457.8322,2363.0413,460.196,2372.87,459.5669" style="stroke:#E7E7E7;stroke-width:1;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="61.0454" x="2271.75" y="423.8738">Raw data</text></g><g class="link" data-entity-1="Serializer" data-entity-2="REST" data-source-line="37" data-uid="lnk26" id="link_Serializer_REST"><path d="M2372.77,480.1269 C2320.65,480.1269 2238.04,480.1269 2166.57,480.1269 C2551.61,535.1269 2551.61,535.1269 681.31,480.1269 C557.09,480.1269 448.2278,368.8122 399.9478,311.3022" fill="none" id="Serializer-to-REST" style="stroke:#E7E7E7;stroke-width:1;"/><polygon fill="#E7E7E7" points="396.09,306.7069,398.8132,316.1718,399.3049,310.5363,404.9403,311.028,396.09,306.7069" style="stroke:#E7E7E7;stroke-width:1;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="98.0396" x="1341.69" y="476.1938">FHIR JSON/XML</text></g><g class="link" data-entity-1="Validator" data-entity-2="GMN28" data-source-line="41" data-uid="lnk30" id="link_Validator_GMN28"><path d="M734.26,297.8669 C744.05,302.0669 754.26,306.3169 763.91,310.1269 C803.18,325.6269 847.15,341.4969 884.49,354.5469" fill="none" id="Validator-GMN28" style="stroke:#E7E7E7;stroke-width:1;stroke-dasharray:7,7;"/></g><g class="link" data-entity-1="Scopes" data-entity-2="GMN31" data-source-line="49" data-uid="lnk33" id="link_Scopes_GMN31"><path d="M1022.55,291.4769 C1043.36,298.2069 1067.96,305.8869 1090.39,312.1269 C1149.21,328.5069 1215.14,344.5969 1270.12,357.4069" fill="none" id="Scopes-GMN31" style="stroke:#E7E7E7;stroke-width:1;stroke-dasharray:7,7;"/></g></g></svg></div></div>
<h3 id="4-smart-on-fhir-architecture-smart-api-request-flow">4. SMART-on-FHIR Architecture, Smart API Request Flow</h3>
<div class="puml-container"><div class="puml light" style=""><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="SEQUENCE" height="855px" preserveAspectRatio="xMidYMid meet" style="width:1122px;height:855px;background:#FFFFFF;" version="1.1" viewBox="0 0 1122 855" width="1122px" zoomAndPan="magnify" class="diagram"><title>SMART API Request Flow</title><defs/><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="197.8047" x="461.2664" y="27.9951">SMART API Request Flow</text><g><title>FHIR REST API</title><rect fill="#F1F1F1" height="506.3906" style="stroke:#181818;stroke-width:1;" width="10" x="280.6709" y="119.8594"/></g><g><title>Token Validator</title><rect fill="#F1F1F1" height="101.5313" style="stroke:#181818;stroke-width:1;" width="10" x="470.7153" y="148.9922"/></g><g><title>Scope Enforcer</title><rect fill="#F1F1F1" height="86.3984" style="stroke:#181818;stroke-width:1;" width="10" x="639.1206" y="279.6563"/></g><g><title>Access Control</title><rect fill="#F1F1F1" height="86.3984" style="stroke:#181818;stroke-width:1;" width="10" x="844.3296" y="395.1875"/></g><g><title>Clinical Database</title><rect fill="#F1F1F1" height="29.1328" style="stroke:#181818;stroke-width:1;" width="10" x="1043.4702" y="525.8516"/></g><g><title>SMART Client</title><rect fill="#000000" fill-opacity="0.00000" height="746.8516" width="8" x="54.9014" y="73.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="58" x2="58" y1="73.5938" y2="820.4453"/></g><g><title>FHIR REST API</title><rect fill="#000000" fill-opacity="0.00000" height="746.8516" width="8" x="281.6709" y="73.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="284.9224" x2="284.9224" y1="73.5938" y2="820.4453"/></g><g><title>Token Validator</title><rect fill="#000000" fill-opacity="0.00000" height="746.8516" width="8" x="471.7153" y="73.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="475.5288" x2="475.5288" y1="73.5938" y2="820.4453"/></g><g><title>Scope Enforcer</title><rect fill="#000000" fill-opacity="0.00000" height="746.8516" width="8" x="640.1206" y="73.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="644.0532" x2="644.0532" y1="73.5938" y2="820.4453"/></g><g><title>Access Control</title><rect fill="#000000" fill-opacity="0.00000" height="746.8516" width="8" x="845.3296" y="73.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="848.561" x2="848.561" y1="73.5938" y2="820.4453"/></g><g><title>Clinical Database</title><rect fill="#000000" fill-opacity="0.00000" height="746.8516" width="8" x="1044.4702" y="73.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="1047.603" x2="1047.603" y1="73.5938" y2="820.4453"/></g><g class="participant participant-head" data-participant="Client"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="107.8027" x="5" y="42.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="93.8027" x="12" y="62.292">SMART Client</text></g><g class="participant participant-tail" data-participant="Client"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="107.8027" x="5" y="819.4453"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="93.8027" x="12" y="839.4404">SMART Client</text></g><g class="participant participant-head" data-participant="API"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="113.4971" x="228.9224" y="42.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="99.4971" x="235.9224" y="62.292">FHIR REST API</text></g><g class="participant participant-tail" data-participant="API"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="113.4971" x="228.9224" y="819.4453"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="99.4971" x="235.9224" y="839.4404">FHIR REST API</text></g><g class="participant participant-head" data-participant="Validator"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="124.373" x="413.5288" y="42.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="110.373" x="420.5288" y="62.292">Token Validator</text></g><g class="participant participant-tail" data-participant="Validator"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="124.373" x="413.5288" y="819.4453"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="110.373" x="420.5288" y="839.4404">Token Validator</text></g><g class="participant participant-head" data-participant="Scopes"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="120.1348" x="584.0532" y="42.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="106.1348" x="591.0532" y="62.292">Scope Enforcer</text></g><g class="participant participant-tail" data-participant="Scopes"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="120.1348" x="584.0532" y="819.4453"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="106.1348" x="591.0532" y="839.4404">Scope Enforcer</text></g><g class="participant participant-head" data-participant="AC"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="117.5371" x="790.561" y="42.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="103.5371" x="797.561" y="62.292">Access Control</text></g><g class="participant participant-tail" data-participant="AC"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="117.5371" x="790.561" y="819.4453"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="103.5371" x="797.561" y="839.4404">Access Control</text></g><g class="participant participant-head" data-participant="DB"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="135.7344" x="980.603" y="42.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="121.7344" x="987.603" y="62.292">Clinical Database</text></g><g class="participant participant-tail" data-participant="DB"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="135.7344" x="980.603" y="819.4453"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="121.7344" x="987.603" y="839.4404">Clinical Database</text></g><g><title>FHIR REST API</title><rect fill="#F1F1F1" height="506.3906" style="stroke:#181818;stroke-width:1;" width="10" x="280.6709" y="119.8594"/></g><g><title>Token Validator</title><rect fill="#F1F1F1" height="101.5313" style="stroke:#181818;stroke-width:1;" width="10" x="470.7153" y="148.9922"/></g><g><title>Scope Enforcer</title><rect fill="#F1F1F1" height="86.3984" style="stroke:#181818;stroke-width:1;" width="10" x="639.1206" y="279.6563"/></g><g><title>Access Control</title><rect fill="#F1F1F1" height="86.3984" style="stroke:#181818;stroke-width:1;" width="10" x="844.3296" y="395.1875"/></g><g><title>Clinical Database</title><rect fill="#F1F1F1" height="29.1328" style="stroke:#181818;stroke-width:1;" width="10" x="1043.4702" y="525.8516"/></g><g class="message" data-participant-1="Client" data-participant-2="API"><polygon fill="#181818" points="268.6709,115.8594,278.6709,119.8594,268.6709,123.8594,272.6709,119.8594" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="58.9014" x2="274.6709" y1="119.8594" y2="119.8594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="202.7695" x="65.9014" y="99.6606">GET /Observation?patient=123</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="196.644" x="65.9014" y="114.7935">Authorization: Bearer {token}</text></g><g class="message" data-participant-1="API" data-participant-2="Validator"><polygon fill="#181818" points="458.7153,144.9922,468.7153,148.9922,458.7153,152.9922,462.7153,148.9922" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="290.6709" x2="464.7153" y1="148.9922" y2="148.9922"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="94.3452" x="297.6709" y="143.9263">Validate token</text></g><g class="message" data-participant-1="Validator" data-participant-2="Validator"><line style="stroke:#181818;stroke-width:1;" x1="480.7153" x2="522.7153" y1="208.3906" y2="208.3906"/><line style="stroke:#181818;stroke-width:1;" x1="522.7153" x2="522.7153" y1="208.3906" y2="221.3906"/><line style="stroke:#181818;stroke-width:1;" x1="481.7153" x2="522.7153" y1="221.3906" y2="221.3906"/><polygon fill="#181818" points="491.7153,217.3906,481.7153,221.3906,491.7153,225.3906,487.7153,221.3906" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="134.4053" x="487.7153" y="173.0591">Check JWT signature</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="108.0181" x="487.7153" y="188.1919">Verify expiration</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="116.981" x="487.7153" y="203.3247">Validate audience</text></g><g class="message" data-participant-1="Validator" data-participant-2="API"><polygon fill="#181818" points="301.6709,246.5234,291.6709,250.5234,301.6709,254.5234,297.6709,250.5234" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="295.6709" x2="474.7153" y1="250.5234" y2="250.5234"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="135.8589" x="307.6709" y="245.4575">Token valid + claims</text></g><g class="message" data-participant-1="API" data-participant-2="Scopes"><polygon fill="#181818" points="627.1206,275.6563,637.1206,279.6563,627.1206,283.6563,631.1206,279.6563" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="290.6709" x2="633.1206" y1="279.6563" y2="279.6563"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="89.0195" x="297.6709" y="274.5903">Check scopes</text></g><g class="message" data-participant-1="Scopes" data-participant-2="Scopes"><line style="stroke:#181818;stroke-width:1;" x1="649.1206" x2="691.1206" y1="323.9219" y2="323.9219"/><line style="stroke:#181818;stroke-width:1;" x1="691.1206" x2="691.1206" y1="323.9219" y2="336.9219"/><line style="stroke:#181818;stroke-width:1;" x1="650.1206" x2="691.1206" y1="336.9219" y2="336.9219"/><polygon fill="#181818" points="660.1206,332.9219,650.1206,336.9219,660.1206,340.9219,656.1206,336.9219" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="171.209" x="656.1206" y="303.7231">Extract scopes from token</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="163.4966" x="656.1206" y="318.856">patient/Observation.read</text></g><g class="message" data-participant-1="Scopes" data-participant-2="API"><polygon fill="#181818" points="301.6709,362.0547,291.6709,366.0547,301.6709,370.0547,297.6709,366.0547" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="295.6709" x2="643.1206" y1="366.0547" y2="366.0547"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="132.2217" x="307.6709" y="360.9888">Scope allows access</text></g><g class="message" data-participant-1="API" data-participant-2="AC"><polygon fill="#181818" points="832.3296,391.1875,842.3296,395.1875,832.3296,399.1875,836.3296,395.1875" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="290.6709" x2="838.3296" y1="395.1875" y2="395.1875"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="148.8589" x="297.6709" y="390.1216">Check resource access</text></g><g class="message" data-participant-1="AC" data-participant-2="AC"><line style="stroke:#181818;stroke-width:1;" x1="854.3296" x2="896.3296" y1="439.4531" y2="439.4531"/><line style="stroke:#181818;stroke-width:1;" x1="896.3296" x2="896.3296" y1="439.4531" y2="452.4531"/><line style="stroke:#181818;stroke-width:1;" x1="855.3296" x2="896.3296" y1="452.4531" y2="452.4531"/><polygon fill="#181818" points="865.3296,448.4531,855.3296,452.4531,865.3296,456.4531,861.3296,452.4531" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="141.8701" x="861.3296" y="419.2544">Verify patient context</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="165.1406" x="861.3296" y="434.3872">patient ID in token = 123</text></g><g class="message" data-participant-1="AC" data-participant-2="API"><polygon fill="#181818" points="301.6709,477.5859,291.6709,481.5859,301.6709,485.5859,297.6709,481.5859" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="295.6709" x2="848.3296" y1="481.5859" y2="481.5859"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="113.1787" x="307.6709" y="476.52">Access permitted</text></g><g class="message" data-participant-1="API" data-participant-2="DB"><polygon fill="#181818" points="1031.4702,521.8516,1041.4702,525.8516,1031.4702,529.8516,1035.4702,525.8516" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="290.6709" x2="1037.4702" y1="525.8516" y2="525.8516"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="136.7285" x="297.6709" y="505.6528">SELECT observations</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="160.8179" x="297.6709" y="520.7856">WHERE patient_id = 123</text></g><g class="message" data-participant-1="DB" data-participant-2="API"><polygon fill="#181818" points="301.6709,550.9844,291.6709,554.9844,301.6709,558.9844,297.6709,554.9844" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="295.6709" x2="1047.4702" y1="554.9844" y2="554.9844"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="142.0605" x="307.6709" y="549.9185">Raw observation data</text></g><g class="message" data-participant-1="API" data-participant-2="API"><line style="stroke:#181818;stroke-width:1;" x1="290.6709" x2="332.6709" y1="584.1172" y2="584.1172"/><line style="stroke:#181818;stroke-width:1;" x1="332.6709" x2="332.6709" y1="584.1172" y2="597.1172"/><line style="stroke:#181818;stroke-width:1;" x1="291.6709" x2="332.6709" y1="597.1172" y2="597.1172"/><polygon fill="#181818" points="301.6709,593.1172,291.6709,597.1172,301.6709,601.1172,297.6709,597.1172" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="156.0444" x="297.6709" y="579.0513">Serialize to FHIR Bundle</text></g><g class="message" data-participant-1="API" data-participant-2="Client"><polygon fill="#181818" points="69.9014,622.25,59.9014,626.25,69.9014,630.25,65.9014,626.25" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="63.9014" x2="284.6709" y1="626.25" y2="626.25"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="125.8296" x="75.9014" y="621.1841">FHIR Bundle (JSON)</text></g><path d="M480,639.25 L480,724.25 L621,724.25 L621,649.25 L611,639.25 L480,639.25" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M611,639.25 L611,649.25 L621,649.25 L611,639.25" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="64.3589" x="486" y="656.3169">Rejects if:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="120.6626" x="486" y="671.4497">• Invalid signature</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="102.1147" x="486" y="686.5825">• Expired token</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="118.0283" x="486" y="701.7153">• Wrong audience</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="109.2051" x="486" y="716.8481">• Revoked token</text><path d="M649,734.9141 L649,804.9141 L836,804.9141 L836,744.9141 L826,734.9141 L649,734.9141" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M826,734.9141 L826,744.9141 L836,744.9141 L826,734.9141" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="51.1431" x="655" y="751.981">Checks:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="166.6196" x="655" y="767.1138">• Required scope present</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="159.6182" x="655" y="782.2466">• Resource type allowed</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="157.4663" x="655" y="797.3794">• Read/write permission</text></g></svg></div><div class="puml dark" style=""><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="SEQUENCE" height="855px" preserveAspectRatio="xMidYMid meet" style="width:1122px;height:855px;background:#1B1B1B;" version="1.1" viewBox="0 0 1122 855" width="1122px" zoomAndPan="magnify" class="diagram"><title>SMART API Request Flow</title><defs/><g><rect fill="#1B1B1B" height="855" style="stroke:none;stroke-width:1;" width="1122" x="0" y="0"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="197.8047" x="461.2664" y="27.9951">SMART API Request Flow</text><g><title>FHIR REST API</title><rect fill="#313139" height="506.3906" style="stroke:#E7E7E7;stroke-width:1;" width="10" x="280.6709" y="119.8594"/></g><g><title>Token Validator</title><rect fill="#313139" height="101.5313" style="stroke:#E7E7E7;stroke-width:1;" width="10" x="470.7153" y="148.9922"/></g><g><title>Scope Enforcer</title><rect fill="#313139" height="86.3984" style="stroke:#E7E7E7;stroke-width:1;" width="10" x="639.1206" y="279.6563"/></g><g><title>Access Control</title><rect fill="#313139" height="86.3984" style="stroke:#E7E7E7;stroke-width:1;" width="10" x="844.3296" y="395.1875"/></g><g><title>Clinical Database</title><rect fill="#313139" height="29.1328" style="stroke:#E7E7E7;stroke-width:1;" width="10" x="1043.4702" y="525.8516"/></g><g><title>SMART Client</title><rect fill="#000000" fill-opacity="0.00000" height="746.8516" width="8" x="54.9014" y="73.5938"/><line style="stroke:#E7E7E7;stroke-width:0.5;stroke-dasharray:5,5;" x1="58" x2="58" y1="73.5938" y2="820.4453"/></g><g><title>FHIR REST API</title><rect fill="#000000" fill-opacity="0.00000" height="746.8516" width="8" x="281.6709" y="73.5938"/><line style="stroke:#E7E7E7;stroke-width:0.5;stroke-dasharray:5,5;" x1="284.9224" x2="284.9224" y1="73.5938" y2="820.4453"/></g><g><title>Token Validator</title><rect fill="#000000" fill-opacity="0.00000" height="746.8516" width="8" x="471.7153" y="73.5938"/><line style="stroke:#E7E7E7;stroke-width:0.5;stroke-dasharray:5,5;" x1="475.5288" x2="475.5288" y1="73.5938" y2="820.4453"/></g><g><title>Scope Enforcer</title><rect fill="#000000" fill-opacity="0.00000" height="746.8516" width="8" x="640.1206" y="73.5938"/><line style="stroke:#E7E7E7;stroke-width:0.5;stroke-dasharray:5,5;" x1="644.0532" x2="644.0532" y1="73.5938" y2="820.4453"/></g><g><title>Access Control</title><rect fill="#000000" fill-opacity="0.00000" height="746.8516" width="8" x="845.3296" y="73.5938"/><line style="stroke:#E7E7E7;stroke-width:0.5;stroke-dasharray:5,5;" x1="848.561" x2="848.561" y1="73.5938" y2="820.4453"/></g><g><title>Clinical Database</title><rect fill="#000000" fill-opacity="0.00000" height="746.8516" width="8" x="1044.4702" y="73.5938"/><line style="stroke:#E7E7E7;stroke-width:0.5;stroke-dasharray:5,5;" x1="1047.603" x2="1047.603" y1="73.5938" y2="820.4453"/></g><g class="participant participant-head" data-participant="Client"><rect fill="#222222" height="30.2969" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="107.8027" x="5" y="42.2969"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="93.8027" x="12" y="62.292">SMART Client</text></g><g class="participant participant-tail" data-participant="Client"><rect fill="#222222" height="30.2969" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="107.8027" x="5" y="819.4453"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="93.8027" x="12" y="839.4404">SMART Client</text></g><g class="participant participant-head" data-participant="API"><rect fill="#222222" height="30.2969" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="113.4971" x="228.9224" y="42.2969"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="99.4971" x="235.9224" y="62.292">FHIR REST API</text></g><g class="participant participant-tail" data-participant="API"><rect fill="#222222" height="30.2969" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="113.4971" x="228.9224" y="819.4453"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="99.4971" x="235.9224" y="839.4404">FHIR REST API</text></g><g class="participant participant-head" data-participant="Validator"><rect fill="#222222" height="30.2969" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="124.373" x="413.5288" y="42.2969"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="110.373" x="420.5288" y="62.292">Token Validator</text></g><g class="participant participant-tail" data-participant="Validator"><rect fill="#222222" height="30.2969" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="124.373" x="413.5288" y="819.4453"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="110.373" x="420.5288" y="839.4404">Token Validator</text></g><g class="participant participant-head" data-participant="Scopes"><rect fill="#222222" height="30.2969" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="120.1348" x="584.0532" y="42.2969"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="106.1348" x="591.0532" y="62.292">Scope Enforcer</text></g><g class="participant participant-tail" data-participant="Scopes"><rect fill="#222222" height="30.2969" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="120.1348" x="584.0532" y="819.4453"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="106.1348" x="591.0532" y="839.4404">Scope Enforcer</text></g><g class="participant participant-head" data-participant="AC"><rect fill="#222222" height="30.2969" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="117.5371" x="790.561" y="42.2969"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="103.5371" x="797.561" y="62.292">Access Control</text></g><g class="participant participant-tail" data-participant="AC"><rect fill="#222222" height="30.2969" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="117.5371" x="790.561" y="819.4453"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="103.5371" x="797.561" y="839.4404">Access Control</text></g><g class="participant participant-head" data-participant="DB"><rect fill="#222222" height="30.2969" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="135.7344" x="980.603" y="42.2969"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="121.7344" x="987.603" y="62.292">Clinical Database</text></g><g class="participant participant-tail" data-participant="DB"><rect fill="#222222" height="30.2969" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="135.7344" x="980.603" y="819.4453"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="121.7344" x="987.603" y="839.4404">Clinical Database</text></g><g><title>FHIR REST API</title><rect fill="#313139" height="506.3906" style="stroke:#E7E7E7;stroke-width:1;" width="10" x="280.6709" y="119.8594"/></g><g><title>Token Validator</title><rect fill="#313139" height="101.5313" style="stroke:#E7E7E7;stroke-width:1;" width="10" x="470.7153" y="148.9922"/></g><g><title>Scope Enforcer</title><rect fill="#313139" height="86.3984" style="stroke:#E7E7E7;stroke-width:1;" width="10" x="639.1206" y="279.6563"/></g><g><title>Access Control</title><rect fill="#313139" height="86.3984" style="stroke:#E7E7E7;stroke-width:1;" width="10" x="844.3296" y="395.1875"/></g><g><title>Clinical Database</title><rect fill="#313139" height="29.1328" style="stroke:#E7E7E7;stroke-width:1;" width="10" x="1043.4702" y="525.8516"/></g><g class="message" data-participant-1="Client" data-participant-2="API"><polygon fill="#E7E7E7" points="268.6709,115.8594,278.6709,119.8594,268.6709,123.8594,272.6709,119.8594" style="stroke:#E7E7E7;stroke-width:1;"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="58.9014" x2="274.6709" y1="119.8594" y2="119.8594"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="202.7695" x="65.9014" y="99.6606">GET /Observation?patient=123</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="196.644" x="65.9014" y="114.7935">Authorization: Bearer {token}</text></g><g class="message" data-participant-1="API" data-participant-2="Validator"><polygon fill="#E7E7E7" points="458.7153,144.9922,468.7153,148.9922,458.7153,152.9922,462.7153,148.9922" style="stroke:#E7E7E7;stroke-width:1;"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="290.6709" x2="464.7153" y1="148.9922" y2="148.9922"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="94.3452" x="297.6709" y="143.9263">Validate token</text></g><g class="message" data-participant-1="Validator" data-participant-2="Validator"><line style="stroke:#E7E7E7;stroke-width:1;" x1="480.7153" x2="522.7153" y1="208.3906" y2="208.3906"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="522.7153" x2="522.7153" y1="208.3906" y2="221.3906"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="481.7153" x2="522.7153" y1="221.3906" y2="221.3906"/><polygon fill="#E7E7E7" points="491.7153,217.3906,481.7153,221.3906,491.7153,225.3906,487.7153,221.3906" style="stroke:#E7E7E7;stroke-width:1;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="134.4053" x="487.7153" y="173.0591">Check JWT signature</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="108.0181" x="487.7153" y="188.1919">Verify expiration</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="116.981" x="487.7153" y="203.3247">Validate audience</text></g><g class="message" data-participant-1="Validator" data-participant-2="API"><polygon fill="#E7E7E7" points="301.6709,246.5234,291.6709,250.5234,301.6709,254.5234,297.6709,250.5234" style="stroke:#E7E7E7;stroke-width:1;"/><line style="stroke:#E7E7E7;stroke-width:1;stroke-dasharray:2,2;" x1="295.6709" x2="474.7153" y1="250.5234" y2="250.5234"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="135.8589" x="307.6709" y="245.4575">Token valid + claims</text></g><g class="message" data-participant-1="API" data-participant-2="Scopes"><polygon fill="#E7E7E7" points="627.1206,275.6563,637.1206,279.6563,627.1206,283.6563,631.1206,279.6563" style="stroke:#E7E7E7;stroke-width:1;"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="290.6709" x2="633.1206" y1="279.6563" y2="279.6563"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="89.0195" x="297.6709" y="274.5903">Check scopes</text></g><g class="message" data-participant-1="Scopes" data-participant-2="Scopes"><line style="stroke:#E7E7E7;stroke-width:1;" x1="649.1206" x2="691.1206" y1="323.9219" y2="323.9219"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="691.1206" x2="691.1206" y1="323.9219" y2="336.9219"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="650.1206" x2="691.1206" y1="336.9219" y2="336.9219"/><polygon fill="#E7E7E7" points="660.1206,332.9219,650.1206,336.9219,660.1206,340.9219,656.1206,336.9219" style="stroke:#E7E7E7;stroke-width:1;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="171.209" x="656.1206" y="303.7231">Extract scopes from token</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="163.4966" x="656.1206" y="318.856">patient/Observation.read</text></g><g class="message" data-participant-1="Scopes" data-participant-2="API"><polygon fill="#E7E7E7" points="301.6709,362.0547,291.6709,366.0547,301.6709,370.0547,297.6709,366.0547" style="stroke:#E7E7E7;stroke-width:1;"/><line style="stroke:#E7E7E7;stroke-width:1;stroke-dasharray:2,2;" x1="295.6709" x2="643.1206" y1="366.0547" y2="366.0547"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="132.2217" x="307.6709" y="360.9888">Scope allows access</text></g><g class="message" data-participant-1="API" data-participant-2="AC"><polygon fill="#E7E7E7" points="832.3296,391.1875,842.3296,395.1875,832.3296,399.1875,836.3296,395.1875" style="stroke:#E7E7E7;stroke-width:1;"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="290.6709" x2="838.3296" y1="395.1875" y2="395.1875"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="148.8589" x="297.6709" y="390.1216">Check resource access</text></g><g class="message" data-participant-1="AC" data-participant-2="AC"><line style="stroke:#E7E7E7;stroke-width:1;" x1="854.3296" x2="896.3296" y1="439.4531" y2="439.4531"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="896.3296" x2="896.3296" y1="439.4531" y2="452.4531"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="855.3296" x2="896.3296" y1="452.4531" y2="452.4531"/><polygon fill="#E7E7E7" points="865.3296,448.4531,855.3296,452.4531,865.3296,456.4531,861.3296,452.4531" style="stroke:#E7E7E7;stroke-width:1;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="141.8701" x="861.3296" y="419.2544">Verify patient context</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="165.1406" x="861.3296" y="434.3872">patient ID in token = 123</text></g><g class="message" data-participant-1="AC" data-participant-2="API"><polygon fill="#E7E7E7" points="301.6709,477.5859,291.6709,481.5859,301.6709,485.5859,297.6709,481.5859" style="stroke:#E7E7E7;stroke-width:1;"/><line style="stroke:#E7E7E7;stroke-width:1;stroke-dasharray:2,2;" x1="295.6709" x2="848.3296" y1="481.5859" y2="481.5859"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="113.1787" x="307.6709" y="476.52">Access permitted</text></g><g class="message" data-participant-1="API" data-participant-2="DB"><polygon fill="#E7E7E7" points="1031.4702,521.8516,1041.4702,525.8516,1031.4702,529.8516,1035.4702,525.8516" style="stroke:#E7E7E7;stroke-width:1;"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="290.6709" x2="1037.4702" y1="525.8516" y2="525.8516"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="136.7285" x="297.6709" y="505.6528">SELECT observations</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="160.8179" x="297.6709" y="520.7856">WHERE patient_id = 123</text></g><g class="message" data-participant-1="DB" data-participant-2="API"><polygon fill="#E7E7E7" points="301.6709,550.9844,291.6709,554.9844,301.6709,558.9844,297.6709,554.9844" style="stroke:#E7E7E7;stroke-width:1;"/><line style="stroke:#E7E7E7;stroke-width:1;stroke-dasharray:2,2;" x1="295.6709" x2="1047.4702" y1="554.9844" y2="554.9844"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="142.0605" x="307.6709" y="549.9185">Raw observation data</text></g><g class="message" data-participant-1="API" data-participant-2="API"><line style="stroke:#E7E7E7;stroke-width:1;" x1="290.6709" x2="332.6709" y1="584.1172" y2="584.1172"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="332.6709" x2="332.6709" y1="584.1172" y2="597.1172"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="291.6709" x2="332.6709" y1="597.1172" y2="597.1172"/><polygon fill="#E7E7E7" points="301.6709,593.1172,291.6709,597.1172,301.6709,601.1172,297.6709,597.1172" style="stroke:#E7E7E7;stroke-width:1;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="156.0444" x="297.6709" y="579.0513">Serialize to FHIR Bundle</text></g><g class="message" data-participant-1="API" data-participant-2="Client"><polygon fill="#E7E7E7" points="69.9014,622.25,59.9014,626.25,69.9014,630.25,65.9014,626.25" style="stroke:#E7E7E7;stroke-width:1;"/><line style="stroke:#E7E7E7;stroke-width:1;stroke-dasharray:2,2;" x1="63.9014" x2="284.6709" y1="626.25" y2="626.25"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="125.8296" x="75.9014" y="621.1841">FHIR Bundle (JSON)</text></g><path d="M480,639.25 L480,724.25 L621,724.25 L621,649.25 L611,639.25 L480,639.25" fill="#714137" style="stroke:#E7E7E7;stroke-width:0.5;"/><path d="M611,639.25 L611,649.25 L621,649.25 L611,639.25" fill="#714137" style="stroke:#E7E7E7;stroke-width:0.5;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="64.3589" x="486" y="656.3169">Rejects if:</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="120.6626" x="486" y="671.4497">• Invalid signature</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="102.1147" x="486" y="686.5825">• Expired token</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="118.0283" x="486" y="701.7153">• Wrong audience</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="109.2051" x="486" y="716.8481">• Revoked token</text><path d="M649,734.9141 L649,804.9141 L836,804.9141 L836,744.9141 L826,734.9141 L649,734.9141" fill="#714137" style="stroke:#E7E7E7;stroke-width:0.5;"/><path d="M826,734.9141 L826,744.9141 L836,744.9141 L826,734.9141" fill="#714137" style="stroke:#E7E7E7;stroke-width:0.5;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="51.1431" x="655" y="751.981">Checks:</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="166.6196" x="655" y="767.1138">• Required scope present</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="159.6182" x="655" y="782.2466">• Resource type allowed</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="157.4663" x="655" y="797.3794">• Read/write permission</text></g></svg></div></div>
<h3 id="5-smart-on-fhir-architecture-smart-discovery-process">5. SMART-on-FHIR Architecture, SMART Discovery Process</h3>
<div class="puml-container"><div class="puml light" style=""><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="SEQUENCE" height="779px" preserveAspectRatio="xMidYMid meet" style="width:583px;height:779px;background:#FFFFFF;" version="1.1" viewBox="0 0 583 779" width="583px" zoomAndPan="magnify" class="diagram"><title>SMART Discovery Process</title><defs/><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="203.4922" x="185.9512" y="27.9951">SMART Discovery Process</text><g><title>FHIR Server</title><rect fill="#F1F1F1" height="104.7969" style="stroke:#181818;stroke-width:1;" width="10" x="323.0605" y="147.8594"/></g><g><title>FHIR Server</title><rect fill="#F1F1F1" height="89.6641" style="stroke:#181818;stroke-width:1;" width="10" x="323.0605" y="281.7891"/></g><g><title>SMART Client</title><rect fill="#000000" fill-opacity="0.00000" height="670.3828" width="8" x="54.9014" y="73.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="58" x2="58" y1="73.5938" y2="743.9766"/></g><g><title>FHIR Server</title><rect fill="#000000" fill-opacity="0.00000" height="670.3828" width="8" x="324.0605" y="73.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="327.6621" x2="327.6621" y1="73.5938" y2="743.9766"/></g><g class="participant participant-head" data-participant="Client"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="107.8027" x="5" y="42.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="93.8027" x="12" y="62.292">SMART Client</text></g><g class="participant participant-tail" data-participant="Client"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="107.8027" x="5" y="742.9766"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="93.8027" x="12" y="762.9717">SMART Client</text></g><g class="participant participant-head" data-participant="FHIR"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="96.7969" x="279.6621" y="42.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="82.7969" x="286.6621" y="62.292">FHIR Server</text></g><g class="participant participant-tail" data-participant="FHIR"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="96.7969" x="279.6621" y="742.9766"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="82.7969" x="286.6621" y="762.9717">FHIR Server</text></g><g><title>FHIR Server</title><rect fill="#F1F1F1" height="104.7969" style="stroke:#181818;stroke-width:1;" width="10" x="323.0605" y="147.8594"/></g><g><title>FHIR Server</title><rect fill="#F1F1F1" height="89.6641" style="stroke:#181818;stroke-width:1;" width="10" x="323.0605" y="281.7891"/></g><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="576.3945" x="0" y="104.1602"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="576.3945" y1="104.1602" y2="104.1602"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="576.3945" y1="107.1602" y2="107.1602"/><rect fill="#EEEEEE" height="23.1328" style="stroke:#000000;stroke-width:2;" width="90.3242" x="243.0352" y="93.5938"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="71.7983" x="249.0352" y="109.6606">Discovery</text><g class="message" data-participant-1="Client" data-participant-2="FHIR"><polygon fill="#181818" points="311.0605,143.8594,321.0605,147.8594,311.0605,151.8594,315.0605,147.8594" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="58.9014" x2="317.0605" y1="147.8594" y2="147.8594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="245.1592" x="65.9014" y="142.7935">GET /.well-known/smart-configuration</text></g><g class="message" data-participant-1="FHIR" data-participant-2="Client"><polygon fill="#181818" points="69.9014,248.6563,59.9014,252.6563,69.9014,256.6563,65.9014,252.6563" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="63.9014" x2="327.0605" y1="252.6563" y2="252.6563"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="55.104" x="75.9014" y="171.9263">Returns:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="162.0874" x="75.9014" y="187.0591">• authorization_endpoint</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="112.7598" x="75.9014" y="202.1919">• token_endpoint</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="85.6997" x="75.9014" y="217.3247">• capabilities</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="129.3589" x="75.9014" y="232.4575">• scopes_supported</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="176.1919" x="75.9014" y="247.5903">• code_challenge_methods</text></g><g class="message" data-participant-1="Client" data-participant-2="FHIR"><polygon fill="#181818" points="311.0605,277.7891,321.0605,281.7891,311.0605,285.7891,315.0605,281.7891" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="58.9014" x2="317.0605" y1="281.7891" y2="281.7891"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="97.7476" x="65.9014" y="276.7231">GET /metadata</text></g><g class="message" data-participant-1="FHIR" data-participant-2="Client"><polygon fill="#181818" points="69.9014,367.4531,59.9014,371.4531,69.9014,375.4531,65.9014,371.4531" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="63.9014" x2="327.0605" y1="371.4531" y2="371.4531"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="172.1802" x="75.9014" y="305.856">FHIR CapabilityStatement:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="147.145" x="75.9014" y="320.9888">• Supported resources</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="136.2842" x="75.9014" y="336.1216">• Search parameters</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="83.2686" x="75.9014" y="351.2544">• Operations</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="180.4893" x="75.9014" y="366.3872">• Security (SMART-on-FHIR)</text></g><g class="message" data-participant-1="Client" data-participant-2="Client"><line style="stroke:#181818;stroke-width:1;" x1="58.9014" x2="100.9014" y1="415.7188" y2="415.7188"/><line style="stroke:#181818;stroke-width:1;" x1="100.9014" x2="100.9014" y1="415.7188" y2="428.7188"/><line style="stroke:#181818;stroke-width:1;" x1="59.9014" x2="100.9014" y1="428.7188" y2="428.7188"/><polygon fill="#181818" points="69.9014,424.7188,59.9014,428.7188,69.9014,432.7188,65.9014,428.7188" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="131.8408" x="65.9014" y="395.52">Configure endpoints</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="102.4893" x="65.9014" y="410.6528">and capabilities</text></g><path d="M63,441.7188 L63,541.7188 L271,541.7188 L271,451.7188 L261,441.7188 L63,441.7188" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M261,441.7188 L261,451.7188 L271,451.7188 L261,441.7188" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="144.9614" x="69" y="458.7856">Discovery provides:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="150.9727" x="69" y="473.9185">• OAuth endpoint URLs</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="187.0337" x="69" y="489.0513">• Supported SMART features</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="120.4341" x="69" y="504.1841">• Available scopes</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="119.9517" x="69" y="519.3169">• FHIR capabilities</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="143.8252" x="69" y="534.4497">• Launch flow support</text><path d="M333,552.5156 L333,728.5156 L571,728.5156 L571,562.5156 L561,552.5156 L333,552.5156" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M561,552.5156 L561,562.5156 L571,562.5156 L561,552.5156" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="217.3945" x="339" y="569.5825">smart-configuration includes:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8.271" x="339" y="584.7153">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="199.2466" x="347.2646" y="599.8481">&quot;authorization_endpoint&quot;: &quot;...&quot;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="149.9189" x="347.2646" y="614.981">&quot;token_endpoint&quot;: &quot;...&quot;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="99.4424" x="347.2646" y="630.1138">&quot;capabilities&quot;: [</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="85.8076" x="355.5293" y="645.2466">&quot;launch-ehr&quot;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="136.3223" x="355.5293" y="660.3794">&quot;launch-standalone&quot;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="95.6021" x="355.5293" y="675.5122">&quot;client-public&quot;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="138.9692" x="355.5293" y="690.645">&quot;sso-openid-connect&quot;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="5.0718" x="347.2646" y="705.7778">]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8.271" x="339" y="720.9106">}</text></g></svg></div><div class="puml dark" style=""><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="SEQUENCE" height="779px" preserveAspectRatio="xMidYMid meet" style="width:583px;height:779px;background:#1B1B1B;" version="1.1" viewBox="0 0 583 779" width="583px" zoomAndPan="magnify" class="diagram"><title>SMART Discovery Process</title><defs/><g><rect fill="#1B1B1B" height="779" style="stroke:none;stroke-width:1;" width="583" x="0" y="0"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="203.4922" x="185.9512" y="27.9951">SMART Discovery Process</text><g><title>FHIR Server</title><rect fill="#313139" height="104.7969" style="stroke:#E7E7E7;stroke-width:1;" width="10" x="323.0605" y="147.8594"/></g><g><title>FHIR Server</title><rect fill="#313139" height="89.6641" style="stroke:#E7E7E7;stroke-width:1;" width="10" x="323.0605" y="281.7891"/></g><g><title>SMART Client</title><rect fill="#000000" fill-opacity="0.00000" height="670.3828" width="8" x="54.9014" y="73.5938"/><line style="stroke:#E7E7E7;stroke-width:0.5;stroke-dasharray:5,5;" x1="58" x2="58" y1="73.5938" y2="743.9766"/></g><g><title>FHIR Server</title><rect fill="#000000" fill-opacity="0.00000" height="670.3828" width="8" x="324.0605" y="73.5938"/><line style="stroke:#E7E7E7;stroke-width:0.5;stroke-dasharray:5,5;" x1="327.6621" x2="327.6621" y1="73.5938" y2="743.9766"/></g><g class="participant participant-head" data-participant="Client"><rect fill="#222222" height="30.2969" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="107.8027" x="5" y="42.2969"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="93.8027" x="12" y="62.292">SMART Client</text></g><g class="participant participant-tail" data-participant="Client"><rect fill="#222222" height="30.2969" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="107.8027" x="5" y="742.9766"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="93.8027" x="12" y="762.9717">SMART Client</text></g><g class="participant participant-head" data-participant="FHIR"><rect fill="#222222" height="30.2969" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="96.7969" x="279.6621" y="42.2969"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="82.7969" x="286.6621" y="62.292">FHIR Server</text></g><g class="participant participant-tail" data-participant="FHIR"><rect fill="#222222" height="30.2969" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="96.7969" x="279.6621" y="742.9766"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="82.7969" x="286.6621" y="762.9717">FHIR Server</text></g><g><title>FHIR Server</title><rect fill="#313139" height="104.7969" style="stroke:#E7E7E7;stroke-width:1;" width="10" x="323.0605" y="147.8594"/></g><g><title>FHIR Server</title><rect fill="#313139" height="89.6641" style="stroke:#E7E7E7;stroke-width:1;" width="10" x="323.0605" y="281.7891"/></g><rect fill="#111111" height="3" style="stroke:#111111;stroke-width:1;" width="576.3945" x="0" y="104.1602"/><line style="stroke:#FFFFFF;stroke-width:1;" x1="0" x2="576.3945" y1="104.1602" y2="104.1602"/><line style="stroke:#FFFFFF;stroke-width:1;" x1="0" x2="576.3945" y1="107.1602" y2="107.1602"/><rect fill="#111111" height="23.1328" style="stroke:#FFFFFF;stroke-width:2;" width="90.3242" x="243.0352" y="93.5938"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="71.7983" x="249.0352" y="109.6606">Discovery</text><g class="message" data-participant-1="Client" data-participant-2="FHIR"><polygon fill="#E7E7E7" points="311.0605,143.8594,321.0605,147.8594,311.0605,151.8594,315.0605,147.8594" style="stroke:#E7E7E7;stroke-width:1;"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="58.9014" x2="317.0605" y1="147.8594" y2="147.8594"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="245.1592" x="65.9014" y="142.7935">GET /.well-known/smart-configuration</text></g><g class="message" data-participant-1="FHIR" data-participant-2="Client"><polygon fill="#E7E7E7" points="69.9014,248.6563,59.9014,252.6563,69.9014,256.6563,65.9014,252.6563" style="stroke:#E7E7E7;stroke-width:1;"/><line style="stroke:#E7E7E7;stroke-width:1;stroke-dasharray:2,2;" x1="63.9014" x2="327.0605" y1="252.6563" y2="252.6563"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="55.104" x="75.9014" y="171.9263">Returns:</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="162.0874" x="75.9014" y="187.0591">• authorization_endpoint</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="112.7598" x="75.9014" y="202.1919">• token_endpoint</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="85.6997" x="75.9014" y="217.3247">• capabilities</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="129.3589" x="75.9014" y="232.4575">• scopes_supported</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="176.1919" x="75.9014" y="247.5903">• code_challenge_methods</text></g><g class="message" data-participant-1="Client" data-participant-2="FHIR"><polygon fill="#E7E7E7" points="311.0605,277.7891,321.0605,281.7891,311.0605,285.7891,315.0605,281.7891" style="stroke:#E7E7E7;stroke-width:1;"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="58.9014" x2="317.0605" y1="281.7891" y2="281.7891"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="97.7476" x="65.9014" y="276.7231">GET /metadata</text></g><g class="message" data-participant-1="FHIR" data-participant-2="Client"><polygon fill="#E7E7E7" points="69.9014,367.4531,59.9014,371.4531,69.9014,375.4531,65.9014,371.4531" style="stroke:#E7E7E7;stroke-width:1;"/><line style="stroke:#E7E7E7;stroke-width:1;stroke-dasharray:2,2;" x1="63.9014" x2="327.0605" y1="371.4531" y2="371.4531"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="172.1802" x="75.9014" y="305.856">FHIR CapabilityStatement:</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="147.145" x="75.9014" y="320.9888">• Supported resources</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="136.2842" x="75.9014" y="336.1216">• Search parameters</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="83.2686" x="75.9014" y="351.2544">• Operations</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="180.4893" x="75.9014" y="366.3872">• Security (SMART-on-FHIR)</text></g><g class="message" data-participant-1="Client" data-participant-2="Client"><line style="stroke:#E7E7E7;stroke-width:1;" x1="58.9014" x2="100.9014" y1="415.7188" y2="415.7188"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="100.9014" x2="100.9014" y1="415.7188" y2="428.7188"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="59.9014" x2="100.9014" y1="428.7188" y2="428.7188"/><polygon fill="#E7E7E7" points="69.9014,424.7188,59.9014,428.7188,69.9014,432.7188,65.9014,428.7188" style="stroke:#E7E7E7;stroke-width:1;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="131.8408" x="65.9014" y="395.52">Configure endpoints</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="102.4893" x="65.9014" y="410.6528">and capabilities</text></g><path d="M63,441.7188 L63,541.7188 L271,541.7188 L271,451.7188 L261,441.7188 L63,441.7188" fill="#714137" style="stroke:#E7E7E7;stroke-width:0.5;"/><path d="M261,441.7188 L261,451.7188 L271,451.7188 L261,441.7188" fill="#714137" style="stroke:#E7E7E7;stroke-width:0.5;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="144.9614" x="69" y="458.7856">Discovery provides:</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="150.9727" x="69" y="473.9185">• OAuth endpoint URLs</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="187.0337" x="69" y="489.0513">• Supported SMART features</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="120.4341" x="69" y="504.1841">• Available scopes</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="119.9517" x="69" y="519.3169">• FHIR capabilities</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="143.8252" x="69" y="534.4497">• Launch flow support</text><path d="M333,552.5156 L333,728.5156 L571,728.5156 L571,562.5156 L561,552.5156 L333,552.5156" fill="#714137" style="stroke:#E7E7E7;stroke-width:0.5;"/><path d="M561,552.5156 L561,562.5156 L571,562.5156 L561,552.5156" fill="#714137" style="stroke:#E7E7E7;stroke-width:0.5;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="217.3945" x="339" y="569.5825">smart-configuration includes:</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8.271" x="339" y="584.7153">{</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="199.2466" x="347.2646" y="599.8481">&quot;authorization_endpoint&quot;: &quot;...&quot;,</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="149.9189" x="347.2646" y="614.981">&quot;token_endpoint&quot;: &quot;...&quot;,</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="99.4424" x="347.2646" y="630.1138">&quot;capabilities&quot;: [</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="85.8076" x="355.5293" y="645.2466">&quot;launch-ehr&quot;,</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="136.3223" x="355.5293" y="660.3794">&quot;launch-standalone&quot;,</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="95.6021" x="355.5293" y="675.5122">&quot;client-public&quot;,</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="138.9692" x="355.5293" y="690.645">&quot;sso-openid-connect&quot;</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="5.0718" x="347.2646" y="705.7778">]</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8.271" x="339" y="720.9106">}</text></g></svg></div></div>
<hr/>
<h2 id="halo-smart-integration-architecture">HALO SMART Integration Architecture</h2>
<h3 id="1-halo-smart-integration-high-level-architecture-context">1. HALO SMART Integration, High-Level Architecture (Context)</h3>
<div class="puml-container"><div class="puml light" style=""><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="DESCRIPTION" height="425px" preserveAspectRatio="xMidYMid meet" style="width:1522px;height:425px;background:#FFFFFF;" version="1.1" viewBox="0 0 1522 425" width="1522px" zoomAndPan="magnify" class="diagram"><title>HALO Integration - System Context</title><defs/><g><g class="title" data-source-line="3"><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="277.5801" x="615.3849" y="22.9951">HALO Integration - System Context</text></g><g class="cluster" data-entity="Your Application" data-source-line="9" data-uid="ent0003" id="cluster_Your Application"><path d="M221.86,209.2969 L353.6588,209.2969 A3.75,3.75 0 0 1 356.1588,211.7969 L363.1588,231.5938 L931.96,231.5938 A2.5,2.5 0 0 1 934.46,234.0938 L934.46,319.7969 A2.5,2.5 0 0 1 931.96,322.2969 L221.86,322.2969 A2.5,2.5 0 0 1 219.36,319.7969 L219.36,211.7969 A2.5,2.5 0 0 1 221.86,209.2969" fill="none" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="219.36" x2="363.1588" y1="231.5938" y2="231.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="130.7988" x="223.36" y="224.292">Your Application</text></g><g class="cluster" data-entity="HALO System" data-source-line="15" data-uid="ent0007" id="cluster_HALO System"><path d="M1086.52,43.2969 L1194.0854,43.2969 A3.75,3.75 0 0 1 1196.5854,45.7969 L1203.5854,65.5938 L1508.64,65.5938 A2.5,2.5 0 0 1 1511.14,68.0938 L1511.14,251.7969 A2.5,2.5 0 0 1 1508.64,254.2969 L1086.52,254.2969 A2.5,2.5 0 0 1 1084.02,251.7969 L1084.02,45.7969 A2.5,2.5 0 0 1 1086.52,43.2969" fill="none" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="1084.02" x2="1203.5854" y1="65.5938" y2="65.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="106.5654" x="1088.02" y="58.292">HALO System</text></g><g class="entity" data-entity="FE" data-source-line="10" data-uid="ent0004" id="entity_FE"><rect fill="#F1F1F1" height="62.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="118.2236" x="235.36" y="244.0069"/><rect fill="#F1F1F1" height="10" style="stroke:#181818;stroke-width:0.5;" width="15" x="333.5836" y="249.0069"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="331.5836" y="251.0069"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="331.5836" y="255.0069"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="63.1094" x="250.36" y="277.002">Frontend</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="78.2236" x="250.36" y="293.2989">Application</text></g><g class="entity" data-entity="BE" data-source-line="11" data-uid="ent0005" id="entity_BE"><rect fill="#F1F1F1" height="62.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="100.3613" x="468.58" y="244.0069"/><rect fill="#F1F1F1" height="10" style="stroke:#181818;stroke-width:0.5;" width="15" x="548.9413" y="249.0069"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="546.9413" y="251.0069"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="546.9413" y="255.0069"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="60.3613" x="483.58" y="277.002">Backend</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="59.0352" x="483.58" y="293.2989">Services</text></g><g class="entity" data-entity="IL" data-source-line="12" data-uid="ent0006" id="entity_IL"><rect fill="#F1F1F1" height="62.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="160.5176" x="757.94" y="244.0069"/><rect fill="#F1F1F1" height="10" style="stroke:#181818;stroke-width:0.5;" width="15" x="898.4576" y="249.0069"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="896.4576" y="251.0069"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="896.4576" y="255.0069"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="120.5176" x="772.94" y="277.002">HALO Integration</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="39.0332" x="772.94" y="293.2989">Layer</text></g><g class="entity" data-entity="Auth" data-source-line="16" data-uid="ent0008" id="entity_Auth"><rect fill="#F1F1F1" height="62.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="133.7686" x="1100.02" y="78.0069"/><rect fill="#F1F1F1" height="10" style="stroke:#181818;stroke-width:0.5;" width="15" x="1213.7886" y="83.0069"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="1211.7886" y="85.0069"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="1211.7886" y="89.0069"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="38.9238" x="1115.02" y="111.002">HALO</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="93.7686" x="1115.02" y="127.2989">Authorization</text></g><g class="entity" data-entity="API" data-source-line="17" data-uid="ent0009" id="entity_API"><rect fill="#F1F1F1" height="62.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="99.0352" x="1117.39" y="176.0069"/><rect fill="#F1F1F1" height="10" style="stroke:#181818;stroke-width:0.5;" width="15" x="1196.4252" y="181.0069"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="1194.4252" y="183.0069"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="1194.4252" y="187.0069"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="38.9238" x="1132.39" y="209.002">HALO</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="59.0352" x="1132.39" y="225.2989">FHIR API</text></g><g class="entity" data-entity="DB" data-source-line="18" data-uid="ent0010" id="entity_DB"><path d="M1408.34,182.5069 C1408.34,172.5069 1451.7404,172.5069 1451.7404,172.5069 C1451.7404,172.5069 1495.1408,172.5069 1495.1408,182.5069 L1495.1408,224.1006 C1495.1408,234.1006 1451.7404,234.1006 1451.7404,234.1006 C1451.7404,234.1006 1408.34,234.1006 1408.34,224.1006 L1408.34,182.5069" fill="#F1F1F1" style="stroke:#181818;stroke-width:0.5;"/><path d="M1408.34,182.5069 C1408.34,192.5069 1451.7404,192.5069 1451.7404,192.5069 C1451.7404,192.5069 1495.1408,192.5069 1495.1408,182.5069" fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="38.9238" x="1418.34" y="209.502">HALO</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="66.8008" x="1418.34" y="225.7989">Database</text></g><g class="entity" data-entity="User" data-source-line="7" data-uid="ent0002" id="entity_User"><ellipse cx="35.6782" cy="245.6469" fill="#F1F1F1" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M35.6782,253.6469 L35.6782,280.6469 M22.6782,261.6469 L48.6782,261.6469 M35.6782,280.6469 L22.6782,295.6469 M35.6782,280.6469 L48.6782,295.6469" fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="59.3564" x="6" y="310.142">Clinician</text></g><g class="entity" data-entity="Obs" data-source-line="21" data-uid="ent0011" id="entity_Obs"><path d="M1400.0247,368.8683 C1404.0114,362.1431 1407.8659,361.8898 1412.8313,367.8829 C1415.0667,361.4721 1420.9704,359.8944 1425.1652,365.9433 C1429.3398,359.3229 1434.476,360.0633 1438.8829,365.683 C1442.8438,357.9108 1448.2364,358.3722 1453.6627,364.0757 C1458.728,359.118 1462.4141,359.2822 1465.5809,366.0117 C1470.8493,360.019 1476.8935,359.695 1480.6315,367.6617 C1483.476,362.3056 1489.2234,361.9734 1492.381,367.3179 C1496.7337,360.3786 1503.423,361.9589 1506.4521,368.6812 C1514.629,371.6758 1514.2509,376.9609 1508.8394,382.332 C1515.3499,387.3817 1514.3432,395.0019 1506.242,397.5591 C1503.7985,406.2929 1498.1281,406.9757 1491.9082,401.3212 C1488.9308,406.3022 1483.4923,406.4159 1480.615,401.2101 C1477.8451,409.7198 1471.8864,410.173 1465.9488,404.4815 C1462.7041,411.6995 1457.482,411.383 1452.9764,405.7547 C1448.796,410.9267 1442.5967,410.2553 1439.5692,404.3582 C1434.2708,409.1533 1430.0544,409.6039 1426.2225,402.687 C1420.4462,408.9866 1415.6347,407.1269 1411.8158,400.5047 C1407.2394,405.0048 1402.2285,404.0969 1399.4909,398.303 C1391.2909,394.9392 1389.6056,390.6741 1396.182,383.9125 C1390.4896,378.2579 1391.6234,370.923 1400.0247,368.8683" fill="#F1F1F1" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="92.7637" x="1405.36" y="387.142">Observability</text></g><g class="entity" data-entity="GMN20" data-source-line="33" data-uid="ent0021" id="entity_GMN20"><path d="M1077.46,273.4669 L1077.46,301.1569 L918.7,285.2769 L1077.46,309.1569 L1077.46,359.1309 A0,0 0 0 0 1077.46,359.1309 L1256.3579,359.1309 A0,0 0 0 0 1256.3579,359.1309 L1256.3579,283.4669 L1246.3579,273.4669 L1077.46,273.4669 A0,0 0 0 0 1077.46,273.4669" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1246.3579,273.4669 L1246.3579,283.4669 L1256.3579,283.4669 L1246.3579,273.4669" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="127.7529" x="1083.46" y="290.5338">Integration Layer</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="142.6763" x="1083.46" y="305.6666">• Token management</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="157.8979" x="1083.46" y="320.7994">• Retry &amp; error handling</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="153.3467" x="1083.46" y="335.9322">• Rate limit compliance</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="139.6802" x="1083.46" y="351.065">• FHIR client wrapper</text></g><g class="link" data-entity-1="User" data-entity-2="FE" data-source-line="23" data-uid="lnk12" id="link_User_FE"><path d="M65.64,275.2969 C106.56,275.2969 176.21,275.2969 229.07,275.2969" fill="none" id="User-to-FE" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="235.07,275.2969,226.07,271.2969,230.07,275.2969,226.07,279.2969,235.07,275.2969" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="106.9009" x="96.36" y="271.3638">Uses application</text></g><g class="link" data-entity-1="FE" data-entity-2="BE" data-source-line="24" data-uid="lnk13" id="link_FE_BE"><path d="M353.87,275.2969 C389.51,275.2969 428.55,275.2969 462.4,275.2969" fill="none" id="FE-to-BE" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="468.4,275.2969,459.4,271.2969,463.4,275.2969,459.4,279.2969,468.4,275.2969" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="53.8091" x="384.58" y="271.3638">API calls</text></g><g class="link" data-entity-1="BE" data-entity-2="IL" data-source-line="25" data-uid="lnk14" id="link_BE_IL"><path d="M569.36,275.2969 C619.75,275.2969 692.59,275.2969 751.71,275.2969" fill="none" id="BE-to-IL" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="757.71,275.2969,748.71,271.2969,752.71,275.2969,748.71,279.2969,757.71,275.2969" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="127.0801" x="599.94" y="271.3638">Request HALO data</text></g><g class="link" data-entity-1="IL" data-entity-2="Auth" data-source-line="26" data-uid="lnk15" id="link_IL_Auth"><path d="M889.2,243.5769 C908.12,231.9969 930.03,219.1069 950.46,208.2969 C999.59,182.3269 1051.3136,158.6229 1094.4436,139.7429" fill="none" id="IL-to-Auth" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="1099.94,137.3369,1090.0913,137.2817,1095.3596,139.3419,1093.2994,144.6102,1099.94,137.3369" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="95.4307" x="951.46" y="158.5738">Authentication</text></g><g class="link" data-entity-1="IL" data-entity-2="API" data-source-line="27" data-uid="lnk16" id="link_IL_API"><path d="M918.7,258.7569 C980.66,245.8569 1058.8158,229.589 1111.2058,218.689" fill="none" id="IL-to-API" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="1117.08,217.4669,1107.4539,215.384,1112.1848,218.4853,1109.0835,223.2163,1117.08,217.4669" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="90.7271" x="953.96" y="229.2738">FHIR requests</text></g><g class="link" data-entity-1="API" data-entity-2="DB" data-source-line="28" data-uid="lnk17" id="link_API_DB"><path d="M1216.85,206.6069 C1270.76,205.8469 1350.6106,204.711 1401.9406,203.991" fill="none" id="API-to-DB" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="1407.94,203.9069,1398.8848,200.0335,1402.9405,203.977,1398.997,208.0327,1407.94,203.9069" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="72.9219" x="1287.36" y="200.6638">Query data</text></g><g class="link" data-entity-1="IL" data-entity-2="Obs" data-source-line="29" data-uid="lnk18" id="link_IL_Obs"><path d="M886.12,306.9069 C932.19,335.8769 1005.6,376.7269 1076.02,393.2969 C1184.36,418.7969 1309.2225,406.2465 1384.1425,394.4965" fill="none" id="IL-to-Obs" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="1390.07,393.5669,1380.5589,391.0096,1385.1304,394.3416,1381.7984,398.913,1390.07,393.5669" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="97.2588" x="1118.41" y="389.3638">Logs &amp; metrics</text></g><g class="link" data-entity-1="API" data-entity-2="Obs" data-source-line="30" data-uid="lnk19" id="link_API_Obs"><path d="M1216.91,233.6569 C1229.84,240.8269 1243.71,248.7169 1256.36,256.2969 C1313.25,290.4469 1372.5797,329.5708 1411.0997,355.4508" fill="none" id="API-to-Obs" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="1416.08,358.7969,1410.8402,350.4575,1411.9297,356.0085,1406.3788,357.098,1416.08,358.7969" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="63.8574" x="1291.86" y="272.1438">Audit trail</text></g></g></svg></div><div class="puml dark" style=""><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="DESCRIPTION" height="425px" preserveAspectRatio="xMidYMid meet" style="width:1522px;height:425px;background:#1B1B1B;" version="1.1" viewBox="0 0 1522 425" width="1522px" zoomAndPan="magnify" class="diagram"><title>HALO Integration - System Context</title><defs/><g><rect fill="#1B1B1B" height="425" style="stroke:none;stroke-width:1;" width="1522" x="0" y="0"/><g class="title" data-source-line="3"><text fill="#FFFFFF" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="277.5801" x="615.3849" y="22.9951">HALO Integration - System Context</text></g><g class="cluster" data-entity="Your Application" data-source-line="9" data-uid="ent0003" id="cluster_Your Application"><path d="M221.86,209.2969 L353.6588,209.2969 A3.75,3.75 0 0 1 356.1588,211.7969 L363.1588,231.5938 L931.96,231.5938 A2.5,2.5 0 0 1 934.46,234.0938 L934.46,319.7969 A2.5,2.5 0 0 1 931.96,322.2969 L221.86,322.2969 A2.5,2.5 0 0 1 219.36,319.7969 L219.36,211.7969 A2.5,2.5 0 0 1 221.86,209.2969" fill="none" style="stroke:#FFFFFF;stroke-width:1.5;"/><line style="stroke:#FFFFFF;stroke-width:1.5;" x1="219.36" x2="363.1588" y1="231.5938" y2="231.5938"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="130.7988" x="223.36" y="224.292">Your Application</text></g><g class="cluster" data-entity="HALO System" data-source-line="15" data-uid="ent0007" id="cluster_HALO System"><path d="M1086.52,43.2969 L1194.0854,43.2969 A3.75,3.75 0 0 1 1196.5854,45.7969 L1203.5854,65.5938 L1508.64,65.5938 A2.5,2.5 0 0 1 1511.14,68.0938 L1511.14,251.7969 A2.5,2.5 0 0 1 1508.64,254.2969 L1086.52,254.2969 A2.5,2.5 0 0 1 1084.02,251.7969 L1084.02,45.7969 A2.5,2.5 0 0 1 1086.52,43.2969" fill="none" style="stroke:#FFFFFF;stroke-width:1.5;"/><line style="stroke:#FFFFFF;stroke-width:1.5;" x1="1084.02" x2="1203.5854" y1="65.5938" y2="65.5938"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="106.5654" x="1088.02" y="58.292">HALO System</text></g><g class="entity" data-entity="FE" data-source-line="10" data-uid="ent0004" id="entity_FE"><rect fill="#313139" height="62.5938" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="118.2236" x="235.36" y="244.0069"/><rect fill="#313139" height="10" style="stroke:#E7E7E7;stroke-width:0.5;" width="15" x="333.5836" y="249.0069"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="331.5836" y="251.0069"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="331.5836" y="255.0069"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="63.1094" x="250.36" y="277.002">Frontend</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="78.2236" x="250.36" y="293.2989">Application</text></g><g class="entity" data-entity="BE" data-source-line="11" data-uid="ent0005" id="entity_BE"><rect fill="#313139" height="62.5938" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="100.3613" x="468.58" y="244.0069"/><rect fill="#313139" height="10" style="stroke:#E7E7E7;stroke-width:0.5;" width="15" x="548.9413" y="249.0069"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="546.9413" y="251.0069"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="546.9413" y="255.0069"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="60.3613" x="483.58" y="277.002">Backend</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="59.0352" x="483.58" y="293.2989">Services</text></g><g class="entity" data-entity="IL" data-source-line="12" data-uid="ent0006" id="entity_IL"><rect fill="#313139" height="62.5938" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="160.5176" x="757.94" y="244.0069"/><rect fill="#313139" height="10" style="stroke:#E7E7E7;stroke-width:0.5;" width="15" x="898.4576" y="249.0069"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="896.4576" y="251.0069"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="896.4576" y="255.0069"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="120.5176" x="772.94" y="277.002">HALO Integration</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="39.0332" x="772.94" y="293.2989">Layer</text></g><g class="entity" data-entity="Auth" data-source-line="16" data-uid="ent0008" id="entity_Auth"><rect fill="#313139" height="62.5938" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="133.7686" x="1100.02" y="78.0069"/><rect fill="#313139" height="10" style="stroke:#E7E7E7;stroke-width:0.5;" width="15" x="1213.7886" y="83.0069"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="1211.7886" y="85.0069"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="1211.7886" y="89.0069"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="38.9238" x="1115.02" y="111.002">HALO</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="93.7686" x="1115.02" y="127.2989">Authorization</text></g><g class="entity" data-entity="API" data-source-line="17" data-uid="ent0009" id="entity_API"><rect fill="#313139" height="62.5938" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="99.0352" x="1117.39" y="176.0069"/><rect fill="#313139" height="10" style="stroke:#E7E7E7;stroke-width:0.5;" width="15" x="1196.4252" y="181.0069"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="1194.4252" y="183.0069"/><rect fill="#313139" height="2" style="stroke:#E7E7E7;stroke-width:0.5;" width="4" x="1194.4252" y="187.0069"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="38.9238" x="1132.39" y="209.002">HALO</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="59.0352" x="1132.39" y="225.2989">FHIR API</text></g><g class="entity" data-entity="DB" data-source-line="18" data-uid="ent0010" id="entity_DB"><path d="M1408.34,182.5069 C1408.34,172.5069 1451.7404,172.5069 1451.7404,172.5069 C1451.7404,172.5069 1495.1408,172.5069 1495.1408,182.5069 L1495.1408,224.1006 C1495.1408,234.1006 1451.7404,234.1006 1451.7404,234.1006 C1451.7404,234.1006 1408.34,234.1006 1408.34,224.1006 L1408.34,182.5069" fill="#313139" style="stroke:#E7E7E7;stroke-width:0.5;"/><path d="M1408.34,182.5069 C1408.34,192.5069 1451.7404,192.5069 1451.7404,192.5069 C1451.7404,192.5069 1495.1408,192.5069 1495.1408,182.5069" fill="none" style="stroke:#E7E7E7;stroke-width:0.5;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="38.9238" x="1418.34" y="209.502">HALO</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="66.8008" x="1418.34" y="225.7989">Database</text></g><g class="entity" data-entity="User" data-source-line="7" data-uid="ent0002" id="entity_User"><ellipse cx="35.6782" cy="245.6469" fill="#313139" rx="8" ry="8" style="stroke:#E7E7E7;stroke-width:0.5;"/><path d="M35.6782,253.6469 L35.6782,280.6469 M22.6782,261.6469 L48.6782,261.6469 M35.6782,280.6469 L22.6782,295.6469 M35.6782,280.6469 L48.6782,295.6469" fill="none" style="stroke:#E7E7E7;stroke-width:0.5;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="59.3564" x="6" y="310.142">Clinician</text></g><g class="entity" data-entity="Obs" data-source-line="21" data-uid="ent0011" id="entity_Obs"><path d="M1400.0247,368.8683 C1404.0114,362.1431 1407.8659,361.8898 1412.8313,367.8829 C1415.0667,361.4721 1420.9704,359.8944 1425.1652,365.9433 C1429.3398,359.3229 1434.476,360.0633 1438.8829,365.683 C1442.8438,357.9108 1448.2364,358.3722 1453.6627,364.0757 C1458.728,359.118 1462.4141,359.2822 1465.5809,366.0117 C1470.8493,360.019 1476.8935,359.695 1480.6315,367.6617 C1483.476,362.3056 1489.2234,361.9734 1492.381,367.3179 C1496.7337,360.3786 1503.423,361.9589 1506.4521,368.6812 C1514.629,371.6758 1514.2509,376.9609 1508.8394,382.332 C1515.3499,387.3817 1514.3432,395.0019 1506.242,397.5591 C1503.7985,406.2929 1498.1281,406.9757 1491.9082,401.3212 C1488.9308,406.3022 1483.4923,406.4159 1480.615,401.2101 C1477.8451,409.7198 1471.8864,410.173 1465.9488,404.4815 C1462.7041,411.6995 1457.482,411.383 1452.9764,405.7547 C1448.796,410.9267 1442.5967,410.2553 1439.5692,404.3582 C1434.2708,409.1533 1430.0544,409.6039 1426.2225,402.687 C1420.4462,408.9866 1415.6347,407.1269 1411.8158,400.5047 C1407.2394,405.0048 1402.2285,404.0969 1399.4909,398.303 C1391.2909,394.9392 1389.6056,390.6741 1396.182,383.9125 C1390.4896,378.2579 1391.6234,370.923 1400.0247,368.8683" fill="#313139" style="stroke:#E7E7E7;stroke-width:0.5;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="92.7637" x="1405.36" y="387.142">Observability</text></g><g class="entity" data-entity="GMN20" data-source-line="33" data-uid="ent0021" id="entity_GMN20"><path d="M1077.46,273.4669 L1077.46,301.1569 L918.7,285.2769 L1077.46,309.1569 L1077.46,359.1309 A0,0 0 0 0 1077.46,359.1309 L1256.3579,359.1309 A0,0 0 0 0 1256.3579,359.1309 L1256.3579,283.4669 L1246.3579,273.4669 L1077.46,273.4669 A0,0 0 0 0 1077.46,273.4669" fill="#714137" style="stroke:#E7E7E7;stroke-width:0.5;"/><path d="M1246.3579,273.4669 L1246.3579,283.4669 L1256.3579,283.4669 L1246.3579,273.4669" fill="#714137" style="stroke:#E7E7E7;stroke-width:0.5;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="127.7529" x="1083.46" y="290.5338">Integration Layer</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="142.6763" x="1083.46" y="305.6666">• Token management</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="157.8979" x="1083.46" y="320.7994">• Retry &amp; error handling</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="153.3467" x="1083.46" y="335.9322">• Rate limit compliance</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="139.6802" x="1083.46" y="351.065">• FHIR client wrapper</text></g><g class="link" data-entity-1="User" data-entity-2="FE" data-source-line="23" data-uid="lnk12" id="link_User_FE"><path d="M65.64,275.2969 C106.56,275.2969 176.21,275.2969 229.07,275.2969" fill="none" id="User-to-FE" style="stroke:#E7E7E7;stroke-width:1;"/><polygon fill="#E7E7E7" points="235.07,275.2969,226.07,271.2969,230.07,275.2969,226.07,279.2969,235.07,275.2969" style="stroke:#E7E7E7;stroke-width:1;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="106.9009" x="96.36" y="271.3638">Uses application</text></g><g class="link" data-entity-1="FE" data-entity-2="BE" data-source-line="24" data-uid="lnk13" id="link_FE_BE"><path d="M353.87,275.2969 C389.51,275.2969 428.55,275.2969 462.4,275.2969" fill="none" id="FE-to-BE" style="stroke:#E7E7E7;stroke-width:1;"/><polygon fill="#E7E7E7" points="468.4,275.2969,459.4,271.2969,463.4,275.2969,459.4,279.2969,468.4,275.2969" style="stroke:#E7E7E7;stroke-width:1;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="53.8091" x="384.58" y="271.3638">API calls</text></g><g class="link" data-entity-1="BE" data-entity-2="IL" data-source-line="25" data-uid="lnk14" id="link_BE_IL"><path d="M569.36,275.2969 C619.75,275.2969 692.59,275.2969 751.71,275.2969" fill="none" id="BE-to-IL" style="stroke:#E7E7E7;stroke-width:1;"/><polygon fill="#E7E7E7" points="757.71,275.2969,748.71,271.2969,752.71,275.2969,748.71,279.2969,757.71,275.2969" style="stroke:#E7E7E7;stroke-width:1;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="127.0801" x="599.94" y="271.3638">Request HALO data</text></g><g class="link" data-entity-1="IL" data-entity-2="Auth" data-source-line="26" data-uid="lnk15" id="link_IL_Auth"><path d="M889.2,243.5769 C908.12,231.9969 930.03,219.1069 950.46,208.2969 C999.59,182.3269 1051.3136,158.6229 1094.4436,139.7429" fill="none" id="IL-to-Auth" style="stroke:#E7E7E7;stroke-width:1;"/><polygon fill="#E7E7E7" points="1099.94,137.3369,1090.0913,137.2817,1095.3596,139.3419,1093.2994,144.6102,1099.94,137.3369" style="stroke:#E7E7E7;stroke-width:1;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="95.4307" x="951.46" y="158.5738">Authentication</text></g><g class="link" data-entity-1="IL" data-entity-2="API" data-source-line="27" data-uid="lnk16" id="link_IL_API"><path d="M918.7,258.7569 C980.66,245.8569 1058.8158,229.589 1111.2058,218.689" fill="none" id="IL-to-API" style="stroke:#E7E7E7;stroke-width:1;"/><polygon fill="#E7E7E7" points="1117.08,217.4669,1107.4539,215.384,1112.1848,218.4853,1109.0835,223.2163,1117.08,217.4669" style="stroke:#E7E7E7;stroke-width:1;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="90.7271" x="953.96" y="229.2738">FHIR requests</text></g><g class="link" data-entity-1="API" data-entity-2="DB" data-source-line="28" data-uid="lnk17" id="link_API_DB"><path d="M1216.85,206.6069 C1270.76,205.8469 1350.6106,204.711 1401.9406,203.991" fill="none" id="API-to-DB" style="stroke:#E7E7E7;stroke-width:1;"/><polygon fill="#E7E7E7" points="1407.94,203.9069,1398.8848,200.0335,1402.9405,203.977,1398.997,208.0327,1407.94,203.9069" style="stroke:#E7E7E7;stroke-width:1;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="72.9219" x="1287.36" y="200.6638">Query data</text></g><g class="link" data-entity-1="IL" data-entity-2="Obs" data-source-line="29" data-uid="lnk18" id="link_IL_Obs"><path d="M886.12,306.9069 C932.19,335.8769 1005.6,376.7269 1076.02,393.2969 C1184.36,418.7969 1309.2225,406.2465 1384.1425,394.4965" fill="none" id="IL-to-Obs" style="stroke:#E7E7E7;stroke-width:1;"/><polygon fill="#E7E7E7" points="1390.07,393.5669,1380.5589,391.0096,1385.1304,394.3416,1381.7984,398.913,1390.07,393.5669" style="stroke:#E7E7E7;stroke-width:1;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="97.2588" x="1118.41" y="389.3638">Logs &amp; metrics</text></g><g class="link" data-entity-1="API" data-entity-2="Obs" data-source-line="30" data-uid="lnk19" id="link_API_Obs"><path d="M1216.91,233.6569 C1229.84,240.8269 1243.71,248.7169 1256.36,256.2969 C1313.25,290.4469 1372.5797,329.5708 1411.0997,355.4508" fill="none" id="API-to-Obs" style="stroke:#E7E7E7;stroke-width:1;"/><polygon fill="#E7E7E7" points="1416.08,358.7969,1410.8402,350.4575,1411.9297,356.0085,1406.3788,357.098,1416.08,358.7969" style="stroke:#E7E7E7;stroke-width:1;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="63.8574" x="1291.86" y="272.1438">Audit trail</text></g></g></svg></div></div>
<h3 id="2-halo-smart-integration-authentication-flow">2. HALO SMART Integration, Authentication Flow</h3>
<div class="puml-container"><div class="puml light" style=""><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="SEQUENCE" height="725px" preserveAspectRatio="xMidYMid meet" style="width:972px;height:725px;background:#FFFFFF;" version="1.1" viewBox="0 0 972 725" width="972px" zoomAndPan="magnify" class="diagram"><title>HALO SMART Authentication Flow</title><defs/><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="267.3262" x="351.1592" y="27.9951">HALO SMART Authentication Flow</text><g><title>Clinician</title><rect fill="#000000" fill-opacity="0.00000" height="525.7891" width="8" x="33.6782" y="118.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="37" x2="37" y1="118.5938" y2="644.3828"/></g><g><title>Frontend UI</title><rect fill="#000000" fill-opacity="0.00000" height="525.7891" width="8" x="229.1221" y="118.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="232.1543" x2="232.1543" y1="118.5938" y2="644.3828"/></g><g><title>SMART Launch</title><rect fill="#000000" fill-opacity="0.00000" height="525.7891" width="8" x="427.7651" y="118.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="430.7813" x2="430.7813" y1="118.5938" y2="644.3828"/></g><g><title>Backend</title><rect fill="#000000" fill-opacity="0.00000" height="525.7891" width="8" x="573.894" y="118.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="576.9409" x2="576.9409" y1="118.5938" y2="644.3828"/></g><g><title>Token</title><rect fill="#000000" fill-opacity="0.00000" height="525.7891" width="8" x="754.6304" y="118.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="758.2422" x2="758.2422" y1="118.5938" y2="644.3828"/></g><g><title>HALO OAuth</title><rect fill="#000000" fill-opacity="0.00000" height="525.7891" width="8" x="849.6216" y="118.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="853.0186" x2="853.0186" y1="118.5938" y2="644.3828"/></g><g class="participant participant-head" data-participant="User"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="59.3564" x="5" y="115.292">Clinician</text><ellipse cx="37.6782" cy="50.7969" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M37.6782,58.7969 L37.6782,85.7969 M24.6782,66.7969 L50.6782,66.7969 M37.6782,85.7969 L24.6782,100.7969 M37.6782,85.7969 L50.6782,100.7969" fill="none" style="stroke:#181818;stroke-width:0.5;"/></g><g class="participant participant-tail" data-participant="User"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="59.3564" x="5" y="656.3779">Clinician</text><ellipse cx="37.6782" cy="668.1797" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M37.6782,676.1797 L37.6782,703.1797 M24.6782,684.1797 L50.6782,684.1797 M37.6782,703.1797 L24.6782,718.1797 M37.6782,703.1797 L50.6782,718.1797" fill="none" style="stroke:#181818;stroke-width:0.5;"/></g><g class="participant participant-head" data-participant="FE"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="95.9355" x="185.1543" y="87.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="81.9355" x="192.1543" y="107.292">Frontend UI</text></g><g class="participant participant-tail" data-participant="FE"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="95.9355" x="185.1543" y="643.3828"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="81.9355" x="192.1543" y="663.3779">Frontend UI</text></g><g class="participant participant-head" data-participant="Launch"><rect fill="#E2E2F0" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="117.9678" x="372.7813" y="71"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="103.9678" x="379.7813" y="90.9951">SMART Launch</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="55.125" x="404.2026" y="107.292">Handler</text></g><g class="participant participant-tail" data-participant="Launch"><rect fill="#E2E2F0" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="117.9678" x="372.7813" y="643.3828"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="103.9678" x="379.7813" y="663.3779">SMART Launch</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="55.125" x="404.2026" y="679.6748">Handler</text></g><g class="participant participant-head" data-participant="Auth"><rect fill="#E2E2F0" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="131.9063" x="511.9409" y="71"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="60.3613" x="547.7134" y="90.9951">Backend</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="117.9063" x="518.9409" y="107.292">Auth Middleware</text></g><g class="participant participant-tail" data-participant="Auth"><rect fill="#E2E2F0" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="131.9063" x="511.9409" y="643.3828"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="60.3613" x="547.7134" y="663.3779">Backend</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="117.9063" x="518.9409" y="679.6748">Auth Middleware</text></g><g class="participant participant-head" data-participant="Storage"><rect fill="#E2E2F0" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="68.7764" x="724.2422" y="71"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="42.7109" x="737.2749" y="90.9951">Token</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="54.7764" x="731.2422" y="107.292">Storage</text></g><g class="participant participant-tail" data-participant="Storage"><rect fill="#E2E2F0" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="68.7764" x="724.2422" y="643.3828"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="42.7109" x="737.2749" y="663.3779">Token</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="54.7764" x="731.2422" y="679.6748">Storage</text></g><g class="participant participant-head" data-participant="HALO"><rect fill="#E2E2F0" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="101.2061" x="803.0186" y="71"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="87.2061" x="810.0186" y="90.9951">HALO OAuth</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="45.9102" x="830.6665" y="107.292">Server</text></g><g class="participant participant-tail" data-participant="HALO"><rect fill="#E2E2F0" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="101.2061" x="803.0186" y="643.3828"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="87.2061" x="810.0186" y="663.3779">HALO OAuth</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="45.9102" x="830.6665" y="679.6748">Server</text></g><g class="message" data-participant-1="User" data-participant-2="FE"><polygon fill="#181818" points="221.1221,145.7266,231.1221,149.7266,221.1221,153.7266,225.1221,149.7266" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="37.6782" x2="227.1221" y1="149.7266" y2="149.7266"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="134.8115" x="44.6782" y="144.6606">Click launch in HALO</text></g><g class="message" data-participant-1="FE" data-participant-2="Launch"><polygon fill="#181818" points="419.7651,174.8594,429.7651,178.8594,419.7651,182.8594,423.7651,178.8594" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="233.1221" x2="425.7651" y1="178.8594" y2="178.8594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="174.6431" x="240.1221" y="173.7935">Initialize with launch token</text></g><g class="message" data-participant-1="Launch" data-participant-2="HALO"><polygon fill="#181818" points="841.6216,219.125,851.6216,223.125,841.6216,227.125,845.6216,223.125" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="431.7651" x2="847.6216" y1="223.125" y2="223.125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="140.9053" x="438.7651" y="202.9263">Authorization request</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="178.3057" x="438.7651" y="218.0591">(with launch token &amp; PKCE)</text></g><g class="message" data-participant-1="HALO" data-participant-2="User"><polygon fill="#181818" points="48.6782,248.2578,38.6782,252.2578,48.6782,256.2578,44.6782,252.2578" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="42.6782" x2="852.6216" y1="252.2578" y2="252.2578"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="105.1489" x="54.6782" y="247.1919">Login &amp; consent</text></g><g class="message" data-participant-1="User" data-participant-2="HALO"><polygon fill="#181818" points="841.6216,277.3906,851.6216,281.3906,841.6216,285.3906,845.6216,281.3906" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="37.6782" x2="847.6216" y1="281.3906" y2="281.3906"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="54.3867" x="44.6782" y="276.3247">Approve</text></g><g class="message" data-participant-1="HALO" data-participant-2="Launch"><polygon fill="#181818" points="442.7651,306.5234,432.7651,310.5234,442.7651,314.5234,438.7651,310.5234" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="436.7651" x2="852.6216" y1="310.5234" y2="310.5234"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="113.1089" x="448.7651" y="305.4575">Return auth code</text></g><g class="message" data-participant-1="Launch" data-participant-2="Auth"><polygon fill="#181818" points="565.894,335.6563,575.894,339.6563,565.894,343.6563,569.894,339.6563" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="431.7651" x2="571.894" y1="339.6563" y2="339.6563"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="122.1289" x="438.7651" y="334.5903">Forward auth code</text></g><g class="message" data-participant-1="Auth" data-participant-2="HALO"><polygon fill="#181818" points="841.6216,379.9219,851.6216,383.9219,841.6216,387.9219,845.6216,383.9219" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="577.894" x2="847.6216" y1="383.9219" y2="383.9219"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="168.9619" x="584.894" y="363.7231">Exchange code for tokens</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="125.8867" x="584.894" y="378.856">(with code_verifier)</text></g><g class="message" data-participant-1="HALO" data-participant-2="Auth"><polygon fill="#181818" points="588.894,424.1875,578.894,428.1875,588.894,432.1875,584.894,428.1875" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="582.894" x2="852.6216" y1="428.1875" y2="428.1875"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="192.061" x="594.894" y="407.9888">Access token + refresh token</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="114.645" x="594.894" y="423.1216">+ patient context</text></g><g class="message" data-participant-1="Auth" data-participant-2="Storage"><polygon fill="#181818" points="746.6304,468.4531,756.6304,472.4531,746.6304,476.4531,750.6304,472.4531" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="577.894" x2="752.6304" y1="472.4531" y2="472.4531"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="141.3052" x="584.894" y="452.2544">Store tokens securely</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="156.7363" x="584.894" y="467.3872">(encrypted, with expiry)</text></g><g class="message" data-participant-1="Auth" data-participant-2="FE"><polygon fill="#181818" points="244.1221,497.5859,234.1221,501.5859,244.1221,505.5859,240.1221,501.5859" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="238.1221" x2="576.894" y1="501.5859" y2="501.5859"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="128.3052" x="250.1221" y="496.52">Session established</text></g><g class="message" data-participant-1="FE" data-participant-2="User"><polygon fill="#181818" points="48.6782,526.7188,38.6782,530.7188,48.6782,534.7188,44.6782,530.7188" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="42.6782" x2="232.1221" y1="530.7188" y2="530.7188"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="171.4438" x="54.6782" y="525.6528">Display patient dashboard</text></g><path d="M763,543.7188 L763,628.7188 L965,628.7188 L965,553.7188 L955,543.7188 L763,543.7188" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M955,543.7188 L955,553.7188 L965,553.7188 L955,543.7188" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="106.8564" x="769" y="560.7856">Token Storage</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="124.5791" x="769" y="575.9185">• Encrypted at rest</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="143.4253" x="769" y="591.0513">• 1-hour access token</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="170.7012" x="769" y="606.1841">• Long-lived refresh token</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="181.6445" x="769" y="621.3169">• Patient/encounter context</text></g></svg></div><div class="puml dark" style=""><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="SEQUENCE" height="725px" preserveAspectRatio="xMidYMid meet" style="width:972px;height:725px;background:#1B1B1B;" version="1.1" viewBox="0 0 972 725" width="972px" zoomAndPan="magnify" class="diagram"><title>HALO SMART Authentication Flow</title><defs/><g><rect fill="#1B1B1B" height="725" style="stroke:none;stroke-width:1;" width="972" x="0" y="0"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="267.3262" x="351.1592" y="27.9951">HALO SMART Authentication Flow</text><g><title>Clinician</title><rect fill="#000000" fill-opacity="0.00000" height="525.7891" width="8" x="33.6782" y="118.5938"/><line style="stroke:#E7E7E7;stroke-width:0.5;stroke-dasharray:5,5;" x1="37" x2="37" y1="118.5938" y2="644.3828"/></g><g><title>Frontend UI</title><rect fill="#000000" fill-opacity="0.00000" height="525.7891" width="8" x="229.1221" y="118.5938"/><line style="stroke:#E7E7E7;stroke-width:0.5;stroke-dasharray:5,5;" x1="232.1543" x2="232.1543" y1="118.5938" y2="644.3828"/></g><g><title>SMART Launch</title><rect fill="#000000" fill-opacity="0.00000" height="525.7891" width="8" x="427.7651" y="118.5938"/><line style="stroke:#E7E7E7;stroke-width:0.5;stroke-dasharray:5,5;" x1="430.7813" x2="430.7813" y1="118.5938" y2="644.3828"/></g><g><title>Backend</title><rect fill="#000000" fill-opacity="0.00000" height="525.7891" width="8" x="573.894" y="118.5938"/><line style="stroke:#E7E7E7;stroke-width:0.5;stroke-dasharray:5,5;" x1="576.9409" x2="576.9409" y1="118.5938" y2="644.3828"/></g><g><title>Token</title><rect fill="#000000" fill-opacity="0.00000" height="525.7891" width="8" x="754.6304" y="118.5938"/><line style="stroke:#E7E7E7;stroke-width:0.5;stroke-dasharray:5,5;" x1="758.2422" x2="758.2422" y1="118.5938" y2="644.3828"/></g><g><title>HALO OAuth</title><rect fill="#000000" fill-opacity="0.00000" height="525.7891" width="8" x="849.6216" y="118.5938"/><line style="stroke:#E7E7E7;stroke-width:0.5;stroke-dasharray:5,5;" x1="853.0186" x2="853.0186" y1="118.5938" y2="644.3828"/></g><g class="participant participant-head" data-participant="User"><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="59.3564" x="5" y="115.292">Clinician</text><ellipse cx="37.6782" cy="50.7969" fill="#222222" rx="8" ry="8" style="stroke:#E7E7E7;stroke-width:0.5;"/><path d="M37.6782,58.7969 L37.6782,85.7969 M24.6782,66.7969 L50.6782,66.7969 M37.6782,85.7969 L24.6782,100.7969 M37.6782,85.7969 L50.6782,100.7969" fill="none" style="stroke:#E7E7E7;stroke-width:0.5;"/></g><g class="participant participant-tail" data-participant="User"><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="59.3564" x="5" y="656.3779">Clinician</text><ellipse cx="37.6782" cy="668.1797" fill="#222222" rx="8" ry="8" style="stroke:#E7E7E7;stroke-width:0.5;"/><path d="M37.6782,676.1797 L37.6782,703.1797 M24.6782,684.1797 L50.6782,684.1797 M37.6782,703.1797 L24.6782,718.1797 M37.6782,703.1797 L50.6782,718.1797" fill="none" style="stroke:#E7E7E7;stroke-width:0.5;"/></g><g class="participant participant-head" data-participant="FE"><rect fill="#222222" height="30.2969" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="95.9355" x="185.1543" y="87.2969"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="81.9355" x="192.1543" y="107.292">Frontend UI</text></g><g class="participant participant-tail" data-participant="FE"><rect fill="#222222" height="30.2969" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="95.9355" x="185.1543" y="643.3828"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="81.9355" x="192.1543" y="663.3779">Frontend UI</text></g><g class="participant participant-head" data-participant="Launch"><rect fill="#222222" height="46.5938" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="117.9678" x="372.7813" y="71"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="103.9678" x="379.7813" y="90.9951">SMART Launch</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="55.125" x="404.2026" y="107.292">Handler</text></g><g class="participant participant-tail" data-participant="Launch"><rect fill="#222222" height="46.5938" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="117.9678" x="372.7813" y="643.3828"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="103.9678" x="379.7813" y="663.3779">SMART Launch</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="55.125" x="404.2026" y="679.6748">Handler</text></g><g class="participant participant-head" data-participant="Auth"><rect fill="#222222" height="46.5938" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="131.9063" x="511.9409" y="71"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="60.3613" x="547.7134" y="90.9951">Backend</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="117.9063" x="518.9409" y="107.292">Auth Middleware</text></g><g class="participant participant-tail" data-participant="Auth"><rect fill="#222222" height="46.5938" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="131.9063" x="511.9409" y="643.3828"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="60.3613" x="547.7134" y="663.3779">Backend</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="117.9063" x="518.9409" y="679.6748">Auth Middleware</text></g><g class="participant participant-head" data-participant="Storage"><rect fill="#222222" height="46.5938" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="68.7764" x="724.2422" y="71"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="42.7109" x="737.2749" y="90.9951">Token</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="54.7764" x="731.2422" y="107.292">Storage</text></g><g class="participant participant-tail" data-participant="Storage"><rect fill="#222222" height="46.5938" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="68.7764" x="724.2422" y="643.3828"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="42.7109" x="737.2749" y="663.3779">Token</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="54.7764" x="731.2422" y="679.6748">Storage</text></g><g class="participant participant-head" data-participant="HALO"><rect fill="#222222" height="46.5938" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="101.2061" x="803.0186" y="71"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="87.2061" x="810.0186" y="90.9951">HALO OAuth</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="45.9102" x="830.6665" y="107.292">Server</text></g><g class="participant participant-tail" data-participant="HALO"><rect fill="#222222" height="46.5938" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="101.2061" x="803.0186" y="643.3828"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="87.2061" x="810.0186" y="663.3779">HALO OAuth</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="45.9102" x="830.6665" y="679.6748">Server</text></g><g class="message" data-participant-1="User" data-participant-2="FE"><polygon fill="#E7E7E7" points="221.1221,145.7266,231.1221,149.7266,221.1221,153.7266,225.1221,149.7266" style="stroke:#E7E7E7;stroke-width:1;"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="37.6782" x2="227.1221" y1="149.7266" y2="149.7266"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="134.8115" x="44.6782" y="144.6606">Click launch in HALO</text></g><g class="message" data-participant-1="FE" data-participant-2="Launch"><polygon fill="#E7E7E7" points="419.7651,174.8594,429.7651,178.8594,419.7651,182.8594,423.7651,178.8594" style="stroke:#E7E7E7;stroke-width:1;"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="233.1221" x2="425.7651" y1="178.8594" y2="178.8594"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="174.6431" x="240.1221" y="173.7935">Initialize with launch token</text></g><g class="message" data-participant-1="Launch" data-participant-2="HALO"><polygon fill="#E7E7E7" points="841.6216,219.125,851.6216,223.125,841.6216,227.125,845.6216,223.125" style="stroke:#E7E7E7;stroke-width:1;"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="431.7651" x2="847.6216" y1="223.125" y2="223.125"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="140.9053" x="438.7651" y="202.9263">Authorization request</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="178.3057" x="438.7651" y="218.0591">(with launch token &amp; PKCE)</text></g><g class="message" data-participant-1="HALO" data-participant-2="User"><polygon fill="#E7E7E7" points="48.6782,248.2578,38.6782,252.2578,48.6782,256.2578,44.6782,252.2578" style="stroke:#E7E7E7;stroke-width:1;"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="42.6782" x2="852.6216" y1="252.2578" y2="252.2578"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="105.1489" x="54.6782" y="247.1919">Login &amp; consent</text></g><g class="message" data-participant-1="User" data-participant-2="HALO"><polygon fill="#E7E7E7" points="841.6216,277.3906,851.6216,281.3906,841.6216,285.3906,845.6216,281.3906" style="stroke:#E7E7E7;stroke-width:1;"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="37.6782" x2="847.6216" y1="281.3906" y2="281.3906"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="54.3867" x="44.6782" y="276.3247">Approve</text></g><g class="message" data-participant-1="HALO" data-participant-2="Launch"><polygon fill="#E7E7E7" points="442.7651,306.5234,432.7651,310.5234,442.7651,314.5234,438.7651,310.5234" style="stroke:#E7E7E7;stroke-width:1;"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="436.7651" x2="852.6216" y1="310.5234" y2="310.5234"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="113.1089" x="448.7651" y="305.4575">Return auth code</text></g><g class="message" data-participant-1="Launch" data-participant-2="Auth"><polygon fill="#E7E7E7" points="565.894,335.6563,575.894,339.6563,565.894,343.6563,569.894,339.6563" style="stroke:#E7E7E7;stroke-width:1;"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="431.7651" x2="571.894" y1="339.6563" y2="339.6563"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="122.1289" x="438.7651" y="334.5903">Forward auth code</text></g><g class="message" data-participant-1="Auth" data-participant-2="HALO"><polygon fill="#E7E7E7" points="841.6216,379.9219,851.6216,383.9219,841.6216,387.9219,845.6216,383.9219" style="stroke:#E7E7E7;stroke-width:1;"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="577.894" x2="847.6216" y1="383.9219" y2="383.9219"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="168.9619" x="584.894" y="363.7231">Exchange code for tokens</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="125.8867" x="584.894" y="378.856">(with code_verifier)</text></g><g class="message" data-participant-1="HALO" data-participant-2="Auth"><polygon fill="#E7E7E7" points="588.894,424.1875,578.894,428.1875,588.894,432.1875,584.894,428.1875" style="stroke:#E7E7E7;stroke-width:1;"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="582.894" x2="852.6216" y1="428.1875" y2="428.1875"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="192.061" x="594.894" y="407.9888">Access token + refresh token</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="114.645" x="594.894" y="423.1216">+ patient context</text></g><g class="message" data-participant-1="Auth" data-participant-2="Storage"><polygon fill="#E7E7E7" points="746.6304,468.4531,756.6304,472.4531,746.6304,476.4531,750.6304,472.4531" style="stroke:#E7E7E7;stroke-width:1;"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="577.894" x2="752.6304" y1="472.4531" y2="472.4531"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="141.3052" x="584.894" y="452.2544">Store tokens securely</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="156.7363" x="584.894" y="467.3872">(encrypted, with expiry)</text></g><g class="message" data-participant-1="Auth" data-participant-2="FE"><polygon fill="#E7E7E7" points="244.1221,497.5859,234.1221,501.5859,244.1221,505.5859,240.1221,501.5859" style="stroke:#E7E7E7;stroke-width:1;"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="238.1221" x2="576.894" y1="501.5859" y2="501.5859"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="128.3052" x="250.1221" y="496.52">Session established</text></g><g class="message" data-participant-1="FE" data-participant-2="User"><polygon fill="#E7E7E7" points="48.6782,526.7188,38.6782,530.7188,48.6782,534.7188,44.6782,530.7188" style="stroke:#E7E7E7;stroke-width:1;"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="42.6782" x2="232.1221" y1="530.7188" y2="530.7188"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="171.4438" x="54.6782" y="525.6528">Display patient dashboard</text></g><path d="M763,543.7188 L763,628.7188 L965,628.7188 L965,553.7188 L955,543.7188 L763,543.7188" fill="#714137" style="stroke:#E7E7E7;stroke-width:0.5;"/><path d="M955,543.7188 L955,553.7188 L965,553.7188 L955,543.7188" fill="#714137" style="stroke:#E7E7E7;stroke-width:0.5;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="106.8564" x="769" y="560.7856">Token Storage</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="124.5791" x="769" y="575.9185">• Encrypted at rest</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="143.4253" x="769" y="591.0513">• 1-hour access token</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="170.7012" x="769" y="606.1841">• Long-lived refresh token</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="181.6445" x="769" y="621.3169">• Patient/encounter context</text></g></svg></div></div>
<h3 id="3-halo-smart-integration-data-access-flow">3. HALO SMART Integration, Data Access Flow</h3>
<div class="puml-container"><div class="puml light" style=""><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="SEQUENCE" height="958px" preserveAspectRatio="xMidYMid meet" style="width:1040px;height:958px;background:#FFFFFF;" version="1.1" viewBox="0 0 1040 958" width="1040px" zoomAndPan="magnify" class="diagram"><title>HALO FHIR Data Access Flow</title><defs/><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="227.8555" x="407.9629" y="27.9951">HALO FHIR Data Access Flow</text><rect fill="none" height="177.6016" style="stroke:#000000;stroke-width:1.5;" width="349.4619" x="537.1802" y="225.2891"/><g><title>Patient</title><rect fill="#000000" fill-opacity="0.00000" height="743.2578" width="8" x="46.1001" y="120.8906"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="50" x2="50" y1="120.8906" y2="864.1484"/></g><g><title>Business</title><rect fill="#000000" fill-opacity="0.00000" height="743.2578" width="8" x="207.2983" y="120.8906"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="210.4307" x2="210.4307" y1="120.8906" y2="864.1484"/></g><g><title>HALO SMART</title><rect fill="#000000" fill-opacity="0.00000" height="743.2578" width="8" x="409.5405" y="120.8906"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="413.4424" x2="413.4424" y1="120.8906" y2="864.1484"/></g><g><title>Token</title><rect fill="#000000" fill-opacity="0.00000" height="743.2578" width="8" x="580.8633" y="120.8906"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="584.1802" x2="584.1802" y1="120.8906" y2="864.1484"/></g><g><title>Token</title><rect fill="#000000" fill-opacity="0.00000" height="743.2578" width="8" x="738.4434" y="120.8906"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="742.0552" x2="742.0552" y1="120.8906" y2="864.1484"/></g><g><title>HALO FHIR</title><rect fill="#000000" fill-opacity="0.00000" height="743.2578" width="8" x="827.7368" y="120.8906"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="830.8315" x2="830.8315" y1="120.8906" y2="864.1484"/></g><g><title>HALO</title><rect fill="#000000" fill-opacity="0.00000" height="743.2578" width="8" x="999.3809" y="120.8906"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="1002.9805" x2="1002.9805" y1="120.8906" y2="864.1484"/></g><g class="participant participant-head" data-participant="UI"><rect fill="#E2E2F0" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="90.2002" x="5" y="73.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="49.376" x="25.4121" y="93.292">Patient</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="76.2002" x="12" y="109.5889">Dashboard</text></g><g class="participant participant-tail" data-participant="UI"><rect fill="#E2E2F0" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="90.2002" x="5" y="863.1484"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="49.376" x="25.4121" y="883.1436">Patient</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="76.2002" x="12" y="899.4404">Dashboard</text></g><g class="participant participant-head" data-participant="BL"><rect fill="#E2E2F0" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="75.7354" x="173.4307" y="73.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="61.7354" x="180.4307" y="93.292">Business</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="36.8389" x="192.8789" y="109.5889">Logic</text></g><g class="participant participant-tail" data-participant="BL"><rect fill="#E2E2F0" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="75.7354" x="173.4307" y="863.1484"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="61.7354" x="180.4307" y="883.1436">Business</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="36.8389" x="192.8789" y="899.4404">Logic</text></g><g class="participant participant-head" data-participant="Client"><rect fill="#E2E2F0" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="106.1963" x="360.4424" y="73.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="92.1963" x="367.4424" y="93.292">HALO SMART</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="40.5303" x="393.2754" y="109.5889">Client</text></g><g class="participant participant-tail" data-participant="Client"><rect fill="#E2E2F0" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="106.1963" x="360.4424" y="863.1484"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="92.1963" x="367.4424" y="883.1436">HALO SMART</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="40.5303" x="393.2754" y="899.4404">Client</text></g><g class="participant participant-head" data-participant="TM"><rect fill="#E2E2F0" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="75.3662" x="547.1802" y="73.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="42.7109" x="563.5078" y="93.292">Token</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="61.3662" x="554.1802" y="109.5889">Manager</text></g><g class="participant participant-tail" data-participant="TM"><rect fill="#E2E2F0" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="75.3662" x="547.1802" y="863.1484"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="42.7109" x="563.5078" y="883.1436">Token</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="61.3662" x="554.1802" y="899.4404">Manager</text></g><g class="participant participant-head" data-participant="Storage"><rect fill="#E2E2F0" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="68.7764" x="708.0552" y="73.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="42.7109" x="721.0879" y="93.292">Token</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="54.7764" x="715.0552" y="109.5889">Storage</text></g><g class="participant participant-tail" data-participant="Storage"><rect fill="#E2E2F0" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="68.7764" x="708.0552" y="863.1484"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="42.7109" x="721.0879" y="883.1436">Token</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="54.7764" x="715.0552" y="899.4404">Storage</text></g><g class="participant participant-head" data-participant="API"><rect fill="#E2E2F0" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="89.8105" x="786.8315" y="73.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="75.8105" x="793.8315" y="93.292">HALO FHIR</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="22.1484" x="820.6626" y="109.5889">API</text></g><g class="participant participant-tail" data-participant="API"><rect fill="#E2E2F0" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="89.8105" x="786.8315" y="863.1484"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="75.8105" x="793.8315" y="883.1436">HALO FHIR</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="22.1484" x="820.6626" y="899.4404">API</text></g><g class="participant participant-head" data-participant="DB"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="38.9238" x="980.9189" y="101.292">HALO</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="66.8008" x="966.9805" y="117.5889">Database</text><path d="M985.3809,52.2969 C985.3809,42.2969 1003.3809,42.2969 1003.3809,42.2969 C1003.3809,42.2969 1021.3809,42.2969 1021.3809,52.2969 L1021.3809,78.2969 C1021.3809,88.2969 1003.3809,88.2969 1003.3809,88.2969 C1003.3809,88.2969 985.3809,88.2969 985.3809,78.2969 L985.3809,52.2969" fill="#E2E2F0" style="stroke:#181818;stroke-width:0.5;"/><path d="M985.3809,52.2969 C985.3809,62.2969 1003.3809,62.2969 1003.3809,62.2969 C1003.3809,62.2969 1021.3809,62.2969 1021.3809,52.2969" fill="none" style="stroke:#181818;stroke-width:0.5;"/></g><g class="participant participant-tail" data-participant="DB"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="38.9238" x="980.9189" y="876.1436">HALO</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="66.8008" x="966.9805" y="892.4404">Database</text><path d="M985.3809,905.7422 C985.3809,895.7422 1003.3809,895.7422 1003.3809,895.7422 C1003.3809,895.7422 1021.3809,895.7422 1021.3809,905.7422 L1021.3809,931.7422 C1021.3809,941.7422 1003.3809,941.7422 1003.3809,941.7422 C1003.3809,941.7422 985.3809,941.7422 985.3809,931.7422 L985.3809,905.7422" fill="#E2E2F0" style="stroke:#181818;stroke-width:0.5;"/><path d="M985.3809,905.7422 C985.3809,915.7422 1003.3809,915.7422 1003.3809,915.7422 C1003.3809,915.7422 1021.3809,915.7422 1021.3809,905.7422" fill="none" style="stroke:#181818;stroke-width:0.5;"/></g><g class="message" data-participant-1="UI" data-participant-2="BL"><polygon fill="#181818" points="199.2983,148.0234,209.2983,152.0234,199.2983,156.0234,203.2983,152.0234" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="50.1001" x2="205.2983" y1="152.0234" y2="152.0234"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="137.1982" x="57.1001" y="146.9575">Request patient data</text></g><g class="message" data-participant-1="BL" data-participant-2="Client"><polygon fill="#181818" points="401.5405,177.1563,411.5405,181.1563,401.5405,185.1563,405.5405,181.1563" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="211.2983" x2="407.5405" y1="181.1563" y2="181.1563"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="178.2422" x="218.2983" y="176.0903">Get Patient + Observations</text></g><g class="message" data-participant-1="Client" data-participant-2="TM"><polygon fill="#181818" points="572.8633,206.2891,582.8633,210.2891,572.8633,214.2891,576.8633,210.2891" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="413.5405" x2="578.8633" y1="210.2891" y2="210.2891"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="147.3228" x="420.5405" y="205.2231">Get valid access token</text></g><path d="M537.1802,225.2891 L601.623,225.2891 L601.623,232.4219 L591.623,242.4219 L537.1802,242.4219 L537.1802,225.2891" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="177.6016" style="stroke:#000000;stroke-width:1.5;" width="349.4619" x="537.1802" y="225.2891"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19.4429" x="552.1802" y="238.356">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="81.5601" x="616.623" y="237.4995">[Token valid]</text><g class="message" data-participant-1="TM" data-participant-2="Storage"><polygon fill="#181818" points="730.4434,259.5547,740.4434,263.5547,730.4434,267.5547,734.4434,263.5547" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="584.8633" x2="736.4434" y1="263.5547" y2="263.5547"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="95.7227" x="591.8633" y="258.4888">Retrieve token</text></g><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2,2;" x1="537.1802" x2="886.6421" y1="272.5547" y2="272.5547"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="98.5112" x="542.1802" y="282.7651">[Token expired]</text><g class="message" data-participant-1="TM" data-participant-2="Storage"><polygon fill="#181818" points="730.4434,303.4922,740.4434,307.4922,730.4434,311.4922,734.4434,307.4922" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="584.8633" x2="736.4434" y1="307.4922" y2="307.4922"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="114.5244" x="591.8633" y="302.4263">Get refresh token</text></g><g class="message" data-participant-1="TM" data-participant-2="API"><polygon fill="#181818" points="819.7368,332.625,829.7368,336.625,819.7368,340.625,823.7368,336.625" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="584.8633" x2="825.7368" y1="336.625" y2="336.625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="138.8486" x="591.8633" y="331.5591">Refresh access token</text></g><g class="message" data-participant-1="API" data-participant-2="TM"><polygon fill="#181818" points="595.8633,361.7578,585.8633,365.7578,595.8633,369.7578,591.8633,365.7578" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="589.8633" x2="830.7368" y1="365.7578" y2="365.7578"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="117.2412" x="601.8633" y="360.6919">New access token</text></g><g class="message" data-participant-1="TM" data-participant-2="Storage"><polygon fill="#181818" points="730.4434,390.8906,740.4434,394.8906,730.4434,398.8906,734.4434,394.8906" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="584.8633" x2="736.4434" y1="394.8906" y2="394.8906"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="133.5801" x="591.8633" y="389.8247">Update stored token</text></g><g class="message" data-participant-1="Client" data-participant-2="API"><polygon fill="#181818" points="819.7368,442.1563,829.7368,446.1563,819.7368,450.1563,823.7368,446.1563" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="413.5405" x2="825.7368" y1="446.1563" y2="446.1563"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="113.3755" x="420.5405" y="425.9575">GET /Patient/{id}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="196.644" x="420.5405" y="441.0903">Authorization: Bearer {token}</text></g><g class="message" data-participant-1="API" data-participant-2="API"><line style="stroke:#181818;stroke-width:1;" x1="831.7368" x2="873.7368" y1="475.2891" y2="475.2891"/><line style="stroke:#181818;stroke-width:1;" x1="873.7368" x2="873.7368" y1="475.2891" y2="488.2891"/><line style="stroke:#181818;stroke-width:1;" x1="832.7368" x2="873.7368" y1="488.2891" y2="488.2891"/><polygon fill="#181818" points="842.7368,484.2891,832.7368,488.2891,842.7368,492.2891,838.7368,488.2891" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="157.644" x="838.7368" y="470.2231">Validate token &amp; scopes</text></g><g class="message" data-participant-1="API" data-participant-2="DB"><polygon fill="#181818" points="991.3809,513.4219,1001.3809,517.4219,991.3809,521.4219,995.3809,517.4219" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="831.7368" x2="997.3809" y1="517.4219" y2="517.4219"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="123.3159" x="838.7368" y="512.356">Query patient data</text></g><g class="message" data-participant-1="DB" data-participant-2="API"><polygon fill="#181818" points="842.7368,542.5547,832.7368,546.5547,842.7368,550.5547,838.7368,546.5547" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="836.7368" x2="1002.3809" y1="546.5547" y2="546.5547"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="92.022" x="848.7368" y="541.4888">Patient record</text></g><g class="message" data-participant-1="API" data-participant-2="Client"><polygon fill="#181818" points="424.5405,571.6875,414.5405,575.6875,424.5405,579.6875,420.5405,575.6875" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="418.5405" x2="830.7368" y1="575.6875" y2="575.6875"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="141.0322" x="430.5405" y="570.6216">FHIR Patient resource</text></g><g class="message" data-participant-1="Client" data-participant-2="API"><polygon fill="#181818" points="819.7368,600.8203,829.7368,604.8203,819.7368,608.8203,823.7368,604.8203" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="413.5405" x2="825.7368" y1="604.8203" y2="604.8203"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="206.3623" x="420.5405" y="599.7544">GET /Observation?patient={id}</text></g><g class="message" data-participant-1="API" data-participant-2="DB"><polygon fill="#181818" points="991.3809,629.9531,1001.3809,633.9531,991.3809,637.9531,995.3809,633.9531" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="831.7368" x2="997.3809" y1="633.9531" y2="633.9531"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="127.2959" x="838.7368" y="628.8872">Query observations</text></g><g class="message" data-participant-1="DB" data-participant-2="API"><polygon fill="#181818" points="842.7368,659.0859,832.7368,663.0859,842.7368,667.0859,838.7368,663.0859" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="836.7368" x2="1002.3809" y1="663.0859" y2="663.0859"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="132.1074" x="848.7368" y="658.02">Observation records</text></g><g class="message" data-participant-1="API" data-participant-2="Client"><polygon fill="#181818" points="424.5405,688.2188,414.5405,692.2188,424.5405,696.2188,420.5405,692.2188" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="418.5405" x2="830.7368" y1="692.2188" y2="692.2188"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="79.5107" x="430.5405" y="687.1528">FHIR Bundle</text></g><g class="message" data-participant-1="Client" data-participant-2="BL"><polygon fill="#181818" points="222.2983,717.3516,212.2983,721.3516,222.2983,725.3516,218.2983,721.3516" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="216.2983" x2="412.5405" y1="721.3516" y2="721.3516"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="146.1294" x="228.2983" y="716.2856">Parsed FHIR resources</text></g><g class="message" data-participant-1="BL" data-participant-2="UI"><polygon fill="#181818" points="61.1001,746.4844,51.1001,750.4844,61.1001,754.4844,57.1001,750.4844" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="55.1001" x2="210.2983" y1="750.4844" y2="750.4844"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="101.2642" x="67.1001" y="745.4185">Formatted data</text></g><path d="M418,763.4844 L418,848.4844 L608,848.4844 L608,773.4844 L598,763.4844 L418,763.4844" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M598,763.4844 L598,773.4844 L608,773.4844 L598,763.4844" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="167.9336" x="424" y="780.5513">SMART Client Features</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="169.8252" x="424" y="795.6841">• Automatic token refresh</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="126.1279" x="424" y="810.8169">• Request batching</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="129.5557" x="424" y="825.9497">• Response caching</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="137.2173" x="424" y="841.0825">• Error normalization</text></g></svg></div><div class="puml dark" style=""><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="SEQUENCE" height="958px" preserveAspectRatio="xMidYMid meet" style="width:1040px;height:958px;background:#1B1B1B;" version="1.1" viewBox="0 0 1040 958" width="1040px" zoomAndPan="magnify" class="diagram"><title>HALO FHIR Data Access Flow</title><defs/><g><rect fill="#1B1B1B" height="958" style="stroke:none;stroke-width:1;" width="1040" x="0" y="0"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="227.8555" x="407.9629" y="27.9951">HALO FHIR Data Access Flow</text><rect fill="none" height="177.6016" style="stroke:#FFFFFF;stroke-width:1.5;" width="349.4619" x="537.1802" y="225.2891"/><g><title>Patient</title><rect fill="#000000" fill-opacity="0.00000" height="743.2578" width="8" x="46.1001" y="120.8906"/><line style="stroke:#E7E7E7;stroke-width:0.5;stroke-dasharray:5,5;" x1="50" x2="50" y1="120.8906" y2="864.1484"/></g><g><title>Business</title><rect fill="#000000" fill-opacity="0.00000" height="743.2578" width="8" x="207.2983" y="120.8906"/><line style="stroke:#E7E7E7;stroke-width:0.5;stroke-dasharray:5,5;" x1="210.4307" x2="210.4307" y1="120.8906" y2="864.1484"/></g><g><title>HALO SMART</title><rect fill="#000000" fill-opacity="0.00000" height="743.2578" width="8" x="409.5405" y="120.8906"/><line style="stroke:#E7E7E7;stroke-width:0.5;stroke-dasharray:5,5;" x1="413.4424" x2="413.4424" y1="120.8906" y2="864.1484"/></g><g><title>Token</title><rect fill="#000000" fill-opacity="0.00000" height="743.2578" width="8" x="580.8633" y="120.8906"/><line style="stroke:#E7E7E7;stroke-width:0.5;stroke-dasharray:5,5;" x1="584.1802" x2="584.1802" y1="120.8906" y2="864.1484"/></g><g><title>Token</title><rect fill="#000000" fill-opacity="0.00000" height="743.2578" width="8" x="738.4434" y="120.8906"/><line style="stroke:#E7E7E7;stroke-width:0.5;stroke-dasharray:5,5;" x1="742.0552" x2="742.0552" y1="120.8906" y2="864.1484"/></g><g><title>HALO FHIR</title><rect fill="#000000" fill-opacity="0.00000" height="743.2578" width="8" x="827.7368" y="120.8906"/><line style="stroke:#E7E7E7;stroke-width:0.5;stroke-dasharray:5,5;" x1="830.8315" x2="830.8315" y1="120.8906" y2="864.1484"/></g><g><title>HALO</title><rect fill="#000000" fill-opacity="0.00000" height="743.2578" width="8" x="999.3809" y="120.8906"/><line style="stroke:#E7E7E7;stroke-width:0.5;stroke-dasharray:5,5;" x1="1002.9805" x2="1002.9805" y1="120.8906" y2="864.1484"/></g><g class="participant participant-head" data-participant="UI"><rect fill="#222222" height="46.5938" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="90.2002" x="5" y="73.2969"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="49.376" x="25.4121" y="93.292">Patient</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="76.2002" x="12" y="109.5889">Dashboard</text></g><g class="participant participant-tail" data-participant="UI"><rect fill="#222222" height="46.5938" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="90.2002" x="5" y="863.1484"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="49.376" x="25.4121" y="883.1436">Patient</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="76.2002" x="12" y="899.4404">Dashboard</text></g><g class="participant participant-head" data-participant="BL"><rect fill="#222222" height="46.5938" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="75.7354" x="173.4307" y="73.2969"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="61.7354" x="180.4307" y="93.292">Business</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="36.8389" x="192.8789" y="109.5889">Logic</text></g><g class="participant participant-tail" data-participant="BL"><rect fill="#222222" height="46.5938" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="75.7354" x="173.4307" y="863.1484"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="61.7354" x="180.4307" y="883.1436">Business</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="36.8389" x="192.8789" y="899.4404">Logic</text></g><g class="participant participant-head" data-participant="Client"><rect fill="#222222" height="46.5938" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="106.1963" x="360.4424" y="73.2969"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="92.1963" x="367.4424" y="93.292">HALO SMART</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="40.5303" x="393.2754" y="109.5889">Client</text></g><g class="participant participant-tail" data-participant="Client"><rect fill="#222222" height="46.5938" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="106.1963" x="360.4424" y="863.1484"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="92.1963" x="367.4424" y="883.1436">HALO SMART</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="40.5303" x="393.2754" y="899.4404">Client</text></g><g class="participant participant-head" data-participant="TM"><rect fill="#222222" height="46.5938" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="75.3662" x="547.1802" y="73.2969"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="42.7109" x="563.5078" y="93.292">Token</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="61.3662" x="554.1802" y="109.5889">Manager</text></g><g class="participant participant-tail" data-participant="TM"><rect fill="#222222" height="46.5938" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="75.3662" x="547.1802" y="863.1484"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="42.7109" x="563.5078" y="883.1436">Token</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="61.3662" x="554.1802" y="899.4404">Manager</text></g><g class="participant participant-head" data-participant="Storage"><rect fill="#222222" height="46.5938" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="68.7764" x="708.0552" y="73.2969"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="42.7109" x="721.0879" y="93.292">Token</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="54.7764" x="715.0552" y="109.5889">Storage</text></g><g class="participant participant-tail" data-participant="Storage"><rect fill="#222222" height="46.5938" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="68.7764" x="708.0552" y="863.1484"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="42.7109" x="721.0879" y="883.1436">Token</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="54.7764" x="715.0552" y="899.4404">Storage</text></g><g class="participant participant-head" data-participant="API"><rect fill="#222222" height="46.5938" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="89.8105" x="786.8315" y="73.2969"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="75.8105" x="793.8315" y="93.292">HALO FHIR</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="22.1484" x="820.6626" y="109.5889">API</text></g><g class="participant participant-tail" data-participant="API"><rect fill="#222222" height="46.5938" rx="2.5" ry="2.5" style="stroke:#E7E7E7;stroke-width:0.5;" width="89.8105" x="786.8315" y="863.1484"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="75.8105" x="793.8315" y="883.1436">HALO FHIR</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="22.1484" x="820.6626" y="899.4404">API</text></g><g class="participant participant-head" data-participant="DB"><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="38.9238" x="980.9189" y="101.292">HALO</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="66.8008" x="966.9805" y="117.5889">Database</text><path d="M985.3809,52.2969 C985.3809,42.2969 1003.3809,42.2969 1003.3809,42.2969 C1003.3809,42.2969 1021.3809,42.2969 1021.3809,52.2969 L1021.3809,78.2969 C1021.3809,88.2969 1003.3809,88.2969 1003.3809,88.2969 C1003.3809,88.2969 985.3809,88.2969 985.3809,78.2969 L985.3809,52.2969" fill="#222222" style="stroke:#E7E7E7;stroke-width:0.5;"/><path d="M985.3809,52.2969 C985.3809,62.2969 1003.3809,62.2969 1003.3809,62.2969 C1003.3809,62.2969 1021.3809,62.2969 1021.3809,52.2969" fill="none" style="stroke:#E7E7E7;stroke-width:0.5;"/></g><g class="participant participant-tail" data-participant="DB"><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="38.9238" x="980.9189" y="876.1436">HALO</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="66.8008" x="966.9805" y="892.4404">Database</text><path d="M985.3809,905.7422 C985.3809,895.7422 1003.3809,895.7422 1003.3809,895.7422 C1003.3809,895.7422 1021.3809,895.7422 1021.3809,905.7422 L1021.3809,931.7422 C1021.3809,941.7422 1003.3809,941.7422 1003.3809,941.7422 C1003.3809,941.7422 985.3809,941.7422 985.3809,931.7422 L985.3809,905.7422" fill="#222222" style="stroke:#E7E7E7;stroke-width:0.5;"/><path d="M985.3809,905.7422 C985.3809,915.7422 1003.3809,915.7422 1003.3809,915.7422 C1003.3809,915.7422 1021.3809,915.7422 1021.3809,905.7422" fill="none" style="stroke:#E7E7E7;stroke-width:0.5;"/></g><g class="message" data-participant-1="UI" data-participant-2="BL"><polygon fill="#E7E7E7" points="199.2983,148.0234,209.2983,152.0234,199.2983,156.0234,203.2983,152.0234" style="stroke:#E7E7E7;stroke-width:1;"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="50.1001" x2="205.2983" y1="152.0234" y2="152.0234"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="137.1982" x="57.1001" y="146.9575">Request patient data</text></g><g class="message" data-participant-1="BL" data-participant-2="Client"><polygon fill="#E7E7E7" points="401.5405,177.1563,411.5405,181.1563,401.5405,185.1563,405.5405,181.1563" style="stroke:#E7E7E7;stroke-width:1;"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="211.2983" x2="407.5405" y1="181.1563" y2="181.1563"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="178.2422" x="218.2983" y="176.0903">Get Patient + Observations</text></g><g class="message" data-participant-1="Client" data-participant-2="TM"><polygon fill="#E7E7E7" points="572.8633,206.2891,582.8633,210.2891,572.8633,214.2891,576.8633,210.2891" style="stroke:#E7E7E7;stroke-width:1;"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="413.5405" x2="578.8633" y1="210.2891" y2="210.2891"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="147.3228" x="420.5405" y="205.2231">Get valid access token</text></g><path d="M537.1802,225.2891 L601.623,225.2891 L601.623,232.4219 L591.623,242.4219 L537.1802,242.4219 L537.1802,225.2891" fill="#555555" style="stroke:#FFFFFF;stroke-width:1.5;"/><rect fill="none" height="177.6016" style="stroke:#FFFFFF;stroke-width:1.5;" width="349.4619" x="537.1802" y="225.2891"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19.4429" x="552.1802" y="238.356">alt</text><text fill="#FFFFFF" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="81.5601" x="616.623" y="237.4995">[Token valid]</text><g class="message" data-participant-1="TM" data-participant-2="Storage"><polygon fill="#E7E7E7" points="730.4434,259.5547,740.4434,263.5547,730.4434,267.5547,734.4434,263.5547" style="stroke:#E7E7E7;stroke-width:1;"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="584.8633" x2="736.4434" y1="263.5547" y2="263.5547"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="95.7227" x="591.8633" y="258.4888">Retrieve token</text></g><line style="stroke:#FFFFFF;stroke-width:1;stroke-dasharray:2,2;" x1="537.1802" x2="886.6421" y1="272.5547" y2="272.5547"/><text fill="#FFFFFF" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="98.5112" x="542.1802" y="282.7651">[Token expired]</text><g class="message" data-participant-1="TM" data-participant-2="Storage"><polygon fill="#E7E7E7" points="730.4434,303.4922,740.4434,307.4922,730.4434,311.4922,734.4434,307.4922" style="stroke:#E7E7E7;stroke-width:1;"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="584.8633" x2="736.4434" y1="307.4922" y2="307.4922"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="114.5244" x="591.8633" y="302.4263">Get refresh token</text></g><g class="message" data-participant-1="TM" data-participant-2="API"><polygon fill="#E7E7E7" points="819.7368,332.625,829.7368,336.625,819.7368,340.625,823.7368,336.625" style="stroke:#E7E7E7;stroke-width:1;"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="584.8633" x2="825.7368" y1="336.625" y2="336.625"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="138.8486" x="591.8633" y="331.5591">Refresh access token</text></g><g class="message" data-participant-1="API" data-participant-2="TM"><polygon fill="#E7E7E7" points="595.8633,361.7578,585.8633,365.7578,595.8633,369.7578,591.8633,365.7578" style="stroke:#E7E7E7;stroke-width:1;"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="589.8633" x2="830.7368" y1="365.7578" y2="365.7578"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="117.2412" x="601.8633" y="360.6919">New access token</text></g><g class="message" data-participant-1="TM" data-participant-2="Storage"><polygon fill="#E7E7E7" points="730.4434,390.8906,740.4434,394.8906,730.4434,398.8906,734.4434,394.8906" style="stroke:#E7E7E7;stroke-width:1;"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="584.8633" x2="736.4434" y1="394.8906" y2="394.8906"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="133.5801" x="591.8633" y="389.8247">Update stored token</text></g><g class="message" data-participant-1="Client" data-participant-2="API"><polygon fill="#E7E7E7" points="819.7368,442.1563,829.7368,446.1563,819.7368,450.1563,823.7368,446.1563" style="stroke:#E7E7E7;stroke-width:1;"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="413.5405" x2="825.7368" y1="446.1563" y2="446.1563"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="113.3755" x="420.5405" y="425.9575">GET /Patient/{id}</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="196.644" x="420.5405" y="441.0903">Authorization: Bearer {token}</text></g><g class="message" data-participant-1="API" data-participant-2="API"><line style="stroke:#E7E7E7;stroke-width:1;" x1="831.7368" x2="873.7368" y1="475.2891" y2="475.2891"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="873.7368" x2="873.7368" y1="475.2891" y2="488.2891"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="832.7368" x2="873.7368" y1="488.2891" y2="488.2891"/><polygon fill="#E7E7E7" points="842.7368,484.2891,832.7368,488.2891,842.7368,492.2891,838.7368,488.2891" style="stroke:#E7E7E7;stroke-width:1;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="157.644" x="838.7368" y="470.2231">Validate token &amp; scopes</text></g><g class="message" data-participant-1="API" data-participant-2="DB"><polygon fill="#E7E7E7" points="991.3809,513.4219,1001.3809,517.4219,991.3809,521.4219,995.3809,517.4219" style="stroke:#E7E7E7;stroke-width:1;"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="831.7368" x2="997.3809" y1="517.4219" y2="517.4219"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="123.3159" x="838.7368" y="512.356">Query patient data</text></g><g class="message" data-participant-1="DB" data-participant-2="API"><polygon fill="#E7E7E7" points="842.7368,542.5547,832.7368,546.5547,842.7368,550.5547,838.7368,546.5547" style="stroke:#E7E7E7;stroke-width:1;"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="836.7368" x2="1002.3809" y1="546.5547" y2="546.5547"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="92.022" x="848.7368" y="541.4888">Patient record</text></g><g class="message" data-participant-1="API" data-participant-2="Client"><polygon fill="#E7E7E7" points="424.5405,571.6875,414.5405,575.6875,424.5405,579.6875,420.5405,575.6875" style="stroke:#E7E7E7;stroke-width:1;"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="418.5405" x2="830.7368" y1="575.6875" y2="575.6875"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="141.0322" x="430.5405" y="570.6216">FHIR Patient resource</text></g><g class="message" data-participant-1="Client" data-participant-2="API"><polygon fill="#E7E7E7" points="819.7368,600.8203,829.7368,604.8203,819.7368,608.8203,823.7368,604.8203" style="stroke:#E7E7E7;stroke-width:1;"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="413.5405" x2="825.7368" y1="604.8203" y2="604.8203"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="206.3623" x="420.5405" y="599.7544">GET /Observation?patient={id}</text></g><g class="message" data-participant-1="API" data-participant-2="DB"><polygon fill="#E7E7E7" points="991.3809,629.9531,1001.3809,633.9531,991.3809,637.9531,995.3809,633.9531" style="stroke:#E7E7E7;stroke-width:1;"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="831.7368" x2="997.3809" y1="633.9531" y2="633.9531"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="127.2959" x="838.7368" y="628.8872">Query observations</text></g><g class="message" data-participant-1="DB" data-participant-2="API"><polygon fill="#E7E7E7" points="842.7368,659.0859,832.7368,663.0859,842.7368,667.0859,838.7368,663.0859" style="stroke:#E7E7E7;stroke-width:1;"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="836.7368" x2="1002.3809" y1="663.0859" y2="663.0859"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="132.1074" x="848.7368" y="658.02">Observation records</text></g><g class="message" data-participant-1="API" data-participant-2="Client"><polygon fill="#E7E7E7" points="424.5405,688.2188,414.5405,692.2188,424.5405,696.2188,420.5405,692.2188" style="stroke:#E7E7E7;stroke-width:1;"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="418.5405" x2="830.7368" y1="692.2188" y2="692.2188"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="79.5107" x="430.5405" y="687.1528">FHIR Bundle</text></g><g class="message" data-participant-1="Client" data-participant-2="BL"><polygon fill="#E7E7E7" points="222.2983,717.3516,212.2983,721.3516,222.2983,725.3516,218.2983,721.3516" style="stroke:#E7E7E7;stroke-width:1;"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="216.2983" x2="412.5405" y1="721.3516" y2="721.3516"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="146.1294" x="228.2983" y="716.2856">Parsed FHIR resources</text></g><g class="message" data-participant-1="BL" data-participant-2="UI"><polygon fill="#E7E7E7" points="61.1001,746.4844,51.1001,750.4844,61.1001,754.4844,57.1001,750.4844" style="stroke:#E7E7E7;stroke-width:1;"/><line style="stroke:#E7E7E7;stroke-width:1;" x1="55.1001" x2="210.2983" y1="750.4844" y2="750.4844"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="101.2642" x="67.1001" y="745.4185">Formatted data</text></g><path d="M418,763.4844 L418,848.4844 L608,848.4844 L608,773.4844 L598,763.4844 L418,763.4844" fill="#714137" style="stroke:#E7E7E7;stroke-width:0.5;"/><path d="M598,763.4844 L598,773.4844 L608,773.4844 L598,763.4844" fill="#714137" style="stroke:#E7E7E7;stroke-width:0.5;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="167.9336" x="424" y="780.5513">SMART Client Features</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="169.8252" x="424" y="795.6841">• Automatic token refresh</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="126.1279" x="424" y="810.8169">• Request batching</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="129.5557" x="424" y="825.9497">• Response caching</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="137.2173" x="424" y="841.0825">• Error normalization</text></g></svg></div></div>
<h2 id="security-best-practices">Security Best Practices</h2>
<div class="puml-container"><div class="puml light" style=""><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="DESCRIPTION" height="434px" preserveAspectRatio="xMidYMid meet" style="width:1853px;height:434px;background:#FFFFFF;" version="1.1" viewBox="0 0 1853 434" width="1853px" zoomAndPan="magnify" class="diagram"><title>SMART-on-FHIR Security Best Practices</title><defs/><g><g class="title" data-source-line="3"><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="311.3633" x="763.8184" y="22.9951">SMART-on-FHIR Security Best Practices</text></g><g class="cluster" data-entity="Client Security" data-source-line="5" data-uid="ent0002" id="cluster_Client Security"><path d="M8.5,166.0869 L125.7656,166.0869 A3.75,3.75 0 0 1 128.2656,168.5869 L135.2656,188.3838 L1484.5,188.3838 A2.5,2.5 0 0 1 1487,190.8838 L1487,285.1169 A2.5,2.5 0 0 1 1484.5,287.6169 L8.5,287.6169 A2.5,2.5 0 0 1 6,285.1169 L6,168.5869 A2.5,2.5 0 0 1 8.5,166.0869" fill="none" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="6" x2="135.2656" y1="188.3838" y2="188.3838"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="116.2656" x="10" y="181.082">Client Security</text></g><g class="cluster" data-entity="Server Security" data-source-line="26" data-uid="ent0015" id="cluster_Server Security"><path d="M183.5,336.6169 L306.7471,336.6169 A3.75,3.75 0 0 1 309.2471,339.1169 L316.2471,358.9138 L1104.5,358.9138 A2.5,2.5 0 0 1 1107,361.4138 L1107,425.1169 A2.5,2.5 0 0 1 1104.5,427.6169 L183.5,427.6169 A2.5,2.5 0 0 1 181,425.1169 L181,339.1169 A2.5,2.5 0 0 1 183.5,336.6169" fill="none" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="181" x2="316.2471" y1="358.9138" y2="358.9138"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="122.2471" x="185" y="351.612">Server Security</text></g><g class="cluster" data-entity="Network Security" data-source-line="34" data-uid="ent0021" id="cluster_Network Security"><path d="M1348.5,338.3669 L1486.4102,338.3669 A3.75,3.75 0 0 1 1488.9102,340.8669 L1495.9102,360.6638 L1843.5,360.6638 A2.5,2.5 0 0 1 1846,363.1638 L1846,423.3669 A2.5,2.5 0 0 1 1843.5,425.8669 L1348.5,425.8669 A2.5,2.5 0 0 1 1346,423.3669 L1346,340.8669 A2.5,2.5 0 0 1 1348.5,338.3669" fill="none" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="1346" x2="1495.9102" y1="360.6638" y2="360.6638"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="136.9102" x="1350" y="353.362">Network Security</text></g><g class="entity" data-entity="UC1" data-source-line="6" data-uid="ent0003" id="entity_UC1"><ellipse cx="240.9991" cy="236.3605" fill="#F1F1F1" rx="50.2691" ry="14.5236" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="66.8486" x="207.5748" y="241.0089">Use PKCE</text></g><g class="entity" data-entity="UC2" data-source-line="7" data-uid="ent0004" id="entity_UC2"><ellipse cx="88.9952" cy="236.3599" fill="#F1F1F1" rx="67.1152" ry="15.823" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="99.0117" x="39.4893" y="241.0083">Validate State</text></g><g class="entity" data-entity="UC3" data-source-line="8" data-uid="ent0005" id="entity_UC3"><ellipse cx="648.0002" cy="236.3529" fill="#F1F1F1" rx="90.4802" ry="20.496" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="154.8271" x="570.5866" y="241.0014">Secure Token Storage</text></g><g class="entity" data-entity="UC4" data-source-line="9" data-uid="ent0006" id="entity_UC4"><ellipse cx="1410.0033" cy="236.3605" fill="#F1F1F1" rx="60.6133" ry="14.5236" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="81.4775" x="1369.2646" y="241.0089">HTTPS Only</text></g><g class="entity" data-entity="UC5" data-source-line="10" data-uid="ent0007" id="entity_UC5"><ellipse cx="1243.0037" cy="236.3616" fill="#F1F1F1" rx="71.1737" ry="16.6347" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="109.3203" x="1188.3436" y="241.0101">Minimize Scope</text></g><g class="entity" data-entity="UC6" data-source-line="11" data-uid="ent0008" id="entity_UC6"><ellipse cx="1067.0048" cy="236.3538" fill="#F1F1F1" rx="69.9848" ry="16.397" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="106.3398" x="1013.8349" y="241.0023">Token Rotation</text></g><g class="entity" data-entity="GMN9" data-source-line="14" data-uid="ent0010" id="entity_GMN9"><path d="M325.91,216.2169 L325.91,232.3569 L291.75,236.3569 L325.91,240.3569 L325.91,256.4825 A0,0 0 0 0 325.91,256.4825 L522.099,256.4825 A0,0 0 0 0 522.099,256.4825 L522.099,226.2169 L512.099,216.2169 L325.91,216.2169 A0,0 0 0 0 325.91,216.2169" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M512.099,216.2169 L512.099,226.2169 L522.099,226.2169 L512.099,216.2169" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="170.5933" x="331.91" y="233.2838">Required for public clients</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="175.189" x="331.91" y="248.4166">Prevents code interception</text></g><g class="entity" data-entity="GMN12" data-source-line="19" data-uid="ent0013" id="entity_GMN12"><path d="M773.9,201.0869 L773.9,232.3569 L738.66,236.3569 L773.9,240.3569 L773.9,271.6181 A0,0 0 0 0 773.9,271.6181 L962.11,271.6181 A0,0 0 0 0 962.11,271.6181 L962.11,211.0869 L952.11,201.0869 L773.9,201.0869 A0,0 0 0 0 773.9,201.0869" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M952.11,201.0869 L952.11,211.0869 L962.11,211.0869 L952.11,201.0869" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="103.2383" x="779.9" y="218.1538">• Never in URLs</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="167.21" x="779.9" y="233.2866">• Use httpOnly cookies or</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="97.0176" x="788.1646" y="248.4194">secure storage</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="108.3291" x="779.9" y="263.5522">• Encrypt at rest</text></g><g class="entity" data-entity="SV1" data-source-line="27" data-uid="ent0016" id="entity_SV1"><ellipse cx="285.002" cy="391.6153" fill="#F1F1F1" rx="87.992" ry="19.9984" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="149.1807" x="210.4117" y="396.2637">Validate Redirect URI</text></g><g class="entity" data-entity="SV2" data-source-line="28" data-uid="ent0017" id="entity_SV2"><ellipse cx="473.0046" cy="391.6178" fill="#F1F1F1" rx="64.9046" ry="15.3809" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="93.2148" x="426.3972" y="396.2662">Rate Limiting</text></g><g class="entity" data-entity="SV3" data-source-line="29" data-uid="ent0018" id="entity_SV3"><ellipse cx="648.0011" cy="391.6151" fill="#F1F1F1" rx="74.7911" ry="17.3582" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="118.2207" x="588.8907" y="396.2635">Token Expiration</text></g><g class="entity" data-entity="SV4" data-source-line="30" data-uid="ent0019" id="entity_SV4"><ellipse cx="824.0042" cy="391.6217" fill="#F1F1F1" rx="66.3242" ry="15.6648" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="96.9541" x="775.5271" y="396.2701">Audit Logging</text></g><g class="entity" data-entity="SV5" data-source-line="31" data-uid="ent0020" id="entity_SV5"><ellipse cx="1007.9972" cy="391.6163" fill="#F1F1F1" rx="82.6972" ry="18.9394" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="136.9922" x="939.5011" y="396.2647">Scope Enforcement</text></g><g class="entity" data-entity="NS1" data-source-line="35" data-uid="ent0022" id="entity_NS1"><ellipse cx="1410.0011" cy="391.6205" fill="#F1F1F1" rx="48.0311" ry="14.5236" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="63.6836" x="1378.1593" y="396.2689">TLS 1.2+</text></g><g class="entity" data-entity="NS2" data-source-line="36" data-uid="ent0023" id="entity_NS2"><ellipse cx="1571.9971" cy="391.6163" fill="#F1F1F1" rx="79.2471" ry="18.2494" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="128.8984" x="1507.5479" y="396.2647">Certificate Pinning</text></g><g class="entity" data-entity="NS3" data-source-line="37" data-uid="ent0024" id="entity_NS3"><ellipse cx="1757.9967" cy="391.6202" fill="#F1F1F1" rx="71.8167" ry="16.7633" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="110.9199" x="1702.5367" y="396.2686">Input Validation</text></g><g class="entity" data-entity="Dev" data-source-line="40" data-uid="ent0025" id="entity_Dev"><ellipse cx="740.0015" cy="51.2969" fill="#F1F1F1" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M740.0015,59.2969 L740.0015,86.2969 M727.0015,67.2969 L753.0015,67.2969 M740.0015,86.2969 L727.0015,101.2969 M740.0015,86.2969 L753.0015,101.2969" fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="72.0029" x="704" y="115.792">Developer</text></g><g class="link" data-entity-1="Dev" data-entity-2="UC1" data-source-line="42" data-uid="lnk26" id="link_Dev_UC1"><path d="M703.55,88.4069 C635.07,100.5469 482.53,127.5669 354,150.0869 C333.56,153.6669 326.07,147.8769 308,158.0869 C280.95,173.3769 262.6904,198.7421 251.8704,216.5121" fill="none" id="Dev-to-UC1" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="248.75,221.6369,256.8471,216.03,251.3503,217.3663,250.0141,211.8695,248.75,221.6369" style="stroke:#181818;stroke-width:1;"/></g><g class="link" data-entity-1="Dev" data-entity-2="UC2" data-source-line="43" data-uid="lnk27" id="link_Dev_UC2"><path d="M703.57,83.9769 C593.84,90.5569 268.2,113.4369 173,158.0869 C142.14,172.5569 118.6021,197.8009 104.0021,215.8609" fill="none" id="Dev-to-UC2" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="100.23,220.5269,108.9988,216.0426,103.3734,216.6385,102.7774,211.0132,100.23,220.5269" style="stroke:#181818;stroke-width:1;"/></g><g class="link" data-entity-1="Dev" data-entity-2="UC3" data-source-line="44" data-uid="lnk28" id="link_Dev_UC3"><path d="M717.49,119.4669 C699.3,149.8069 677.4957,186.1712 662.9657,210.4012" fill="none" id="Dev-to-UC3" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="659.88,215.5469,667.9391,209.8855,662.4514,211.2588,661.0781,205.7712,659.88,215.5469" style="stroke:#181818;stroke-width:1;"/></g><g class="link" data-entity-1="Dev" data-entity-2="UC4" data-source-line="45" data-uid="lnk29" id="link_Dev_UC4"><path d="M776.5,83.5869 C889.67,89.1569 1232.95,109.7169 1332,158.0869 C1362.14,172.8069 1384.184,198.9522 1397.214,216.8922" fill="none" id="Dev-to-UC4" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="1400.74,221.7469,1398.6875,212.1143,1397.8017,217.7013,1392.2146,216.8156,1400.74,221.7469" style="stroke:#181818;stroke-width:1;"/></g><g class="link" data-entity-1="Dev" data-entity-2="UC5" data-source-line="46" data-uid="lnk30" id="link_Dev_UC5"><path d="M776.29,82.2969 C850.82,84.3469 1024.92,95.9869 1154,158.0869 C1184.98,172.9969 1209.6297,197.135 1225.6597,215.055" fill="none" id="Dev-to-UC5" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="1229.66,219.5269,1226.6409,210.1522,1226.3265,215.8003,1220.6783,215.4859,1229.66,219.5269" style="stroke:#181818;stroke-width:1;"/></g><g class="link" data-entity-1="Dev" data-entity-2="UC6" data-source-line="47" data-uid="lnk31" id="link_Dev_UC6"><path d="M776.48,88.5469 C825.26,98.4669 913.3,120.1869 980,158.0869 C1009.33,174.7569 1033.3514,198.1471 1049.3314,215.4671" fill="none" id="Dev-to-UC6" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="1053.4,219.8769,1050.2369,210.5498,1050.0095,216.202,1044.3572,215.9746,1053.4,219.8769" style="stroke:#181818;stroke-width:1;"/></g><g class="link" data-entity-1="UC1" data-entity-2="SV1" data-source-line="49" data-uid="lnk32" id="link_UC1_SV1"><path d="M244.98,251.2269 C252.85,278.6369 268.7534,334.0301 277.7734,365.4301" fill="none" id="UC1-to-SV1" style="stroke:#181818;stroke-width:1;stroke-dasharray:7,7;"/><polygon fill="#181818" points="279.43,371.1969,280.7897,361.4423,278.0495,366.3912,273.1006,363.6511,279.43,371.1969" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="70.3638" x="265.32" y="316.6838">Verified by</text></g><g class="link" data-entity-1="UC2" data-entity-2="SV1" data-source-line="50" data-uid="lnk33" id="link_UC2_SV1"><path d="M98.4,252.3869 C110.18,270.3269 131.78,300.4169 156,320.6169 C182.61,342.8169 211.9128,358.6712 238.6328,371.0112" fill="none" id="UC2-to-SV1" style="stroke:#181818;stroke-width:1;stroke-dasharray:7,7;"/><polygon fill="#181818" points="244.08,373.5269,237.5864,366.122,239.5407,371.4305,234.2322,373.3849,244.08,373.5269" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="94.9546" x="157" y="316.6838">Prevents CSRF</text></g><g class="link" data-entity-1="UC3" data-entity-2="SV3" data-source-line="51" data-uid="lnk34" id="link_UC3_SV3"><path d="M648,257.0769 C648,287.4769 648,339.2469 648,367.7969" fill="none" id="UC3-to-SV3" style="stroke:#181818;stroke-width:1;stroke-dasharray:7,7;"/><polygon fill="#181818" points="648,373.7969,652,364.7969,648,368.7969,644,364.7969,648,373.7969" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="118.4663" x="649" y="316.6838">Short-lived tokens</text></g><g class="link" data-entity-1="UC4" data-entity-2="NS1" data-source-line="52" data-uid="lnk35" id="link_UC4_NS1"><path d="M1410,251.2269 C1410,280.4069 1410,341.8369 1410,370.8869" fill="none" id="UC4-to-NS1" style="stroke:#181818;stroke-width:1;stroke-dasharray:7,7;"/><polygon fill="#181818" points="1410,376.8869,1414,367.8869,1410,371.8869,1406,367.8869,1410,376.8869" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="118.9487" x="1411" y="316.6838">Transport security</text></g><g class="link" data-entity-1="UC5" data-entity-2="SV5" data-source-line="53" data-uid="lnk36" id="link_UC5_SV5"><path d="M1219.96,252.4669 C1202,264.2369 1176.43,280.9869 1154,295.6169 C1112.34,322.8069 1068.9708,351.0072 1039.6908,370.0372" fill="none" id="UC5-to-SV5" style="stroke:#181818;stroke-width:1;stroke-dasharray:7,7;"/><polygon fill="#181818" points="1034.66,373.3069,1044.386,371.7562,1038.8523,370.5821,1040.0264,365.0485,1034.66,373.3069" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="95.583" x="1139.18" y="316.6838">Least privilege</text></g><g class="link" data-entity-1="UC6" data-entity-2="SV3" data-source-line="54" data-uid="lnk37" id="link_UC6_SV3"><path d="M1049.68,252.4669 C1033.01,266.1069 1006.51,285.5369 980,295.6169 C954.84,305.1869 765.15,319.0169 740,328.6169 C711.93,339.3369 688.5393,356.1999 670.9293,370.7199" fill="none" id="UC6-to-SV3" style="stroke:#181818;stroke-width:1;stroke-dasharray:7,7;"/><polygon fill="#181818" points="666.3,374.5369,675.7886,371.8976,670.1578,371.356,670.6993,365.7252,666.3,374.5369" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="97.6841" x="933.79" y="316.6838">Refresh tokens</text></g></g></svg></div><div class="puml dark" style=""><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="DESCRIPTION" height="434px" preserveAspectRatio="xMidYMid meet" style="width:1853px;height:434px;background:#1B1B1B;" version="1.1" viewBox="0 0 1853 434" width="1853px" zoomAndPan="magnify" class="diagram"><title>SMART-on-FHIR Security Best Practices</title><defs/><g><rect fill="#1B1B1B" height="434" style="stroke:none;stroke-width:1;" width="1853" x="0" y="0"/><g class="title" data-source-line="3"><text fill="#FFFFFF" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="311.3633" x="763.8184" y="22.9951">SMART-on-FHIR Security Best Practices</text></g><g class="cluster" data-entity="Client Security" data-source-line="5" data-uid="ent0002" id="cluster_Client Security"><path d="M8.5,166.0869 L125.7656,166.0869 A3.75,3.75 0 0 1 128.2656,168.5869 L135.2656,188.3838 L1484.5,188.3838 A2.5,2.5 0 0 1 1487,190.8838 L1487,285.1169 A2.5,2.5 0 0 1 1484.5,287.6169 L8.5,287.6169 A2.5,2.5 0 0 1 6,285.1169 L6,168.5869 A2.5,2.5 0 0 1 8.5,166.0869" fill="none" style="stroke:#FFFFFF;stroke-width:1.5;"/><line style="stroke:#FFFFFF;stroke-width:1.5;" x1="6" x2="135.2656" y1="188.3838" y2="188.3838"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="116.2656" x="10" y="181.082">Client Security</text></g><g class="cluster" data-entity="Server Security" data-source-line="26" data-uid="ent0015" id="cluster_Server Security"><path d="M183.5,336.6169 L306.7471,336.6169 A3.75,3.75 0 0 1 309.2471,339.1169 L316.2471,358.9138 L1104.5,358.9138 A2.5,2.5 0 0 1 1107,361.4138 L1107,425.1169 A2.5,2.5 0 0 1 1104.5,427.6169 L183.5,427.6169 A2.5,2.5 0 0 1 181,425.1169 L181,339.1169 A2.5,2.5 0 0 1 183.5,336.6169" fill="none" style="stroke:#FFFFFF;stroke-width:1.5;"/><line style="stroke:#FFFFFF;stroke-width:1.5;" x1="181" x2="316.2471" y1="358.9138" y2="358.9138"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="122.2471" x="185" y="351.612">Server Security</text></g><g class="cluster" data-entity="Network Security" data-source-line="34" data-uid="ent0021" id="cluster_Network Security"><path d="M1348.5,338.3669 L1486.4102,338.3669 A3.75,3.75 0 0 1 1488.9102,340.8669 L1495.9102,360.6638 L1843.5,360.6638 A2.5,2.5 0 0 1 1846,363.1638 L1846,423.3669 A2.5,2.5 0 0 1 1843.5,425.8669 L1348.5,425.8669 A2.5,2.5 0 0 1 1346,423.3669 L1346,340.8669 A2.5,2.5 0 0 1 1348.5,338.3669" fill="none" style="stroke:#FFFFFF;stroke-width:1.5;"/><line style="stroke:#FFFFFF;stroke-width:1.5;" x1="1346" x2="1495.9102" y1="360.6638" y2="360.6638"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="136.9102" x="1350" y="353.362">Network Security</text></g><g class="entity" data-entity="UC1" data-source-line="6" data-uid="ent0003" id="entity_UC1"><ellipse cx="240.9991" cy="236.3605" fill="#313139" rx="50.2691" ry="14.5236" style="stroke:#E7E7E7;stroke-width:0.5;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="66.8486" x="207.5748" y="241.0089">Use PKCE</text></g><g class="entity" data-entity="UC2" data-source-line="7" data-uid="ent0004" id="entity_UC2"><ellipse cx="88.9952" cy="236.3599" fill="#313139" rx="67.1152" ry="15.823" style="stroke:#E7E7E7;stroke-width:0.5;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="99.0117" x="39.4893" y="241.0083">Validate State</text></g><g class="entity" data-entity="UC3" data-source-line="8" data-uid="ent0005" id="entity_UC3"><ellipse cx="648.0002" cy="236.3529" fill="#313139" rx="90.4802" ry="20.496" style="stroke:#E7E7E7;stroke-width:0.5;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="154.8271" x="570.5866" y="241.0014">Secure Token Storage</text></g><g class="entity" data-entity="UC4" data-source-line="9" data-uid="ent0006" id="entity_UC4"><ellipse cx="1410.0033" cy="236.3605" fill="#313139" rx="60.6133" ry="14.5236" style="stroke:#E7E7E7;stroke-width:0.5;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="81.4775" x="1369.2646" y="241.0089">HTTPS Only</text></g><g class="entity" data-entity="UC5" data-source-line="10" data-uid="ent0007" id="entity_UC5"><ellipse cx="1243.0037" cy="236.3616" fill="#313139" rx="71.1737" ry="16.6347" style="stroke:#E7E7E7;stroke-width:0.5;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="109.3203" x="1188.3436" y="241.0101">Minimize Scope</text></g><g class="entity" data-entity="UC6" data-source-line="11" data-uid="ent0008" id="entity_UC6"><ellipse cx="1067.0048" cy="236.3538" fill="#313139" rx="69.9848" ry="16.397" style="stroke:#E7E7E7;stroke-width:0.5;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="106.3398" x="1013.8349" y="241.0023">Token Rotation</text></g><g class="entity" data-entity="GMN9" data-source-line="14" data-uid="ent0010" id="entity_GMN9"><path d="M325.91,216.2169 L325.91,232.3569 L291.75,236.3569 L325.91,240.3569 L325.91,256.4825 A0,0 0 0 0 325.91,256.4825 L522.099,256.4825 A0,0 0 0 0 522.099,256.4825 L522.099,226.2169 L512.099,216.2169 L325.91,216.2169 A0,0 0 0 0 325.91,216.2169" fill="#714137" style="stroke:#E7E7E7;stroke-width:0.5;"/><path d="M512.099,216.2169 L512.099,226.2169 L522.099,226.2169 L512.099,216.2169" fill="#714137" style="stroke:#E7E7E7;stroke-width:0.5;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="170.5933" x="331.91" y="233.2838">Required for public clients</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="175.189" x="331.91" y="248.4166">Prevents code interception</text></g><g class="entity" data-entity="GMN12" data-source-line="19" data-uid="ent0013" id="entity_GMN12"><path d="M773.9,201.0869 L773.9,232.3569 L738.66,236.3569 L773.9,240.3569 L773.9,271.6181 A0,0 0 0 0 773.9,271.6181 L962.11,271.6181 A0,0 0 0 0 962.11,271.6181 L962.11,211.0869 L952.11,201.0869 L773.9,201.0869 A0,0 0 0 0 773.9,201.0869" fill="#714137" style="stroke:#E7E7E7;stroke-width:0.5;"/><path d="M952.11,201.0869 L952.11,211.0869 L962.11,211.0869 L952.11,201.0869" fill="#714137" style="stroke:#E7E7E7;stroke-width:0.5;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="103.2383" x="779.9" y="218.1538">• Never in URLs</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="167.21" x="779.9" y="233.2866">• Use httpOnly cookies or</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="97.0176" x="788.1646" y="248.4194">secure storage</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="108.3291" x="779.9" y="263.5522">• Encrypt at rest</text></g><g class="entity" data-entity="SV1" data-source-line="27" data-uid="ent0016" id="entity_SV1"><ellipse cx="285.002" cy="391.6153" fill="#313139" rx="87.992" ry="19.9984" style="stroke:#E7E7E7;stroke-width:0.5;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="149.1807" x="210.4117" y="396.2637">Validate Redirect URI</text></g><g class="entity" data-entity="SV2" data-source-line="28" data-uid="ent0017" id="entity_SV2"><ellipse cx="473.0046" cy="391.6178" fill="#313139" rx="64.9046" ry="15.3809" style="stroke:#E7E7E7;stroke-width:0.5;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="93.2148" x="426.3972" y="396.2662">Rate Limiting</text></g><g class="entity" data-entity="SV3" data-source-line="29" data-uid="ent0018" id="entity_SV3"><ellipse cx="648.0011" cy="391.6151" fill="#313139" rx="74.7911" ry="17.3582" style="stroke:#E7E7E7;stroke-width:0.5;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="118.2207" x="588.8907" y="396.2635">Token Expiration</text></g><g class="entity" data-entity="SV4" data-source-line="30" data-uid="ent0019" id="entity_SV4"><ellipse cx="824.0042" cy="391.6217" fill="#313139" rx="66.3242" ry="15.6648" style="stroke:#E7E7E7;stroke-width:0.5;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="96.9541" x="775.5271" y="396.2701">Audit Logging</text></g><g class="entity" data-entity="SV5" data-source-line="31" data-uid="ent0020" id="entity_SV5"><ellipse cx="1007.9972" cy="391.6163" fill="#313139" rx="82.6972" ry="18.9394" style="stroke:#E7E7E7;stroke-width:0.5;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="136.9922" x="939.5011" y="396.2647">Scope Enforcement</text></g><g class="entity" data-entity="NS1" data-source-line="35" data-uid="ent0022" id="entity_NS1"><ellipse cx="1410.0011" cy="391.6205" fill="#313139" rx="48.0311" ry="14.5236" style="stroke:#E7E7E7;stroke-width:0.5;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="63.6836" x="1378.1593" y="396.2689">TLS 1.2+</text></g><g class="entity" data-entity="NS2" data-source-line="36" data-uid="ent0023" id="entity_NS2"><ellipse cx="1571.9971" cy="391.6163" fill="#313139" rx="79.2471" ry="18.2494" style="stroke:#E7E7E7;stroke-width:0.5;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="128.8984" x="1507.5479" y="396.2647">Certificate Pinning</text></g><g class="entity" data-entity="NS3" data-source-line="37" data-uid="ent0024" id="entity_NS3"><ellipse cx="1757.9967" cy="391.6202" fill="#313139" rx="71.8167" ry="16.7633" style="stroke:#E7E7E7;stroke-width:0.5;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="110.9199" x="1702.5367" y="396.2686">Input Validation</text></g><g class="entity" data-entity="Dev" data-source-line="40" data-uid="ent0025" id="entity_Dev"><ellipse cx="740.0015" cy="51.2969" fill="#313139" rx="8" ry="8" style="stroke:#E7E7E7;stroke-width:0.5;"/><path d="M740.0015,59.2969 L740.0015,86.2969 M727.0015,67.2969 L753.0015,67.2969 M740.0015,86.2969 L727.0015,101.2969 M740.0015,86.2969 L753.0015,101.2969" fill="none" style="stroke:#E7E7E7;stroke-width:0.5;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="72.0029" x="704" y="115.792">Developer</text></g><g class="link" data-entity-1="Dev" data-entity-2="UC1" data-source-line="42" data-uid="lnk26" id="link_Dev_UC1"><path d="M703.55,88.4069 C635.07,100.5469 482.53,127.5669 354,150.0869 C333.56,153.6669 326.07,147.8769 308,158.0869 C280.95,173.3769 262.6904,198.7421 251.8704,216.5121" fill="none" id="Dev-to-UC1" style="stroke:#E7E7E7;stroke-width:1;"/><polygon fill="#E7E7E7" points="248.75,221.6369,256.8471,216.03,251.3503,217.3663,250.0141,211.8695,248.75,221.6369" style="stroke:#E7E7E7;stroke-width:1;"/></g><g class="link" data-entity-1="Dev" data-entity-2="UC2" data-source-line="43" data-uid="lnk27" id="link_Dev_UC2"><path d="M703.57,83.9769 C593.84,90.5569 268.2,113.4369 173,158.0869 C142.14,172.5569 118.6021,197.8009 104.0021,215.8609" fill="none" id="Dev-to-UC2" style="stroke:#E7E7E7;stroke-width:1;"/><polygon fill="#E7E7E7" points="100.23,220.5269,108.9988,216.0426,103.3734,216.6385,102.7774,211.0132,100.23,220.5269" style="stroke:#E7E7E7;stroke-width:1;"/></g><g class="link" data-entity-1="Dev" data-entity-2="UC3" data-source-line="44" data-uid="lnk28" id="link_Dev_UC3"><path d="M717.49,119.4669 C699.3,149.8069 677.4957,186.1712 662.9657,210.4012" fill="none" id="Dev-to-UC3" style="stroke:#E7E7E7;stroke-width:1;"/><polygon fill="#E7E7E7" points="659.88,215.5469,667.9391,209.8855,662.4514,211.2588,661.0781,205.7712,659.88,215.5469" style="stroke:#E7E7E7;stroke-width:1;"/></g><g class="link" data-entity-1="Dev" data-entity-2="UC4" data-source-line="45" data-uid="lnk29" id="link_Dev_UC4"><path d="M776.5,83.5869 C889.67,89.1569 1232.95,109.7169 1332,158.0869 C1362.14,172.8069 1384.184,198.9522 1397.214,216.8922" fill="none" id="Dev-to-UC4" style="stroke:#E7E7E7;stroke-width:1;"/><polygon fill="#E7E7E7" points="1400.74,221.7469,1398.6875,212.1143,1397.8017,217.7013,1392.2146,216.8156,1400.74,221.7469" style="stroke:#E7E7E7;stroke-width:1;"/></g><g class="link" data-entity-1="Dev" data-entity-2="UC5" data-source-line="46" data-uid="lnk30" id="link_Dev_UC5"><path d="M776.29,82.2969 C850.82,84.3469 1024.92,95.9869 1154,158.0869 C1184.98,172.9969 1209.6297,197.135 1225.6597,215.055" fill="none" id="Dev-to-UC5" style="stroke:#E7E7E7;stroke-width:1;"/><polygon fill="#E7E7E7" points="1229.66,219.5269,1226.6409,210.1522,1226.3265,215.8003,1220.6783,215.4859,1229.66,219.5269" style="stroke:#E7E7E7;stroke-width:1;"/></g><g class="link" data-entity-1="Dev" data-entity-2="UC6" data-source-line="47" data-uid="lnk31" id="link_Dev_UC6"><path d="M776.48,88.5469 C825.26,98.4669 913.3,120.1869 980,158.0869 C1009.33,174.7569 1033.3514,198.1471 1049.3314,215.4671" fill="none" id="Dev-to-UC6" style="stroke:#E7E7E7;stroke-width:1;"/><polygon fill="#E7E7E7" points="1053.4,219.8769,1050.2369,210.5498,1050.0095,216.202,1044.3572,215.9746,1053.4,219.8769" style="stroke:#E7E7E7;stroke-width:1;"/></g><g class="link" data-entity-1="UC1" data-entity-2="SV1" data-source-line="49" data-uid="lnk32" id="link_UC1_SV1"><path d="M244.98,251.2269 C252.85,278.6369 268.7534,334.0301 277.7734,365.4301" fill="none" id="UC1-to-SV1" style="stroke:#E7E7E7;stroke-width:1;stroke-dasharray:7,7;"/><polygon fill="#E7E7E7" points="279.43,371.1969,280.7897,361.4423,278.0495,366.3912,273.1006,363.6511,279.43,371.1969" style="stroke:#E7E7E7;stroke-width:1;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="70.3638" x="265.32" y="316.6838">Verified by</text></g><g class="link" data-entity-1="UC2" data-entity-2="SV1" data-source-line="50" data-uid="lnk33" id="link_UC2_SV1"><path d="M98.4,252.3869 C110.18,270.3269 131.78,300.4169 156,320.6169 C182.61,342.8169 211.9128,358.6712 238.6328,371.0112" fill="none" id="UC2-to-SV1" style="stroke:#E7E7E7;stroke-width:1;stroke-dasharray:7,7;"/><polygon fill="#E7E7E7" points="244.08,373.5269,237.5864,366.122,239.5407,371.4305,234.2322,373.3849,244.08,373.5269" style="stroke:#E7E7E7;stroke-width:1;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="94.9546" x="157" y="316.6838">Prevents CSRF</text></g><g class="link" data-entity-1="UC3" data-entity-2="SV3" data-source-line="51" data-uid="lnk34" id="link_UC3_SV3"><path d="M648,257.0769 C648,287.4769 648,339.2469 648,367.7969" fill="none" id="UC3-to-SV3" style="stroke:#E7E7E7;stroke-width:1;stroke-dasharray:7,7;"/><polygon fill="#E7E7E7" points="648,373.7969,652,364.7969,648,368.7969,644,364.7969,648,373.7969" style="stroke:#E7E7E7;stroke-width:1;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="118.4663" x="649" y="316.6838">Short-lived tokens</text></g><g class="link" data-entity-1="UC4" data-entity-2="NS1" data-source-line="52" data-uid="lnk35" id="link_UC4_NS1"><path d="M1410,251.2269 C1410,280.4069 1410,341.8369 1410,370.8869" fill="none" id="UC4-to-NS1" style="stroke:#E7E7E7;stroke-width:1;stroke-dasharray:7,7;"/><polygon fill="#E7E7E7" points="1410,376.8869,1414,367.8869,1410,371.8869,1406,367.8869,1410,376.8869" style="stroke:#E7E7E7;stroke-width:1;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="118.9487" x="1411" y="316.6838">Transport security</text></g><g class="link" data-entity-1="UC5" data-entity-2="SV5" data-source-line="53" data-uid="lnk36" id="link_UC5_SV5"><path d="M1219.96,252.4669 C1202,264.2369 1176.43,280.9869 1154,295.6169 C1112.34,322.8069 1068.9708,351.0072 1039.6908,370.0372" fill="none" id="UC5-to-SV5" style="stroke:#E7E7E7;stroke-width:1;stroke-dasharray:7,7;"/><polygon fill="#E7E7E7" points="1034.66,373.3069,1044.386,371.7562,1038.8523,370.5821,1040.0264,365.0485,1034.66,373.3069" style="stroke:#E7E7E7;stroke-width:1;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="95.583" x="1139.18" y="316.6838">Least privilege</text></g><g class="link" data-entity-1="UC6" data-entity-2="SV3" data-source-line="54" data-uid="lnk37" id="link_UC6_SV3"><path d="M1049.68,252.4669 C1033.01,266.1069 1006.51,285.5369 980,295.6169 C954.84,305.1869 765.15,319.0169 740,328.6169 C711.93,339.3369 688.5393,356.1999 670.9293,370.7199" fill="none" id="UC6-to-SV3" style="stroke:#E7E7E7;stroke-width:1;stroke-dasharray:7,7;"/><polygon fill="#E7E7E7" points="666.3,374.5369,675.7886,371.8976,670.1578,371.356,670.6993,365.7252,666.3,374.5369" style="stroke:#E7E7E7;stroke-width:1;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="97.6841" x="933.79" y="316.6838">Refresh tokens</text></g></g></svg></div></div>
<h2 id="smart-on-fhir-data-flow">SMART-on-FHIR Data Flow</h2>
<div class="puml-container"><div class="puml light" style=""><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="DESCRIPTION" height="846px" preserveAspectRatio="xMidYMid meet" style="width:770px;height:846px;background:#FFFFFF;" version="1.1" viewBox="0 0 770 846" width="770px" zoomAndPan="magnify" class="diagram"><title>SMART-on-FHIR Data Flow</title><defs/><g><g class="title" data-source-line="3"><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="207.5254" x="274.5922" y="22.9951">SMART-on-FHIR Data Flow</text></g><g class="entity" data-entity="UA" data-source-line="5" data-uid="ent0002" id="entity_UA"><ellipse cx="283.5083" cy="505.4505" fill="#F1F1F1" rx="59.8883" ry="14.5236" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="80.4521" x="243.2822" y="510.0989">User Action</text></g><g class="entity" data-entity="LA" data-source-line="6" data-uid="ent0003" id="entity_LA"><ellipse cx="283.507" cy="611.5623" fill="#F1F1F1" rx="60.977" ry="14.5954" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="82.4961" x="242.2589" y="616.2107">Launch App</text></g><g class="entity" data-entity="AUTH" data-source-line="7" data-uid="ent0004" id="entity_AUTH"><ellipse cx="397.5146" cy="718.3118" fill="#F1F1F1" rx="63.7246" ry="15.1449" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="90.0566" x="352.4863" y="722.9602">Authenticate</text></g><g class="entity" data-entity="CONSENT" data-source-line="8" data-uid="ent0005" id="entity_CONSENT"><ellipse cx="520.5069" cy="824.9805" fill="#F1F1F1" rx="43.6469" ry="14.5236" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="57.4834" x="491.7652" y="829.6289">Consent</text></g><g class="entity" data-entity="TOKEN" data-source-line="9" data-uid="ent0006" id="entity_TOKEN"><ellipse cx="526.5112" cy="93.7005" fill="#F1F1F1" rx="33.2012" ry="14.5236" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="42.7109" x="505.1557" y="98.3489">Token</text></g><g class="entity" data-entity="FR" data-source-line="10" data-uid="ent0007" id="entity_FR"><ellipse cx="115.5058" cy="256.356" fill="#F1F1F1" rx="65.3458" ry="15.4692" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="94.3838" x="68.3139" y="261.0045">FHIR Request</text></g><g class="entity" data-entity="DD" data-source-line="11" data-uid="ent0008" id="entity_DD"><ellipse cx="69.512" cy="391.2793" fill="#F1F1F1" rx="63.512" ry="15.1024" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="89.4824" x="24.7708" y="395.9277">Data Display</text></g><g class="entity" data-entity="DB" data-source-line="13" data-uid="ent0009" id="entity_DB"><path d="M200.34,378.6269 C200.34,368.6269 260.5158,368.6269 260.5158,368.6269 C260.5158,368.6269 320.6916,368.6269 320.6916,378.6269 L320.6916,403.9238 C320.6916,413.9238 260.5158,413.9238 260.5158,413.9238 C260.5158,413.9238 200.34,413.9238 200.34,403.9238 L200.34,378.6269" fill="#F1F1F1" style="stroke:#181818;stroke-width:0.5;"/><path d="M200.34,378.6269 C200.34,388.6269 260.5158,388.6269 260.5158,388.6269 C260.5158,388.6269 320.6916,388.6269 320.6916,378.6269" fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="100.3516" x="210.34" y="405.622">EHR Database</text></g><g class="entity" data-entity="TS" data-source-line="14" data-uid="ent0010" id="entity_TS"><path d="M480.28,243.7069 C480.28,233.7069 532.5158,233.7069 532.5158,233.7069 C532.5158,233.7069 584.7517,233.7069 584.7517,243.7069 L584.7517,269.0038 C584.7517,279.0038 532.5158,279.0038 532.5158,279.0038 C532.5158,279.0038 480.28,279.0038 480.28,269.0038 L480.28,243.7069" fill="#F1F1F1" style="stroke:#181818;stroke-width:0.5;"/><path d="M480.28,243.7069 C480.28,253.7069 532.5158,253.7069 532.5158,253.7069 C532.5158,253.7069 584.7517,253.7069 584.7517,243.7069" fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="84.4717" x="490.28" y="270.702">Token Store</text></g><g class="entity" data-entity="GMN21" data-source-line="28" data-uid="ent0022" id="entity_GMN21"><path d="M594.82,43.2969 L594.82,89.6969 L560.1,93.6969 L594.82,97.6969 L594.82,144.0938 A0,0 0 0 0 594.82,144.0938 L752.2057,144.0938 A0,0 0 0 0 752.2057,144.0938 L752.2057,53.2969 L742.2057,43.2969 L594.82,43.2969 A0,0 0 0 0 594.82,43.2969" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M742.2057,43.2969 L742.2057,53.2969 L752.2057,53.2969 L742.2057,43.2969" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="61.3374" x="600.82" y="60.3638">Contains:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="136.3857" x="600.82" y="75.4966">• Access token (JWT)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="102.7114" x="600.82" y="90.6294">• Refresh token</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="86.1123" x="600.82" y="105.7622">• Expiry time</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="97.208" x="600.82" y="120.895">• Scope grants</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="111.0078" x="600.82" y="136.0278">• Patient context</text></g><g class="entity" data-entity="GMN24" data-source-line="37" data-uid="ent0025" id="entity_GMN24"><path d="M215.79,221.0969 L215.79,252.3569 L181.02,256.3569 L215.79,260.3569 L215.79,291.6281 A0,0 0 0 0 215.79,291.6281 L445.2343,291.6281 A0,0 0 0 0 445.2343,291.6281 L445.2343,231.0969 L435.2343,221.0969 L215.79,221.0969 A0,0 0 0 0 215.79,221.0969" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M435.2343,221.0969 L435.2343,231.0969 L445.2343,231.0969 L435.2343,221.0969" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="92.4219" x="221.79" y="238.1638">With Headers:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="208.4443" x="221.79" y="253.2966">• Authorization: Bearer {token}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="200.1797" x="221.79" y="268.4294">• Accept: application/fhir+json</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="206.4829" x="221.79" y="283.5622">• Prefer: return=representation</text></g><g class="link" data-entity-1="UA" data-entity-2="LA" data-source-line="16" data-uid="lnk11" id="link_UA_LA"><path d="M283.51,520.0569 C283.51,539.8969 283.51,570.5869 283.51,590.6169" fill="none" id="UA-to-LA" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="283.51,596.6169,287.51,587.6169,283.51,591.6169,279.51,587.6169,283.51,596.6169" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="95.0879" x="284.51" y="563.0338">1. Click launch</text></g><g class="link" data-entity-1="LA" data-entity-2="AUTH" data-source-line="17" data-uid="lnk12" id="link_LA_AUTH"><path d="M297.95,625.8269 C319.52,645.6469 355.5624,678.7567 377.6824,699.0867" fill="none" id="LA-to-AUTH" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="382.1,703.1469,378.1803,694.1116,378.4187,699.7634,372.7668,700.0018,382.1,703.1469" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="121.875" x="348.34" y="669.2238">2. Redirect to auth</text></g><g class="link" data-entity-1="AUTH" data-entity-2="CONSENT" data-source-line="18" data-uid="lnk13" id="link_AUTH_CONSENT"><path d="M413.85,733.2069 C437.76,753.5569 477.4205,787.3085 500.7005,807.1185" fill="none" id="AUTH-to-CONSENT" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="505.27,811.0069,501.008,802.1279,501.4621,807.7665,495.8235,808.2206,505.27,811.0069" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="107.1929" x="467.38" y="776.5138">3. Show consent</text></g><g class="link" data-entity-1="CONSENT" data-entity-2="TOKEN" data-source-line="19" data-uid="lnk14" id="link_CONSENT_TOKEN"><path d="M549.66,813.9069 C586.03,799.2669 643.51,768.3769 643.51,719.3069 C402.51,839.4969 402.51,839.4969 643.51,255.3569 C643.51,217.9369 643.2,204.5869 621.51,174.0969 C607.79,154.8069 595.86,159.0469 577.51,144.0969 C563.37,132.5669 552.7091,122.1718 542.6991,111.8118" fill="none" id="CONSENT-to-TOKEN" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="538.53,107.4969,541.9071,116.7486,542.0043,111.0926,547.6603,111.1898,538.53,107.4969" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="118.1997" x="644.51" y="510.0138">4. Generate token</text></g><g class="link" data-entity-1="TOKEN" data-entity-2="TS" data-source-line="20" data-uid="lnk15" id="link_TOKEN_TS"><path d="M525.22,108.4369 C523.65,127.1569 521.46,161.6969 523.51,191.0969 C524.5,205.2569 525.7424,215.1222 527.7224,227.5022" fill="none" id="TOKEN-to-TS" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="528.67,233.4269,531.1984,223.9081,527.8804,228.4896,523.2988,225.1715,528.67,233.4269" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="92.1299" x="524.51" y="187.1638">5. Store token</text></g><g class="link" data-entity-1="TOKEN" data-entity-2="FR" data-source-line="21" data-uid="lnk16" id="link_TOKEN_FR"><path d="M502.16,103.8569 C447.62,124.4169 311.59,175.9669 198.51,221.0969 C181.28,227.9669 167.6801,233.5532 152.1201,240.0232" fill="none" id="TOKEN-to-FR" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="146.58,242.3269,156.426,242.5648,151.1968,240.4072,153.3545,235.178,146.58,242.3269" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="81.7705" x="316.48" y="187.1638">6. Use token</text></g><g class="link" data-entity-1="FR" data-entity-2="DB" data-source-line="22" data-uid="lnk17" id="link_FR_DB"><path d="M127.71,271.8869 C142.17,288.7369 167.34,316.9669 191.51,338.6269 C203.1,349.0069 211.813,355.9504 223.833,364.7204" fill="none" id="FR-to-DB" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="228.68,368.2569,223.7671,359.7208,224.6408,365.3098,219.0519,366.1835,228.68,368.2569" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="89.4575" x="192.51" y="334.6938">7. Query data</text></g><g class="link" data-entity-1="DB" data-entity-2="FR" data-source-line="23" data-uid="lnk18" id="link_DB_FR"><path d="M279.16,368.1369 C288.75,353.9369 296.52,335.6169 286.51,321.6269 C262.47,288.0169 237.18,306.1869 198.51,291.6269 C180.86,284.9769 166.8783,279.2888 151.2083,272.6788" fill="none" id="DB-to-FR" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="145.68,270.3469,152.4178,277.5304,150.2869,272.2902,155.5271,270.1593,145.68,270.3469" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="162.4429" x="292.18" y="334.6938">8. Return FHIR resources</text></g><g class="link" data-entity-1="FR" data-entity-2="DD" data-source-line="24" data-uid="lnk19" id="link_FR_DD"><path d="M87.49,270.7269 C68.42,281.5269 44.67,298.6969 33.51,321.6269 C24.21,340.7469 35.8979,358.1241 49.4279,371.9141" fill="none" id="FR-to-DD" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="53.63,376.1969,50.1821,366.9713,50.1283,372.6279,44.4717,372.574,53.63,376.1969" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="116.7524" x="34.51" y="334.6938">9. Transform data</text></g><g class="link" data-entity-1="DD" data-entity-2="UA" data-source-line="25" data-uid="lnk20" id="link_DD_UA"><path d="M94.9,405.5769 C136.53,427.4069 213.4264,467.7002 254.1564,489.0602" fill="none" id="DD-to-UA" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="259.47,491.8469,253.3573,484.1245,255.042,489.5247,249.6418,491.2094,259.47,491.8469" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="122.3955" x="196.68" y="456.9838">10. Display to user</text></g></g></svg></div><div class="puml dark" style=""><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="DESCRIPTION" height="846px" preserveAspectRatio="xMidYMid meet" style="width:770px;height:846px;background:#1B1B1B;" version="1.1" viewBox="0 0 770 846" width="770px" zoomAndPan="magnify" class="diagram"><title>SMART-on-FHIR Data Flow</title><defs/><g><rect fill="#1B1B1B" height="846" style="stroke:none;stroke-width:1;" width="770" x="0" y="0"/><g class="title" data-source-line="3"><text fill="#FFFFFF" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="207.5254" x="274.5922" y="22.9951">SMART-on-FHIR Data Flow</text></g><g class="entity" data-entity="UA" data-source-line="5" data-uid="ent0002" id="entity_UA"><ellipse cx="283.5083" cy="505.4505" fill="#313139" rx="59.8883" ry="14.5236" style="stroke:#E7E7E7;stroke-width:0.5;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="80.4521" x="243.2822" y="510.0989">User Action</text></g><g class="entity" data-entity="LA" data-source-line="6" data-uid="ent0003" id="entity_LA"><ellipse cx="283.507" cy="611.5623" fill="#313139" rx="60.977" ry="14.5954" style="stroke:#E7E7E7;stroke-width:0.5;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="82.4961" x="242.2589" y="616.2107">Launch App</text></g><g class="entity" data-entity="AUTH" data-source-line="7" data-uid="ent0004" id="entity_AUTH"><ellipse cx="397.5146" cy="718.3118" fill="#313139" rx="63.7246" ry="15.1449" style="stroke:#E7E7E7;stroke-width:0.5;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="90.0566" x="352.4863" y="722.9602">Authenticate</text></g><g class="entity" data-entity="CONSENT" data-source-line="8" data-uid="ent0005" id="entity_CONSENT"><ellipse cx="520.5069" cy="824.9805" fill="#313139" rx="43.6469" ry="14.5236" style="stroke:#E7E7E7;stroke-width:0.5;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="57.4834" x="491.7652" y="829.6289">Consent</text></g><g class="entity" data-entity="TOKEN" data-source-line="9" data-uid="ent0006" id="entity_TOKEN"><ellipse cx="526.5112" cy="93.7005" fill="#313139" rx="33.2012" ry="14.5236" style="stroke:#E7E7E7;stroke-width:0.5;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="42.7109" x="505.1557" y="98.3489">Token</text></g><g class="entity" data-entity="FR" data-source-line="10" data-uid="ent0007" id="entity_FR"><ellipse cx="115.5058" cy="256.356" fill="#313139" rx="65.3458" ry="15.4692" style="stroke:#E7E7E7;stroke-width:0.5;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="94.3838" x="68.3139" y="261.0045">FHIR Request</text></g><g class="entity" data-entity="DD" data-source-line="11" data-uid="ent0008" id="entity_DD"><ellipse cx="69.512" cy="391.2793" fill="#313139" rx="63.512" ry="15.1024" style="stroke:#E7E7E7;stroke-width:0.5;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="89.4824" x="24.7708" y="395.9277">Data Display</text></g><g class="entity" data-entity="DB" data-source-line="13" data-uid="ent0009" id="entity_DB"><path d="M200.34,378.6269 C200.34,368.6269 260.5158,368.6269 260.5158,368.6269 C260.5158,368.6269 320.6916,368.6269 320.6916,378.6269 L320.6916,403.9238 C320.6916,413.9238 260.5158,413.9238 260.5158,413.9238 C260.5158,413.9238 200.34,413.9238 200.34,403.9238 L200.34,378.6269" fill="#313139" style="stroke:#E7E7E7;stroke-width:0.5;"/><path d="M200.34,378.6269 C200.34,388.6269 260.5158,388.6269 260.5158,388.6269 C260.5158,388.6269 320.6916,388.6269 320.6916,378.6269" fill="none" style="stroke:#E7E7E7;stroke-width:0.5;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="100.3516" x="210.34" y="405.622">EHR Database</text></g><g class="entity" data-entity="TS" data-source-line="14" data-uid="ent0010" id="entity_TS"><path d="M480.28,243.7069 C480.28,233.7069 532.5158,233.7069 532.5158,233.7069 C532.5158,233.7069 584.7517,233.7069 584.7517,243.7069 L584.7517,269.0038 C584.7517,279.0038 532.5158,279.0038 532.5158,279.0038 C532.5158,279.0038 480.28,279.0038 480.28,269.0038 L480.28,243.7069" fill="#313139" style="stroke:#E7E7E7;stroke-width:0.5;"/><path d="M480.28,243.7069 C480.28,253.7069 532.5158,253.7069 532.5158,253.7069 C532.5158,253.7069 584.7517,253.7069 584.7517,243.7069" fill="none" style="stroke:#E7E7E7;stroke-width:0.5;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="84.4717" x="490.28" y="270.702">Token Store</text></g><g class="entity" data-entity="GMN21" data-source-line="28" data-uid="ent0022" id="entity_GMN21"><path d="M594.82,43.2969 L594.82,89.6969 L560.1,93.6969 L594.82,97.6969 L594.82,144.0938 A0,0 0 0 0 594.82,144.0938 L752.2057,144.0938 A0,0 0 0 0 752.2057,144.0938 L752.2057,53.2969 L742.2057,43.2969 L594.82,43.2969 A0,0 0 0 0 594.82,43.2969" fill="#714137" style="stroke:#E7E7E7;stroke-width:0.5;"/><path d="M742.2057,43.2969 L742.2057,53.2969 L752.2057,53.2969 L742.2057,43.2969" fill="#714137" style="stroke:#E7E7E7;stroke-width:0.5;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="61.3374" x="600.82" y="60.3638">Contains:</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="136.3857" x="600.82" y="75.4966">• Access token (JWT)</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="102.7114" x="600.82" y="90.6294">• Refresh token</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="86.1123" x="600.82" y="105.7622">• Expiry time</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="97.208" x="600.82" y="120.895">• Scope grants</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="111.0078" x="600.82" y="136.0278">• Patient context</text></g><g class="entity" data-entity="GMN24" data-source-line="37" data-uid="ent0025" id="entity_GMN24"><path d="M215.79,221.0969 L215.79,252.3569 L181.02,256.3569 L215.79,260.3569 L215.79,291.6281 A0,0 0 0 0 215.79,291.6281 L445.2343,291.6281 A0,0 0 0 0 445.2343,291.6281 L445.2343,231.0969 L435.2343,221.0969 L215.79,221.0969 A0,0 0 0 0 215.79,221.0969" fill="#714137" style="stroke:#E7E7E7;stroke-width:0.5;"/><path d="M435.2343,221.0969 L435.2343,231.0969 L445.2343,231.0969 L435.2343,221.0969" fill="#714137" style="stroke:#E7E7E7;stroke-width:0.5;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="92.4219" x="221.79" y="238.1638">With Headers:</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="208.4443" x="221.79" y="253.2966">• Authorization: Bearer {token}</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="200.1797" x="221.79" y="268.4294">• Accept: application/fhir+json</text><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="206.4829" x="221.79" y="283.5622">• Prefer: return=representation</text></g><g class="link" data-entity-1="UA" data-entity-2="LA" data-source-line="16" data-uid="lnk11" id="link_UA_LA"><path d="M283.51,520.0569 C283.51,539.8969 283.51,570.5869 283.51,590.6169" fill="none" id="UA-to-LA" style="stroke:#E7E7E7;stroke-width:1;"/><polygon fill="#E7E7E7" points="283.51,596.6169,287.51,587.6169,283.51,591.6169,279.51,587.6169,283.51,596.6169" style="stroke:#E7E7E7;stroke-width:1;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="95.0879" x="284.51" y="563.0338">1. Click launch</text></g><g class="link" data-entity-1="LA" data-entity-2="AUTH" data-source-line="17" data-uid="lnk12" id="link_LA_AUTH"><path d="M297.95,625.8269 C319.52,645.6469 355.5624,678.7567 377.6824,699.0867" fill="none" id="LA-to-AUTH" style="stroke:#E7E7E7;stroke-width:1;"/><polygon fill="#E7E7E7" points="382.1,703.1469,378.1803,694.1116,378.4187,699.7634,372.7668,700.0018,382.1,703.1469" style="stroke:#E7E7E7;stroke-width:1;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="121.875" x="348.34" y="669.2238">2. Redirect to auth</text></g><g class="link" data-entity-1="AUTH" data-entity-2="CONSENT" data-source-line="18" data-uid="lnk13" id="link_AUTH_CONSENT"><path d="M413.85,733.2069 C437.76,753.5569 477.4205,787.3085 500.7005,807.1185" fill="none" id="AUTH-to-CONSENT" style="stroke:#E7E7E7;stroke-width:1;"/><polygon fill="#E7E7E7" points="505.27,811.0069,501.008,802.1279,501.4621,807.7665,495.8235,808.2206,505.27,811.0069" style="stroke:#E7E7E7;stroke-width:1;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="107.1929" x="467.38" y="776.5138">3. Show consent</text></g><g class="link" data-entity-1="CONSENT" data-entity-2="TOKEN" data-source-line="19" data-uid="lnk14" id="link_CONSENT_TOKEN"><path d="M549.66,813.9069 C586.03,799.2669 643.51,768.3769 643.51,719.3069 C402.51,839.4969 402.51,839.4969 643.51,255.3569 C643.51,217.9369 643.2,204.5869 621.51,174.0969 C607.79,154.8069 595.86,159.0469 577.51,144.0969 C563.37,132.5669 552.7091,122.1718 542.6991,111.8118" fill="none" id="CONSENT-to-TOKEN" style="stroke:#E7E7E7;stroke-width:1;"/><polygon fill="#E7E7E7" points="538.53,107.4969,541.9071,116.7486,542.0043,111.0926,547.6603,111.1898,538.53,107.4969" style="stroke:#E7E7E7;stroke-width:1;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="118.1997" x="644.51" y="510.0138">4. Generate token</text></g><g class="link" data-entity-1="TOKEN" data-entity-2="TS" data-source-line="20" data-uid="lnk15" id="link_TOKEN_TS"><path d="M525.22,108.4369 C523.65,127.1569 521.46,161.6969 523.51,191.0969 C524.5,205.2569 525.7424,215.1222 527.7224,227.5022" fill="none" id="TOKEN-to-TS" style="stroke:#E7E7E7;stroke-width:1;"/><polygon fill="#E7E7E7" points="528.67,233.4269,531.1984,223.9081,527.8804,228.4896,523.2988,225.1715,528.67,233.4269" style="stroke:#E7E7E7;stroke-width:1;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="92.1299" x="524.51" y="187.1638">5. Store token</text></g><g class="link" data-entity-1="TOKEN" data-entity-2="FR" data-source-line="21" data-uid="lnk16" id="link_TOKEN_FR"><path d="M502.16,103.8569 C447.62,124.4169 311.59,175.9669 198.51,221.0969 C181.28,227.9669 167.6801,233.5532 152.1201,240.0232" fill="none" id="TOKEN-to-FR" style="stroke:#E7E7E7;stroke-width:1;"/><polygon fill="#E7E7E7" points="146.58,242.3269,156.426,242.5648,151.1968,240.4072,153.3545,235.178,146.58,242.3269" style="stroke:#E7E7E7;stroke-width:1;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="81.7705" x="316.48" y="187.1638">6. Use token</text></g><g class="link" data-entity-1="FR" data-entity-2="DB" data-source-line="22" data-uid="lnk17" id="link_FR_DB"><path d="M127.71,271.8869 C142.17,288.7369 167.34,316.9669 191.51,338.6269 C203.1,349.0069 211.813,355.9504 223.833,364.7204" fill="none" id="FR-to-DB" style="stroke:#E7E7E7;stroke-width:1;"/><polygon fill="#E7E7E7" points="228.68,368.2569,223.7671,359.7208,224.6408,365.3098,219.0519,366.1835,228.68,368.2569" style="stroke:#E7E7E7;stroke-width:1;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="89.4575" x="192.51" y="334.6938">7. Query data</text></g><g class="link" data-entity-1="DB" data-entity-2="FR" data-source-line="23" data-uid="lnk18" id="link_DB_FR"><path d="M279.16,368.1369 C288.75,353.9369 296.52,335.6169 286.51,321.6269 C262.47,288.0169 237.18,306.1869 198.51,291.6269 C180.86,284.9769 166.8783,279.2888 151.2083,272.6788" fill="none" id="DB-to-FR" style="stroke:#E7E7E7;stroke-width:1;"/><polygon fill="#E7E7E7" points="145.68,270.3469,152.4178,277.5304,150.2869,272.2902,155.5271,270.1593,145.68,270.3469" style="stroke:#E7E7E7;stroke-width:1;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="162.4429" x="292.18" y="334.6938">8. Return FHIR resources</text></g><g class="link" data-entity-1="FR" data-entity-2="DD" data-source-line="24" data-uid="lnk19" id="link_FR_DD"><path d="M87.49,270.7269 C68.42,281.5269 44.67,298.6969 33.51,321.6269 C24.21,340.7469 35.8979,358.1241 49.4279,371.9141" fill="none" id="FR-to-DD" style="stroke:#E7E7E7;stroke-width:1;"/><polygon fill="#E7E7E7" points="53.63,376.1969,50.1821,366.9713,50.1283,372.6279,44.4717,372.574,53.63,376.1969" style="stroke:#E7E7E7;stroke-width:1;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="116.7524" x="34.51" y="334.6938">9. Transform data</text></g><g class="link" data-entity-1="DD" data-entity-2="UA" data-source-line="25" data-uid="lnk20" id="link_DD_UA"><path d="M94.9,405.5769 C136.53,427.4069 213.4264,467.7002 254.1564,489.0602" fill="none" id="DD-to-UA" style="stroke:#E7E7E7;stroke-width:1;"/><polygon fill="#E7E7E7" points="259.47,491.8469,253.3573,484.1245,255.042,489.5247,249.6418,491.2094,259.47,491.8469" style="stroke:#E7E7E7;stroke-width:1;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="122.3955" x="196.68" y="456.9838">10. Display to user</text></g></g></svg></div></div>
</article>
</div>
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
</div>
<button class="md-top md-icon" data-md-component="top" hidden="" type="button">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"></path></svg>
  Back to top
</button>
</main>
<footer class="md-footer">
<nav aria-label="Footer" class="md-footer__inner md-grid">
<a aria-label="Previous: SMART-on-FHIR and Integration Quick Reference" class="md-footer__link md-footer__link--prev" href="../quick_ref/">
<div class="md-footer__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
</div>
<div class="md-footer__title">
<span class="md-footer__direction">
                Previous
              </span>
<div class="md-ellipsis">
                SMART-on-FHIR and Integration Quick Reference
              </div>
</div>
</a>
<a aria-label="Next: Ontario eHealth &amp;amp; HALO Integration Glossary" class="md-footer__link md-footer__link--next" href="../gloss_ontario_halo/">
<div class="md-footer__title">
<span class="md-footer__direction">
                Next
              </span>
<div class="md-ellipsis">
                Ontario eHealth &amp; HALO Integration Glossary
              </div>
</div>
<div class="md-footer__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"></path></svg>
</div>
</a>
</nav>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<div class="md-consent" data-md-component="consent" hidden="" id="__consent">
<div class="md-consent__overlay"></div>
<aside class="md-consent__inner">
<form class="md-consent__form md-grid md-typeset" name="consent">
<h4>Cookie consent</h4>
<p>We use cookies to recognize your repeated visits and preferences, as well as to measure the effectiveness of our documentation and whether users find what they're searching for. With your consent, you're helping us to make our documentation better.
</p>
<input class="md-toggle" id="__settings" type="checkbox"/>
<div class="md-consent__settings">
<ul class="task-list">
<li class="task-list-item">
<label class="task-list-control">
<input checked="" name="analytics" type="checkbox"/>
<span class="task-list-indicator"></span>
          Google Analytics
        </label>
</li>
</ul>
</div>
<div class="md-consent__controls">
<button class="md-button md-button--primary">Accept</button>
<label class="md-button" for="__settings">Manage settings</label>
</div>
</form>
</aside>
</div>
<script>var consent=__md_get("__consent");if(consent)for(var input of document.forms.consent.elements)input.name&&(input.checked=consent[input.name]||!1);else"file:"!==location.protocol&&setTimeout((function(){document.querySelector("[data-md-component=consent]").hidden=!1}),250);var form=document.forms.consent;for(var action of["submit","reset"])form.addEventListener(action,(function(e){if(e.preventDefault(),"reset"===e.type)for(var n of document.forms.consent.elements)n.name&&(n.checked=!1);__md_set("__consent",Object.fromEntries(Array.from(new FormData(form).keys()).map((function(e){return[e,!0]})))),location.hash="",location.reload()}))</script>
<script id="__config" type="application/json">{"base": "../..", "features": ["navigation.top", "navigation.footer", "navigation.indexes", "search.highlight", "search.suggest", "search.share", "content.code.copy", "content.code.select"], "search": "../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
<script src="../../assets/javascripts/bundle.525ec568.min.js"></script>
<script src="../../js/seamaiden.js"></script>
<script src="https://cdn.jsdelivr.net/gh/rod2ik/cdn@main/mkdocs/javascripts/mkdocs-graphviz.js"></script>
<script src="../../js/diagram-zoom.js"></script>
<script src="../../js/alphabet-auto.js"></script>
<script src="../../js/svg-patcher.js"></script>
<script src="../../assets/mkdocs_puml/puml.js"></script>
<script src="https://unpkg.com/@panzoom/panzoom@4.5.1/dist/panzoom.min.js"></script>
<script src="../../assets/mkdocs_puml/interaction.js"></script>
</body>
</html>