
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<link href="https://cassmastern.github.io/cass-sandbox/sec_ehealth/quick_ref/" rel="canonical"/>
<link href="../" rel="prev"/>
<link href="../smart-fhir-visuals/" rel="next"/>
<link href="../../img/favicon.ico" rel="icon"/>
<meta content="mkdocs-1.6.1, mkdocs-material-9.5.39" name="generator"/>
<title>SMART-on-FHIR and Integration Quick Reference - Ler's Sandobx</title>
<link href="../../assets/stylesheets/main.8c3ca2c6.min.css" rel="stylesheet"/>
<link href="../../assets/stylesheets/palette.06af60db.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
<link href="../../css/alphabet.css" rel="stylesheet"/>
<link href="../../css/diagram-zoom.css" rel="stylesheet"/>
<link href="../../css/cm-logo.css" rel="stylesheet"/>
<link href="../../css/color-vars.css" rel="stylesheet"/>
<link href="../../assets/mkdocs_puml/puml.css" rel="stylesheet"/>
<link href="../../assets/mkdocs_puml/interaction.css" rel="stylesheet"/>
<script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
<script id="__analytics">function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-GD2XWDMP2E"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-GD2XWDMP2E",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-GD2XWDMP2E",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script>
<script>if("undefined"!=typeof __md_analytics){var consent=__md_get("__consent");consent&&consent.analytics&&__md_analytics()}</script>
</head>
<body data-md-color-accent="indigo" data-md-color-primary="indigo" data-md-color-scheme="slate" dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#smart-on-fhir-and-integration-quick-reference">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header md-header--shadow" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="Ler's Sandobx" class="md-header__button md-logo" data-md-component="logo" href="../.." title="Ler's Sandobx">
<img alt="logo" src="../../img/logo.svg"/>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            Ler's Sandobx
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              SMART-on-FHIR and Integration Quick Reference
            
          </span>
</div>
</div>
</div>
<form class="md-header__option" data-md-component="palette">
<input aria-label="Switch to light mode" class="md-option" data-md-color-accent="indigo" data-md-color-media="" data-md-color-primary="indigo" data-md-color-scheme="slate" id="__palette_0" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_1" hidden="" title="Switch to light mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"></path></svg>
</label>
<input aria-label="Switch to dark mode" class="md-option" data-md-color-accent="indigo" data-md-color-media="" data-md-color-primary="indigo" data-md-color-scheme="default" id="__palette_1" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_0" hidden="" title="Switch to dark mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"></path></svg>
</label>
</form>
<script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
</label>
<nav aria-label="Search" class="md-search__options">
<a aria-label="Share" class="md-search__icon md-icon" data-clipboard="" data-clipboard-text="" data-md-component="search-share" href="javascript:void(0)" tabindex="-1" title="Share">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"></path></svg>
</a>
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" title="Clear" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>
</button>
</nav>
<div class="md-search__suggest" data-md-component="search-suggest"></div>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="" tabindex="0">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="Ler's Sandobx" class="md-nav__button md-logo" data-md-component="logo" href="../.." title="Ler's Sandobx">
<img alt="logo" src="../../img/logo.svg"/>
</a>
    Ler's Sandobx
  </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../..">
<span class="md-ellipsis">
    HOME
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_2" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../sec_about/">
<span class="md-ellipsis">
    ABOUT THIS WEBSITE
  </span>
</a>
<label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_2_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_2">
<span class="md-nav__icon md-icon"></span>
            ABOUT THIS WEBSITE
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../sec_about/whatsinhere/">
<span class="md-ellipsis">
    What's in Here?
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../sec_about/about-sitedev/">
<span class="md-ellipsis">
    How This Site Was Developed and Deployed
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../sec_about/about-wf-breakdown/">
<span class="md-ellipsis">
    Detailed Breakdown of My Workflow
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../sec_about/roadmap/">
<span class="md-ellipsis">
    Roadmap &amp; Changelog
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../sec_about/feedback/">
<span class="md-ellipsis">
    Feedback
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_3" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../sec_cloud/">
<span class="md-ellipsis">
    IN THE CLOUDS
  </span>
</a>
<label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_3_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_3">
<span class="md-nav__icon md-icon"></span>
            IN THE CLOUDS
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../sec_cloud/aws-gcp-azure/">
<span class="md-ellipsis">
    Architectures of AWS, GCP, and Azure
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../sec_cloud/aws-gcp-azure_glossary/">
<span class="md-ellipsis">
    Cross-Platform Cloud &amp; DevOps Glossary (AWS, GCP, Azure)
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../sec_cloud/aws-gcp-azure_glossary_enhanced/">
<span class="md-ellipsis">
    Cross-Platform Cloud &amp; DevOps Glossary (AWS, GCP, Azure) — Enhanced
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../sec_cloud/jakarta-ee-azure/">
<span class="md-ellipsis">
    A Jakarta Enterprise Application on Azure
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_4" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../sec_accss/">
<span class="md-ellipsis">
    ACCESSIBILITY
  </span>
</a>
<label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_4_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_4">
<span class="md-nav__icon md-icon"></span>
            ACCESSIBILITY
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../sec_accss/accss_/">
<span class="md-ellipsis">
    Accessibility Reference
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../sec_accss/visuals-for-the-sightless/">
<span class="md-ellipsis">
    Visuals for the Sightless
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../sec_accss/accss_diagram-dilemma/">
<span class="md-ellipsis">
    The Diagramming Dilemma
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../sec_accss/mermaid-beyond-reach/">
<span class="md-ellipsis">
    An Accessible Mermaid Beyond Reach
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../sec_accss/mermaid-captured/">
<span class="md-ellipsis">
    Mermaid Captured
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../sec_accss/mkdocs-mermaid-plantuml-graphviz/">
<span class="md-ellipsis">
    Diagram Accessibility: Current State/Path Forward
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_5" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../sec_freeform/">
<span class="md-ellipsis">
    CONCEPTS, ESSAYS &amp; MORE
  </span>
</a>
<label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_5_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_5">
<span class="md-nav__icon md-icon"></span>
            CONCEPTS, ESSAYS &amp; MORE
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../sec_freeform/ibm-sanfran/">
<span class="md-ellipsis">
    IBM SanFrancisco
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../sec_freeform/ai-accessibility/">
<span class="md-ellipsis">
    Accessibility with AI
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../sec_freeform/ai-accessibility_bus/">
<span class="md-ellipsis">
    Accessibility with AI (Concept Note)
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../sec_freeform/gen-ai-landscape-primer/">
<span class="md-ellipsis">
    GenAI Landscape in 2025
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../sec_freeform/identity/">
<span class="md-ellipsis">
    The Long Arc of Digital Identity
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_6" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../sec_net-sec/">
<span class="md-ellipsis">
    NETWORKS &amp; SECURITY
  </span>
</a>
<label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_6_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_6">
<span class="md-nav__icon md-icon"></span>
            NETWORKS &amp; SECURITY
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../sec_net-sec/network_data_center/">
<span class="md-ellipsis">
    A Hypothetical Data Centre Network
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../sec_net-sec/network_data_center_stride/">
<span class="md-ellipsis">
    Network Security and Threat Modeling — STRIDE
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../sec_net-sec/network_data_center_mitre/">
<span class="md-ellipsis">
    Network Security and Threat Modeling — MITRE ATT&amp;CK
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../sec_net-sec/saml-admin/">
<span class="md-ellipsis">
    Single Sign-On (SSO) Admin Guide — SAML 2.0 Integration
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_7" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../">
<span class="md-ellipsis">
    eHEALTH
  </span>
</a>
<label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="true" aria-labelledby="__nav_7_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_7">
<span class="md-nav__icon md-icon"></span>
            eHEALTH
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
<span class="md-ellipsis">
    SMART-on-FHIR and Integration Quick Reference
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
<span class="md-ellipsis">
    SMART-on-FHIR and Integration Quick Reference
  </span>
</a>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#quick-start-checklist">
<span class="md-ellipsis">
      Quick Start Checklist
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#discovery-endpoint">
<span class="md-ellipsis">
      Discovery Endpoint
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#authorization-flow">
<span class="md-ellipsis">
      Authorization Flow
    </span>
</a>
<nav aria-label="Authorization Flow" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#step-1-authorization-request-ehr-launch">
<span class="md-ellipsis">
      Step 1: Authorization Request (EHR Launch)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#step-2-authorization-request-standalone-launch">
<span class="md-ellipsis">
      Step 2: Authorization Request (Standalone Launch)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#step-3-token-exchange">
<span class="md-ellipsis">
      Step 3: Token Exchange
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#step-4-token-refresh">
<span class="md-ellipsis">
      Step 4: Token Refresh
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#smart-scopes">
<span class="md-ellipsis">
      SMART Scopes
    </span>
</a>
<nav aria-label="SMART Scopes" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#context-scopes">
<span class="md-ellipsis">
      Context Scopes
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#patient-specific-scopes">
<span class="md-ellipsis">
      Patient-Specific Scopes
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#user-scopes">
<span class="md-ellipsis">
      User Scopes
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#system-scopes-backend-services">
<span class="md-ellipsis">
      System Scopes (Backend Services)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#special-scopes">
<span class="md-ellipsis">
      Special Scopes
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#fhir-api-requests">
<span class="md-ellipsis">
      FHIR API Requests
    </span>
</a>
<nav aria-label="FHIR API Requests" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#read-single-resource">
<span class="md-ellipsis">
      Read Single Resource
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#search-resources">
<span class="md-ellipsis">
      Search Resources
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#common-search-parameters">
<span class="md-ellipsis">
      Common Search Parameters
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#create-resource">
<span class="md-ellipsis">
      Create Resource
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#update-resource">
<span class="md-ellipsis">
      Update Resource
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#delete-resource">
<span class="md-ellipsis">
      Delete Resource
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#pkce-implementation">
<span class="md-ellipsis">
      PKCE Implementation
    </span>
</a>
<nav aria-label="PKCE Implementation" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#generate-code-verifier">
<span class="md-ellipsis">
      Generate Code Verifier
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#generate-code-challenge">
<span class="md-ellipsis">
      Generate Code Challenge
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#common-fhir-resources">
<span class="md-ellipsis">
      Common FHIR Resources
    </span>
</a>
<nav aria-label="Common FHIR Resources" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#patient">
<span class="md-ellipsis">
      Patient
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#observation-vital-signs">
<span class="md-ellipsis">
      Observation (Vital Signs)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#condition-diagnosis">
<span class="md-ellipsis">
      Condition (Diagnosis)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#medicationrequest">
<span class="md-ellipsis">
      MedicationRequest
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#error-handling">
<span class="md-ellipsis">
      Error Handling
    </span>
</a>
<nav aria-label="Error Handling" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#oauth-errors-authorization-callback">
<span class="md-ellipsis">
      OAuth Errors (Authorization Callback)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#http-status-codes">
<span class="md-ellipsis">
      HTTP Status Codes
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#fhir-operationoutcome">
<span class="md-ellipsis">
      FHIR OperationOutcome
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#testing-tools">
<span class="md-ellipsis">
      Testing Tools
    </span>
</a>
<nav aria-label="Testing Tools" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#smart-app-launcher">
<span class="md-ellipsis">
      SMART App Launcher
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#hapi-fhir-server-public-test-server">
<span class="md-ellipsis">
      HAPI FHIR Server (Public Test Server)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#postman-collection">
<span class="md-ellipsis">
      Postman Collection
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#curl-examples">
<span class="md-ellipsis">
      curl Examples
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#halo-specific-gotchas">
<span class="md-ellipsis">
      HALO-Specific Gotchas
    </span>
</a>
<nav aria-label="HALO-Specific Gotchas" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#token-expiration">
<span class="md-ellipsis">
      Token Expiration
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#rate-limiting">
<span class="md-ellipsis">
      Rate Limiting
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#redirect-uri-matching">
<span class="md-ellipsis">
      Redirect URI Matching
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#scope-requirements">
<span class="md-ellipsis">
      Scope Requirements
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#tenant-isolation">
<span class="md-ellipsis">
      Tenant Isolation
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#fhir-profiles">
<span class="md-ellipsis">
      FHIR Profiles
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#security-best-practices">
<span class="md-ellipsis">
      Security Best Practices
    </span>
</a>
<nav aria-label="Security Best Practices" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#do">
<span class="md-ellipsis">
      ✅ DO
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#dont">
<span class="md-ellipsis">
      ❌ DON'T
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#quick-reference-urls">
<span class="md-ellipsis">
      Quick Reference URLs
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#debugging-checklist">
<span class="md-ellipsis">
      Debugging Checklist
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#common-integration-patterns">
<span class="md-ellipsis">
      Common Integration Patterns
    </span>
</a>
<nav aria-label="Common Integration Patterns" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#pattern-1-simple-patient-dashboard">
<span class="md-ellipsis">
      Pattern 1: Simple Patient Dashboard
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#pattern-2-clinical-decision-support">
<span class="md-ellipsis">
      Pattern 2: Clinical Decision Support
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#pattern-3-data-entry-app">
<span class="md-ellipsis">
      Pattern 3: Data Entry App
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#pattern-4-batch-data-analysis-backend">
<span class="md-ellipsis">
      Pattern 4: Batch Data Analysis (Backend)
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#pro-tips">
<span class="md-ellipsis">
      Pro Tips
    </span>
</a>
<nav aria-label="Pro Tips" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#optimize-fhir-queries">
<span class="md-ellipsis">
      Optimize FHIR Queries
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#token-management-strategy">
<span class="md-ellipsis">
      Token Management Strategy
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#error-recovery-pattern">
<span class="md-ellipsis">
      Error Recovery Pattern
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#secure-token-storage-browser">
<span class="md-ellipsis">
      Secure Token Storage (Browser)
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#learning-path">
<span class="md-ellipsis">
      🎓 Learning Path
    </span>
</a>
<nav aria-label="🎓 Learning Path" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#beginner">
<span class="md-ellipsis">
      Beginner
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#intermediate">
<span class="md-ellipsis">
      Intermediate
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#advanced">
<span class="md-ellipsis">
      Advanced
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#troubleshooting-guide">
<span class="md-ellipsis">
      Troubleshooting Guide
    </span>
</a>
<nav aria-label="Troubleshooting Guide" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#issue-invalid-redirect-uri">
<span class="md-ellipsis">
      Issue: "Invalid redirect URI"
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#issue-invalid-scope">
<span class="md-ellipsis">
      Issue: "Invalid scope"
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#issue-token-expired-immediately">
<span class="md-ellipsis">
      Issue: Token expired immediately
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#issue-403-forbidden-on-fhir-request">
<span class="md-ellipsis">
      Issue: 403 Forbidden on FHIR request
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#issue-cors-errors-in-browser">
<span class="md-ellipsis">
      Issue: CORS errors in browser
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#issue-rate-limit-errors-429">
<span class="md-ellipsis">
      Issue: Rate limit errors (429)
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#pre-production-checklist">
<span class="md-ellipsis">
      Pre-Production Checklist
    </span>
</a>
<nav aria-label="Pre-Production Checklist" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#security">
<span class="md-ellipsis">
      Security
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#functionality">
<span class="md-ellipsis">
      Functionality
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#performance">
<span class="md-ellipsis">
      Performance
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#compliance">
<span class="md-ellipsis">
      Compliance
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#testing">
<span class="md-ellipsis">
      Testing
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#monitoring">
<span class="md-ellipsis">
      Monitoring
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#support-resources">
<span class="md-ellipsis">
      Support Resources
    </span>
</a>
<nav aria-label="Support Resources" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#official-documentation">
<span class="md-ellipsis">
      Official Documentation
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#community">
<span class="md-ellipsis">
      Community
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#testing-tools_1">
<span class="md-ellipsis">
      Testing Tools
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#libraries">
<span class="md-ellipsis">
      Libraries
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#halo-specific-quick-reference">
<span class="md-ellipsis">
      HALO-Specific Quick Reference
    </span>
</a>
<nav aria-label="HALO-Specific Quick Reference" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#typical-halo-configuration">
<span class="md-ellipsis">
      Typical HALO Configuration
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#halo-common-headers">
<span class="md-ellipsis">
      HALO Common Headers
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#halo-rate-limit-handling">
<span class="md-ellipsis">
      HALO Rate Limit Handling
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#halo-custom-extensions-example">
<span class="md-ellipsis">
      HALO Custom Extensions (Example)
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#common-gotchas-solutions">
<span class="md-ellipsis">
      Common Gotchas &amp; Solutions
    </span>
</a>
<nav aria-label="Common Gotchas &amp; Solutions" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#gotcha-1-token-in-url">
<span class="md-ellipsis">
      Gotcha #1: Token in URL
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#gotcha-2-not-validating-state">
<span class="md-ellipsis">
      Gotcha #2: Not Validating State
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#gotcha-3-hardcoded-fhir-base-url">
<span class="md-ellipsis">
      Gotcha #3: Hardcoded FHIR Base URL
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#gotcha-4-ignoring-token-expiration">
<span class="md-ellipsis">
      Gotcha #4: Ignoring Token Expiration
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#gotcha-5-not-handling-bundle-pagination">
<span class="md-ellipsis">
      Gotcha #5: Not Handling Bundle Pagination
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#gotcha-6-creating-resources-without-validation">
<span class="md-ellipsis">
      Gotcha #6: Creating Resources Without Validation
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#code-snippets-library">
<span class="md-ellipsis">
      Code Snippets Library
    </span>
</a>
<nav aria-label="Code Snippets Library" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#complete-smart-launch-minimal">
<span class="md-ellipsis">
      Complete SMART Launch (Minimal)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#fhir-search-with-filters">
<span class="md-ellipsis">
      FHIR Search with Filters
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#create-observation-helper">
<span class="md-ellipsis">
      Create Observation Helper
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#performance-optimization-tips">
<span class="md-ellipsis">
      Performance Optimization Tips
    </span>
</a>
<nav aria-label="Performance Optimization Tips" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#1-use-batch-requests">
<span class="md-ellipsis">
      1. Use Batch Requests
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#2-implement-caching">
<span class="md-ellipsis">
      2. Implement Caching
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#3-lazy-load-data">
<span class="md-ellipsis">
      3. Lazy Load Data
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#final-checklist-before-going-live">
<span class="md-ellipsis">
      Final Checklist Before Going Live
    </span>
</a>
<nav aria-label="Final Checklist Before Going Live" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#documentation">
<span class="md-ellipsis">
      Documentation
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#legal-compliance">
<span class="md-ellipsis">
      Legal &amp; Compliance
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#operations">
<span class="md-ellipsis">
      Operations
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#support">
<span class="md-ellipsis">
      Support
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../smart-fhir-visuals/">
<span class="md-ellipsis">
    SMART-on-FHIR and Integration — Visuals
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../gloss_ontario_halo/">
<span class="md-ellipsis">
    Ontario eHealth &amp; HALO Integration Glossary
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_7_5" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../sec_deepdive/">
<span class="md-ellipsis">
    Deep Dive into SMART-on-FHIR
  </span>
</a>
<label class="md-nav__link" for="__nav_7_5" id="__nav_7_5_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_7_5_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_7_5">
<span class="md-nav__icon md-icon"></span>
            Deep Dive into SMART-on-FHIR
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_7_5_2" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../sec_deepdive/eh-dd-01-foundations/">
<span class="md-ellipsis">
    Foundations
  </span>
</a>
<label class="md-nav__link" for="__nav_7_5_2" id="__nav_7_5_2_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_7_5_2_label" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_7_5_2">
<span class="md-nav__icon md-icon"></span>
            Foundations
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../sec_deepdive/eh-dd-01-foundations/deepdive-overview/">
<span class="md-ellipsis">
    Overview of SMART-on-FHIR
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../sec_deepdive/eh-dd-01-foundations/deepdive-overview-fhir-arch/">
<span class="md-ellipsis">
    SMART-on-FHIR Architecture Overview
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../sec_deepdive/eh-dd-01-foundations/deepdive-overview-fhir-resources/">
<span class="md-ellipsis">
    Key FHIR Resources
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_7_5_3" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../sec_deepdive/eh-dd-02-fhir-data-fundamentals/">
<span class="md-ellipsis">
    FHIR Data Fundamentals
  </span>
</a>
<label class="md-nav__link" for="__nav_7_5_3" id="__nav_7_5_3_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_7_5_3_label" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_7_5_3">
<span class="md-nav__icon md-icon"></span>
            FHIR Data Fundamentals
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../sec_deepdive/eh-dd-02-fhir-data-fundamentals/deepdive-fhir-data-types/">
<span class="md-ellipsis">
    FHIR Data Types
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../sec_deepdive/eh-dd-02-fhir-data-fundamentals/deepdive-fhir-code-systems/">
<span class="md-ellipsis">
    Common FHIR Code Systems
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../sec_deepdive/eh-dd-02-fhir-data-fundamentals/deepdive-fhir-cardinality/">
<span class="md-ellipsis">
    FHIR Resource Cardinality
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../sec_deepdive/eh-dd-02-fhir-data-fundamentals/deepdive-complete-resource-example/">
<span class="md-ellipsis">
    Complete Example Resource
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_7_5_4" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../sec_deepdive/eh-dd-03-fhir-resource-relationships/">
<span class="md-ellipsis">
    FHIR Resource Relationships
  </span>
</a>
<label class="md-nav__link" for="__nav_7_5_4" id="__nav_7_5_4_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_7_5_4_label" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_7_5_4">
<span class="md-nav__icon md-icon"></span>
            FHIR Resource Relationships
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../sec_deepdive/eh-dd-03-fhir-resource-relationships/deepdive-fhir-resource-relationship/">
<span class="md-ellipsis">
    Deepdive fhir resource relationship
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../sec_deepdive/eh-dd-03-fhir-resource-relationships/deepdive-fhir-resource-relationships-comprehensive/">
<span class="md-ellipsis">
    FHIR Comprehensive Resource Relationships
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../sec_deepdive/eh-dd-03-fhir-resource-relationships/deepdive-fhir-resource-bundles/">
<span class="md-ellipsis">
    FHIR Resource Bundles
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_7_5_5" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../sec_deepdive/eh-dd-04-working-with-fhir-apis/">
<span class="md-ellipsis">
    Working with FHIR Resource APIs
  </span>
</a>
<label class="md-nav__link" for="__nav_7_5_5" id="__nav_7_5_5_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_7_5_5_label" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_7_5_5">
<span class="md-nav__icon md-icon"></span>
            Working with FHIR Resource APIs
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../sec_deepdive/eh-dd-04-working-with-fhir-apis/deepdive-fhir-search-parameters/">
<span class="md-ellipsis">
    FHIR Search Parameters
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../sec_deepdive/eh-dd-04-working-with-fhir-apis/deepdive-fhir-rest-common-ops/">
<span class="md-ellipsis">
    Common FHIR Operations (REST API)
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../sec_deepdive/eh-dd-04-working-with-fhir-apis/deepdive-error-handling/">
<span class="md-ellipsis">
    Error Handling and OperationOutcome
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../sec_deepdive/eh-dd-04-working-with-fhir-apis/deepdive-fhir-validation/">
<span class="md-ellipsis">
    FHIR Validation
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_7_5_6" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../sec_deepdive/eh-dd-05-advanced-fhir-concepts/">
<span class="md-ellipsis">
    Advanced FHIR Concepts
  </span>
</a>
<label class="md-nav__link" for="__nav_7_5_6" id="__nav_7_5_6_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_7_5_6_label" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_7_5_6">
<span class="md-nav__icon md-icon"></span>
            Advanced FHIR Concepts
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../sec_deepdive/eh-dd-05-advanced-fhir-concepts/deepdive-fhir-profiles-and-extensions/">
<span class="md-ellipsis">
    FHIR Profiles and Extensions
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_7_5_7" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../sec_deepdive/eh-dd-06-smart-auth/">
<span class="md-ellipsis">
    SMART Authorization
  </span>
</a>
<label class="md-nav__link" for="__nav_7_5_7" id="__nav_7_5_7_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_7_5_7_label" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_7_5_7">
<span class="md-nav__icon md-icon"></span>
            SMART Authorization
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../sec_deepdive/eh-dd-06-smart-auth/deepdive-oauth-flow/">
<span class="md-ellipsis">
    OAuth 2.0 Flow
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../sec_deepdive/eh-dd-06-smart-auth/deepdive-smart-launch-flow/">
<span class="md-ellipsis">
    SMART Launch Flow
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../sec_deepdive/eh-dd-06-smart-auth/deepdive-smart-scopes-and-auth/">
<span class="md-ellipsis">
    SMART Scopes and Authorization
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../sec_deepdive/eh-dd-06-smart-auth/deepdive-smart-config-discovery/">
<span class="md-ellipsis">
    SMART Configuration Discovery
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../sec_deepdive/eh-dd-06-smart-auth/deepdive-security-and-access-control/">
<span class="md-ellipsis">
    Security and Access Control
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_7_5_8" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../sec_deepdive/eh-dd-07-hands-on-practice/">
<span class="md-ellipsis">
    Hands-On Practice
  </span>
</a>
<label class="md-nav__link" for="__nav_7_5_8" id="__nav_7_5_8_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_7_5_8_label" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_7_5_8">
<span class="md-nav__icon md-icon"></span>
            Hands-On Practice
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../sec_deepdive/eh-dd-07-hands-on-practice/deepdive-smart-health-it-sandbox/">
<span class="md-ellipsis">
    Using the SMART Health IT Sandbox
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../sec_deepdive/eh-dd-07-hands-on-practice/deepdive-smart_client_impl-sample-app/">
<span class="md-ellipsis">
    Practical Example: Building a SMART App
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../sec_deepdive/eh-dd-07-hands-on-practice/deepdive-smart_client_impl/">
<span class="md-ellipsis">
    SMART Client Implementation (Python)
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../sec_deepdive/eh-dd-07-hands-on-practice/deepdive-smart_client_impl-practical-code-examples/">
<span class="md-ellipsis">
    Practical Code Examples
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../sec_deepdive/eh-dd-07-hands-on-practice/deepdive-testing-and-debugging/">
<span class="md-ellipsis">
    Testing and Debugging
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_7_5_9" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../sec_deepdive/eh-dd-08-wrap-up/">
<span class="md-ellipsis">
    Wrap-Up
  </span>
</a>
<label class="md-nav__link" for="__nav_7_5_9" id="__nav_7_5_9_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_7_5_9_label" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_7_5_9">
<span class="md-nav__icon md-icon"></span>
            Wrap-Up
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../sec_deepdive/eh-dd-08-wrap-up/deepdive-key-takeaways/">
<span class="md-ellipsis">
    Deepdive key takeaways
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../sec_deepdive/eh-dd-08-wrap-up/deepdive-summary/">
<span class="md-ellipsis">
    Summary
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_8" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../sec_cheatsheets/">
<span class="md-ellipsis">
    VARIOUS CHEAT SHEETS
  </span>
</a>
<label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_8_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_8">
<span class="md-nav__icon md-icon"></span>
            VARIOUS CHEAT SHEETS
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../sec_cheatsheets/cheatsheet-docker/">
<span class="md-ellipsis">
    Docker Command Cheatsheet
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../sec_cheatsheets/cheatsheet-kubectl/">
<span class="md-ellipsis">
    Kubectl Command Cheat Sheet
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../sec_cheatsheets/cheatsheet_compound-modifiers/">
<span class="md-ellipsis">
    Compound Modifiers Cheat Sheet
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_9" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../sec_gloss/">
<span class="md-ellipsis">
    MISC GLOSSARIES
  </span>
</a>
<label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_9_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_9">
<span class="md-nav__icon md-icon"></span>
            MISC GLOSSARIES
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../sec_gloss/gloss_oss/">
<span class="md-ellipsis">
    Glossary of OSS Terms
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../sec_gloss/gloss_networking/">
<span class="md-ellipsis">
    Glossary of Networking Terms
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../sec_gloss/gloss_kuber/">
<span class="md-ellipsis">
    Glossary of Kubernetes Terms
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../sec_gloss/gloss_cloud-native/">
<span class="md-ellipsis">
    Glossary of Cloud-Native Terms
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#quick-start-checklist">
<span class="md-ellipsis">
      Quick Start Checklist
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#discovery-endpoint">
<span class="md-ellipsis">
      Discovery Endpoint
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#authorization-flow">
<span class="md-ellipsis">
      Authorization Flow
    </span>
</a>
<nav aria-label="Authorization Flow" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#step-1-authorization-request-ehr-launch">
<span class="md-ellipsis">
      Step 1: Authorization Request (EHR Launch)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#step-2-authorization-request-standalone-launch">
<span class="md-ellipsis">
      Step 2: Authorization Request (Standalone Launch)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#step-3-token-exchange">
<span class="md-ellipsis">
      Step 3: Token Exchange
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#step-4-token-refresh">
<span class="md-ellipsis">
      Step 4: Token Refresh
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#smart-scopes">
<span class="md-ellipsis">
      SMART Scopes
    </span>
</a>
<nav aria-label="SMART Scopes" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#context-scopes">
<span class="md-ellipsis">
      Context Scopes
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#patient-specific-scopes">
<span class="md-ellipsis">
      Patient-Specific Scopes
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#user-scopes">
<span class="md-ellipsis">
      User Scopes
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#system-scopes-backend-services">
<span class="md-ellipsis">
      System Scopes (Backend Services)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#special-scopes">
<span class="md-ellipsis">
      Special Scopes
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#fhir-api-requests">
<span class="md-ellipsis">
      FHIR API Requests
    </span>
</a>
<nav aria-label="FHIR API Requests" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#read-single-resource">
<span class="md-ellipsis">
      Read Single Resource
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#search-resources">
<span class="md-ellipsis">
      Search Resources
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#common-search-parameters">
<span class="md-ellipsis">
      Common Search Parameters
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#create-resource">
<span class="md-ellipsis">
      Create Resource
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#update-resource">
<span class="md-ellipsis">
      Update Resource
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#delete-resource">
<span class="md-ellipsis">
      Delete Resource
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#pkce-implementation">
<span class="md-ellipsis">
      PKCE Implementation
    </span>
</a>
<nav aria-label="PKCE Implementation" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#generate-code-verifier">
<span class="md-ellipsis">
      Generate Code Verifier
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#generate-code-challenge">
<span class="md-ellipsis">
      Generate Code Challenge
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#common-fhir-resources">
<span class="md-ellipsis">
      Common FHIR Resources
    </span>
</a>
<nav aria-label="Common FHIR Resources" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#patient">
<span class="md-ellipsis">
      Patient
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#observation-vital-signs">
<span class="md-ellipsis">
      Observation (Vital Signs)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#condition-diagnosis">
<span class="md-ellipsis">
      Condition (Diagnosis)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#medicationrequest">
<span class="md-ellipsis">
      MedicationRequest
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#error-handling">
<span class="md-ellipsis">
      Error Handling
    </span>
</a>
<nav aria-label="Error Handling" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#oauth-errors-authorization-callback">
<span class="md-ellipsis">
      OAuth Errors (Authorization Callback)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#http-status-codes">
<span class="md-ellipsis">
      HTTP Status Codes
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#fhir-operationoutcome">
<span class="md-ellipsis">
      FHIR OperationOutcome
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#testing-tools">
<span class="md-ellipsis">
      Testing Tools
    </span>
</a>
<nav aria-label="Testing Tools" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#smart-app-launcher">
<span class="md-ellipsis">
      SMART App Launcher
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#hapi-fhir-server-public-test-server">
<span class="md-ellipsis">
      HAPI FHIR Server (Public Test Server)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#postman-collection">
<span class="md-ellipsis">
      Postman Collection
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#curl-examples">
<span class="md-ellipsis">
      curl Examples
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#halo-specific-gotchas">
<span class="md-ellipsis">
      HALO-Specific Gotchas
    </span>
</a>
<nav aria-label="HALO-Specific Gotchas" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#token-expiration">
<span class="md-ellipsis">
      Token Expiration
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#rate-limiting">
<span class="md-ellipsis">
      Rate Limiting
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#redirect-uri-matching">
<span class="md-ellipsis">
      Redirect URI Matching
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#scope-requirements">
<span class="md-ellipsis">
      Scope Requirements
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#tenant-isolation">
<span class="md-ellipsis">
      Tenant Isolation
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#fhir-profiles">
<span class="md-ellipsis">
      FHIR Profiles
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#security-best-practices">
<span class="md-ellipsis">
      Security Best Practices
    </span>
</a>
<nav aria-label="Security Best Practices" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#do">
<span class="md-ellipsis">
      ✅ DO
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#dont">
<span class="md-ellipsis">
      ❌ DON'T
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#quick-reference-urls">
<span class="md-ellipsis">
      Quick Reference URLs
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#debugging-checklist">
<span class="md-ellipsis">
      Debugging Checklist
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#common-integration-patterns">
<span class="md-ellipsis">
      Common Integration Patterns
    </span>
</a>
<nav aria-label="Common Integration Patterns" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#pattern-1-simple-patient-dashboard">
<span class="md-ellipsis">
      Pattern 1: Simple Patient Dashboard
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#pattern-2-clinical-decision-support">
<span class="md-ellipsis">
      Pattern 2: Clinical Decision Support
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#pattern-3-data-entry-app">
<span class="md-ellipsis">
      Pattern 3: Data Entry App
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#pattern-4-batch-data-analysis-backend">
<span class="md-ellipsis">
      Pattern 4: Batch Data Analysis (Backend)
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#pro-tips">
<span class="md-ellipsis">
      Pro Tips
    </span>
</a>
<nav aria-label="Pro Tips" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#optimize-fhir-queries">
<span class="md-ellipsis">
      Optimize FHIR Queries
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#token-management-strategy">
<span class="md-ellipsis">
      Token Management Strategy
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#error-recovery-pattern">
<span class="md-ellipsis">
      Error Recovery Pattern
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#secure-token-storage-browser">
<span class="md-ellipsis">
      Secure Token Storage (Browser)
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#learning-path">
<span class="md-ellipsis">
      🎓 Learning Path
    </span>
</a>
<nav aria-label="🎓 Learning Path" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#beginner">
<span class="md-ellipsis">
      Beginner
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#intermediate">
<span class="md-ellipsis">
      Intermediate
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#advanced">
<span class="md-ellipsis">
      Advanced
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#troubleshooting-guide">
<span class="md-ellipsis">
      Troubleshooting Guide
    </span>
</a>
<nav aria-label="Troubleshooting Guide" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#issue-invalid-redirect-uri">
<span class="md-ellipsis">
      Issue: "Invalid redirect URI"
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#issue-invalid-scope">
<span class="md-ellipsis">
      Issue: "Invalid scope"
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#issue-token-expired-immediately">
<span class="md-ellipsis">
      Issue: Token expired immediately
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#issue-403-forbidden-on-fhir-request">
<span class="md-ellipsis">
      Issue: 403 Forbidden on FHIR request
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#issue-cors-errors-in-browser">
<span class="md-ellipsis">
      Issue: CORS errors in browser
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#issue-rate-limit-errors-429">
<span class="md-ellipsis">
      Issue: Rate limit errors (429)
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#pre-production-checklist">
<span class="md-ellipsis">
      Pre-Production Checklist
    </span>
</a>
<nav aria-label="Pre-Production Checklist" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#security">
<span class="md-ellipsis">
      Security
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#functionality">
<span class="md-ellipsis">
      Functionality
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#performance">
<span class="md-ellipsis">
      Performance
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#compliance">
<span class="md-ellipsis">
      Compliance
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#testing">
<span class="md-ellipsis">
      Testing
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#monitoring">
<span class="md-ellipsis">
      Monitoring
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#support-resources">
<span class="md-ellipsis">
      Support Resources
    </span>
</a>
<nav aria-label="Support Resources" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#official-documentation">
<span class="md-ellipsis">
      Official Documentation
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#community">
<span class="md-ellipsis">
      Community
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#testing-tools_1">
<span class="md-ellipsis">
      Testing Tools
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#libraries">
<span class="md-ellipsis">
      Libraries
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#halo-specific-quick-reference">
<span class="md-ellipsis">
      HALO-Specific Quick Reference
    </span>
</a>
<nav aria-label="HALO-Specific Quick Reference" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#typical-halo-configuration">
<span class="md-ellipsis">
      Typical HALO Configuration
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#halo-common-headers">
<span class="md-ellipsis">
      HALO Common Headers
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#halo-rate-limit-handling">
<span class="md-ellipsis">
      HALO Rate Limit Handling
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#halo-custom-extensions-example">
<span class="md-ellipsis">
      HALO Custom Extensions (Example)
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#common-gotchas-solutions">
<span class="md-ellipsis">
      Common Gotchas &amp; Solutions
    </span>
</a>
<nav aria-label="Common Gotchas &amp; Solutions" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#gotcha-1-token-in-url">
<span class="md-ellipsis">
      Gotcha #1: Token in URL
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#gotcha-2-not-validating-state">
<span class="md-ellipsis">
      Gotcha #2: Not Validating State
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#gotcha-3-hardcoded-fhir-base-url">
<span class="md-ellipsis">
      Gotcha #3: Hardcoded FHIR Base URL
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#gotcha-4-ignoring-token-expiration">
<span class="md-ellipsis">
      Gotcha #4: Ignoring Token Expiration
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#gotcha-5-not-handling-bundle-pagination">
<span class="md-ellipsis">
      Gotcha #5: Not Handling Bundle Pagination
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#gotcha-6-creating-resources-without-validation">
<span class="md-ellipsis">
      Gotcha #6: Creating Resources Without Validation
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#code-snippets-library">
<span class="md-ellipsis">
      Code Snippets Library
    </span>
</a>
<nav aria-label="Code Snippets Library" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#complete-smart-launch-minimal">
<span class="md-ellipsis">
      Complete SMART Launch (Minimal)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#fhir-search-with-filters">
<span class="md-ellipsis">
      FHIR Search with Filters
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#create-observation-helper">
<span class="md-ellipsis">
      Create Observation Helper
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#performance-optimization-tips">
<span class="md-ellipsis">
      Performance Optimization Tips
    </span>
</a>
<nav aria-label="Performance Optimization Tips" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#1-use-batch-requests">
<span class="md-ellipsis">
      1. Use Batch Requests
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#2-implement-caching">
<span class="md-ellipsis">
      2. Implement Caching
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#3-lazy-load-data">
<span class="md-ellipsis">
      3. Lazy Load Data
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#final-checklist-before-going-live">
<span class="md-ellipsis">
      Final Checklist Before Going Live
    </span>
</a>
<nav aria-label="Final Checklist Before Going Live" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#documentation">
<span class="md-ellipsis">
      Documentation
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#legal-compliance">
<span class="md-ellipsis">
      Legal &amp; Compliance
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#operations">
<span class="md-ellipsis">
      Operations
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#support">
<span class="md-ellipsis">
      Support
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<h1 id="smart-on-fhir-and-integration-quick-reference">SMART-on-FHIR and Integration Quick Reference</h1>
<h2 id="quick-start-checklist">Quick Start Checklist</h2>
<ul>
<li>[ ] Register app with EHR/HALO</li>
<li>[ ] Obtain <code>client_id</code> (and <code>client_secret</code> for confidential clients)</li>
<li>[ ] Configure redirect URIs</li>
<li>[ ] Discover SMART endpoints via <code>.well-known/smart-configuration</code></li>
<li>[ ] Implement OAuth 2.0 authorization flow with PKCE</li>
<li>[ ] Handle token lifecycle (refresh, expiration)</li>
<li>[ ] Test in sandbox environment</li>
</ul>
<hr/>
<h2 id="discovery-endpoint">Discovery Endpoint</h2>
<div class="highlight"><pre><span></span><code><span class="err">GET https://[fhir-base]/.well-known/smart-configuration</span>
</code></pre></div>
<p><strong>Returns:</strong>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">"authorization_endpoint"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://auth.example.com/authorize"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"token_endpoint"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://auth.example.com/token"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"token_endpoint_auth_methods_supported"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"client_secret_basic"</span><span class="p">],</span>
<span class="w">  </span><span class="nt">"registration_endpoint"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://auth.example.com/register"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"scopes_supported"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"launch"</span><span class="p">,</span><span class="w"> </span><span class="s2">"launch/patient"</span><span class="p">,</span><span class="w"> </span><span class="s2">"patient/*.read"</span><span class="p">],</span>
<span class="w">  </span><span class="nt">"response_types_supported"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"code"</span><span class="p">],</span>
<span class="w">  </span><span class="nt">"capabilities"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="s2">"launch-ehr"</span><span class="p">,</span>
<span class="w">    </span><span class="s2">"launch-standalone"</span><span class="p">,</span>
<span class="w">    </span><span class="s2">"client-public"</span><span class="p">,</span>
<span class="w">    </span><span class="s2">"client-confidential-symmetric"</span><span class="p">,</span>
<span class="w">    </span><span class="s2">"context-ehr-patient"</span><span class="p">,</span>
<span class="w">    </span><span class="s2">"sso-openid-connect"</span>
<span class="w">  </span><span class="p">]</span>
<span class="p">}</span>
</code></pre></div></p>
<hr/>
<h2 id="authorization-flow">Authorization Flow</h2>
<h3 id="step-1-authorization-request-ehr-launch">Step 1: Authorization Request (EHR Launch)</h3>
<div class="highlight"><pre><span></span><code><span class="err">GET /authorize?</span>
<span class="err">  response_type=code&amp;</span>
<span class="err">  client_id=[YOUR_CLIENT_ID]&amp;</span>
<span class="err">  redirect_uri=[YOUR_REDIRECT_URI]&amp;</span>
<span class="err">  scope=launch/patient patient/*.read&amp;</span>
<span class="err">  state=[RANDOM_STRING]&amp;</span>
<span class="err">  aud=[FHIR_BASE_URL]&amp;</span>
<span class="err">  launch=[LAUNCH_TOKEN]&amp;</span>
<span class="err">  code_challenge=[SHA256_HASH]&amp;</span>
<span class="err">  code_challenge_method=S256</span>
</code></pre></div>
<h3 id="step-2-authorization-request-standalone-launch">Step 2: Authorization Request (Standalone Launch)</h3>
<div class="highlight"><pre><span></span><code><span class="err">GET /authorize?</span>
<span class="err">  response_type=code&amp;</span>
<span class="err">  client_id=[YOUR_CLIENT_ID]&amp;</span>
<span class="err">  redirect_uri=[YOUR_REDIRECT_URI]&amp;</span>
<span class="err">  scope=patient/*.read openid fhirUser&amp;</span>
<span class="err">  state=[RANDOM_STRING]&amp;</span>
<span class="err">  aud=[FHIR_BASE_URL]&amp;</span>
<span class="err">  code_challenge=[SHA256_HASH]&amp;</span>
<span class="err">  code_challenge_method=S256</span>
</code></pre></div>
<p><strong>Note:</strong> No <code>launch</code> parameter in standalone!</p>
<h3 id="step-3-token-exchange">Step 3: Token Exchange</h3>
<div class="highlight"><pre><span></span><code><span class="err">POST /token</span>
<span class="err">Content-Type: application/x-www-form-urlencoded</span>
<span class="err">Authorization: Basic [BASE64(client_id:client_secret)]  // For confidential clients</span>

<span class="err">grant_type=authorization_code&amp;</span>
<span class="err">code=[AUTH_CODE]&amp;</span>
<span class="err">redirect_uri=[YOUR_REDIRECT_URI]&amp;</span>
<span class="err">client_id=[YOUR_CLIENT_ID]&amp;</span>
<span class="err">code_verifier=[ORIGINAL_VERIFIER]</span>
</code></pre></div>
<p><strong>Response:</strong>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">"access_token"</span><span class="p">:</span><span class="w"> </span><span class="s2">"eyJ0eXAiOiJKV1Qi..."</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"token_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Bearer"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"expires_in"</span><span class="p">:</span><span class="w"> </span><span class="mi">3600</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"scope"</span><span class="p">:</span><span class="w"> </span><span class="s2">"launch/patient patient/*.read"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"patient"</span><span class="p">:</span><span class="w"> </span><span class="s2">"123456"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"encounter"</span><span class="p">:</span><span class="w"> </span><span class="s2">"789"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"refresh_token"</span><span class="p">:</span><span class="w"> </span><span class="s2">"eyJ0eXAiOiJKV1Qi..."</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"id_token"</span><span class="p">:</span><span class="w"> </span><span class="s2">"eyJ0eXAiOiJKV1Qi..."</span><span class="w">  </span><span class="c1">// If openid scope</span>
<span class="p">}</span>
</code></pre></div></p>
<h3 id="step-4-token-refresh">Step 4: Token Refresh</h3>
<div class="highlight"><pre><span></span><code><span class="err">POST /token</span>
<span class="err">Content-Type: application/x-www-form-urlencoded</span>

<span class="err">grant_type=refresh_token&amp;</span>
<span class="err">refresh_token=[REFRESH_TOKEN]&amp;</span>
<span class="err">client_id=[YOUR_CLIENT_ID]&amp;</span>
<span class="err">scope=[ORIGINAL_SCOPES]</span>
</code></pre></div>
<hr/>
<h2 id="smart-scopes">SMART Scopes</h2>
<h3 id="context-scopes">Context Scopes</h3>
<table>
<thead>
<tr>
<th>Scope</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>launch</code></td>
<td>Indicates EHR launch</td>
</tr>
<tr>
<td><code>launch/patient</code></td>
<td>Request patient context at launch</td>
</tr>
<tr>
<td><code>launch/encounter</code></td>
<td>Request encounter context at launch</td>
</tr>
</tbody>
</table>
<h3 id="patient-specific-scopes">Patient-Specific Scopes</h3>
<table>
<thead>
<tr>
<th>Scope</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>patient/*.read</code></td>
<td>Read all resources for patient in context</td>
</tr>
<tr>
<td><code>patient/*.write</code></td>
<td>Write all resources for patient in context</td>
</tr>
<tr>
<td><code>patient/*.*</code></td>
<td>Read and write all resources</td>
</tr>
<tr>
<td><code>patient/Observation.read</code></td>
<td>Read only Observations for patient</td>
</tr>
<tr>
<td><code>patient/Condition.read</code></td>
<td>Read only Conditions for patient</td>
</tr>
<tr>
<td><code>patient/MedicationRequest.read</code></td>
<td>Read only MedicationRequests</td>
</tr>
</tbody>
</table>
<h3 id="user-scopes">User Scopes</h3>
<table>
<thead>
<tr>
<th>Scope</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>user/*.read</code></td>
<td>Read all resources user can access</td>
</tr>
<tr>
<td><code>user/*.write</code></td>
<td>Write all resources user can access</td>
</tr>
<tr>
<td><code>user/Practitioner.read</code></td>
<td>Read Practitioner resources</td>
</tr>
</tbody>
</table>
<h3 id="system-scopes-backend-services">System Scopes (Backend Services)</h3>
<table>
<thead>
<tr>
<th>Scope</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>system/*.read</code></td>
<td>Read all resources (backend only)</td>
</tr>
<tr>
<td><code>system/*.write</code></td>
<td>Write all resources (backend only)</td>
</tr>
</tbody>
</table>
<h3 id="special-scopes">Special Scopes</h3>
<table>
<thead>
<tr>
<th>Scope</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>openid</code></td>
<td>OpenID Connect authentication</td>
</tr>
<tr>
<td><code>fhirUser</code></td>
<td>Get FHIR resource reference for user</td>
</tr>
<tr>
<td><code>profile</code></td>
<td>Get user profile info</td>
</tr>
<tr>
<td><code>offline_access</code></td>
<td>Request refresh token</td>
</tr>
<tr>
<td><code>online_access</code></td>
<td>Token valid only while user online</td>
</tr>
</tbody>
</table>
<hr/>
<h2 id="fhir-api-requests">FHIR API Requests</h2>
<h3 id="read-single-resource">Read Single Resource</h3>
<div class="highlight"><pre><span></span><code><span class="err">GET /Patient/123456</span>
<span class="err">Authorization: Bearer [ACCESS_TOKEN]</span>
<span class="err">Accept: application/fhir+json</span>
</code></pre></div>
<h3 id="search-resources">Search Resources</h3>
<div class="highlight"><pre><span></span><code><span class="err">GET /Observation?patient=123456&amp;category=vital-signs&amp;date=ge2024-01-01</span>
<span class="err">Authorization: Bearer [ACCESS_TOKEN]</span>
<span class="err">Accept: application/fhir+json</span>
</code></pre></div>
<h3 id="common-search-parameters">Common Search Parameters</h3>
<ul>
<li><code>patient</code> - Filter by patient</li>
<li><code>_id</code> - Resource ID</li>
<li><code>_lastUpdated</code> - Last update time</li>
<li><code>_count</code> - Number of results</li>
<li><code>_sort</code> - Sort order</li>
<li><code>date</code> - Date range (use <code>ge</code>, <code>le</code>, <code>gt</code>, <code>lt</code> prefixes)</li>
<li><code>code</code> - Filter by code</li>
<li><code>status</code> - Filter by status</li>
</ul>
<h3 id="create-resource">Create Resource</h3>
<div class="highlight"><pre><span></span><code><span class="err">POST /Observation</span>
<span class="err">Authorization: Bearer [ACCESS_TOKEN]</span>
<span class="err">Content-Type: application/fhir+json</span>

<span class="err">{</span>
<span class="err">  "resourceType": "Observation",</span>
<span class="err">  "status": "final",</span>
<span class="err">  "code": {</span>
<span class="err">    "coding": [{</span>
<span class="err">      "system": "http://loinc.org",</span>
<span class="err">      "code": "29463-7",</span>
<span class="err">      "display": "Body Weight"</span>
<span class="err">    }]</span>
<span class="err">  },</span>
<span class="err">  "subject": { "reference": "Patient/123456" },</span>
<span class="err">  "valueQuantity": {</span>
<span class="err">    "value": 70,</span>
<span class="err">    "unit": "kg",</span>
<span class="err">    "system": "http://unitsofmeasure.org",</span>
<span class="err">    "code": "kg"</span>
<span class="err">  }</span>
<span class="err">}</span>
</code></pre></div>
<h3 id="update-resource">Update Resource</h3>
<div class="highlight"><pre><span></span><code><span class="err">PUT /Observation/789</span>
<span class="err">Authorization: Bearer [ACCESS_TOKEN]</span>
<span class="err">Content-Type: application/fhir+json</span>

<span class="err">{</span>
<span class="err">  "resourceType": "Observation",</span>
<span class="err">  "id": "789",</span>
<span class="err">  ... [complete updated resource]</span>
<span class="err">}</span>
</code></pre></div>
<h3 id="delete-resource">Delete Resource</h3>
<div class="highlight"><pre><span></span><code><span class="err">DELETE /Observation/789</span>
<span class="err">Authorization: Bearer [ACCESS_TOKEN]</span>
</code></pre></div>
<hr/>
<h2 id="pkce-implementation">PKCE Implementation</h2>
<h3 id="generate-code-verifier">Generate Code Verifier</h3>
<div class="highlight"><pre><span></span><code><span class="kd">function</span><span class="w"> </span><span class="nx">generateCodeVerifier</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">array</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Uint8Array</span><span class="p">(</span><span class="mf">32</span><span class="p">);</span>
<span class="w">  </span><span class="nx">crypto</span><span class="p">.</span><span class="nx">getRandomValues</span><span class="p">(</span><span class="nx">array</span><span class="p">);</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">base64URLEncode</span><span class="p">(</span><span class="nx">array</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="generate-code-challenge">Generate Code Challenge</h3>
<div class="highlight"><pre><span></span><code><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">generateCodeChallenge</span><span class="p">(</span><span class="nx">verifier</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">encoder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">TextEncoder</span><span class="p">();</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">encoder</span><span class="p">.</span><span class="nx">encode</span><span class="p">(</span><span class="nx">verifier</span><span class="p">);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">hash</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">crypto</span><span class="p">.</span><span class="nx">subtle</span><span class="p">.</span><span class="nx">digest</span><span class="p">(</span><span class="s1">'SHA-256'</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="p">);</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">base64URLEncode</span><span class="p">(</span><span class="ow">new</span><span class="w"> </span><span class="nb">Uint8Array</span><span class="p">(</span><span class="nx">hash</span><span class="p">));</span>
<span class="p">}</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">base64URLEncode</span><span class="p">(</span><span class="nx">buffer</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">btoa</span><span class="p">(</span><span class="nb">String</span><span class="p">.</span><span class="nx">fromCharCode</span><span class="p">(...</span><span class="nx">buffer</span><span class="p">))</span>
<span class="w">    </span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\+/g</span><span class="p">,</span><span class="w"> </span><span class="s1">'-'</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\//g</span><span class="p">,</span><span class="w"> </span><span class="s1">'_'</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/=/g</span><span class="p">,</span><span class="w"> </span><span class="s1">''</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<hr/>
<h2 id="common-fhir-resources">Common FHIR Resources</h2>
<h3 id="patient">Patient</h3>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">"resourceType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Patient"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"123"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="w"> </span><span class="nt">"family"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Smith"</span><span class="p">,</span><span class="w"> </span><span class="nt">"given"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"John"</span><span class="p">]</span><span class="w"> </span><span class="p">}],</span>
<span class="w">  </span><span class="nt">"birthDate"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1970-01-01"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"gender"</span><span class="p">:</span><span class="w"> </span><span class="s2">"male"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"identifier"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span>
<span class="w">    </span><span class="nt">"system"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://hospital.org/mrn"</span><span class="p">,</span>
<span class="w">    </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"12345"</span>
<span class="w">  </span><span class="p">}]</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="observation-vital-signs">Observation (Vital Signs)</h3>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">"resourceType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Observation"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"final"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"category"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span>
<span class="w">    </span><span class="nt">"coding"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span>
<span class="w">      </span><span class="nt">"system"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://terminology.hl7.org/CodeSystem/observation-category"</span><span class="p">,</span>
<span class="w">      </span><span class="nt">"code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"vital-signs"</span>
<span class="w">    </span><span class="p">}]</span>
<span class="w">  </span><span class="p">}],</span>
<span class="w">  </span><span class="nt">"code"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">"coding"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span>
<span class="w">      </span><span class="nt">"system"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://loinc.org"</span><span class="p">,</span>
<span class="w">      </span><span class="nt">"code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"85354-9"</span><span class="p">,</span>
<span class="w">      </span><span class="nt">"display"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Blood pressure"</span>
<span class="w">    </span><span class="p">}]</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">"subject"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">"reference"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Patient/123"</span><span class="w"> </span><span class="p">},</span>
<span class="w">  </span><span class="nt">"effectiveDateTime"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2024-01-15T10:30:00Z"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"component"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">"code"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">"coding"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span>
<span class="w">          </span><span class="nt">"system"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://loinc.org"</span><span class="p">,</span>
<span class="w">          </span><span class="nt">"code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"8480-6"</span><span class="p">,</span>
<span class="w">          </span><span class="nt">"display"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Systolic"</span>
<span class="w">        </span><span class="p">}]</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="nt">"valueQuantity"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="mi">120</span><span class="p">,</span><span class="w"> </span><span class="nt">"unit"</span><span class="p">:</span><span class="w"> </span><span class="s2">"mmHg"</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">"code"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">"coding"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span>
<span class="w">          </span><span class="nt">"system"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://loinc.org"</span><span class="p">,</span>
<span class="w">          </span><span class="nt">"code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"8462-4"</span><span class="p">,</span>
<span class="w">          </span><span class="nt">"display"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Diastolic"</span>
<span class="w">        </span><span class="p">}]</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="nt">"valueQuantity"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="mi">80</span><span class="p">,</span><span class="w"> </span><span class="nt">"unit"</span><span class="p">:</span><span class="w"> </span><span class="s2">"mmHg"</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">]</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="condition-diagnosis">Condition (Diagnosis)</h3>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">"resourceType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Condition"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"clinicalStatus"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">"coding"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span>
<span class="w">      </span><span class="nt">"system"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://terminology.hl7.org/CodeSystem/condition-clinical"</span><span class="p">,</span>
<span class="w">      </span><span class="nt">"code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"active"</span>
<span class="w">    </span><span class="p">}]</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">"code"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">"coding"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span>
<span class="w">      </span><span class="nt">"system"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://snomed.info/sct"</span><span class="p">,</span>
<span class="w">      </span><span class="nt">"code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"73211009"</span><span class="p">,</span>
<span class="w">      </span><span class="nt">"display"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Diabetes mellitus"</span>
<span class="w">    </span><span class="p">}]</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">"subject"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">"reference"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Patient/123"</span><span class="w"> </span><span class="p">},</span>
<span class="w">  </span><span class="nt">"onsetDateTime"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2020-03-15"</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="medicationrequest">MedicationRequest</h3>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">"resourceType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"MedicationRequest"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"active"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"intent"</span><span class="p">:</span><span class="w"> </span><span class="s2">"order"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"medicationCodeableConcept"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">"coding"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span>
<span class="w">      </span><span class="nt">"system"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://www.nlm.nih.gov/research/umls/rxnorm"</span><span class="p">,</span>
<span class="w">      </span><span class="nt">"code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"206765"</span><span class="p">,</span>
<span class="w">      </span><span class="nt">"display"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Metformin 500 MG"</span>
<span class="w">    </span><span class="p">}]</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">"subject"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">"reference"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Patient/123"</span><span class="w"> </span><span class="p">},</span>
<span class="w">  </span><span class="nt">"dosageInstruction"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span>
<span class="w">    </span><span class="nt">"text"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Take 1 tablet twice daily with meals"</span><span class="p">,</span>
<span class="w">    </span><span class="nt">"timing"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">"repeat"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">"frequency"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="nt">"period"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="nt">"periodUnit"</span><span class="p">:</span><span class="w"> </span><span class="s2">"d"</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">"doseAndRate"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span>
<span class="w">      </span><span class="nt">"doseQuantity"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="nt">"unit"</span><span class="p">:</span><span class="w"> </span><span class="s2">"tablet"</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="p">}]</span>
<span class="w">  </span><span class="p">}]</span>
<span class="p">}</span>
</code></pre></div>
<hr/>
<h2 id="error-handling">Error Handling</h2>
<h3 id="oauth-errors-authorization-callback">OAuth Errors (Authorization Callback)</h3>
<div class="highlight"><pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="nx">params</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">URLSearchParams</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">search</span><span class="p">);</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">has</span><span class="p">(</span><span class="s1">'error'</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">error</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">params</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'error'</span><span class="p">);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">params</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'error_description'</span><span class="p">);</span>

<span class="w">  </span><span class="k">switch</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="s1">'access_denied'</span><span class="o">:</span>
<span class="w">      </span><span class="c1">// User denied consent</span>
<span class="w">      </span><span class="k">break</span><span class="p">;</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="s1">'invalid_scope'</span><span class="o">:</span>
<span class="w">      </span><span class="c1">// Requested scope not available</span>
<span class="w">      </span><span class="k">break</span><span class="p">;</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="s1">'server_error'</span><span class="o">:</span>
<span class="w">      </span><span class="c1">// Server error occurred</span>
<span class="w">      </span><span class="k">break</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="http-status-codes">HTTP Status Codes</h3>
<table>
<thead>
<tr>
<th>Code</th>
<th>Meaning</th>
<th>Action</th>
</tr>
</thead>
<tbody>
<tr>
<td>200</td>
<td>OK</td>
<td>Success</td>
</tr>
<tr>
<td>201</td>
<td>Created</td>
<td>Resource created successfully</td>
</tr>
<tr>
<td>400</td>
<td>Bad Request</td>
<td>Fix request format/validation</td>
</tr>
<tr>
<td>401</td>
<td>Unauthorized</td>
<td>Token expired/invalid - refresh or re-auth</td>
</tr>
<tr>
<td>403</td>
<td>Forbidden</td>
<td>Insufficient scope - request more scopes</td>
</tr>
<tr>
<td>404</td>
<td>Not Found</td>
<td>Resource doesn't exist</td>
</tr>
<tr>
<td>429</td>
<td>Too Many Requests</td>
<td>Implement backoff, check Retry-After header</td>
</tr>
<tr>
<td>500</td>
<td>Server Error</td>
<td>Retry with exponential backoff</td>
</tr>
</tbody>
</table>
<h3 id="fhir-operationoutcome">FHIR OperationOutcome</h3>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">"resourceType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"OperationOutcome"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"issue"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span>
<span class="w">    </span><span class="nt">"severity"</span><span class="p">:</span><span class="w"> </span><span class="s2">"error"</span><span class="p">,</span>
<span class="w">    </span><span class="nt">"code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"invalid"</span><span class="p">,</span>
<span class="w">    </span><span class="nt">"diagnostics"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Missing required field: subject"</span><span class="p">,</span>
<span class="w">    </span><span class="nt">"location"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"Observation.subject"</span><span class="p">]</span>
<span class="w">  </span><span class="p">}]</span>
<span class="p">}</span>
</code></pre></div>
<hr/>
<h2 id="testing-tools">Testing Tools</h2>
<h3 id="smart-app-launcher">SMART App Launcher</h3>
<p><div class="highlight"><pre><span></span><code>https://launch.smarthealthit.org/
</code></pre></div>
- Test EHR and standalone launches
- Inspect requests/responses
- Multiple patient scenarios</p>
<h3 id="hapi-fhir-server-public-test-server">HAPI FHIR Server (Public Test Server)</h3>
<div class="highlight"><pre><span></span><code>https://hapi.fhir.org/baseR4
</code></pre></div>
<h3 id="postman-collection">Postman Collection</h3>
<p>Import SMART-on-FHIR collection for API testing</p>
<h3 id="curl-examples">curl Examples</h3>
<p><strong>Get Patient:</strong>
<div class="highlight"><pre><span></span><code>curl<span class="w"> </span>-H<span class="w"> </span><span class="s2">"Authorization: Bearer YOUR_TOKEN"</span><span class="w"> </span><span class="se">\</span>
<span class="w">     </span>-H<span class="w"> </span><span class="s2">"Accept: application/fhir+json"</span><span class="w"> </span><span class="se">\</span>
<span class="w">     </span>https://fhir.example.com/Patient/123
</code></pre></div></p>
<p><strong>Search Observations:</strong>
<div class="highlight"><pre><span></span><code>curl<span class="w"> </span>-H<span class="w"> </span><span class="s2">"Authorization: Bearer YOUR_TOKEN"</span><span class="w"> </span><span class="se">\</span>
<span class="w">     </span>-H<span class="w"> </span><span class="s2">"Accept: application/fhir+json"</span><span class="w"> </span><span class="se">\</span>
<span class="w">     </span><span class="s2">"https://fhir.example.com/Observation?patient=123&amp;category=vital-signs"</span>
</code></pre></div></p>
<hr/>
<h2 id="halo-specific-gotchas">HALO-Specific Gotchas</h2>
<h3 id="token-expiration">Token Expiration</h3>
<ul>
<li><strong>Default:</strong> 1 hour</li>
<li><strong>Action:</strong> Implement proactive refresh (e.g., at 55 minutes)</li>
<li><strong>Test:</strong> Verify refresh token flow works</li>
</ul>
<h3 id="rate-limiting">Rate Limiting</h3>
<ul>
<li><strong>Typical Limit:</strong> 100 requests/minute</li>
<li><strong>Headers:</strong> Check <code>X-RateLimit-*</code> headers</li>
<li><strong>Strategy:</strong> Implement exponential backoff and request batching</li>
</ul>
<h3 id="redirect-uri-matching">Redirect URI Matching</h3>
<ul>
<li>Must match <strong>exactly</strong> (including trailing slash, protocol, port)</li>
<li>Test: <code>https://app.com/callback</code> ≠ <code>https://app.com/callback/</code></li>
</ul>
<h3 id="scope-requirements">Scope Requirements</h3>
<ul>
<li>Some HALO deployments require specific scopes beyond SMART standard</li>
<li>Check: HALO documentation for custom scopes</li>
<li>Example: <code>halo/custom.read</code></li>
</ul>
<h3 id="tenant-isolation">Tenant Isolation</h3>
<ul>
<li>Multi-tenant HALO deployments may require tenant ID in requests</li>
<li>Header: <code>X-Tenant-ID: your-tenant-id</code></li>
<li>Check: HALO configuration docs</li>
</ul>
<h3 id="fhir-profiles">FHIR Profiles</h3>
<ul>
<li>HALO may use custom FHIR profiles with additional required fields</li>
<li>Validate: Resources against HALO's CapabilityStatement</li>
<li>Example: Custom extensions on Patient resource</li>
</ul>
<hr/>
<h2 id="security-best-practices">Security Best Practices</h2>
<h3 id="do">✅ DO</h3>
<ul>
<li>Use PKCE for all public clients</li>
<li>Validate <code>state</code> parameter on callback</li>
<li>Store tokens securely (httpOnly cookies, secure storage)</li>
<li>Use HTTPS everywhere</li>
<li>Implement token rotation</li>
<li>Request minimal necessary scopes</li>
<li>Set short token expiration times</li>
<li>Log security events</li>
<li>Validate JWT signatures</li>
<li>Sanitize all user input</li>
</ul>
<h3 id="dont">❌ DON'T</h3>
<ul>
<li>Store tokens in localStorage (XSS vulnerable)</li>
<li>Include tokens in URLs</li>
<li>Share client credentials</li>
<li>Use implicit flow (deprecated)</li>
<li>Skip state validation</li>
<li>Request more scopes than needed</li>
<li>Ignore token expiration</li>
<li>Log sensitive data (tokens, PHI)</li>
<li>Trust client-side data without validation</li>
</ul>
<hr/>
<h2 id="quick-reference-urls">Quick Reference URLs</h2>
<table>
<thead>
<tr>
<th>Resource</th>
<th>URL</th>
</tr>
</thead>
<tbody>
<tr>
<td>SMART Spec</td>
<td>http://hl7.org/fhir/smart-app-launch/</td>
</tr>
<tr>
<td>FHIR R4 Spec</td>
<td>http://hl7.org/fhir/R4/</td>
</tr>
<tr>
<td>SMART Sandbox</td>
<td>https://launch.smarthealthit.org/</td>
</tr>
<tr>
<td>OAuth 2.0 RFC</td>
<td>https://tools.ietf.org/html/rfc6749</td>
</tr>
<tr>
<td>PKCE RFC</td>
<td>https://tools.ietf.org/html/rfc7636</td>
</tr>
<tr>
<td>JWT RFC</td>
<td>https://tools.ietf.org/html/rfc7519</td>
</tr>
</tbody>
</table>
<hr/>
<h2 id="debugging-checklist">Debugging Checklist</h2>
<ul>
<li>[ ] Verify SMART configuration endpoint is accessible</li>
<li>[ ] Check redirect URI matches exactly</li>
<li>[ ] Confirm client_id is correct</li>
<li>[ ] Validate state parameter</li>
<li>[ ] Check PKCE verifier/challenge match</li>
<li>[ ] Verify scopes are supported by EHR</li>
<li>[ ] Check token hasn't expired</li>
<li>[ ] Confirm Authorization header format: <code>Bearer &lt;token&gt;</code></li>
<li>[ ] Validate FHIR resource structure</li>
<li>[ ] Check for CORS issues (browser console)</li>
<li>[ ] Review server logs for detailed errors</li>
<li>[ ] Test with known-good access token</li>
<li>[ ] Verify network connectivity to FHIR server</li>
<li>[ ] Check for rate limiting (429 responses)</li>
<li>[ ] Validate aud parameter matches FHIR base URL</li>
</ul>
<hr/>
<h2 id="common-integration-patterns">Common Integration Patterns</h2>
<h3 id="pattern-1-simple-patient-dashboard">Pattern 1: Simple Patient Dashboard</h3>
<ol>
<li>EHR launches app with patient context</li>
<li>App exchanges code for token (includes patient ID)</li>
<li>App fetches: Patient, Observations, Conditions, Medications</li>
<li>Display summary dashboard</li>
</ol>
<h3 id="pattern-2-clinical-decision-support">Pattern 2: Clinical Decision Support</h3>
<ol>
<li>App requests <code>patient/*.read</code> and <code>user/Practitioner.read</code></li>
<li>Fetch patient data and analyze</li>
<li>Display recommendations based on clinical rules</li>
<li>Optionally write back results with <code>patient/*.write</code></li>
</ol>
<h3 id="pattern-3-data-entry-app">Pattern 3: Data Entry App</h3>
<ol>
<li>Request <code>patient/*.write</code> scope</li>
<li>Validate input data against FHIR profiles</li>
<li>POST/PUT resources to FHIR server</li>
<li>Handle validation errors and retry</li>
</ol>
<h3 id="pattern-4-batch-data-analysis-backend">Pattern 4: Batch Data Analysis (Backend)</h3>
<ol>
<li>Use system scopes (<code>system/*.read</code>)</li>
<li>Authenticate with client credentials</li>
<li>Query multiple patient records</li>
<li>Perform population-level analytics</li>
</ol>
<hr/>
<h2 id="pro-tips">Pro Tips</h2>
<h3 id="optimize-fhir-queries">Optimize FHIR Queries</h3>
<div class="highlight"><pre><span></span><code><span class="err"># Use _revinclude to get related resources in one call</span>
<span class="err">GET /Patient/123?_revinclude=Observation:patient</span>

<span class="err"># Use _elements to limit returned fields</span>
<span class="err">GET /Patient/123?_elements=id,name,birthDate</span>

<span class="err"># Use _summary for lightweight responses</span>
<span class="err">GET /Patient/123?_summary=true</span>

<span class="err"># Batch requests to reduce round trips</span>
<span class="err">POST / </span>
<span class="err">Content-Type: application/fhir+json</span>
<span class="err">{</span>
<span class="err">  "resourceType": "Bundle",</span>
<span class="err">  "type": "batch",</span>
<span class="err">  "entry": [</span>
<span class="err">    { "request": { "method": "GET", "url": "Patient/123" } },</span>
<span class="err">    { "request": { "method": "GET", "url": "Observation?patient=123" } }</span>
<span class="err">  ]</span>
<span class="err">}</span>
</code></pre></div>
<h3 id="token-management-strategy">Token Management Strategy</h3>
<div class="highlight"><pre><span></span><code><span class="kd">class</span><span class="w"> </span><span class="nx">TokenManager</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kr">constructor</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">refreshThreshold</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">300000</span><span class="p">;</span><span class="w"> </span><span class="c1">// 5 minutes before expiry</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nx">shouldRefresh</span><span class="p">(</span><span class="nx">expiresAt</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="p">(</span><span class="nx">expiresAt</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">refreshThreshold</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">async</span><span class="w"> </span><span class="nx">getValidToken</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">tokenData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">getStoredToken</span><span class="p">();</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">shouldRefresh</span><span class="p">(</span><span class="nx">tokenData</span><span class="p">.</span><span class="nx">expiresAt</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">refreshToken</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">tokenData</span><span class="p">.</span><span class="nx">accessToken</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="error-recovery-pattern">Error Recovery Pattern</h3>
<div class="highlight"><pre><span></span><code><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">fhirRequestWithRetry</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span><span class="w"> </span><span class="nx">options</span><span class="p">,</span><span class="w"> </span><span class="nx">maxRetries</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">3</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">let</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">maxRetries</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span><span class="w"> </span><span class="nx">options</span><span class="p">);</span>

<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">status</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">401</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Token expired, refresh and retry</span>
<span class="w">        </span><span class="k">await</span><span class="w"> </span><span class="nx">refreshToken</span><span class="p">();</span>
<span class="w">        </span><span class="k">continue</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>

<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">status</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">429</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Rate limited, wait and retry</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">retryAfter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">headers</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'Retry-After'</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">pow</span><span class="p">(</span><span class="mf">2</span><span class="p">,</span><span class="w"> </span><span class="nx">i</span><span class="p">);</span>
<span class="w">        </span><span class="k">await</span><span class="w"> </span><span class="nx">sleep</span><span class="p">(</span><span class="nx">retryAfter</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">1000</span><span class="p">);</span>
<span class="w">        </span><span class="k">continue</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>

<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">ok</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>
<span class="w">      </span><span class="p">}</span>

<span class="w">      </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`HTTP </span><span class="si">${</span><span class="nx">response</span><span class="p">.</span><span class="nx">status</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>

<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">i</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">maxRetries</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">1</span><span class="p">)</span><span class="w"> </span><span class="k">throw</span><span class="w"> </span><span class="nx">error</span><span class="p">;</span>
<span class="w">      </span><span class="k">await</span><span class="w"> </span><span class="nx">sleep</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">pow</span><span class="p">(</span><span class="mf">2</span><span class="p">,</span><span class="w"> </span><span class="nx">i</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">1000</span><span class="p">);</span><span class="w"> </span><span class="c1">// Exponential backoff</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="secure-token-storage-browser">Secure Token Storage (Browser)</h3>
<div class="highlight"><pre><span></span><code><span class="c1">// ✅ Use httpOnly cookie (set by backend)</span>
<span class="c1">// Backend sets cookie after token exchange</span>
<span class="nx">res</span><span class="p">.</span><span class="nx">cookie</span><span class="p">(</span><span class="s1">'smart_token'</span><span class="p">,</span><span class="w"> </span><span class="nx">tokenData</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">httpOnly</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">  </span><span class="nx">secure</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">  </span><span class="nx">sameSite</span><span class="o">:</span><span class="w"> </span><span class="s1">'strict'</span><span class="p">,</span>
<span class="w">  </span><span class="nx">maxAge</span><span class="o">:</span><span class="w"> </span><span class="mf">3600000</span>
<span class="p">});</span>

<span class="c1">// ✅ Use sessionStorage for temporary data</span>
<span class="nx">sessionStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="s1">'patient_context'</span><span class="p">,</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span>
<span class="w">  </span><span class="nx">patientId</span><span class="o">:</span><span class="w"> </span><span class="nx">tokenData</span><span class="p">.</span><span class="nx">patient</span><span class="p">,</span>
<span class="w">  </span><span class="nx">encounterId</span><span class="o">:</span><span class="w"> </span><span class="nx">tokenData</span><span class="p">.</span><span class="nx">encounter</span>
<span class="p">}));</span>

<span class="c1">// ❌ Never use localStorage for tokens (XSS vulnerable)</span>
<span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="s1">'access_token'</span><span class="p">,</span><span class="w"> </span><span class="nx">token</span><span class="p">);</span><span class="w"> </span><span class="c1">// DON'T DO THIS!</span>
</code></pre></div>
<hr/>
<h2 id="learning-path">🎓 Learning Path</h2>
<h3 id="beginner">Beginner</h3>
<ol>
<li>Understand OAuth 2.0 basics</li>
<li>Set up SMART sandbox account</li>
<li>Try EHR launch with sample app</li>
<li>Read basic FHIR resources (Patient, Observation)</li>
<li>Implement simple patient dashboard</li>
</ol>
<h3 id="intermediate">Intermediate</h3>
<ol>
<li>Implement PKCE flow from scratch</li>
<li>Handle token refresh logic</li>
<li>Work with complex FHIR resources (Bundle, DocumentReference)</li>
<li>Implement error handling and retry logic</li>
<li>Add write capabilities</li>
</ol>
<h3 id="advanced">Advanced</h3>
<ol>
<li>Implement backend services with system scopes</li>
<li>Custom FHIR profiles and extensions</li>
<li>Performance optimization (batching, caching)</li>
<li>Production deployment and monitoring</li>
<li>Security hardening and penetration testing</li>
</ol>
<hr/>
<h2 id="troubleshooting-guide">Troubleshooting Guide</h2>
<h3 id="issue-invalid-redirect-uri">Issue: "Invalid redirect URI"</h3>
<p><strong>Cause:</strong> URI mismatch between request and registration<br/>
<strong>Solution:</strong> 
- Check exact match including protocol, port, path, trailing slash
- Verify registration in EHR app registry
- Test: <code>https://app.com/callback</code> vs <code>https://app.com/callback/</code></p>
<h3 id="issue-invalid-scope">Issue: "Invalid scope"</h3>
<p><strong>Cause:</strong> Requested scope not supported by EHR<br/>
<strong>Solution:</strong>
- Check <code>.well-known/smart-configuration</code> for <code>scopes_supported</code>
- Request only necessary scopes
- Verify EHR supports SMART App Launch 2.0</p>
<h3 id="issue-token-expired-immediately">Issue: Token expired immediately</h3>
<p><strong>Cause:</strong> Clock skew between systems<br/>
<strong>Solution:</strong>
- Sync system clocks (use NTP)
- Add buffer time when checking expiration
- Implement proactive token refresh</p>
<h3 id="issue-403-forbidden-on-fhir-request">Issue: 403 Forbidden on FHIR request</h3>
<p><strong>Cause:</strong> Insufficient scope or patient context mismatch<br/>
<strong>Solution:</strong>
- Verify token includes required scope
- Check patient ID matches context
- Review OperationOutcome for details</p>
<h3 id="issue-cors-errors-in-browser">Issue: CORS errors in browser</h3>
<p><strong>Cause:</strong> Browser blocking cross-origin requests<br/>
<strong>Solution:</strong>
- Proxy FHIR requests through your backend
- Configure CORS headers on FHIR server (if you control it)
- Use server-side token exchange</p>
<h3 id="issue-rate-limit-errors-429">Issue: Rate limit errors (429)</h3>
<p><strong>Cause:</strong> Too many requests in short time<br/>
<strong>Solution:</strong>
- Implement exponential backoff
- Use batch requests to consolidate calls
- Cache responses when appropriate
- Check <code>Retry-After</code> header</p>
<hr/>
<h2 id="pre-production-checklist">Pre-Production Checklist</h2>
<h3 id="security">Security</h3>
<ul>
<li>[ ] PKCE implemented for public clients</li>
<li>[ ] State parameter validated</li>
<li>[ ] Tokens stored securely (not in localStorage)</li>
<li>[ ] HTTPS enforced everywhere</li>
<li>[ ] Client secret secured (if confidential client)</li>
<li>[ ] Input validation on all user data</li>
<li>[ ] JWT signatures verified</li>
<li>[ ] Sensitive data not logged</li>
</ul>
<h3 id="functionality">Functionality</h3>
<ul>
<li>[ ] Token refresh implemented</li>
<li>[ ] Error handling for all API calls</li>
<li>[ ] Offline mode (if applicable)</li>
<li>[ ] Data validation before FHIR POST/PUT</li>
<li>[ ] Loading states in UI</li>
<li>[ ] Graceful degradation</li>
</ul>
<h3 id="performance">Performance</h3>
<ul>
<li>[ ] Request batching where possible</li>
<li>[ ] Response caching strategy</li>
<li>[ ] Rate limiting handling</li>
<li>[ ] Lazy loading of data</li>
<li>[ ] Optimized FHIR queries (_elements, _summary)</li>
</ul>
<h3 id="compliance">Compliance</h3>
<ul>
<li>[ ] HIPAA compliance review</li>
<li>[ ] Patient consent flow</li>
<li>[ ] Audit logging</li>
<li>[ ] Data retention policy</li>
<li>[ ] Privacy policy updated</li>
<li>[ ] Terms of service</li>
</ul>
<h3 id="testing">Testing</h3>
<ul>
<li>[ ] Unit tests for core logic</li>
<li>[ ] Integration tests with FHIR server</li>
<li>[ ] E2E tests for critical flows</li>
<li>[ ] Security testing (OWASP Top 10)</li>
<li>[ ] Load testing</li>
<li>[ ] Cross-browser testing</li>
</ul>
<h3 id="monitoring">Monitoring</h3>
<ul>
<li>[ ] Error tracking (e.g., Sentry)</li>
<li>[ ] Performance monitoring (e.g., New Relic)</li>
<li>[ ] Uptime monitoring</li>
<li>[ ] Log aggregation</li>
<li>[ ] Alert configuration</li>
<li>[ ] Dashboard for key metrics</li>
</ul>
<hr/>
<h2 id="support-resources">Support Resources</h2>
<h3 id="official-documentation">Official Documentation</h3>
<ul>
<li><strong>SMART App Launch</strong>: http://hl7.org/fhir/smart-app-launch/</li>
<li><strong>FHIR R4</strong>: http://hl7.org/fhir/R4/</li>
<li><strong>HL7 FHIR Chat</strong>: https://chat.fhir.org/</li>
</ul>
<h3 id="community">Community</h3>
<ul>
<li><strong>FHIR Zulip</strong>: https://chat.fhir.org/</li>
<li><strong>HL7 FHIR List</strong>: https://chat.fhir.org/#narrow/stream/179166-implementers</li>
<li><strong>Stack Overflow</strong>: Tag <code>fhir</code> or <code>smart-on-fhir</code></li>
</ul>
<h3 id="testing-tools_1">Testing Tools</h3>
<ul>
<li><strong>SMART App Launcher</strong>: https://launch.smarthealthit.org/</li>
<li><strong>HAPI Test Server</strong>: https://hapi.fhir.org/baseR4</li>
<li><strong>Inferno Test Suite</strong>: https://inferno.healthit.gov/</li>
<li><strong>Touchstone Testing</strong>: https://touchstone.aegis.net/</li>
</ul>
<h3 id="libraries">Libraries</h3>
<ul>
<li><strong>JavaScript</strong>: fhirclient.js (https://github.com/smart-on-fhir/client-js)</li>
<li><strong>Python</strong>: fhirclient (https://github.com/smart-on-fhir/client-py)</li>
<li><strong>Java</strong>: HAPI FHIR (https://hapifhir.io/)</li>
<li><strong>.NET</strong>: Firely SDK (https://fire.ly/)</li>
</ul>
<hr/>
<h2 id="halo-specific-quick-reference">HALO-Specific Quick Reference</h2>
<h3 id="typical-halo-configuration">Typical HALO Configuration</h3>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nx">fhirBaseUrl</span><span class="o">:</span><span class="w"> </span><span class="s1">'https://fhir.halo.yourdomain.com'</span><span class="p">,</span>
<span class="w">  </span><span class="nx">authEndpoint</span><span class="o">:</span><span class="w"> </span><span class="s1">'https://auth.halo.yourdomain.com/oauth2/authorize'</span><span class="p">,</span>
<span class="w">  </span><span class="nx">tokenEndpoint</span><span class="o">:</span><span class="w"> </span><span class="s1">'https://auth.halo.yourdomain.com/oauth2/token'</span><span class="p">,</span>
<span class="w">  </span><span class="nx">clientId</span><span class="o">:</span><span class="w"> </span><span class="s1">'your-registered-client-id'</span><span class="p">,</span>
<span class="w">  </span><span class="nx">scopes</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s1">'launch/patient'</span><span class="p">,</span><span class="w"> </span><span class="s1">'patient/*.read'</span><span class="p">,</span><span class="w"> </span><span class="s1">'offline_access'</span><span class="p">],</span>

<span class="w">  </span><span class="c1">// HALO-specific</span>
<span class="w">  </span><span class="nx">tenantId</span><span class="o">:</span><span class="w"> </span><span class="s1">'your-tenant-id'</span><span class="p">,</span>
<span class="w">  </span><span class="nx">apiVersion</span><span class="o">:</span><span class="w"> </span><span class="s1">'R4'</span><span class="p">,</span>
<span class="w">  </span><span class="nx">rateLimit</span><span class="o">:</span><span class="w"> </span><span class="mf">100</span><span class="p">,</span><span class="w"> </span><span class="c1">// requests per minute</span>
<span class="w">  </span><span class="nx">tokenExpiry</span><span class="o">:</span><span class="w"> </span><span class="mf">3600</span><span class="w"> </span><span class="c1">// 1 hour</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="halo-common-headers">HALO Common Headers</h3>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="s1">'Authorization'</span><span class="o">:</span><span class="w"> </span><span class="s1">'Bearer YOUR_ACCESS_TOKEN'</span><span class="p">,</span>
<span class="w">  </span><span class="s1">'Accept'</span><span class="o">:</span><span class="w"> </span><span class="s1">'application/fhir+json'</span><span class="p">,</span>
<span class="w">  </span><span class="s1">'Content-Type'</span><span class="o">:</span><span class="w"> </span><span class="s1">'application/fhir+json'</span><span class="p">,</span>
<span class="w">  </span><span class="s1">'X-Tenant-ID'</span><span class="o">:</span><span class="w"> </span><span class="s1">'your-tenant-id'</span><span class="p">,</span><span class="w"> </span><span class="c1">// If multi-tenant</span>
<span class="w">  </span><span class="s1">'X-Request-ID'</span><span class="o">:</span><span class="w"> </span><span class="s1">'unique-request-id'</span><span class="w"> </span><span class="c1">// For tracing</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="halo-rate-limit-handling">HALO Rate Limit Handling</h3>
<div class="highlight"><pre><span></span><code><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">haloRequest</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span><span class="w"> </span><span class="nx">options</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span><span class="w"> </span><span class="nx">options</span><span class="p">);</span>

<span class="w">  </span><span class="c1">// Check rate limit headers</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">remaining</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">headers</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'X-RateLimit-Remaining'</span><span class="p">);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">reset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">headers</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'X-RateLimit-Reset'</span><span class="p">);</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">status</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">429</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">retryAfter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">headers</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'Retry-After'</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="mf">60</span><span class="p">;</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">warn</span><span class="p">(</span><span class="sb">`Rate limited. Retry after </span><span class="si">${</span><span class="nx">retryAfter</span><span class="si">}</span><span class="sb">s`</span><span class="p">);</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">sleep</span><span class="p">(</span><span class="nx">retryAfter</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">1000</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">haloRequest</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span><span class="w"> </span><span class="nx">options</span><span class="p">);</span><span class="w"> </span><span class="c1">// Retry</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">response</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="halo-custom-extensions-example">HALO Custom Extensions (Example)</h3>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">"resourceType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Patient"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"123"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"extension"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://halo.example.com/fhir/StructureDefinition/patient-priority"</span><span class="p">,</span>
<span class="w">      </span><span class="nt">"valueString"</span><span class="p">:</span><span class="w"> </span><span class="s2">"VIP"</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://halo.example.com/fhir/StructureDefinition/last-sync"</span><span class="p">,</span>
<span class="w">      </span><span class="nt">"valueDateTime"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2024-01-15T10:30:00Z"</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">],</span>
<span class="w">  </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="w"> </span><span class="nt">"family"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Smith"</span><span class="p">,</span><span class="w"> </span><span class="nt">"given"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"John"</span><span class="p">]</span><span class="w"> </span><span class="p">}]</span>
<span class="p">}</span>
</code></pre></div>
<hr/>
<h2 id="common-gotchas-solutions">Common Gotchas &amp; Solutions</h2>
<h3 id="gotcha-1-token-in-url">Gotcha #1: Token in URL</h3>
<div class="highlight"><pre><span></span><code><span class="c1">// ❌ Do NOT expose token in URL/logs</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">href</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sb">`/dashboard?token=</span><span class="si">${</span><span class="nx">accessToken</span><span class="si">}</span><span class="sb">`</span><span class="p">;</span>

<span class="c1">// ✅ Use secure storage</span>
<span class="nx">sessionStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="s1">'token_data'</span><span class="p">,</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">tokenData</span><span class="p">));</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">href</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'/dashboard'</span><span class="p">;</span>
</code></pre></div>
<h3 id="gotcha-2-not-validating-state">Gotcha #2: Not Validating State</h3>
<div class="highlight"><pre><span></span><code><span class="c1">// ❌ CSRF — vulnerable</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">URLSearchParams</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">search</span><span class="p">).</span><span class="nx">get</span><span class="p">(</span><span class="s1">'code'</span><span class="p">);</span>
<span class="nx">exchangeCodeForToken</span><span class="p">(</span><span class="nx">code</span><span class="p">);</span>

<span class="c1">// ✅ Validate state</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">params</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">URLSearchParams</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">search</span><span class="p">);</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">params</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'state'</span><span class="p">);</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">storedState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">sessionStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="s1">'oauth_state'</span><span class="p">);</span>

<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">state</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="nx">storedState</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s1">'State mismatch - possible CSRF attack'</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="gotcha-3-hardcoded-fhir-base-url">Gotcha #3: Hardcoded FHIR Base URL</h3>
<div class="highlight"><pre><span></span><code><span class="c1">// ❌ Doesn't work across environments</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">fhirBase</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'https://fhir.production.com'</span><span class="p">;</span>

<span class="c1">// ✅ Discover dynamically</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">iss</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">URLSearchParams</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">search</span><span class="p">).</span><span class="nx">get</span><span class="p">(</span><span class="s1">'iss'</span><span class="p">);</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="sb">`</span><span class="si">${</span><span class="nx">iss</span><span class="si">}</span><span class="sb">/.well-known/smart-configuration`</span><span class="p">)</span>
<span class="w">  </span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">json</span><span class="p">());</span>
</code></pre></div>
<h3 id="gotcha-4-ignoring-token-expiration">Gotcha #4: Ignoring Token Expiration</h3>
<div class="highlight"><pre><span></span><code><span class="c1">// ❌ Do NOT use expired token</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">token</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">sessionStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="s1">'access_token'</span><span class="p">);</span>
<span class="nx">fetch</span><span class="p">(</span><span class="nx">fhirUrl</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">headers</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Authorization</span><span class="o">:</span><span class="w"> </span><span class="sb">`Bearer </span><span class="si">${</span><span class="nx">token</span><span class="si">}</span><span class="sb">`</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">});</span>

<span class="c1">// ✅ Check expiration</span>
<span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">getValidToken</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">tokenData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">sessionStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="s1">'token_data'</span><span class="p">));</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="nx">tokenData</span><span class="p">.</span><span class="nx">expiresAt</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">60000</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// 1 min buffer</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">refreshToken</span><span class="p">();</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">tokenData</span><span class="p">.</span><span class="nx">accessToken</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="gotcha-5-not-handling-bundle-pagination">Gotcha #5: Not Handling Bundle Pagination</h3>
<div class="highlight"><pre><span></span><code><span class="c1">// ❌ Do NOT get first page only</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="sb">`</span><span class="si">${</span><span class="nx">fhirBase</span><span class="si">}</span><span class="sb">/Observation?patient=123`</span><span class="p">);</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">bundle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">observations</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bundle</span><span class="p">.</span><span class="nx">entry</span><span class="p">;</span><span class="w"> </span><span class="c1">// Missing subsequent pages!</span>

<span class="c1">// ✅ Follow next links</span>
<span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">getAllResources</span><span class="p">(</span><span class="nx">initialUrl</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">let</span><span class="w"> </span><span class="nx">allResources</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[];</span>
<span class="w">  </span><span class="kd">let</span><span class="w"> </span><span class="nx">url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">initialUrl</span><span class="p">;</span>

<span class="w">  </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="nx">url</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">headers</span><span class="o">:</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">getHeaders</span><span class="p">()</span><span class="w"> </span><span class="p">});</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">bundle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">bundle</span><span class="p">.</span><span class="nx">entry</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">allResources</span><span class="p">.</span><span class="nx">push</span><span class="p">(...</span><span class="nx">bundle</span><span class="p">.</span><span class="nx">entry</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">e</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">e</span><span class="p">.</span><span class="nx">resource</span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Get next page URL</span>
<span class="w">    </span><span class="nx">url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bundle</span><span class="p">.</span><span class="nx">link</span><span class="o">?</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">l</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">l</span><span class="p">.</span><span class="nx">relation</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">'next'</span><span class="p">)</span><span class="o">?</span><span class="p">.</span><span class="nx">url</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">allResources</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="gotcha-6-creating-resources-without-validation">Gotcha #6: Creating Resources Without Validation</h3>
<div class="highlight"><pre><span></span><code><span class="c1">// ❌ Missing required fields</span>
<span class="k">await</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="sb">`</span><span class="si">${</span><span class="nx">fhirBase</span><span class="si">}</span><span class="sb">/Observation`</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">method</span><span class="o">:</span><span class="w"> </span><span class="s1">'POST'</span><span class="p">,</span>
<span class="w">  </span><span class="nx">body</span><span class="o">:</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span><span class="w"> </span><span class="nx">resourceType</span><span class="o">:</span><span class="w"> </span><span class="s1">'Observation'</span><span class="w"> </span><span class="p">})</span>
<span class="w">  </span><span class="c1">// Missing: status, code, subject - will fail!</span>
<span class="p">});</span>

<span class="c1">// ✅ Validate before sending</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">validateObservation</span><span class="p">(</span><span class="nx">obs</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">required</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s1">'status'</span><span class="p">,</span><span class="w"> </span><span class="s1">'code'</span><span class="p">,</span><span class="w"> </span><span class="s1">'subject'</span><span class="p">];</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">missing</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">required</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">field</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="o">!</span><span class="nx">obs</span><span class="p">[</span><span class="nx">field</span><span class="p">]);</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">missing</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`Missing required fields: </span><span class="si">${</span><span class="nx">missing</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">', '</span><span class="p">)</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="p">[</span><span class="s1">'final'</span><span class="p">,</span><span class="w"> </span><span class="s1">'amended'</span><span class="p">,</span><span class="w"> </span><span class="s1">'corrected'</span><span class="p">].</span><span class="nx">includes</span><span class="p">(</span><span class="nx">obs</span><span class="p">.</span><span class="nx">status</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`Invalid status: </span><span class="si">${</span><span class="nx">obs</span><span class="p">.</span><span class="nx">status</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<hr/>
<h2 id="code-snippets-library">Code Snippets Library</h2>
<h3 id="complete-smart-launch-minimal">Complete SMART Launch (Minimal)</h3>
<div class="highlight"><pre><span></span><code><span class="c1">// 1. Handle launch</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">urlParams</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">URLSearchParams</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">search</span><span class="p">);</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">iss</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">urlParams</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'iss'</span><span class="p">);</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">launch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">urlParams</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'launch'</span><span class="p">);</span>

<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">iss</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">launch</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// Discover endpoints</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="sb">`</span><span class="si">${</span><span class="nx">iss</span><span class="si">}</span><span class="sb">/.well-known/smart-configuration`</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">json</span><span class="p">());</span>

<span class="w">  </span><span class="c1">// Generate PKCE</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">verifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">generateRandomString</span><span class="p">(</span><span class="mf">128</span><span class="p">);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">challenge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">sha256</span><span class="p">(</span><span class="nx">verifier</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="nx">base64url</span><span class="p">);</span>
<span class="w">  </span><span class="nx">sessionStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="s1">'verifier'</span><span class="p">,</span><span class="w"> </span><span class="nx">verifier</span><span class="p">);</span>

<span class="w">  </span><span class="c1">// Redirect to authorize</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">authUrl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">URL</span><span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">authorization_endpoint</span><span class="p">);</span>
<span class="w">  </span><span class="nx">authUrl</span><span class="p">.</span><span class="nx">searchParams</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">'response_type'</span><span class="p">,</span><span class="w"> </span><span class="s1">'code'</span><span class="p">);</span>
<span class="w">  </span><span class="nx">authUrl</span><span class="p">.</span><span class="nx">searchParams</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">'client_id'</span><span class="p">,</span><span class="w"> </span><span class="s1">'my-app-id'</span><span class="p">);</span>
<span class="w">  </span><span class="nx">authUrl</span><span class="p">.</span><span class="nx">searchParams</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">'redirect_uri'</span><span class="p">,</span><span class="w"> </span><span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">origin</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">'/callback'</span><span class="p">);</span>
<span class="w">  </span><span class="nx">authUrl</span><span class="p">.</span><span class="nx">searchParams</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">'scope'</span><span class="p">,</span><span class="w"> </span><span class="s1">'launch/patient patient/*.read'</span><span class="p">);</span>
<span class="w">  </span><span class="nx">authUrl</span><span class="p">.</span><span class="nx">searchParams</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">'state'</span><span class="p">,</span><span class="w"> </span><span class="nx">generateRandomString</span><span class="p">(</span><span class="mf">32</span><span class="p">));</span>
<span class="w">  </span><span class="nx">authUrl</span><span class="p">.</span><span class="nx">searchParams</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">'aud'</span><span class="p">,</span><span class="w"> </span><span class="nx">iss</span><span class="p">);</span>
<span class="w">  </span><span class="nx">authUrl</span><span class="p">.</span><span class="nx">searchParams</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">'launch'</span><span class="p">,</span><span class="w"> </span><span class="nx">launch</span><span class="p">);</span>
<span class="w">  </span><span class="nx">authUrl</span><span class="p">.</span><span class="nx">searchParams</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">'code_challenge'</span><span class="p">,</span><span class="w"> </span><span class="nx">challenge</span><span class="p">);</span>
<span class="w">  </span><span class="nx">authUrl</span><span class="p">.</span><span class="nx">searchParams</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">'code_challenge_method'</span><span class="p">,</span><span class="w"> </span><span class="s1">'S256'</span><span class="p">);</span>

<span class="w">  </span><span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">href</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">authUrl</span><span class="p">.</span><span class="nx">toString</span><span class="p">();</span>
<span class="p">}</span>

<span class="c1">// 2. Handle callback</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">urlParams</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'code'</span><span class="p">);</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">code</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">verifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">sessionStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="s1">'verifier'</span><span class="p">);</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">tokenResponse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="nx">tokenEndpoint</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">method</span><span class="o">:</span><span class="w"> </span><span class="s1">'POST'</span><span class="p">,</span>
<span class="w">    </span><span class="nx">headers</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s1">'Content-Type'</span><span class="o">:</span><span class="w"> </span><span class="s1">'application/x-www-form-urlencoded'</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="nx">body</span><span class="o">:</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">URLSearchParams</span><span class="p">({</span>
<span class="w">      </span><span class="nx">grant_type</span><span class="o">:</span><span class="w"> </span><span class="s1">'authorization_code'</span><span class="p">,</span>
<span class="w">      </span><span class="nx">code</span><span class="o">:</span><span class="w"> </span><span class="nx">code</span><span class="p">,</span>
<span class="w">      </span><span class="nx">redirect_uri</span><span class="o">:</span><span class="w"> </span><span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">origin</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">'/callback'</span><span class="p">,</span>
<span class="w">      </span><span class="nx">client_id</span><span class="o">:</span><span class="w"> </span><span class="s1">'my-app-id'</span><span class="p">,</span>
<span class="w">      </span><span class="nx">code_verifier</span><span class="o">:</span><span class="w"> </span><span class="nx">verifier</span>
<span class="w">    </span><span class="p">})</span>
<span class="w">  </span><span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">json</span><span class="p">());</span>

<span class="w">  </span><span class="nx">sessionStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="s1">'token'</span><span class="p">,</span><span class="w"> </span><span class="nx">tokenResponse</span><span class="p">.</span><span class="nx">access_token</span><span class="p">);</span>
<span class="w">  </span><span class="nx">sessionStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="s1">'patient'</span><span class="p">,</span><span class="w"> </span><span class="nx">tokenResponse</span><span class="p">.</span><span class="nx">patient</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="fhir-search-with-filters">FHIR Search with Filters</h3>
<div class="highlight"><pre><span></span><code><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">searchObservations</span><span class="p">(</span><span class="nx">patientId</span><span class="p">,</span><span class="w"> </span><span class="nx">filters</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{})</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">URL</span><span class="p">(</span><span class="sb">`</span><span class="si">${</span><span class="nx">fhirBase</span><span class="si">}</span><span class="sb">/Observation`</span><span class="p">);</span>

<span class="w">  </span><span class="c1">// Base filter</span>
<span class="w">  </span><span class="nx">url</span><span class="p">.</span><span class="nx">searchParams</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">'patient'</span><span class="p">,</span><span class="w"> </span><span class="nx">patientId</span><span class="p">);</span>

<span class="w">  </span><span class="c1">// Optional filters</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">filters</span><span class="p">.</span><span class="nx">category</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">url</span><span class="p">.</span><span class="nx">searchParams</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">'category'</span><span class="p">,</span><span class="w"> </span><span class="nx">filters</span><span class="p">.</span><span class="nx">category</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">filters</span><span class="p">.</span><span class="nx">dateFrom</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">url</span><span class="p">.</span><span class="nx">searchParams</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">'date'</span><span class="p">,</span><span class="w"> </span><span class="sb">`ge</span><span class="si">${</span><span class="nx">filters</span><span class="p">.</span><span class="nx">dateFrom</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">filters</span><span class="p">.</span><span class="nx">dateTo</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">url</span><span class="p">.</span><span class="nx">searchParams</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">'date'</span><span class="p">,</span><span class="w"> </span><span class="sb">`le</span><span class="si">${</span><span class="nx">filters</span><span class="p">.</span><span class="nx">dateTo</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">filters</span><span class="p">.</span><span class="nx">code</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">url</span><span class="p">.</span><span class="nx">searchParams</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">'code'</span><span class="p">,</span><span class="w"> </span><span class="nx">filters</span><span class="p">.</span><span class="nx">code</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">filters</span><span class="p">.</span><span class="nx">count</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">url</span><span class="p">.</span><span class="nx">searchParams</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">'_count'</span><span class="p">,</span><span class="w"> </span><span class="nx">filters</span><span class="p">.</span><span class="nx">count</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">filters</span><span class="p">.</span><span class="nx">sort</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">url</span><span class="p">.</span><span class="nx">searchParams</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">'_sort'</span><span class="p">,</span><span class="w"> </span><span class="nx">filters</span><span class="p">.</span><span class="nx">sort</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">token</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">getValidToken</span><span class="p">();</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="nx">url</span><span class="p">.</span><span class="nx">toString</span><span class="p">(),</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">headers</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="s1">'Authorization'</span><span class="o">:</span><span class="w"> </span><span class="sb">`Bearer </span><span class="si">${</span><span class="nx">token</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span>
<span class="w">      </span><span class="s1">'Accept'</span><span class="o">:</span><span class="w"> </span><span class="s1">'application/fhir+json'</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">});</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>
<span class="p">}</span>

<span class="c1">// Usage</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">vitals</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">searchObservations</span><span class="p">(</span><span class="s1">'123'</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">category</span><span class="o">:</span><span class="w"> </span><span class="s1">'vital-signs'</span><span class="p">,</span>
<span class="w">  </span><span class="nx">dateFrom</span><span class="o">:</span><span class="w"> </span><span class="s1">'2024-01-01'</span><span class="p">,</span>
<span class="w">  </span><span class="nx">count</span><span class="o">:</span><span class="w"> </span><span class="mf">50</span><span class="p">,</span>
<span class="w">  </span><span class="nx">sort</span><span class="o">:</span><span class="w"> </span><span class="s1">'-date'</span>
<span class="p">});</span>
</code></pre></div>
<h3 id="create-observation-helper">Create Observation Helper</h3>
<div class="highlight"><pre><span></span><code><span class="kd">function</span><span class="w"> </span><span class="nx">createObservation</span><span class="p">(</span><span class="nx">patientId</span><span class="p">,</span><span class="w"> </span><span class="nx">code</span><span class="p">,</span><span class="w"> </span><span class="nx">value</span><span class="p">,</span><span class="w"> </span><span class="nx">unit</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">resourceType</span><span class="o">:</span><span class="w"> </span><span class="s1">'Observation'</span><span class="p">,</span>
<span class="w">    </span><span class="nx">status</span><span class="o">:</span><span class="w"> </span><span class="s1">'final'</span><span class="p">,</span>
<span class="w">    </span><span class="nx">category</span><span class="o">:</span><span class="w"> </span><span class="p">[{</span>
<span class="w">      </span><span class="nx">coding</span><span class="o">:</span><span class="w"> </span><span class="p">[{</span>
<span class="w">        </span><span class="nx">system</span><span class="o">:</span><span class="w"> </span><span class="s1">'http://terminology.hl7.org/CodeSystem/observation-category'</span><span class="p">,</span>
<span class="w">        </span><span class="nx">code</span><span class="o">:</span><span class="w"> </span><span class="s1">'vital-signs'</span><span class="p">,</span>
<span class="w">        </span><span class="nx">display</span><span class="o">:</span><span class="w"> </span><span class="s1">'Vital Signs'</span>
<span class="w">      </span><span class="p">}]</span>
<span class="w">    </span><span class="p">}],</span>
<span class="w">    </span><span class="nx">code</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">coding</span><span class="o">:</span><span class="w"> </span><span class="p">[{</span>
<span class="w">        </span><span class="nx">system</span><span class="o">:</span><span class="w"> </span><span class="s1">'http://loinc.org'</span><span class="p">,</span>
<span class="w">        </span><span class="nx">code</span><span class="o">:</span><span class="w"> </span><span class="nx">code</span><span class="p">.</span><span class="nx">code</span><span class="p">,</span>
<span class="w">        </span><span class="nx">display</span><span class="o">:</span><span class="w"> </span><span class="nx">code</span><span class="p">.</span><span class="nx">display</span>
<span class="w">      </span><span class="p">}]</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nx">subject</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">reference</span><span class="o">:</span><span class="w"> </span><span class="sb">`Patient/</span><span class="si">${</span><span class="nx">patientId</span><span class="si">}</span><span class="sb">`</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nx">effectiveDateTime</span><span class="o">:</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">().</span><span class="nx">toISOString</span><span class="p">(),</span>
<span class="w">    </span><span class="nx">valueQuantity</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">value</span><span class="o">:</span><span class="w"> </span><span class="nx">value</span><span class="p">,</span>
<span class="w">      </span><span class="nx">unit</span><span class="o">:</span><span class="w"> </span><span class="nx">unit</span><span class="p">,</span>
<span class="w">      </span><span class="nx">system</span><span class="o">:</span><span class="w"> </span><span class="s1">'http://unitsofmeasure.org'</span><span class="p">,</span>
<span class="w">      </span><span class="nx">code</span><span class="o">:</span><span class="w"> </span><span class="nx">unit</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">};</span>
<span class="p">}</span>

<span class="c1">// Usage</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">weightObs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">createObservation</span><span class="p">(</span><span class="s1">'123'</span><span class="p">,</span><span class="w"> </span>
<span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="nx">code</span><span class="o">:</span><span class="w"> </span><span class="s1">'29463-7'</span><span class="p">,</span><span class="w"> </span><span class="nx">display</span><span class="o">:</span><span class="w"> </span><span class="s1">'Body Weight'</span><span class="w"> </span><span class="p">},</span>
<span class="w">  </span><span class="mf">70</span><span class="p">,</span><span class="w"> </span><span class="s1">'kg'</span>
<span class="p">);</span>

<span class="k">await</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="sb">`</span><span class="si">${</span><span class="nx">fhirBase</span><span class="si">}</span><span class="sb">/Observation`</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">method</span><span class="o">:</span><span class="w"> </span><span class="s1">'POST'</span><span class="p">,</span>
<span class="w">  </span><span class="nx">headers</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="s1">'Authorization'</span><span class="o">:</span><span class="w"> </span><span class="sb">`Bearer </span><span class="si">${</span><span class="nx">token</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span>
<span class="w">    </span><span class="s1">'Content-Type'</span><span class="o">:</span><span class="w"> </span><span class="s1">'application/fhir+json'</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nx">body</span><span class="o">:</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">weightObs</span><span class="p">)</span>
<span class="p">});</span>
</code></pre></div>
<hr/>
<h2 id="performance-optimization-tips">Performance Optimization Tips</h2>
<h3 id="1-use-batch-requests">1. Use Batch Requests</h3>
<div class="highlight"><pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="nx">batchRequest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">resourceType</span><span class="o">:</span><span class="w"> </span><span class="s1">'Bundle'</span><span class="p">,</span>
<span class="w">  </span><span class="nx">type</span><span class="o">:</span><span class="w"> </span><span class="s1">'batch'</span><span class="p">,</span>
<span class="w">  </span><span class="nx">entry</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nx">request</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">method</span><span class="o">:</span><span class="w"> </span><span class="s1">'GET'</span><span class="p">,</span>
<span class="w">        </span><span class="nx">url</span><span class="o">:</span><span class="w"> </span><span class="s1">'Patient/123'</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nx">request</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">method</span><span class="o">:</span><span class="w"> </span><span class="s1">'GET'</span><span class="p">,</span>
<span class="w">        </span><span class="nx">url</span><span class="o">:</span><span class="w"> </span><span class="s1">'Observation?patient=123&amp;category=vital-signs&amp;_count=10'</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nx">request</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">method</span><span class="o">:</span><span class="w"> </span><span class="s1">'GET'</span><span class="p">,</span>
<span class="w">        </span><span class="nx">url</span><span class="o">:</span><span class="w"> </span><span class="s1">'Condition?patient=123&amp;clinical-status=active'</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">]</span>
<span class="p">};</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="sb">`</span><span class="si">${</span><span class="nx">fhirBase</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">method</span><span class="o">:</span><span class="w"> </span><span class="s1">'POST'</span><span class="p">,</span>
<span class="w">  </span><span class="nx">headers</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="s1">'Authorization'</span><span class="o">:</span><span class="w"> </span><span class="sb">`Bearer </span><span class="si">${</span><span class="nx">token</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span>
<span class="w">    </span><span class="s1">'Content-Type'</span><span class="o">:</span><span class="w"> </span><span class="s1">'application/fhir+json'</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nx">body</span><span class="o">:</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">batchRequest</span><span class="p">)</span>
<span class="p">});</span>
</code></pre></div>
<h3 id="2-implement-caching">2. Implement Caching</h3>
<div class="highlight"><pre><span></span><code><span class="kd">class</span><span class="w"> </span><span class="nx">FHIRCache</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kr">constructor</span><span class="p">(</span><span class="nx">ttl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">300000</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// 5 minutes default</span>
<span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">cache</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Map</span><span class="p">();</span>
<span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">ttl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">ttl</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nx">set</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span><span class="w"> </span><span class="nx">value</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">cache</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">value</span><span class="p">,</span>
<span class="w">      </span><span class="nx">expiresAt</span><span class="o">:</span><span class="w"> </span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">ttl</span>
<span class="w">    </span><span class="p">});</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nx">get</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">item</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">cache</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">item</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nx">item</span><span class="p">.</span><span class="nx">expiresAt</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">this</span><span class="p">.</span><span class="nx">cache</span><span class="p">.</span><span class="ow">delete</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">item</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nx">clear</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">cache</span><span class="p">.</span><span class="nx">clear</span><span class="p">();</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">cache</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">FHIRCache</span><span class="p">();</span>

<span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">getPatient</span><span class="p">(</span><span class="nx">patientId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">cacheKey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sb">`patient-</span><span class="si">${</span><span class="nx">patientId</span><span class="si">}</span><span class="sb">`</span><span class="p">;</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">cached</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">cache</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">cacheKey</span><span class="p">);</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">cached</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nx">cached</span><span class="p">;</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">patient</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="sb">`</span><span class="si">${</span><span class="nx">fhirBase</span><span class="si">}</span><span class="sb">/Patient/</span><span class="si">${</span><span class="nx">patientId</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">headers</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s1">'Authorization'</span><span class="o">:</span><span class="w"> </span><span class="sb">`Bearer </span><span class="si">${</span><span class="nx">token</span><span class="si">}</span><span class="sb">`</span><span class="w"> </span><span class="p">}</span>
<span class="w">  </span><span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">json</span><span class="p">());</span>

<span class="w">  </span><span class="nx">cache</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">cacheKey</span><span class="p">,</span><span class="w"> </span><span class="nx">patient</span><span class="p">);</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">patient</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="3-lazy-load-data">3. Lazy Load Data</h3>
<div class="highlight"><pre><span></span><code><span class="c1">// Load critical data first, defer non-critical</span>
<span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">loadPatientDashboard</span><span class="p">(</span><span class="nx">patientId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// Critical: Load immediately</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">patient</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">getPatient</span><span class="p">(</span><span class="nx">patientId</span><span class="p">);</span>
<span class="w">  </span><span class="nx">renderPatientHeader</span><span class="p">(</span><span class="nx">patient</span><span class="p">);</span>

<span class="w">  </span><span class="c1">// Non-critical: Load in background</span>
<span class="w">  </span><span class="nb">Promise</span><span class="p">.</span><span class="nx">all</span><span class="p">([</span>
<span class="w">    </span><span class="nx">getRecentVitals</span><span class="p">(</span><span class="nx">patientId</span><span class="p">),</span>
<span class="w">    </span><span class="nx">getActiveConditions</span><span class="p">(</span><span class="nx">patientId</span><span class="p">),</span>
<span class="w">    </span><span class="nx">getActiveMedications</span><span class="p">(</span><span class="nx">patientId</span><span class="p">)</span>
<span class="w">  </span><span class="p">]).</span><span class="nx">then</span><span class="p">(([</span><span class="nx">vitals</span><span class="p">,</span><span class="w"> </span><span class="nx">conditions</span><span class="p">,</span><span class="w"> </span><span class="nx">medications</span><span class="p">])</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">renderVitals</span><span class="p">(</span><span class="nx">vitals</span><span class="p">);</span>
<span class="w">    </span><span class="nx">renderConditions</span><span class="p">(</span><span class="nx">conditions</span><span class="p">);</span>
<span class="w">    </span><span class="nx">renderMedications</span><span class="p">(</span><span class="nx">medications</span><span class="p">);</span>
<span class="w">  </span><span class="p">});</span>
<span class="p">}</span>
</code></pre></div>
<hr/>
<h2 id="final-checklist-before-going-live">Final Checklist Before Going Live</h2>
<h3 id="documentation">Documentation</h3>
<ul>
<li>[ ] API integration documented</li>
<li>[ ] Error handling documented</li>
<li>[ ] Security measures documented</li>
<li>[ ] Deployment process documented</li>
<li>[ ] Incident response plan created</li>
</ul>
<h3 id="legal-compliance">Legal &amp; Compliance</h3>
<ul>
<li>[ ] BAA signed with EHR vendor</li>
<li>[ ] Privacy policy reviewed by legal</li>
<li>[ ] Terms of service finalized</li>
<li>[ ] HIPAA compliance verified</li>
<li>[ ] State-specific requirements checked</li>
</ul>
<h3 id="operations">Operations</h3>
<ul>
<li>[ ] Monitoring dashboards configured</li>
<li>[ ] Alert thresholds set</li>
<li>[ ] On-call rotation established</li>
<li>[ ] Backup and recovery tested</li>
<li>[ ] Disaster recovery plan documented</li>
</ul>
<h3 id="support">Support</h3>
<ul>
<li>[ ] User documentation created</li>
<li>[ ] Support team trained</li>
<li>[ ] Escalation paths defined</li>
<li>[ ] Known issues documented</li>
<li>[ ] FAQ prepared</li>
</ul>
<hr/>
<p><strong>Last Updated:</strong> <code>[date]</code><br/>
<strong>Version:</strong> <code>[version #]</code><br/>
<strong>SMART App Launch Version:</strong> <code>2.0.0 (&lt;&lt;v2.2.0 — Dec 2025?&gt;&gt;)</code> <br/>
<strong>FHIR Version:</strong> <code>R4 (4.0.1)</code> <code>(&lt;&lt;5?&gt;&gt;)</code></p>
<hr/>
</article>
</div>
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
</div>
<button class="md-top md-icon" data-md-component="top" hidden="" type="button">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"></path></svg>
  Back to top
</button>
</main>
<footer class="md-footer">
<nav aria-label="Footer" class="md-footer__inner md-grid">
<a aria-label="Previous: eHealth" class="md-footer__link md-footer__link--prev" href="../">
<div class="md-footer__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
</div>
<div class="md-footer__title">
<span class="md-footer__direction">
                Previous
              </span>
<div class="md-ellipsis">
                eHealth
              </div>
</div>
</a>
<a aria-label="Next: SMART-on-FHIR and Integration — Visuals" class="md-footer__link md-footer__link--next" href="../smart-fhir-visuals/">
<div class="md-footer__title">
<span class="md-footer__direction">
                Next
              </span>
<div class="md-ellipsis">
                SMART-on-FHIR and Integration — Visuals
              </div>
</div>
<div class="md-footer__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"></path></svg>
</div>
</a>
</nav>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<div class="md-consent" data-md-component="consent" hidden="" id="__consent">
<div class="md-consent__overlay"></div>
<aside class="md-consent__inner">
<form class="md-consent__form md-grid md-typeset" name="consent">
<h4>Cookie consent</h4>
<p>We use cookies to recognize your repeated visits and preferences, as well as to measure the effectiveness of our documentation and whether users find what they're searching for. With your consent, you're helping us to make our documentation better.
</p>
<input class="md-toggle" id="__settings" type="checkbox"/>
<div class="md-consent__settings">
<ul class="task-list">
<li class="task-list-item">
<label class="task-list-control">
<input checked="" name="analytics" type="checkbox"/>
<span class="task-list-indicator"></span>
          Google Analytics
        </label>
</li>
</ul>
</div>
<div class="md-consent__controls">
<button class="md-button md-button--primary">Accept</button>
<label class="md-button" for="__settings">Manage settings</label>
</div>
</form>
</aside>
</div>
<script>var consent=__md_get("__consent");if(consent)for(var input of document.forms.consent.elements)input.name&&(input.checked=consent[input.name]||!1);else"file:"!==location.protocol&&setTimeout((function(){document.querySelector("[data-md-component=consent]").hidden=!1}),250);var form=document.forms.consent;for(var action of["submit","reset"])form.addEventListener(action,(function(e){if(e.preventDefault(),"reset"===e.type)for(var n of document.forms.consent.elements)n.name&&(n.checked=!1);__md_set("__consent",Object.fromEntries(Array.from(new FormData(form).keys()).map((function(e){return[e,!0]})))),location.hash="",location.reload()}))</script>
<script id="__config" type="application/json">{"base": "../..", "features": ["navigation.top", "navigation.footer", "navigation.indexes", "search.highlight", "search.suggest", "search.share", "content.code.copy", "content.code.select"], "search": "../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
<script src="../../assets/javascripts/bundle.525ec568.min.js"></script>
<script src="../../js/seamaiden.js"></script>
<script src="../../js/diagram-theme-switcher.js"></script>
<script src="../../js/diagram-zoom.js"></script>
<script src="../../js/alphabet-auto.js"></script>
<script src="../../assets/mkdocs_puml/puml.js"></script>
<script src="https://unpkg.com/@panzoom/panzoom@4.5.1/dist/panzoom.min.js"></script>
<script src="../../assets/mkdocs_puml/interaction.js"></script>
</body>
</html>