
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<link href="https://cassmastern.github.io/cass-sandbox/sec_ehealth/sec_deepdive/eh-dd-06-smart-auth/deepdive-security-and-access-control/" rel="canonical"/>
<link href="../deepdive-smart-config-discovery/" rel="prev"/>
<link href="../../eh-dd-07-hands-on-practice/" rel="next"/>
<link href="../../../../img/favicon.ico" rel="icon"/>
<meta content="mkdocs-1.6.1, mkdocs-material-9.5.39" name="generator"/>
<title>Security and Access Control - Ler's Sandbox</title>
<link href="../../../../assets/stylesheets/main.8c3ca2c6.min.css" rel="stylesheet"/>
<link href="../../../../assets/stylesheets/palette.06af60db.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
<link href="../../../../css/alphabet.css" rel="stylesheet"/>
<link href="../../../../css/diagram-zoom.css" rel="stylesheet"/>
<link href="../../../../css/cm-logo.css" rel="stylesheet"/>
<link href="../../../../css/color-vars.css" rel="stylesheet"/>
<link href="../../../../css/custom-theme-colors.css" rel="stylesheet"/>
<link href="../../../../assets/mkdocs_puml/puml.css" rel="stylesheet"/>
<link href="../../../../assets/mkdocs_puml/interaction.css" rel="stylesheet"/>
<script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
<script id="__analytics">function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-GD2XWDMP2E"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-GD2XWDMP2E",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-GD2XWDMP2E",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script>
<script>if("undefined"!=typeof __md_analytics){var consent=__md_get("__consent");consent&&consent.analytics&&__md_analytics()}</script>
</head>
<body data-md-color-accent="custom" data-md-color-primary="custom" data-md-color-scheme="slate" dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#security-and-access-control">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header md-header--shadow" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="Ler's Sandbox" class="md-header__button md-logo" data-md-component="logo" href="../../../.." title="Ler's Sandbox">
<img alt="logo" src="../../../../img/logo.svg"/>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            Ler's Sandbox
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              Security and Access Control
            
          </span>
</div>
</div>
</div>
<form class="md-header__option" data-md-component="palette">
<input aria-label="Switch to light mode" class="md-option" data-md-color-accent="custom" data-md-color-media="" data-md-color-primary="custom" data-md-color-scheme="slate" id="__palette_0" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_1" hidden="" title="Switch to light mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"></path></svg>
</label>
<input aria-label="Switch to dark mode" class="md-option" data-md-color-accent="custom" data-md-color-media="" data-md-color-primary="custom" data-md-color-scheme="default" id="__palette_1" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_0" hidden="" title="Switch to dark mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"></path></svg>
</label>
</form>
<script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
</label>
<nav aria-label="Search" class="md-search__options">
<a aria-label="Share" class="md-search__icon md-icon" data-clipboard="" data-clipboard-text="" data-md-component="search-share" href="javascript:void(0)" tabindex="-1" title="Share">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"></path></svg>
</a>
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" title="Clear" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>
</button>
</nav>
<div class="md-search__suggest" data-md-component="search-suggest"></div>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="" tabindex="0">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="Ler's Sandbox" class="md-nav__button md-logo" data-md-component="logo" href="../../../.." title="Ler's Sandbox">
<img alt="logo" src="../../../../img/logo.svg"/>
</a>
    Ler's Sandbox
  </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../..">
<span class="md-ellipsis">
    HOME
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_2" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../../../sec_about/">
<span class="md-ellipsis">
    ABOUT THIS WEBSITE
  </span>
</a>
<label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_2_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_2">
<span class="md-nav__icon md-icon"></span>
            ABOUT THIS WEBSITE
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../sec_about/whatsinhere/">
<span class="md-ellipsis">
    What's in Here?
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../sec_about/roadmap/">
<span class="md-ellipsis">
    Roadmap &amp; Changelog
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../sec_about/feedback/">
<span class="md-ellipsis">
    Feedback
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_3" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../../../sec_cloud/">
<span class="md-ellipsis">
    IN THE CLOUDS
  </span>
</a>
<label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_3_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_3">
<span class="md-nav__icon md-icon"></span>
            IN THE CLOUDS
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../sec_cloud/aws-gcp-azure/">
<span class="md-ellipsis">
    Architectures of AWS, GCP, and Azure
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../sec_cloud/aws-gcp-azure_glossary/">
<span class="md-ellipsis">
    Cross-Platform Cloud &amp; DevOps Glossary (AWS, GCP, Azure)
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../sec_cloud/aws-gcp-azure_glossary_enhanced/">
<span class="md-ellipsis">
    Cross-Platform Cloud &amp; DevOps Glossary (AWS, GCP, Azure) — Enhanced
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../sec_cloud/jakarta-ee-azure/">
<span class="md-ellipsis">
    A Jakarta Enterprise Application on Azure
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_4" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../../../sec_accss/">
<span class="md-ellipsis">
    ACCESSIBILITY
  </span>
</a>
<label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_4_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_4">
<span class="md-nav__icon md-icon"></span>
            ACCESSIBILITY
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../sec_accss/accss_/">
<span class="md-ellipsis">
    Accessibility Reference
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../sec_accss/visuals-for-the-sightless/">
<span class="md-ellipsis">
    Visuals for the Sightless
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../sec_accss/accss_diagram-dilemma/">
<span class="md-ellipsis">
    The Diagramming Dilemma
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../sec_accss/mermaid-beyond-reach/">
<span class="md-ellipsis">
    An Accessible Mermaid Beyond Reach
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../sec_accss/mermaid-captured/">
<span class="md-ellipsis">
    Mermaid Captured
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../sec_accss/mkdocs-mermaid-plantuml-graphviz/">
<span class="md-ellipsis">
    Diagram Accessibility: Current State/Path Forward
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_5" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../../../sec_freeform/">
<span class="md-ellipsis">
    CONCEPTS, ESSAYS, ETC.
  </span>
</a>
<label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_5_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_5">
<span class="md-nav__icon md-icon"></span>
            CONCEPTS, ESSAYS, ETC.
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../sec_freeform/ibm-sanfran/">
<span class="md-ellipsis">
    IBM SanFrancisco
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../sec_freeform/ai-accessibility/">
<span class="md-ellipsis">
    Accessibility with AI
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../sec_freeform/ai-accessibility_bus/">
<span class="md-ellipsis">
    Accessibility with AI (Concept Note)
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../sec_freeform/gen-ai-landscape-primer/">
<span class="md-ellipsis">
    GenAI Landscape in August, 2025
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../sec_freeform/identity/">
<span class="md-ellipsis">
    The Long Arc of Digital Identity
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_5_7" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../../../sec_freeform/sec_transl/">
<span class="md-ellipsis">
    Translations
  </span>
</a>
<label class="md-nav__link" for="__nav_5_7" id="__nav_5_7_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_5_7_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_5_7">
<span class="md-nav__icon md-icon"></span>
            Translations
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../sec_freeform/sec_transl/gen-ai-landschaft-dec-2025/">
<span class="md-ellipsis">
    Die GenAI-Landschaft im Dezember 2025
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../sec_freeform/sec_transl/ai-accessibility_bus-de/">
<span class="md-ellipsis">
    Barrierefreiheit mit KI (Konzeptpapier)
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_6" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../../../sec_net-sec/">
<span class="md-ellipsis">
    NETWORKS &amp; SECURITY
  </span>
</a>
<label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_6_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_6">
<span class="md-nav__icon md-icon"></span>
            NETWORKS &amp; SECURITY
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../sec_net-sec/network_data_center/">
<span class="md-ellipsis">
    A Hypothetical Data Centre Network
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../sec_net-sec/network_data_center_stride/">
<span class="md-ellipsis">
    Network Security and Threat Modeling — STRIDE
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../sec_net-sec/network_data_center_mitre/">
<span class="md-ellipsis">
    Network Security and Threat Modeling — MITRE ATT&amp;CK
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../sec_net-sec/saml-admin/">
<span class="md-ellipsis">
    Single Sign-On (SSO) Admin Guide — SAML 2.0 Integration
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_7" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../../">
<span class="md-ellipsis">
    eHEALTH
  </span>
</a>
<label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="true" aria-labelledby="__nav_7_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_7">
<span class="md-nav__icon md-icon"></span>
            eHEALTH
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_7_2" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../">
<span class="md-ellipsis">
    SMART-on-FHIR Deep Dive
  </span>
</a>
<label class="md-nav__link" for="__nav_7_2" id="__nav_7_2_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="true" aria-labelledby="__nav_7_2_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_7_2">
<span class="md-nav__icon md-icon"></span>
            SMART-on-FHIR Deep Dive
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_7_2_2" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../eh-dd-01-foundations/">
<span class="md-ellipsis">
    An Introduction to FHIR
  </span>
</a>
<label class="md-nav__link" for="__nav_7_2_2" id="__nav_7_2_2_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_7_2_2_label" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_7_2_2">
<span class="md-nav__icon md-icon"></span>
            An Introduction to FHIR
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../eh-dd-01-foundations/deepdive-overview/">
<span class="md-ellipsis">
    Overview of SMART-on-FHIR
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../eh-dd-01-foundations/deepdive-overview-fhir-arch/">
<span class="md-ellipsis">
    SMART-on-FHIR Architecture Overview
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../eh-dd-01-foundations/deepdive-overview-fhir-resources/">
<span class="md-ellipsis">
    Key FHIR Resources
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_7_2_3" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../eh-dd-02-fhir-data-fundamentals/">
<span class="md-ellipsis">
    FHIR Data Fundamentals
  </span>
</a>
<label class="md-nav__link" for="__nav_7_2_3" id="__nav_7_2_3_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_7_2_3_label" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_7_2_3">
<span class="md-nav__icon md-icon"></span>
            FHIR Data Fundamentals
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../eh-dd-02-fhir-data-fundamentals/deepdive-fhir-data-types/">
<span class="md-ellipsis">
    FHIR Data Types
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../eh-dd-02-fhir-data-fundamentals/deepdive-fhir-code-systems/">
<span class="md-ellipsis">
    FHIR Terminology Standards
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../eh-dd-02-fhir-data-fundamentals/deepdive-fhir-cardinality/">
<span class="md-ellipsis">
    FHIR Resource Cardinality
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../eh-dd-02-fhir-data-fundamentals/deepdive-complete-resource-example/">
<span class="md-ellipsis">
    Complete FHIR Resource Example
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_7_2_4" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../eh-dd-03-fhir-resource-relationships/">
<span class="md-ellipsis">
    FHIR Resource Relationships
  </span>
</a>
<label class="md-nav__link" for="__nav_7_2_4" id="__nav_7_2_4_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_7_2_4_label" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_7_2_4">
<span class="md-nav__icon md-icon"></span>
            FHIR Resource Relationships
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../eh-dd-03-fhir-resource-relationships/deepdive-fhir-resource-relationships/">
<span class="md-ellipsis">
    FHIR Resource Relationships
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../eh-dd-03-fhir-resource-relationships/deepdive-fhir-resource-relationships-comprehensive/">
<span class="md-ellipsis">
    FHIR Comprehensive Resource Relationships
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../eh-dd-03-fhir-resource-relationships/deepdive-fhir-resource-bundles/">
<span class="md-ellipsis">
    FHIR Resource Bundles
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_7_2_5" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../eh-dd-04-working-with-fhir-apis/">
<span class="md-ellipsis">
    FHIR Resource APIs
  </span>
</a>
<label class="md-nav__link" for="__nav_7_2_5" id="__nav_7_2_5_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_7_2_5_label" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_7_2_5">
<span class="md-nav__icon md-icon"></span>
            FHIR Resource APIs
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../eh-dd-04-working-with-fhir-apis/deepdive-fhir-rest-common-ops/">
<span class="md-ellipsis">
    Common FHIR REST Operations
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../eh-dd-04-working-with-fhir-apis/deepdive-fhir-search-parameters/">
<span class="md-ellipsis">
    FHIR Search Parameters
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../eh-dd-04-working-with-fhir-apis/deepdive-error-handling/">
<span class="md-ellipsis">
    Error Handling and OperationOutcome
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../eh-dd-04-working-with-fhir-apis/deepdive-fhir-validation/">
<span class="md-ellipsis">
    FHIR Validation
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_7_2_6" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../eh-dd-05-advanced-fhir-concepts/">
<span class="md-ellipsis">
    Advanced FHIR Concepts
  </span>
</a>
<label class="md-nav__link" for="__nav_7_2_6" id="__nav_7_2_6_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_7_2_6_label" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_7_2_6">
<span class="md-nav__icon md-icon"></span>
            Advanced FHIR Concepts
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../eh-dd-05-advanced-fhir-concepts/eh-dd-05-advanced-intro/">
<span class="md-ellipsis">
    Handling Variation — Overview
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../eh-dd-05-advanced-fhir-concepts/deepdive-fhir-profiles-and-extensions/">
<span class="md-ellipsis">
    FHIR Profiles and Extensions
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_7_2_7" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../">
<span class="md-ellipsis">
    SMART Authorization
  </span>
</a>
<label class="md-nav__link" for="__nav_7_2_7" id="__nav_7_2_7_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="true" aria-labelledby="__nav_7_2_7_label" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_7_2_7">
<span class="md-nav__icon md-icon"></span>
            SMART Authorization
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../deepdive-oauth-overview/">
<span class="md-ellipsis">
    Overview
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../deepdive-oauth-flow/">
<span class="md-ellipsis">
    OAuth 2.0 Flow
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../deepdive-smart-launch-flow/">
<span class="md-ellipsis">
    SMART Launch Flow
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../deepdive-smart-scopes-and-auth/">
<span class="md-ellipsis">
    SMART Scopes and Authorization
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../deepdive-smart-config-discovery/">
<span class="md-ellipsis">
    SMART Configuration Discovery
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
<span class="md-ellipsis">
    Security and Access Control
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
<span class="md-ellipsis">
    Security and Access Control
  </span>
</a>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#defense-in-depth-multiple-layers-of-protection">
<span class="md-ellipsis">
      Defense in Depth: Multiple Layers of Protection
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#the-security-layers">
<span class="md-ellipsis">
      The Security Layers
    </span>
</a>
<nav aria-label="The Security Layers" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#layer-1-transport-security-tls">
<span class="md-ellipsis">
      Layer 1: Transport Security (TLS)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#layer-2-user-authentication">
<span class="md-ellipsis">
      Layer 2: User Authentication
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#layer-3-token-validation">
<span class="md-ellipsis">
      Layer 3: Token Validation
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#layer-4-scope-authorization">
<span class="md-ellipsis">
      Layer 4: Scope Authorization
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#layer-5-context-verification">
<span class="md-ellipsis">
      Layer 5: Context Verification
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#layer-6-resource-access-control">
<span class="md-ellipsis">
      Layer 6: Resource Access Control
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#layer-7-consent-checking">
<span class="md-ellipsis">
      Layer 7: Consent Checking
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#layer-8-audit-logging">
<span class="md-ellipsis">
      Layer 8: Audit Logging
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#common-attack-vectors-and-mitigations">
<span class="md-ellipsis">
      Common Attack Vectors and Mitigations
    </span>
</a>
<nav aria-label="Common Attack Vectors and Mitigations" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#attack-token-theft">
<span class="md-ellipsis">
      Attack: Token Theft
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#attack-csrf-cross-site-request-forgery">
<span class="md-ellipsis">
      Attack: CSRF (Cross-Site Request Forgery)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#attack-authorization-code-interception">
<span class="md-ellipsis">
      Attack: Authorization Code Interception
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#attack-phishing">
<span class="md-ellipsis">
      Attack: Phishing
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#attack-scope-creep">
<span class="md-ellipsis">
      Attack: Scope Creep
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#security-best-practices-for-apps">
<span class="md-ellipsis">
      Security Best Practices for Apps
    </span>
</a>
<nav aria-label="Security Best Practices for Apps" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#1-never-store-tokens-in-localstorage">
<span class="md-ellipsis">
      1. Never Store Tokens in LocalStorage
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#2-implement-token-refresh-before-expiration">
<span class="md-ellipsis">
      2. Implement Token Refresh Before Expiration
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#3-validate-all-server-responses">
<span class="md-ellipsis">
      3. Validate All Server Responses
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#4-use-pkce-for-public-clients">
<span class="md-ellipsis">
      4. Use PKCE for Public Clients
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#5-clear-tokens-on-logout">
<span class="md-ellipsis">
      5. Clear Tokens on Logout
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#security-checklist">
<span class="md-ellipsis">
      Security Checklist
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#summary">
<span class="md-ellipsis">
      Summary
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#next-steps">
<span class="md-ellipsis">
      Next Steps
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_7_2_8" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../eh-dd-07-hands-on-practice/">
<span class="md-ellipsis">
    Hands-On
  </span>
</a>
<label class="md-nav__link" for="__nav_7_2_8" id="__nav_7_2_8_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_7_2_8_label" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_7_2_8">
<span class="md-nav__icon md-icon"></span>
            Hands-On
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../eh-dd-07-hands-on-practice/deepdive-smart-health-it-sandbox/">
<span class="md-ellipsis">
    Using the SMART Health IT Sandbox
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../eh-dd-07-hands-on-practice/deepdive-smart_client_impl-sample-app/">
<span class="md-ellipsis">
    Building a SMART App: Complete Tutorial
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../eh-dd-07-hands-on-practice/deepdive-smart_client_impl/">
<span class="md-ellipsis">
    SMART Client Example (Python)
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../eh-dd-07-hands-on-practice/deepdive-smart_client_impl-practical-code-examples/">
<span class="md-ellipsis">
    Practical Code Examples
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../eh-dd-07-hands-on-practice/deepdive-testing-and-debugging/">
<span class="md-ellipsis">
    Testing and Debugging
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_7_2_9" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../eh-dd-08-wrap-up/">
<span class="md-ellipsis">
    Wrap-Up
  </span>
</a>
<label class="md-nav__link" for="__nav_7_2_9" id="__nav_7_2_9_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_7_2_9_label" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_7_2_9">
<span class="md-nav__icon md-icon"></span>
            Wrap-Up
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../eh-dd-08-wrap-up/deepdive-key-takeaways/">
<span class="md-ellipsis">
    Deepdive key takeaways
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../eh-dd-08-wrap-up/deepdive-summary/">
<span class="md-ellipsis">
    Summary
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_7_3" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../../sec_integration/">
<span class="md-ellipsis">
    SMART-on-FHIR Integration
  </span>
</a>
<label class="md-nav__link" for="__nav_7_3" id="__nav_7_3_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_7_3_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_7_3">
<span class="md-nav__icon md-icon"></span>
            SMART-on-FHIR Integration
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../sec_integration/quick_ref/">
<span class="md-ellipsis">
    SMART-on-FHIR and Integration Quick Reference
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../sec_integration/smart-fhir-visuals/">
<span class="md-ellipsis">
    SMART-on-FHIR and Integration — Visuals
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../sec_integration/gloss_ontario_halo/">
<span class="md-ellipsis">
    Ontario eHealth &amp; HALO Integration Glossary
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_8" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../../../sec_api/">
<span class="md-ellipsis">
    API DOCUMENTATION
  </span>
</a>
<label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_8_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_8">
<span class="md-nav__icon md-icon"></span>
            API DOCUMENTATION
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_8_2" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../../../sec_api/sec_api_countries/">
<span class="md-ellipsis">
    COUNTRIES REST API
  </span>
</a>
<label class="md-nav__link" for="__nav_8_2" id="__nav_8_2_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_8_2_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_8_2">
<span class="md-nav__icon md-icon"></span>
            COUNTRIES REST API
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../sec_api/sec_api_countries/api-countries-overview/">
<span class="md-ellipsis">
    Overview
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_8_2_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_8_2_3" id="__nav_8_2_3_label" tabindex="0">
<span class="md-ellipsis">
    Guides
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_8_2_3_label" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_8_2_3">
<span class="md-nav__icon md-icon"></span>
            Guides
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../sec_api/sec_api_countries/sec_api_countries_guides/api-countries-guides-quickstart/">
<span class="md-ellipsis">
    Quick Start Guide
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../sec_api/sec_api_countries/sec_api_countries_guides/api-countries-guides-filtering/">
<span class="md-ellipsis">
    Advanced Filtering
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../sec_api/sec_api_countries/sec_api_countries_guides/api-countries-guides-integration/">
<span class="md-ellipsis">
    Integration Patterns
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_8_2_4" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../../../sec_api/sec_api_countries/sec_api_countries_examples/">
<span class="md-ellipsis">
    Examples
  </span>
</a>
<label class="md-nav__link" for="__nav_8_2_4" id="__nav_8_2_4_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_8_2_4_label" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_8_2_4">
<span class="md-nav__icon md-icon"></span>
            Examples
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../sec_api/sec_api_countries/sec_api_countries_examples/api-countries-examples-javascript/">
<span class="md-ellipsis">
    JavaScript Examples
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../sec_api/sec_api_countries/sec_api_countries_examples/api-countries-examples-python/">
<span class="md-ellipsis">
    Python Examples
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../sec_api/sec_api_countries/sec_api_countries_examples/api-countries-examples-usecases/">
<span class="md-ellipsis">
    Real-World Use Cases
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../sec_api/sec_api_countries/reference/">
<span class="md-ellipsis">
    Interactive OpenAPI (Swagger) Reference
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../sec_api/sec_api_countries/resources/">
<span class="md-ellipsis">
    Resources &amp; Support
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_8_3" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../../../sec_api/sec_api_stripe/">
<span class="md-ellipsis">
    STRIPE PAYMENT API
  </span>
</a>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_8_3_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_8_3">
<span class="md-nav__icon md-icon"></span>
            STRIPE PAYMENT API
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_9" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../../../sec_cheatsheets/">
<span class="md-ellipsis">
    CHEAT SHEETS
  </span>
</a>
<label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_9_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_9">
<span class="md-nav__icon md-icon"></span>
            CHEAT SHEETS
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../sec_cheatsheets/cheatsheet-docker/">
<span class="md-ellipsis">
    Docker Command Cheatsheet
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../sec_cheatsheets/cheatsheet-kubectl/">
<span class="md-ellipsis">
    Kubectl Command Cheat Sheet
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../sec_cheatsheets/cheatsheet_compound-modifiers/">
<span class="md-ellipsis">
    Compound Modifiers Cheat Sheet
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_10" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../../../sec_gloss/">
<span class="md-ellipsis">
    GLOSSARIES
  </span>
</a>
<label class="md-nav__link" for="__nav_10" id="__nav_10_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_10_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_10">
<span class="md-nav__icon md-icon"></span>
            GLOSSARIES
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../sec_gloss/gloss_oss/">
<span class="md-ellipsis">
    Glossary of OSS Terms
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../sec_gloss/gloss_networking/">
<span class="md-ellipsis">
    Glossary of Networking Terms
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../sec_gloss/gloss_kuber/">
<span class="md-ellipsis">
    Glossary of Kubernetes Terms
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../sec_gloss/gloss_cloud-native/">
<span class="md-ellipsis">
    Glossary of Cloud-Native Terms
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#defense-in-depth-multiple-layers-of-protection">
<span class="md-ellipsis">
      Defense in Depth: Multiple Layers of Protection
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#the-security-layers">
<span class="md-ellipsis">
      The Security Layers
    </span>
</a>
<nav aria-label="The Security Layers" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#layer-1-transport-security-tls">
<span class="md-ellipsis">
      Layer 1: Transport Security (TLS)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#layer-2-user-authentication">
<span class="md-ellipsis">
      Layer 2: User Authentication
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#layer-3-token-validation">
<span class="md-ellipsis">
      Layer 3: Token Validation
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#layer-4-scope-authorization">
<span class="md-ellipsis">
      Layer 4: Scope Authorization
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#layer-5-context-verification">
<span class="md-ellipsis">
      Layer 5: Context Verification
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#layer-6-resource-access-control">
<span class="md-ellipsis">
      Layer 6: Resource Access Control
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#layer-7-consent-checking">
<span class="md-ellipsis">
      Layer 7: Consent Checking
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#layer-8-audit-logging">
<span class="md-ellipsis">
      Layer 8: Audit Logging
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#common-attack-vectors-and-mitigations">
<span class="md-ellipsis">
      Common Attack Vectors and Mitigations
    </span>
</a>
<nav aria-label="Common Attack Vectors and Mitigations" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#attack-token-theft">
<span class="md-ellipsis">
      Attack: Token Theft
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#attack-csrf-cross-site-request-forgery">
<span class="md-ellipsis">
      Attack: CSRF (Cross-Site Request Forgery)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#attack-authorization-code-interception">
<span class="md-ellipsis">
      Attack: Authorization Code Interception
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#attack-phishing">
<span class="md-ellipsis">
      Attack: Phishing
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#attack-scope-creep">
<span class="md-ellipsis">
      Attack: Scope Creep
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#security-best-practices-for-apps">
<span class="md-ellipsis">
      Security Best Practices for Apps
    </span>
</a>
<nav aria-label="Security Best Practices for Apps" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#1-never-store-tokens-in-localstorage">
<span class="md-ellipsis">
      1. Never Store Tokens in LocalStorage
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#2-implement-token-refresh-before-expiration">
<span class="md-ellipsis">
      2. Implement Token Refresh Before Expiration
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#3-validate-all-server-responses">
<span class="md-ellipsis">
      3. Validate All Server Responses
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#4-use-pkce-for-public-clients">
<span class="md-ellipsis">
      4. Use PKCE for Public Clients
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#5-clear-tokens-on-logout">
<span class="md-ellipsis">
      5. Clear Tokens on Logout
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#security-checklist">
<span class="md-ellipsis">
      Security Checklist
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#summary">
<span class="md-ellipsis">
      Summary
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#next-steps">
<span class="md-ellipsis">
      Next Steps
    </span>
</a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<h1 id="security-and-access-control">Security and Access Control</h1>
<h2 id="defense-in-depth-multiple-layers-of-protection">Defense in Depth: Multiple Layers of Protection</h2>
<p>Healthcare data is the most sensitive personal information. SMART-on-FHIR implements <strong>defense in depth</strong>—multiple independent security layers that protect data even if one layer fails.</p>
<p>Think of it like securing a bank vault:
- 🔒 Outer door (TLS encryption)
- 🔑 Authentication (proving who you are)
- 🎫 Authorization tokens (permission tickets)
- 🚧 Scope checking (what you can do)
- 🏥 Resource access control (additional restrictions)
- 📝 Audit logging (recording all access)</p>
<p>Each layer adds protection. An attacker must defeat ALL layers to access data.</p>
<hr/>
<h2 id="the-security-layers">The Security Layers</h2>
<p>Let's dive right into the deep end by taking a look at the complete security flow:</p>
<div class="mermaid">graph TD
    Request[API Request]

    Request --&gt; TLS[Transport Security TLS]
    TLS --&gt; Auth[Authentication]
    Auth --&gt; Token[Token Validation]
    Token --&gt; Scope[Scope Authorization]
    Scope --&gt; Context[Context Verification]
    Context --&gt; Resource[Resource Access Control]
    Resource --&gt; Consent[Consent Checking]
    Consent --&gt; Audit[Audit Logging]
    Audit --&gt; Response[Return Response]

    TLS --&gt; TLSCheck{Valid HTTPS?}
    TLSCheck --&gt;|No| Reject1[Reject - Insecure]
    TLSCheck --&gt;|Yes| AuthCont[Continue]

    Auth --&gt; AuthCheck{Valid<br/>Credentials?}
    AuthCheck --&gt;|No| Reject2[401 Unauthorized]
    AuthCheck --&gt;|Yes| TokenCont[Continue]

    Token --&gt; TokenCheck{Valid Access<br/>Token?}
    TokenCheck --&gt;|No| Reject3[401 Invalid Token]
    TokenCheck --&gt;|Expired| Reject4[401 Token Expired]
    TokenCheck --&gt;|Yes| ScopeCont[Continue]

    Scope --&gt; ScopeCheck{Required<br/>Scope Present?}
    ScopeCheck --&gt;|No| Reject5[403 Insufficient Scope]
    ScopeCheck --&gt;|Yes| ContextCont[Continue]

    Context --&gt; ContextCheck{Patient Context<br/>Matches?}
    ContextCheck --&gt;|No| Reject6[403 Invalid Context]
    ContextCheck --&gt;|Yes| ResourceCont[Continue]

    Resource --&gt; ResourceCheck{Resource<br/>Authorized?}
    ResourceCheck --&gt;|No| Reject7[403 Forbidden]
    ResourceCheck --&gt;|Yes| ConsentCont[Continue]

    Consent --&gt; ConsentCheck{Consent<br/>Granted?}
    ConsentCheck --&gt;|No| Reject8[403 Consent Denied]
    ConsentCheck --&gt;|Yes| AuditCont[Continue]
</div>
<p>Let's examine each layer:</p>
<h3 id="layer-1-transport-security-tls">Layer 1: Transport Security (TLS)</h3>
<p><strong>What it does</strong>: Encrypts all data in transit.</p>
<p><strong>Requirement</strong>: All FHIR servers MUST use HTTPS (TLS 1.2 or higher).</p>
<p><strong>Protection</strong>:
- Prevents eavesdropping on network traffic
- Ensures data integrity (can't be modified in transit)
- Authenticates server identity (prevents impersonation)</p>
<p><strong>Failure mode</strong>: Without TLS, attacker could intercept tokens and patient data.</p>
<p><strong>Check</strong>: Is URL <code>https://</code>?</p>
<div class="highlight"><pre><span></span><code><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">fhirUrl</span><span class="p">.</span><span class="nx">startsWith</span><span class="p">(</span><span class="s1">'https://'</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s1">'FHIR server must use HTTPS'</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<hr/>
<h3 id="layer-2-user-authentication">Layer 2: User Authentication</h3>
<p><strong>What it does</strong>: Verifies user identity before granting access.</p>
<p><strong>Methods</strong>:
- Username/password
- Multi-factor authentication (MFA)
- Smart cards, biometrics
- Single sign-on (SSO) via SAML, OpenID Connect</p>
<p><strong>Protection</strong>: Ensures only authorized users can initiate sessions.</p>
<p><strong>Failure mode</strong>: Without authentication, anyone could access the system.</p>
<p><strong>Response codes</strong>:
- <code>401 Unauthorized</code>: No credentials provided or invalid credentials</p>
<hr/>
<h3 id="layer-3-token-validation">Layer 3: Token Validation</h3>
<p><strong>What it does</strong>: Validates OAuth access token on every API request.</p>
<p><strong>Checks</strong>:</p>
<ol>
<li><strong>Token exists</strong>: Authorization header present</li>
<li><strong>Signature valid</strong>: JWT signature verifiable using server's public key</li>
<li><strong>Not expired</strong>: Current time &lt; token <code>exp</code> claim</li>
<li><strong>Correct audience</strong>: Token <code>aud</code> claim matches FHIR server URL</li>
<li><strong>Not revoked</strong>: Token not in revocation list</li>
</ol>
<p><strong>Protection</strong>: Stolen or forged tokens are rejected.</p>
<p><strong>Failure modes</strong>:
- <code>401 Unauthorized</code>: Missing, invalid, or expired token
- <code>401 Token Expired</code>: Token expired (client should refresh)</p>
<p><strong>Example validation</strong> (server-side):</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">jwt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>

<span class="k">def</span><span class="w"> </span><span class="nf">validate_token</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">public_key</span><span class="p">,</span> <span class="n">audience</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Decode and verify JWT</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="n">jwt</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span>
            <span class="n">token</span><span class="p">,</span>
            <span class="n">public_key</span><span class="p">,</span>
            <span class="n">algorithms</span><span class="o">=</span><span class="p">[</span><span class="s1">'RS256'</span><span class="p">],</span>
            <span class="n">audience</span><span class="o">=</span><span class="n">audience</span>
        <span class="p">)</span>

        <span class="c1"># Check expiration</span>
        <span class="n">exp</span> <span class="o">=</span> <span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'exp'</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">exp</span> <span class="ow">and</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span><span class="o">.</span><span class="n">timestamp</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">exp</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">'Token expired'</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">payload</span>
    <span class="k">except</span> <span class="n">jwt</span><span class="o">.</span><span class="n">InvalidTokenError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">'Invalid token: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span>
</code></pre></div>
<hr/>
<h3 id="layer-4-scope-authorization">Layer 4: Scope Authorization</h3>
<p><strong>What it does</strong>: Verifies token has required scope for operation.</p>
<p><strong>Logic</strong>:</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">check_scope</span><span class="p">(</span><span class="n">token_scopes</span><span class="p">,</span> <span class="n">required_scope</span><span class="p">):</span>
    <span class="n">scopes</span> <span class="o">=</span> <span class="n">token_scopes</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">' '</span><span class="p">)</span>

    <span class="c1"># Exact match</span>
    <span class="k">if</span> <span class="n">required_scope</span> <span class="ow">in</span> <span class="n">scopes</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="c1"># Wildcard match (patient/*.read includes patient/Observation.read)</span>
    <span class="n">context</span><span class="p">,</span> <span class="n">resource_action</span> <span class="o">=</span> <span class="n">required_scope</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">'/'</span><span class="p">)</span>
    <span class="n">resource</span><span class="p">,</span> <span class="n">action</span> <span class="o">=</span> <span class="n">resource_action</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">'.'</span><span class="p">)</span>

    <span class="k">if</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">context</span><span class="si">}</span><span class="s2">/*.</span><span class="si">{</span><span class="n">action</span><span class="si">}</span><span class="s2">"</span> <span class="ow">in</span> <span class="n">scopes</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">if</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">context</span><span class="si">}</span><span class="s2">/*.*"</span> <span class="ow">in</span> <span class="n">scopes</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="c1"># .write implies .read</span>
    <span class="k">if</span> <span class="n">action</span> <span class="o">==</span> <span class="s1">'read'</span><span class="p">:</span>
        <span class="n">write_scope</span> <span class="o">=</span> <span class="n">required_scope</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">'.read'</span><span class="p">,</span> <span class="s1">'.write'</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">write_scope</span> <span class="ow">in</span> <span class="n">scopes</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>

    <span class="k">return</span> <span class="kc">False</span>
</code></pre></div>
<p><strong>Protection</strong>: Prevents apps from accessing data beyond granted permissions.</p>
<p><strong>Failure mode</strong>:
- <code>403 Forbidden</code>: Insufficient scope</p>
<p><strong>Example</strong>:</p>
<div class="highlight"><pre><span></span><code>Token scope: "patient/Observation.read"
Request: GET /MedicationRequest/123
Result: 403 Forbidden (need patient/MedicationRequest.read)
</code></pre></div>
<hr/>
<h3 id="layer-5-context-verification">Layer 5: Context Verification</h3>
<p><strong>What it does</strong>: Ensures requested resource matches token's patient context.</p>
<p><strong>Check</strong>:</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">verify_patient_context</span><span class="p">(</span><span class="n">token_patient_id</span><span class="p">,</span> <span class="n">requested_patient_id</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">token_patient_id</span> <span class="o">!=</span> <span class="n">requested_patient_id</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ForbiddenError</span><span class="p">(</span><span class="s1">'Patient context mismatch'</span><span class="p">)</span>
</code></pre></div>
<p><strong>Protection</strong>: Prevents apps from accessing wrong patient's data.</p>
<p><strong>Example</strong>:</p>
<div class="highlight"><pre><span></span><code>Token patient: "smart-1288992"
Request: GET /Observation?patient=smart-1032702
Result: 403 Forbidden (token scoped to different patient)
</code></pre></div>
<p><strong>Special case: <code>user/</code> scopes</strong>: Context check uses EHR's access control list instead of token patient claim.</p>
<hr/>
<h3 id="layer-6-resource-access-control">Layer 6: Resource Access Control</h3>
<p><strong>What it does</strong>: Applies EHR's existing access control policies.</p>
<p><strong>Checks</strong>:
- Does user have permission in EHR to view this patient?
- Is data flagged as sensitive (e.g., mental health, HIV status)?
- Are there break-the-glass requirements?
- Do organizational policies restrict access?</p>
<p><strong>Protection</strong>: OAuth tokens don't bypass EHR security—they layer on top.</p>
<p><strong>Failure mode</strong>:
- <code>403 Forbidden</code>: Resource not allowed for user</p>
<p><strong>Example</strong>:</p>
<div class="highlight"><pre><span></span><code>User: Dr. Smith (cardiologist)
Request: GET /Observation/psych-eval-123 (mental health observation)
Result: 403 Forbidden (not Dr. Smith's department)
</code></pre></div>
<hr/>
<h3 id="layer-7-consent-checking">Layer 7: Consent Checking</h3>
<p><strong>What it does</strong>: Respects patient consent directives.</p>
<p><strong>Scenarios</strong>:
- Patient opted out of data sharing with research apps
- Patient restricted access to specific encounters
- Patient granted access only to certain resource types
- Minor patient's guardian consent required</p>
<p><strong>Protection</strong>: Enforces patient privacy preferences.</p>
<p><strong>Failure mode</strong>:
- <code>403 Forbidden</code>: Consent denied</p>
<p><strong>Example</strong>:</p>
<div class="highlight"><pre><span></span><code>Patient opt-out: No sharing with third-party apps
Request: Third-party app tries to access data
Result: 403 Forbidden (consent not granted)
</code></pre></div>
<hr/>
<h3 id="layer-8-audit-logging">Layer 8: Audit Logging</h3>
<p><strong>What it does</strong>: Records all access for accountability.</p>
<p><strong>Logged information</strong>:
- Who accessed (user ID, app ID)
- What was accessed (resource type, ID)
- When (timestamp)
- From where (IP address)
- Result (success/failure)
- Purpose of use (if provided)</p>
<p><strong>Protection</strong>: Detects unauthorized access after the fact. Enables investigation.</p>
<p><strong>Example log entry</strong>:</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">"timestamp"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2024-11-06T15:30:00Z"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"user"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Practitioner/dr-johnson"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"app"</span><span class="p">:</span><span class="w"> </span><span class="s2">"cardiac-risk-calculator"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"action"</span><span class="p">:</span><span class="w"> </span><span class="s2">"read"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"resource"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Patient/smart-1288992"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"result"</span><span class="p">:</span><span class="w"> </span><span class="s2">"success"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"ip"</span><span class="p">:</span><span class="w"> </span><span class="s2">"192.168.1.100"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"scopes"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"patient/Patient.read"</span><span class="p">,</span><span class="w"> </span><span class="s2">"patient/Observation.read"</span><span class="p">]</span>
<span class="p">}</span>
</code></pre></div>
<p><strong>Compliance</strong>: Required by HIPAA, GDPR, and other regulations.</p>
<hr/>
<h2 id="common-attack-vectors-and-mitigations">Common Attack Vectors and Mitigations</h2>
<h3 id="attack-token-theft">Attack: Token Theft</h3>
<p><strong>Scenario</strong>: Attacker intercepts access token (e.g., from browser localStorage via XSS).</p>
<p><strong>Mitigations</strong>:
1. <strong>Short token lifetime</strong> (1 hour typical) - Limits damage window
2. <strong>Refresh tokens</strong> - Stored more securely than access tokens
3. <strong>Token rotation</strong> - New tokens on each refresh
4. <strong>Revocation</strong> - Ability to invalidate compromised tokens</p>
<hr/>
<h3 id="attack-csrf-cross-site-request-forgery">Attack: CSRF (Cross-Site Request Forgery)</h3>
<p><strong>Scenario</strong>: Malicious site tricks user into authorizing attacker's app session.</p>
<p><strong>Mitigation</strong>: <code>state</code> parameter</p>
<div class="highlight"><pre><span></span><code><span class="c1">// App generates random state</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">generateRandomString</span><span class="p">();</span>
<span class="nx">sessionStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="s1">'oauth_state'</span><span class="p">,</span><span class="w"> </span><span class="nx">state</span><span class="p">);</span>

<span class="c1">// Include in authorization request</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">href</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sb">`</span><span class="si">${</span><span class="nx">authEndpoint</span><span class="si">}</span><span class="sb">?...&amp;state=</span><span class="si">${</span><span class="nx">state</span><span class="si">}</span><span class="sb">`</span><span class="p">;</span>

<span class="c1">// Validate on callback</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">returnedState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">URLSearchParams</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">search</span><span class="p">).</span><span class="nx">get</span><span class="p">(</span><span class="s1">'state'</span><span class="p">);</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">returnedState</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="nx">sessionStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="s1">'oauth_state'</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s1">'CSRF detected'</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<hr/>
<h3 id="attack-authorization-code-interception">Attack: Authorization Code Interception</h3>
<p><strong>Scenario</strong>: Attacker intercepts authorization code from redirect URI.</p>
<p><strong>Mitigation</strong>: PKCE (Proof Key for Code Exchange)</p>
<div class="highlight"><pre><span></span><code><span class="c1">// Generate verifier</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">verifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">generateRandomString</span><span class="p">(</span><span class="mf">128</span><span class="p">);</span>
<span class="nx">sessionStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="s1">'code_verifier'</span><span class="p">,</span><span class="w"> </span><span class="nx">verifier</span><span class="p">);</span>

<span class="c1">// Generate challenge</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">challenge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">base64url</span><span class="p">(</span><span class="nx">sha256</span><span class="p">(</span><span class="nx">verifier</span><span class="p">));</span>

<span class="c1">// Include in authorization request</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">authUrl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sb">`</span><span class="si">${</span><span class="nx">authEndpoint</span><span class="si">}</span><span class="sb">?...&amp;code_challenge=</span><span class="si">${</span><span class="nx">challenge</span><span class="si">}</span><span class="sb">&amp;code_challenge_method=S256`</span><span class="p">;</span>

<span class="c1">// Send verifier in token request</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">tokenResponse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="nx">tokenEndpoint</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">method</span><span class="o">:</span><span class="w"> </span><span class="s1">'POST'</span><span class="p">,</span>
<span class="w">  </span><span class="nx">body</span><span class="o">:</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">URLSearchParams</span><span class="p">({</span>
<span class="w">    </span><span class="nx">grant_type</span><span class="o">:</span><span class="w"> </span><span class="s1">'authorization_code'</span><span class="p">,</span>
<span class="w">    </span><span class="nx">code</span><span class="o">:</span><span class="w"> </span><span class="nx">authCode</span><span class="p">,</span>
<span class="w">    </span><span class="nx">code_verifier</span><span class="o">:</span><span class="w"> </span><span class="nx">verifier</span>
<span class="w">  </span><span class="p">})</span>
<span class="p">});</span>
</code></pre></div>
<hr/>
<h3 id="attack-phishing">Attack: Phishing</h3>
<p><strong>Scenario</strong>: Fake authorization server tricks user into entering credentials.</p>
<p><strong>Mitigations</strong>:
1. <strong>User education</strong>: Verify authorization server URL
2. <strong>Branded consent screens</strong>: Recognizable design
3. <strong>Domain validation</strong>: Check authorization endpoint domain
4. <strong>Certificate pinning</strong> (mobile apps): Validate server certificate</p>
<hr/>
<h3 id="attack-scope-creep">Attack: Scope Creep</h3>
<p><strong>Scenario</strong>: App requests excessive permissions, hoping user won't notice.</p>
<p><strong>Mitigations</strong>:
1. <strong>Explicit consent</strong>: Show requested scopes in plain language
2. <strong>Granular approval</strong>: Let users approve subset of scopes
3. <strong>Audit requests</strong>: Log scope requests for review
4. <strong>Principle of least privilege</strong>: Apps should request minimum needed</p>
<hr/>
<h2 id="security-best-practices-for-apps">Security Best Practices for Apps</h2>
<h3 id="1-never-store-tokens-in-localstorage">1. Never Store Tokens in LocalStorage</h3>
<p><strong>Vulnerable to XSS attacks</strong>:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// BAD</span>
<span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="s1">'access_token'</span><span class="p">,</span><span class="w"> </span><span class="nx">token</span><span class="p">);</span>

<span class="c1">// GOOD (access tokens)</span>
<span class="c1">// Store in memory only</span>
<span class="kd">let</span><span class="w"> </span><span class="nx">accessToken</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">tokenResponse</span><span class="p">.</span><span class="nx">access_token</span><span class="p">;</span>

<span class="c1">// GOOD (refresh tokens - server-side app)</span>
<span class="c1">// Store in httpOnly cookie</span>
<span class="nx">res</span><span class="p">.</span><span class="nx">cookie</span><span class="p">(</span><span class="s1">'refresh_token'</span><span class="p">,</span><span class="w"> </span><span class="nx">refreshToken</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">httpOnly</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">  </span><span class="nx">secure</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">  </span><span class="nx">sameSite</span><span class="o">:</span><span class="w"> </span><span class="s1">'strict'</span>
<span class="p">});</span>
</code></pre></div>
<hr/>
<h3 id="2-implement-token-refresh-before-expiration">2. Implement Token Refresh Before Expiration</h3>
<div class="highlight"><pre><span></span><code><span class="kd">class</span><span class="w"> </span><span class="nx">TokenManager</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kr">constructor</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">accessToken</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">expiresAt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">refreshToken</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nx">setTokens</span><span class="p">(</span><span class="nx">tokenResponse</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">accessToken</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">tokenResponse</span><span class="p">.</span><span class="nx">access_token</span><span class="p">;</span>
<span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">refreshToken</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">tokenResponse</span><span class="p">.</span><span class="nx">refresh_token</span><span class="p">;</span>
<span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">expiresAt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">tokenResponse</span><span class="p">.</span><span class="nx">expires_in</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">1000</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Schedule refresh 5 minutes before expiration</span>
<span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">scheduleRefresh</span><span class="p">();</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nx">scheduleRefresh</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">refreshAt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">expiresAt</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="mf">5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">60</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">1000</span><span class="p">);</span><span class="w"> </span><span class="c1">// 5 min before</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">delay</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">refreshAt</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">();</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">delay</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">setTimeout</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">refresh</span><span class="p">(),</span><span class="w"> </span><span class="nx">delay</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">async</span><span class="w"> </span><span class="nx">refresh</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="nx">tokenEndpoint</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">method</span><span class="o">:</span><span class="w"> </span><span class="s1">'POST'</span><span class="p">,</span>
<span class="w">      </span><span class="nx">body</span><span class="o">:</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">URLSearchParams</span><span class="p">({</span>
<span class="w">        </span><span class="nx">grant_type</span><span class="o">:</span><span class="w"> </span><span class="s1">'refresh_token'</span><span class="p">,</span>
<span class="w">        </span><span class="nx">refresh_token</span><span class="o">:</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">refreshToken</span>
<span class="w">      </span><span class="p">})</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">tokenResponse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>
<span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">setTokens</span><span class="p">(</span><span class="nx">tokenResponse</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">async</span><span class="w"> </span><span class="nx">getValidToken</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">expiresAt</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">refresh</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">accessToken</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<hr/>
<h3 id="3-validate-all-server-responses">3. Validate All Server Responses</h3>
<div class="highlight"><pre><span></span><code><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">secureFetch</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span><span class="w"> </span><span class="nx">options</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{})</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">token</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">tokenManager</span><span class="p">.</span><span class="nx">getValidToken</span><span class="p">();</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="p">...</span><span class="nx">options</span><span class="p">,</span>
<span class="w">    </span><span class="nx">headers</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="p">...</span><span class="nx">options</span><span class="p">.</span><span class="nx">headers</span><span class="p">,</span>
<span class="w">      </span><span class="s1">'Authorization'</span><span class="o">:</span><span class="w"> </span><span class="sb">`Bearer </span><span class="si">${</span><span class="nx">token</span><span class="si">}</span><span class="sb">`</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">});</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">status</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">401</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Token invalid/expired</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">handleReauthorization</span><span class="p">();</span>
<span class="w">    </span><span class="k">return</span><span class="p">;</span><span class="w"> </span><span class="c1">// Redirect to login</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">status</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">403</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">outcome</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">'Access denied:'</span><span class="p">,</span><span class="w"> </span><span class="nx">outcome</span><span class="p">);</span>
<span class="w">    </span><span class="nx">showError</span><span class="p">(</span><span class="s1">'You don'</span><span class="nx">t</span><span class="w"> </span><span class="nx">have</span><span class="w"> </span><span class="nx">permission</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">access</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="nx">resource</span><span class="err">'</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">response</span><span class="p">.</span><span class="nx">ok</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">outcome</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>
<span class="w">    </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="nx">outcome</span><span class="p">.</span><span class="nx">issue</span><span class="p">[</span><span class="mf">0</span><span class="p">].</span><span class="nx">diagnostics</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>
<hr/>
<h3 id="4-use-pkce-for-public-clients">4. Use PKCE for Public Clients</h3>
<p><strong>Always use PKCE</strong> for mobile apps and single-page apps:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// Required for public clients</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">usePKCE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>

<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">usePKCE</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">verifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">generateCodeVerifier</span><span class="p">();</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">challenge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">generateCodeChallenge</span><span class="p">(</span><span class="nx">verifier</span><span class="p">);</span>

<span class="w">  </span><span class="nx">sessionStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="s1">'pkce_verifier'</span><span class="p">,</span><span class="w"> </span><span class="nx">verifier</span><span class="p">);</span>

<span class="w">  </span><span class="nx">authUrl</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="sb">`&amp;code_challenge=</span><span class="si">${</span><span class="nx">challenge</span><span class="si">}</span><span class="sb">&amp;code_challenge_method=S256`</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<hr/>
<h3 id="5-clear-tokens-on-logout">5. Clear Tokens on Logout</h3>
<div class="highlight"><pre><span></span><code><span class="kd">function</span><span class="w"> </span><span class="nx">logout</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// Clear tokens</span>
<span class="w">  </span><span class="nx">tokenManager</span><span class="p">.</span><span class="nx">accessToken</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">  </span><span class="nx">tokenManager</span><span class="p">.</span><span class="nx">refreshToken</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>

<span class="w">  </span><span class="c1">// Clear session storage</span>
<span class="w">  </span><span class="nx">sessionStorage</span><span class="p">.</span><span class="nx">clear</span><span class="p">();</span>

<span class="w">  </span><span class="c1">// Revoke tokens on server (if revocation endpoint available)</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">revocation_endpoint</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">fetch</span><span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">revocation_endpoint</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">method</span><span class="o">:</span><span class="w"> </span><span class="s1">'POST'</span><span class="p">,</span>
<span class="w">      </span><span class="nx">body</span><span class="o">:</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">URLSearchParams</span><span class="p">({</span>
<span class="w">        </span><span class="nx">token</span><span class="o">:</span><span class="w"> </span><span class="nx">tokenManager</span><span class="p">.</span><span class="nx">refreshToken</span><span class="p">,</span>
<span class="w">        </span><span class="nx">token_type_hint</span><span class="o">:</span><span class="w"> </span><span class="s1">'refresh_token'</span>
<span class="w">      </span><span class="p">})</span>
<span class="w">    </span><span class="p">});</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="c1">// Redirect to logout page</span>
<span class="w">  </span><span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">href</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'/logout'</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<hr/>
<h2 id="security-checklist">Security Checklist</h2>
<p><strong>Before deploying your SMART app</strong>:</p>
<ul>
<li>[ ] All requests use HTTPS (never HTTP)</li>
<li>[ ] Access tokens stored in memory only</li>
<li>[ ] Refresh tokens stored securely (httpOnly cookies or encrypted storage)</li>
<li>[ ] PKCE implemented for public clients</li>
<li>[ ] State parameter used for CSRF protection</li>
<li>[ ] Token expiration handled gracefully</li>
<li>[ ] 401/403 errors trigger appropriate user messaging</li>
<li>[ ] Tokens revoked on logout</li>
<li>[ ] Audit logging implemented (if applicable)</li>
<li>[ ] Security review completed</li>
<li>[ ] Penetration testing performed (for production apps)</li>
</ul>
<hr/>
<h2 id="summary">Summary</h2>
<p>SMART-on-FHIR security is <strong>defense in depth</strong>. Your diagram shows all layers work together:</p>
<ol>
<li>TLS encrypts transit</li>
<li>Authentication proves identity</li>
<li>Tokens provide delegated access</li>
<li>Scopes limit permissions</li>
<li>Context ensures correct patient</li>
<li>ACLs enforce organizational policies</li>
<li>Consent respects patient wishes</li>
<li>Audit logs track all access</li>
</ol>
<p><strong>No single layer is perfect</strong>, but together they provide robust protection for healthcare data.</p>
<hr/>
<h2 id="next-steps">Next Steps</h2>
<p>This completes the SMART Authorization section. We covered:</p>
<ul>
<li>✅ OAuth 2.0 authorization flow</li>
<li>✅ EHR and standalone launch patterns</li>
<li>✅ SMART scopes and permissions</li>
<li>✅ Configuration discovery</li>
<li>✅ Multi-layer security architecture</li>
</ul>
<p>Next, let's put this into practice with hands-on examples.</p>
</article>
</div>
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
</div>
<button class="md-top md-icon" data-md-component="top" hidden="" type="button">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"></path></svg>
  Back to top
</button>
</main>
<footer class="md-footer">
<nav aria-label="Footer" class="md-footer__inner md-grid">
<a aria-label="Previous: SMART Configuration Discovery" class="md-footer__link md-footer__link--prev" href="../deepdive-smart-config-discovery/">
<div class="md-footer__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
</div>
<div class="md-footer__title">
<span class="md-footer__direction">
                Previous
              </span>
<div class="md-ellipsis">
                SMART Configuration Discovery
              </div>
</div>
</a>
<a aria-label="Next: Hands-On" class="md-footer__link md-footer__link--next" href="../../eh-dd-07-hands-on-practice/">
<div class="md-footer__title">
<span class="md-footer__direction">
                Next
              </span>
<div class="md-ellipsis">
                Hands-On
              </div>
</div>
<div class="md-footer__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"></path></svg>
</div>
</a>
</nav>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<div class="md-consent" data-md-component="consent" hidden="" id="__consent">
<div class="md-consent__overlay"></div>
<aside class="md-consent__inner">
<form class="md-consent__form md-grid md-typeset" name="consent">
<h4>Cookie consent</h4>
<p>We use cookies to recognize your repeated visits and preferences, as well as to measure the effectiveness of our documentation and whether users find what they're searching for. With your consent, you're helping us to make our documentation better.
</p>
<input class="md-toggle" id="__settings" type="checkbox"/>
<div class="md-consent__settings">
<ul class="task-list">
<li class="task-list-item">
<label class="task-list-control">
<input checked="" name="analytics" type="checkbox"/>
<span class="task-list-indicator"></span>
          Google Analytics
        </label>
</li>
</ul>
</div>
<div class="md-consent__controls">
<button class="md-button md-button--primary">Accept</button>
<label class="md-button" for="__settings">Manage settings</label>
</div>
</form>
</aside>
</div>
<script>var consent=__md_get("__consent");if(consent)for(var input of document.forms.consent.elements)input.name&&(input.checked=consent[input.name]||!1);else"file:"!==location.protocol&&setTimeout((function(){document.querySelector("[data-md-component=consent]").hidden=!1}),250);var form=document.forms.consent;for(var action of["submit","reset"])form.addEventListener(action,(function(e){if(e.preventDefault(),"reset"===e.type)for(var n of document.forms.consent.elements)n.name&&(n.checked=!1);__md_set("__consent",Object.fromEntries(Array.from(new FormData(form).keys()).map((function(e){return[e,!0]})))),location.hash="",location.reload()}))</script>
<script id="__config" type="application/json">{"base": "../../../..", "features": ["navigation.top", "navigation.footer", "navigation.indexes", "search.highlight", "search.suggest", "search.share", "content.code.copy", "content.code.select"], "search": "../../../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
<script src="../../../../assets/javascripts/bundle.525ec568.min.js"></script>
<script src="../../../../js/diagram-utils.js"></script>
<script src="../../../../js/seamaiden.js"></script>
<script src="../../../../js/diagram-theme-switcher.js"></script>
<script src="../../../../js/diagram-zoom.js"></script>
<script src="../../../../js/alphabet-auto.js"></script>
<script src="../../../../js/open_in_new_tab.js"></script>
<script src="../../../../assets/mkdocs_puml/puml.js"></script>
<script src="https://unpkg.com/@panzoom/panzoom@4.5.1/dist/panzoom.min.js"></script>
<script src="../../../../assets/mkdocs_puml/interaction.js"></script>
<script src="../../../../js/mermaid.min.js"></script><script>mermaid.initialize({});</script></body>
</html>