
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<link href="https://cassmastern.github.io/cass-sandbox/sec_ehealth/sec_deepdive/eh-dd-05-advanced-fhir-concepts/deepdive-fhir-profiles-and-extensions/" rel="canonical"/>
<link href="../eh-dd-05-advanced-intro/" rel="prev"/>
<link href="../../eh-dd-06-smart-auth/" rel="next"/>
<link href="../../../../img/favicon.ico" rel="icon"/>
<meta content="mkdocs-1.6.1, mkdocs-material-9.5.39" name="generator"/>
<title>FHIR Profiles and Extensions - Ler's Sandbox</title>
<link href="../../../../assets/stylesheets/main.8c3ca2c6.min.css" rel="stylesheet"/>
<link href="../../../../assets/stylesheets/palette.06af60db.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
<link href="../../../../css/alphabet.css" rel="stylesheet"/>
<link href="../../../../css/diagram-zoom.css" rel="stylesheet"/>
<link href="../../../../css/cm-logo.css" rel="stylesheet"/>
<link href="../../../../css/color-vars.css" rel="stylesheet"/>
<link href="../../../../css/custom-theme-colors.css" rel="stylesheet"/>
<link href="../../../../assets/mkdocs_puml/puml.css" rel="stylesheet"/>
<link href="../../../../assets/mkdocs_puml/interaction.css" rel="stylesheet"/>
<script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
<script id="__analytics">function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-GD2XWDMP2E"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-GD2XWDMP2E",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-GD2XWDMP2E",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script>
<script>if("undefined"!=typeof __md_analytics){var consent=__md_get("__consent");consent&&consent.analytics&&__md_analytics()}</script>
</head>
<body data-md-color-accent="custom" data-md-color-primary="custom" data-md-color-scheme="slate" dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#fhir-profiles-and-extensions">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header md-header--shadow" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="Ler's Sandbox" class="md-header__button md-logo" data-md-component="logo" href="../../../.." title="Ler's Sandbox">
<img alt="logo" src="../../../../img/logo.svg"/>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            Ler's Sandbox
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              FHIR Profiles and Extensions
            
          </span>
</div>
</div>
</div>
<form class="md-header__option" data-md-component="palette">
<input aria-label="Switch to light mode" class="md-option" data-md-color-accent="custom" data-md-color-media="" data-md-color-primary="custom" data-md-color-scheme="slate" id="__palette_0" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_1" hidden="" title="Switch to light mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"></path></svg>
</label>
<input aria-label="Switch to dark mode" class="md-option" data-md-color-accent="custom" data-md-color-media="" data-md-color-primary="custom" data-md-color-scheme="default" id="__palette_1" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_0" hidden="" title="Switch to dark mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"></path></svg>
</label>
</form>
<script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
</label>
<nav aria-label="Search" class="md-search__options">
<a aria-label="Share" class="md-search__icon md-icon" data-clipboard="" data-clipboard-text="" data-md-component="search-share" href="javascript:void(0)" tabindex="-1" title="Share">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"></path></svg>
</a>
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" title="Clear" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>
</button>
</nav>
<div class="md-search__suggest" data-md-component="search-suggest"></div>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="" tabindex="0">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="Ler's Sandbox" class="md-nav__button md-logo" data-md-component="logo" href="../../../.." title="Ler's Sandbox">
<img alt="logo" src="../../../../img/logo.svg"/>
</a>
    Ler's Sandbox
  </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../..">
<span class="md-ellipsis">
    HOME
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_2" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../../../sec_about/">
<span class="md-ellipsis">
    ABOUT THIS WEBSITE
  </span>
</a>
<label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_2_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_2">
<span class="md-nav__icon md-icon"></span>
            ABOUT THIS WEBSITE
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../sec_about/whatsinhere/">
<span class="md-ellipsis">
    What's in Here?
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../sec_about/roadmap/">
<span class="md-ellipsis">
    Roadmap &amp; Changelog
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../sec_about/feedback/">
<span class="md-ellipsis">
    Feedback
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_3" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../../../sec_cloud/">
<span class="md-ellipsis">
    IN THE CLOUDS
  </span>
</a>
<label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_3_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_3">
<span class="md-nav__icon md-icon"></span>
            IN THE CLOUDS
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../sec_cloud/aws-gcp-azure/">
<span class="md-ellipsis">
    Architectures of AWS, GCP, and Azure
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../sec_cloud/aws-gcp-azure_glossary/">
<span class="md-ellipsis">
    Cross-Platform Cloud &amp; DevOps Glossary (AWS, GCP, Azure)
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../sec_cloud/aws-gcp-azure_glossary_enhanced/">
<span class="md-ellipsis">
    Cross-Platform Cloud &amp; DevOps Glossary (AWS, GCP, Azure) — Enhanced
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../sec_cloud/jakarta-ee-azure/">
<span class="md-ellipsis">
    A Jakarta Enterprise Application on Azure
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_4" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../../../sec_accss/">
<span class="md-ellipsis">
    ACCESSIBILITY
  </span>
</a>
<label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_4_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_4">
<span class="md-nav__icon md-icon"></span>
            ACCESSIBILITY
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../sec_accss/accss_/">
<span class="md-ellipsis">
    Accessibility Reference
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../sec_accss/visuals-for-the-sightless/">
<span class="md-ellipsis">
    Visuals for the Sightless
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../sec_accss/accss_diagram-dilemma/">
<span class="md-ellipsis">
    The Diagramming Dilemma
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../sec_accss/mermaid-beyond-reach/">
<span class="md-ellipsis">
    An Accessible Mermaid Beyond Reach
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../sec_accss/mermaid-captured/">
<span class="md-ellipsis">
    Mermaid Captured
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../sec_accss/mkdocs-mermaid-plantuml-graphviz/">
<span class="md-ellipsis">
    Diagram Accessibility: Current State/Path Forward
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_5" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../../../sec_freeform/">
<span class="md-ellipsis">
    CONCEPTS, ESSAYS, ETC.
  </span>
</a>
<label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_5_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_5">
<span class="md-nav__icon md-icon"></span>
            CONCEPTS, ESSAYS, ETC.
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../sec_freeform/ibm-sanfran/">
<span class="md-ellipsis">
    IBM SanFrancisco
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../sec_freeform/ai-accessibility/">
<span class="md-ellipsis">
    Accessibility with AI
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../sec_freeform/ai-accessibility_bus/">
<span class="md-ellipsis">
    Accessibility with AI (Concept Note)
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../sec_freeform/gen-ai-landscape-primer/">
<span class="md-ellipsis">
    GenAI Landscape in August, 2025
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../sec_freeform/gen-ai-landschaft-dec-2025/">
<span class="md-ellipsis">
    Die GenAI-Landschaft im Dezember 2025
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../sec_freeform/identity/">
<span class="md-ellipsis">
    The Long Arc of Digital Identity
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_6" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../../../sec_net-sec/">
<span class="md-ellipsis">
    NETWORKS &amp; SECURITY
  </span>
</a>
<label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_6_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_6">
<span class="md-nav__icon md-icon"></span>
            NETWORKS &amp; SECURITY
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../sec_net-sec/network_data_center/">
<span class="md-ellipsis">
    A Hypothetical Data Centre Network
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../sec_net-sec/network_data_center_stride/">
<span class="md-ellipsis">
    Network Security and Threat Modeling — STRIDE
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../sec_net-sec/network_data_center_mitre/">
<span class="md-ellipsis">
    Network Security and Threat Modeling — MITRE ATT&amp;CK
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../sec_net-sec/saml-admin/">
<span class="md-ellipsis">
    Single Sign-On (SSO) Admin Guide — SAML 2.0 Integration
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_7" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../../">
<span class="md-ellipsis">
    eHEALTH
  </span>
</a>
<label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="true" aria-labelledby="__nav_7_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_7">
<span class="md-nav__icon md-icon"></span>
            eHEALTH
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_7_2" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../">
<span class="md-ellipsis">
    SMART-on-FHIR Deep Dive
  </span>
</a>
<label class="md-nav__link" for="__nav_7_2" id="__nav_7_2_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="true" aria-labelledby="__nav_7_2_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_7_2">
<span class="md-nav__icon md-icon"></span>
            SMART-on-FHIR Deep Dive
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_7_2_2" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../eh-dd-01-foundations/">
<span class="md-ellipsis">
    An Introduction to FHIR
  </span>
</a>
<label class="md-nav__link" for="__nav_7_2_2" id="__nav_7_2_2_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_7_2_2_label" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_7_2_2">
<span class="md-nav__icon md-icon"></span>
            An Introduction to FHIR
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../eh-dd-01-foundations/deepdive-overview/">
<span class="md-ellipsis">
    Overview of SMART-on-FHIR
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../eh-dd-01-foundations/deepdive-overview-fhir-arch/">
<span class="md-ellipsis">
    SMART-on-FHIR Architecture Overview
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../eh-dd-01-foundations/deepdive-overview-fhir-resources/">
<span class="md-ellipsis">
    Key FHIR Resources
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_7_2_3" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../eh-dd-02-fhir-data-fundamentals/">
<span class="md-ellipsis">
    FHIR Data Fundamentals
  </span>
</a>
<label class="md-nav__link" for="__nav_7_2_3" id="__nav_7_2_3_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_7_2_3_label" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_7_2_3">
<span class="md-nav__icon md-icon"></span>
            FHIR Data Fundamentals
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../eh-dd-02-fhir-data-fundamentals/deepdive-fhir-data-types/">
<span class="md-ellipsis">
    FHIR Data Types
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../eh-dd-02-fhir-data-fundamentals/deepdive-fhir-code-systems/">
<span class="md-ellipsis">
    FHIR Terminology Standards
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../eh-dd-02-fhir-data-fundamentals/deepdive-fhir-cardinality/">
<span class="md-ellipsis">
    FHIR Resource Cardinality
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../eh-dd-02-fhir-data-fundamentals/deepdive-complete-resource-example/">
<span class="md-ellipsis">
    Complete FHIR Resource Example
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_7_2_4" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../eh-dd-03-fhir-resource-relationships/">
<span class="md-ellipsis">
    FHIR Resource Relationships
  </span>
</a>
<label class="md-nav__link" for="__nav_7_2_4" id="__nav_7_2_4_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_7_2_4_label" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_7_2_4">
<span class="md-nav__icon md-icon"></span>
            FHIR Resource Relationships
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../eh-dd-03-fhir-resource-relationships/deepdive-fhir-resource-relationships/">
<span class="md-ellipsis">
    FHIR Resource Relationships
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../eh-dd-03-fhir-resource-relationships/deepdive-fhir-resource-relationships-comprehensive/">
<span class="md-ellipsis">
    FHIR Comprehensive Resource Relationships
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../eh-dd-03-fhir-resource-relationships/deepdive-fhir-resource-bundles/">
<span class="md-ellipsis">
    FHIR Resource Bundles
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_7_2_5" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../eh-dd-04-working-with-fhir-apis/">
<span class="md-ellipsis">
    FHIR Resource APIs
  </span>
</a>
<label class="md-nav__link" for="__nav_7_2_5" id="__nav_7_2_5_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_7_2_5_label" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_7_2_5">
<span class="md-nav__icon md-icon"></span>
            FHIR Resource APIs
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../eh-dd-04-working-with-fhir-apis/deepdive-fhir-rest-common-ops/">
<span class="md-ellipsis">
    Common FHIR REST Operations
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../eh-dd-04-working-with-fhir-apis/deepdive-fhir-search-parameters/">
<span class="md-ellipsis">
    FHIR Search Parameters
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../eh-dd-04-working-with-fhir-apis/deepdive-error-handling/">
<span class="md-ellipsis">
    Error Handling and OperationOutcome
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../eh-dd-04-working-with-fhir-apis/deepdive-fhir-validation/">
<span class="md-ellipsis">
    FHIR Validation
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_7_2_6" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../">
<span class="md-ellipsis">
    Advanced FHIR Concepts
  </span>
</a>
<label class="md-nav__link" for="__nav_7_2_6" id="__nav_7_2_6_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="true" aria-labelledby="__nav_7_2_6_label" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_7_2_6">
<span class="md-nav__icon md-icon"></span>
            Advanced FHIR Concepts
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../eh-dd-05-advanced-intro/">
<span class="md-ellipsis">
    Handling Variation — Overview
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
<span class="md-ellipsis">
    FHIR Profiles and Extensions
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
<span class="md-ellipsis">
    FHIR Profiles and Extensions
  </span>
</a>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#understanding-profiles-constraints-for-specific-use-cases">
<span class="md-ellipsis">
      Understanding Profiles: Constraints for Specific Use Cases
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#why-profiles-matter">
<span class="md-ellipsis">
      Why Profiles Matter
    </span>
</a>
<nav aria-label="Why Profiles Matter" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#scenario-1-us-healthcare-certification">
<span class="md-ellipsis">
      Scenario 1: US Healthcare Certification
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#scenario-2-international-patient-summary-ips">
<span class="md-ellipsis">
      Scenario 2: International Patient Summary (IPS)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#scenario-3-research-networks">
<span class="md-ellipsis">
      Scenario 3: Research Networks
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#common-profile-types">
<span class="md-ellipsis">
      Common Profile Types
    </span>
</a>
<nav aria-label="Common Profile Types" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#us-core-profiles-us-realm">
<span class="md-ellipsis">
      US Core Profiles (US Realm)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#international-patient-summary-ips">
<span class="md-ellipsis">
      International Patient Summary (IPS)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#smart-app-launch-profiles">
<span class="md-ellipsis">
      SMART App Launch Profiles
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#declaring-profile-conformance">
<span class="md-ellipsis">
      Declaring Profile Conformance
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#searching-by-profile">
<span class="md-ellipsis">
      Searching by Profile
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#understanding-mustsupport">
<span class="md-ellipsis">
      Understanding MustSupport
    </span>
</a>
<nav aria-label="Understanding MustSupport" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#what-mustsupport-does-not-mean">
<span class="md-ellipsis">
      What MustSupport Does NOT Mean
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#what-mustsupport-does-mean">
<span class="md-ellipsis">
      What MustSupport DOES Mean
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#example-us-core-patienttelecom">
<span class="md-ellipsis">
      Example: US Core Patient.telecom
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#fhir-extensions-adding-custom-data">
<span class="md-ellipsis">
      FHIR Extensions: Adding Custom Data
    </span>
</a>
<nav aria-label="FHIR Extensions: Adding Custom Data" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#extension-structure">
<span class="md-ellipsis">
      Extension Structure
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#types-of-extensions">
<span class="md-ellipsis">
      Types of Extensions
    </span>
</a>
<nav aria-label="Types of Extensions" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#simple-extensions-single-value">
<span class="md-ellipsis">
      Simple Extensions (Single Value)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#complex-extensions-nested-structure">
<span class="md-ellipsis">
      Complex Extensions (Nested Structure)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#modifier-extensions-change-meaning">
<span class="md-ellipsis">
      Modifier Extensions (Change Meaning)
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#common-us-core-extensions">
<span class="md-ellipsis">
      Common US Core Extensions
    </span>
</a>
<nav aria-label="Common US Core Extensions" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#race-extension">
<span class="md-ellipsis">
      Race Extension
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#ethnicity-extension">
<span class="md-ellipsis">
      Ethnicity Extension
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#birth-sex-extension">
<span class="md-ellipsis">
      Birth Sex Extension
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#complete-example-us-core-patient-with-extensions">
<span class="md-ellipsis">
      Complete Example: US Core Patient with Extensions
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#accessing-extensions-in-code">
<span class="md-ellipsis">
      Accessing Extensions in Code
    </span>
</a>
<nav aria-label="Accessing Extensions in Code" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#reading-extensions">
<span class="md-ellipsis">
      Reading Extensions
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#reading-complex-extensions">
<span class="md-ellipsis">
      Reading Complex Extensions
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adding-extensions">
<span class="md-ellipsis">
      Adding Extensions
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#slicing-dividing-arrays-into-constrained-subsets">
<span class="md-ellipsis">
      Slicing: Dividing Arrays into Constrained Subsets
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#capabilitystatement-discovering-server-support">
<span class="md-ellipsis">
      CapabilityStatement: Discovering Server Support
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#validation-against-profiles">
<span class="md-ellipsis">
      Validation Against Profiles
    </span>
</a>
<nav aria-label="Validation Against Profiles" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#server-side-validation">
<span class="md-ellipsis">
      Server-Side Validation
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#explicit-validation-with-validate">
<span class="md-ellipsis">
      Explicit Validation with $validate
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#best-practices">
<span class="md-ellipsis">
      Best Practices
    </span>
</a>
<nav aria-label="Best Practices" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#1-declare-profiles-explicitly">
<span class="md-ellipsis">
      1. Declare Profiles Explicitly
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#2-check-capabilitystatement-before-submitting">
<span class="md-ellipsis">
      2. Check CapabilityStatement Before Submitting
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#3-handle-mustsupport-gracefully">
<span class="md-ellipsis">
      3. Handle MustSupport Gracefully
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#4-use-standard-extensions-when-possible">
<span class="md-ellipsis">
      4. Use Standard Extensions When Possible
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#5-document-custom-extensions">
<span class="md-ellipsis">
      5. Document Custom Extensions
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#common-pitfalls">
<span class="md-ellipsis">
      Common Pitfalls
    </span>
</a>
<nav aria-label="Common Pitfalls" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#pitfall-1-assuming-profiles-add-fields">
<span class="md-ellipsis">
      Pitfall 1: Assuming Profiles Add Fields
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#pitfall-2-confusing-mustsupport-with-required">
<span class="md-ellipsis">
      Pitfall 2: Confusing MustSupport with Required
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#pitfall-3-using-wrong-profile-url">
<span class="md-ellipsis">
      Pitfall 3: Using Wrong Profile URL
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#pitfall-4-ignoring-extension-urls">
<span class="md-ellipsis">
      Pitfall 4: Ignoring Extension URLs
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#pitfall-5-not-validating-before-submission">
<span class="md-ellipsis">
      Pitfall 5: Not Validating Before Submission
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#real-world-extension-examples">
<span class="md-ellipsis">
      Real-World Extension Examples
    </span>
</a>
<nav aria-label="Real-World Extension Examples" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#example-1-patients-preferred-pharmacy">
<span class="md-ellipsis">
      Example 1: Patient's Preferred Pharmacy
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#example-2-observation-interpretation-comments">
<span class="md-ellipsis">
      Example 2: Observation Interpretation Comments
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#example-3-specimen-collection-difficulty">
<span class="md-ellipsis">
      Example 3: Specimen Collection Difficulty
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#profile-and-extension-discovery">
<span class="md-ellipsis">
      Profile and Extension Discovery
    </span>
</a>
<nav aria-label="Profile and Extension Discovery" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#finding-available-profiles">
<span class="md-ellipsis">
      Finding Available Profiles
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#finding-extensions-for-a-profile">
<span class="md-ellipsis">
      Finding Extensions for a Profile
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#testing-profile-conformance">
<span class="md-ellipsis">
      Testing Profile Conformance
    </span>
</a>
<nav aria-label="Testing Profile Conformance" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#unit-testing-approach">
<span class="md-ellipsis">
      Unit Testing Approach
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#integration-testing-with-live-server">
<span class="md-ellipsis">
      Integration Testing with Live Server
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#summary-profiles-vs-extensions">
<span class="md-ellipsis">
      Summary: Profiles vs. Extensions
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#key-takeaways">
<span class="md-ellipsis">
      Key Takeaways
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#next-steps">
<span class="md-ellipsis">
      Next Steps
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_7_2_7" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../eh-dd-06-smart-auth/">
<span class="md-ellipsis">
    SMART Authorization
  </span>
</a>
<label class="md-nav__link" for="__nav_7_2_7" id="__nav_7_2_7_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_7_2_7_label" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_7_2_7">
<span class="md-nav__icon md-icon"></span>
            SMART Authorization
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../eh-dd-06-smart-auth/deepdive-oauth-overview/">
<span class="md-ellipsis">
    Overview
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../eh-dd-06-smart-auth/deepdive-oauth-flow/">
<span class="md-ellipsis">
    OAuth 2.0 Flow
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../eh-dd-06-smart-auth/deepdive-smart-launch-flow/">
<span class="md-ellipsis">
    SMART Launch Flow
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../eh-dd-06-smart-auth/deepdive-smart-scopes-and-auth/">
<span class="md-ellipsis">
    SMART Scopes and Authorization
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../eh-dd-06-smart-auth/deepdive-smart-config-discovery/">
<span class="md-ellipsis">
    SMART Configuration Discovery
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../eh-dd-06-smart-auth/deepdive-security-and-access-control/">
<span class="md-ellipsis">
    Security and Access Control
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_7_2_8" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../eh-dd-07-hands-on-practice/">
<span class="md-ellipsis">
    Hands-On
  </span>
</a>
<label class="md-nav__link" for="__nav_7_2_8" id="__nav_7_2_8_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_7_2_8_label" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_7_2_8">
<span class="md-nav__icon md-icon"></span>
            Hands-On
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../eh-dd-07-hands-on-practice/deepdive-smart-health-it-sandbox/">
<span class="md-ellipsis">
    Using the SMART Health IT Sandbox
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../eh-dd-07-hands-on-practice/deepdive-smart_client_impl-sample-app/">
<span class="md-ellipsis">
    Building a SMART App: Complete Tutorial
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../eh-dd-07-hands-on-practice/deepdive-smart_client_impl/">
<span class="md-ellipsis">
    SMART Client Example (Python)
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../eh-dd-07-hands-on-practice/deepdive-smart_client_impl-practical-code-examples/">
<span class="md-ellipsis">
    Practical Code Examples
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../eh-dd-07-hands-on-practice/deepdive-testing-and-debugging/">
<span class="md-ellipsis">
    Testing and Debugging
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_7_2_9" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../eh-dd-08-wrap-up/">
<span class="md-ellipsis">
    Wrap-Up
  </span>
</a>
<label class="md-nav__link" for="__nav_7_2_9" id="__nav_7_2_9_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_7_2_9_label" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_7_2_9">
<span class="md-nav__icon md-icon"></span>
            Wrap-Up
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../eh-dd-08-wrap-up/deepdive-key-takeaways/">
<span class="md-ellipsis">
    Deepdive key takeaways
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../eh-dd-08-wrap-up/deepdive-summary/">
<span class="md-ellipsis">
    Summary
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_7_3" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../../sec_integration/">
<span class="md-ellipsis">
    SMART-on-FHIR Integration
  </span>
</a>
<label class="md-nav__link" for="__nav_7_3" id="__nav_7_3_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_7_3_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_7_3">
<span class="md-nav__icon md-icon"></span>
            SMART-on-FHIR Integration
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../sec_integration/quick_ref/">
<span class="md-ellipsis">
    SMART-on-FHIR and Integration Quick Reference
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../sec_integration/smart-fhir-visuals/">
<span class="md-ellipsis">
    SMART-on-FHIR and Integration — Visuals
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../sec_integration/gloss_ontario_halo/">
<span class="md-ellipsis">
    Ontario eHealth &amp; HALO Integration Glossary
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_8" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../../../sec_api/">
<span class="md-ellipsis">
    API DOCUMENTATION
  </span>
</a>
<label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_8_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_8">
<span class="md-nav__icon md-icon"></span>
            API DOCUMENTATION
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_8_2" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../../../sec_api/sec_api_countries/">
<span class="md-ellipsis">
    COUNTRIES REST API
  </span>
</a>
<label class="md-nav__link" for="__nav_8_2" id="__nav_8_2_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_8_2_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_8_2">
<span class="md-nav__icon md-icon"></span>
            COUNTRIES REST API
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../sec_api/sec_api_countries/api-countries-overview/">
<span class="md-ellipsis">
    Overview
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_8_2_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_8_2_3" id="__nav_8_2_3_label" tabindex="0">
<span class="md-ellipsis">
    Guides
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_8_2_3_label" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_8_2_3">
<span class="md-nav__icon md-icon"></span>
            Guides
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../sec_api/sec_api_countries/sec_api_countries_guides/api-countries-guides-quickstart/">
<span class="md-ellipsis">
    Quick Start Guide
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../sec_api/sec_api_countries/sec_api_countries_guides/api-countries-guides-filtering/">
<span class="md-ellipsis">
    Advanced Filtering
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../sec_api/sec_api_countries/sec_api_countries_guides/api-countries-guides-integration/">
<span class="md-ellipsis">
    Integration Patterns
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_8_2_4" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../../../sec_api/sec_api_countries/sec_api_countries_examples/">
<span class="md-ellipsis">
    Examples
  </span>
</a>
<label class="md-nav__link" for="__nav_8_2_4" id="__nav_8_2_4_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_8_2_4_label" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_8_2_4">
<span class="md-nav__icon md-icon"></span>
            Examples
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../sec_api/sec_api_countries/sec_api_countries_examples/api-countries-examples-javascript/">
<span class="md-ellipsis">
    JavaScript Examples
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../sec_api/sec_api_countries/sec_api_countries_examples/api-countries-examples-python/">
<span class="md-ellipsis">
    Python Examples
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../sec_api/sec_api_countries/sec_api_countries_examples/api-countries-examples-usecases/">
<span class="md-ellipsis">
    Real-World Use Cases
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../sec_api/sec_api_countries/reference/">
<span class="md-ellipsis">
    Interactive OpenAPI (Swagger) Reference
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../sec_api/sec_api_countries/resources/">
<span class="md-ellipsis">
    Resources &amp; Support
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_8_3" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../../../sec_api/sec_api_stripe/">
<span class="md-ellipsis">
    STRIPE PAYMENT API
  </span>
</a>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_8_3_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_8_3">
<span class="md-nav__icon md-icon"></span>
            STRIPE PAYMENT API
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_9" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../../../sec_cheatsheets/">
<span class="md-ellipsis">
    CHEAT SHEETS
  </span>
</a>
<label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_9_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_9">
<span class="md-nav__icon md-icon"></span>
            CHEAT SHEETS
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../sec_cheatsheets/cheatsheet-docker/">
<span class="md-ellipsis">
    Docker Command Cheatsheet
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../sec_cheatsheets/cheatsheet-kubectl/">
<span class="md-ellipsis">
    Kubectl Command Cheat Sheet
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../sec_cheatsheets/cheatsheet_compound-modifiers/">
<span class="md-ellipsis">
    Compound Modifiers Cheat Sheet
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_10" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../../../sec_gloss/">
<span class="md-ellipsis">
    GLOSSARIES
  </span>
</a>
<label class="md-nav__link" for="__nav_10" id="__nav_10_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_10_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_10">
<span class="md-nav__icon md-icon"></span>
            GLOSSARIES
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../sec_gloss/gloss_oss/">
<span class="md-ellipsis">
    Glossary of OSS Terms
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../sec_gloss/gloss_networking/">
<span class="md-ellipsis">
    Glossary of Networking Terms
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../sec_gloss/gloss_kuber/">
<span class="md-ellipsis">
    Glossary of Kubernetes Terms
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../sec_gloss/gloss_cloud-native/">
<span class="md-ellipsis">
    Glossary of Cloud-Native Terms
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#understanding-profiles-constraints-for-specific-use-cases">
<span class="md-ellipsis">
      Understanding Profiles: Constraints for Specific Use Cases
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#why-profiles-matter">
<span class="md-ellipsis">
      Why Profiles Matter
    </span>
</a>
<nav aria-label="Why Profiles Matter" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#scenario-1-us-healthcare-certification">
<span class="md-ellipsis">
      Scenario 1: US Healthcare Certification
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#scenario-2-international-patient-summary-ips">
<span class="md-ellipsis">
      Scenario 2: International Patient Summary (IPS)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#scenario-3-research-networks">
<span class="md-ellipsis">
      Scenario 3: Research Networks
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#common-profile-types">
<span class="md-ellipsis">
      Common Profile Types
    </span>
</a>
<nav aria-label="Common Profile Types" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#us-core-profiles-us-realm">
<span class="md-ellipsis">
      US Core Profiles (US Realm)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#international-patient-summary-ips">
<span class="md-ellipsis">
      International Patient Summary (IPS)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#smart-app-launch-profiles">
<span class="md-ellipsis">
      SMART App Launch Profiles
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#declaring-profile-conformance">
<span class="md-ellipsis">
      Declaring Profile Conformance
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#searching-by-profile">
<span class="md-ellipsis">
      Searching by Profile
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#understanding-mustsupport">
<span class="md-ellipsis">
      Understanding MustSupport
    </span>
</a>
<nav aria-label="Understanding MustSupport" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#what-mustsupport-does-not-mean">
<span class="md-ellipsis">
      What MustSupport Does NOT Mean
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#what-mustsupport-does-mean">
<span class="md-ellipsis">
      What MustSupport DOES Mean
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#example-us-core-patienttelecom">
<span class="md-ellipsis">
      Example: US Core Patient.telecom
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#fhir-extensions-adding-custom-data">
<span class="md-ellipsis">
      FHIR Extensions: Adding Custom Data
    </span>
</a>
<nav aria-label="FHIR Extensions: Adding Custom Data" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#extension-structure">
<span class="md-ellipsis">
      Extension Structure
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#types-of-extensions">
<span class="md-ellipsis">
      Types of Extensions
    </span>
</a>
<nav aria-label="Types of Extensions" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#simple-extensions-single-value">
<span class="md-ellipsis">
      Simple Extensions (Single Value)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#complex-extensions-nested-structure">
<span class="md-ellipsis">
      Complex Extensions (Nested Structure)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#modifier-extensions-change-meaning">
<span class="md-ellipsis">
      Modifier Extensions (Change Meaning)
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#common-us-core-extensions">
<span class="md-ellipsis">
      Common US Core Extensions
    </span>
</a>
<nav aria-label="Common US Core Extensions" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#race-extension">
<span class="md-ellipsis">
      Race Extension
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#ethnicity-extension">
<span class="md-ellipsis">
      Ethnicity Extension
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#birth-sex-extension">
<span class="md-ellipsis">
      Birth Sex Extension
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#complete-example-us-core-patient-with-extensions">
<span class="md-ellipsis">
      Complete Example: US Core Patient with Extensions
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#accessing-extensions-in-code">
<span class="md-ellipsis">
      Accessing Extensions in Code
    </span>
</a>
<nav aria-label="Accessing Extensions in Code" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#reading-extensions">
<span class="md-ellipsis">
      Reading Extensions
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#reading-complex-extensions">
<span class="md-ellipsis">
      Reading Complex Extensions
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adding-extensions">
<span class="md-ellipsis">
      Adding Extensions
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#slicing-dividing-arrays-into-constrained-subsets">
<span class="md-ellipsis">
      Slicing: Dividing Arrays into Constrained Subsets
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#capabilitystatement-discovering-server-support">
<span class="md-ellipsis">
      CapabilityStatement: Discovering Server Support
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#validation-against-profiles">
<span class="md-ellipsis">
      Validation Against Profiles
    </span>
</a>
<nav aria-label="Validation Against Profiles" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#server-side-validation">
<span class="md-ellipsis">
      Server-Side Validation
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#explicit-validation-with-validate">
<span class="md-ellipsis">
      Explicit Validation with $validate
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#best-practices">
<span class="md-ellipsis">
      Best Practices
    </span>
</a>
<nav aria-label="Best Practices" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#1-declare-profiles-explicitly">
<span class="md-ellipsis">
      1. Declare Profiles Explicitly
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#2-check-capabilitystatement-before-submitting">
<span class="md-ellipsis">
      2. Check CapabilityStatement Before Submitting
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#3-handle-mustsupport-gracefully">
<span class="md-ellipsis">
      3. Handle MustSupport Gracefully
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#4-use-standard-extensions-when-possible">
<span class="md-ellipsis">
      4. Use Standard Extensions When Possible
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#5-document-custom-extensions">
<span class="md-ellipsis">
      5. Document Custom Extensions
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#common-pitfalls">
<span class="md-ellipsis">
      Common Pitfalls
    </span>
</a>
<nav aria-label="Common Pitfalls" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#pitfall-1-assuming-profiles-add-fields">
<span class="md-ellipsis">
      Pitfall 1: Assuming Profiles Add Fields
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#pitfall-2-confusing-mustsupport-with-required">
<span class="md-ellipsis">
      Pitfall 2: Confusing MustSupport with Required
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#pitfall-3-using-wrong-profile-url">
<span class="md-ellipsis">
      Pitfall 3: Using Wrong Profile URL
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#pitfall-4-ignoring-extension-urls">
<span class="md-ellipsis">
      Pitfall 4: Ignoring Extension URLs
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#pitfall-5-not-validating-before-submission">
<span class="md-ellipsis">
      Pitfall 5: Not Validating Before Submission
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#real-world-extension-examples">
<span class="md-ellipsis">
      Real-World Extension Examples
    </span>
</a>
<nav aria-label="Real-World Extension Examples" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#example-1-patients-preferred-pharmacy">
<span class="md-ellipsis">
      Example 1: Patient's Preferred Pharmacy
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#example-2-observation-interpretation-comments">
<span class="md-ellipsis">
      Example 2: Observation Interpretation Comments
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#example-3-specimen-collection-difficulty">
<span class="md-ellipsis">
      Example 3: Specimen Collection Difficulty
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#profile-and-extension-discovery">
<span class="md-ellipsis">
      Profile and Extension Discovery
    </span>
</a>
<nav aria-label="Profile and Extension Discovery" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#finding-available-profiles">
<span class="md-ellipsis">
      Finding Available Profiles
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#finding-extensions-for-a-profile">
<span class="md-ellipsis">
      Finding Extensions for a Profile
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#testing-profile-conformance">
<span class="md-ellipsis">
      Testing Profile Conformance
    </span>
</a>
<nav aria-label="Testing Profile Conformance" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#unit-testing-approach">
<span class="md-ellipsis">
      Unit Testing Approach
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#integration-testing-with-live-server">
<span class="md-ellipsis">
      Integration Testing with Live Server
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#summary-profiles-vs-extensions">
<span class="md-ellipsis">
      Summary: Profiles vs. Extensions
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#key-takeaways">
<span class="md-ellipsis">
      Key Takeaways
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#next-steps">
<span class="md-ellipsis">
      Next Steps
    </span>
</a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<h1 id="fhir-profiles-and-extensions">FHIR Profiles and Extensions</h1>
<h2 id="understanding-profiles-constraints-for-specific-use-cases">Understanding Profiles: Constraints for Specific Use Cases</h2>
<p>Base FHIR is intentionally flexible. A Patient resource can exist with just a <code>resourceType</code> field—no name, no identifier, no birthdate. This flexibility enables broad applicability, but it's too loose for real-world clinical systems.</p>
<p><strong>Profiles</strong> solve this by adding constraints:</p>
<ul>
<li><strong>Tighten cardinality</strong>: Make optional fields required (Patient.identifier: 0..<em> → 1..</em>)</li>
<li><strong>Constrain data types</strong>: Limit choices (Patient.deceased[x] must be deceasedBoolean, not deceasedDateTime)</li>
<li><strong>Specify value sets</strong>: Require codes from specific terminologies (Observation.code must be from LOINC)</li>
<li><strong>Add extensions</strong>: Introduce new data elements (race, ethnicity)</li>
<li><strong>Define MustSupport</strong>: Flag elements that systems must be able to process</li>
</ul>
<p>Think of profiles as blueprints overlaid on base FHIR—they don't change the foundation, they add walls and plumbing.</p>
<hr/>
<h2 id="why-profiles-matter">Why Profiles Matter</h2>
<h3 id="scenario-1-us-healthcare-certification">Scenario 1: US Healthcare Certification</h3>
<p>To achieve ONC certification in the US, EHR systems must support <strong>US Core profiles</strong>. These profiles enforce:</p>
<ul>
<li>Every Patient must have at least one identifier, one name, and gender</li>
<li>Race and ethnicity must be captured (via extensions)</li>
<li>Clinical resources must reference encounters</li>
<li>Specific search parameters must be supported</li>
</ul>
<p>Without US Core conformance, systems can't participate in federal programs or exchange data with other certified systems.</p>
<h3 id="scenario-2-international-patient-summary-ips">Scenario 2: International Patient Summary (IPS)</h3>
<p>A Norwegian patient vacations in Australia and has a medical emergency. The Australian hospital needs to access the patient's summary. <strong>IPS profiles</strong> ensure both countries structure data identically:</p>
<ul>
<li>Allergies use same structure and codes</li>
<li>Medication lists are comparable</li>
<li>Problem lists use standard terminologies</li>
</ul>
<p>Profiles make cross-border care possible.</p>
<h3 id="scenario-3-research-networks">Scenario 3: Research Networks</h3>
<p>A cancer research consortium needs consistent genomics data across 50 institutions. A <strong>custom profile</strong> defines:</p>
<ul>
<li>Required genetic test results (HGVS notation)</li>
<li>Mandatory tumor staging fields</li>
<li>Specific specimen collection procedures</li>
</ul>
<p>Without profiles, each institution would structure data differently, making aggregation impossible.</p>
<hr/>
<h2 id="common-profile-types">Common Profile Types</h2>
<h3 id="us-core-profiles-us-realm">US Core Profiles (US Realm)</h3>
<p><strong>Base URL</strong>: <code>http://hl7.org/fhir/us/core/StructureDefinition/</code></p>
<p><strong>Key profiles</strong>:</p>
<ul>
<li><strong>us-core-patient</strong>: Demographics with race/ethnicity extensions</li>
<li><strong>us-core-observation-lab</strong>: Laboratory results with category constraints</li>
<li><strong>us-core-condition</strong>: Diagnoses with required clinical and verification status</li>
<li><strong>us-core-medicationrequest</strong>: Prescriptions with required intent and status</li>
<li><strong>us-core-procedure</strong>: Procedures with required code and performed date</li>
<li><strong>us-core-encounter</strong>: Visits with required type and class</li>
</ul>
<p><strong>Example differences</strong> (Patient):</p>
<table>
<thead>
<tr>
<th>Element</th>
<th>Base FHIR</th>
<th>US Core</th>
</tr>
</thead>
<tbody>
<tr>
<td>identifier</td>
<td>0..*</td>
<td>1..* (required)</td>
</tr>
<tr>
<td>name</td>
<td>0..*</td>
<td>1..* (required)</td>
</tr>
<tr>
<td>gender</td>
<td>0..1</td>
<td>1..1 (required)</td>
</tr>
<tr>
<td>race extension</td>
<td>N/A</td>
<td>0..1 (MustSupport)</td>
</tr>
<tr>
<td>ethnicity extension</td>
<td>N/A</td>
<td>0..1 (MustSupport)</td>
</tr>
</tbody>
</table>
<h3 id="international-patient-summary-ips">International Patient Summary (IPS)</h3>
<p><strong>Base URL</strong>: <code>http://hl7.org/fhir/uv/ips/StructureDefinition/</code></p>
<p><strong>Key profiles</strong>:</p>
<ul>
<li><strong>Patient-uv-ips</strong>: Demographics for international exchange</li>
<li><strong>Observation-results-uv-ips</strong>: Shareable lab/vital results</li>
<li><strong>AllergyIntolerance-uv-ips</strong>: Standardized allergy documentation</li>
<li><strong>Medication-uv-ips</strong>: Medication list using international codes</li>
</ul>
<p><strong>Design principle</strong>: Maximum interoperability with minimal constraints (unlike US Core which is more prescriptive).</p>
<h3 id="smart-app-launch-profiles">SMART App Launch Profiles</h3>
<p><strong>Base URL</strong>: <code>http://hl7.org/fhir/smart-app-launch/StructureDefinition/</code></p>
<p><strong>Key profiles</strong>:</p>
<ul>
<li><strong>patient-access-brands</strong>: Branded EHR endpoints for patient apps</li>
<li><strong>patient-access-endpoint</strong>: OAuth/FHIR capability metadata</li>
</ul>
<hr/>
<h2 id="declaring-profile-conformance">Declaring Profile Conformance</h2>
<p>Resources claim conformance via <code>meta.profile</code>:</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">"resourceType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Patient"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"meta"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">"profile"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">      </span><span class="s2">"http://hl7.org/fhir/us/core/StructureDefinition/us-core-patient"</span>
<span class="w">    </span><span class="p">]</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">"identifier"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">"use"</span><span class="p">:</span><span class="w"> </span><span class="s2">"usual"</span><span class="p">,</span>
<span class="w">      </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">"coding"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span>
<span class="w">          </span><span class="nt">"system"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://terminology.hl7.org/CodeSystem/v2-0203"</span><span class="p">,</span>
<span class="w">          </span><span class="nt">"code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"MR"</span><span class="p">,</span>
<span class="w">          </span><span class="nt">"display"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Medical Record Number"</span>
<span class="w">        </span><span class="p">}]</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="nt">"system"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://hospital.example.org"</span><span class="p">,</span>
<span class="w">      </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"MRN-123456"</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">],</span>
<span class="w">  </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">"use"</span><span class="p">:</span><span class="w"> </span><span class="s2">"official"</span><span class="p">,</span>
<span class="w">      </span><span class="nt">"family"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Shaw"</span><span class="p">,</span>
<span class="w">      </span><span class="nt">"given"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"Amy"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Victoria"</span><span class="p">]</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">],</span>
<span class="w">  </span><span class="nt">"gender"</span><span class="p">:</span><span class="w"> </span><span class="s2">"female"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"birthDate"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1987-02-20"</span>
<span class="p">}</span>
</code></pre></div>
<p><strong>What this declaration means</strong>:</p>
<ul>
<li>Validators will check against US Core Patient rules</li>
<li>Servers may enforce stricter validation</li>
<li>Clients know what fields are guaranteed to be present</li>
<li>Search parameters follow US Core requirements</li>
</ul>
<hr/>
<h2 id="searching-by-profile">Searching by Profile</h2>
<p><strong>Find all US Core patients</strong>:</p>
<div class="highlight"><pre><span></span><code><span class="err">GET /Patient?_profile=http://hl7.org/fhir/us/core/StructureDefinition/us-core-patient</span>
</code></pre></div>
<p><strong>Use case</strong>: Quality measure reporting (only count certified-compliant records)</p>
<hr/>
<h2 id="understanding-mustsupport">Understanding MustSupport</h2>
<p><strong>MustSupport</strong> is a profile flag indicating:</p>
<blockquote>
<p>"If data is available, it MUST be included. If received, it MUST be processed meaningfully."</p>
</blockquote>
<h3 id="what-mustsupport-does-not-mean">What MustSupport Does NOT Mean</h3>
<ul>
<li>❌ "Field is required" (cardinality defines that)</li>
<li>❌ "Data must always exist"</li>
<li>❌ "Must display to user"</li>
</ul>
<h3 id="what-mustsupport-does-mean">What MustSupport DOES Mean</h3>
<p><strong>For senders</strong> (systems producing data):</p>
<ul>
<li>If patient has a phone number, include it in <code>Patient.telecom</code></li>
<li>Don't omit available data</li>
</ul>
<p><strong>For receivers</strong> (systems consuming data):</p>
<ul>
<li>Must be able to store the element</li>
<li>Must be able to retrieve and return it</li>
<li>Must process it "meaningfully" (app-specific definition)</li>
</ul>
<h3 id="example-us-core-patienttelecom">Example: US Core Patient.telecom</h3>
<p>US Core marks <code>Patient.telecom</code> as MustSupport but cardinality is 0..* (optional).</p>
<p><strong>Sender obligations</strong>:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// BAD: Patient has phone number in database but we omit it</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">patient</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">resourceType</span><span class="o">:</span><span class="w"> </span><span class="s2">"Patient"</span><span class="p">,</span>
<span class="w">  </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="p">[{</span><span class="nx">family</span><span class="o">:</span><span class="w"> </span><span class="s2">"Shaw"</span><span class="p">}],</span>
<span class="w">  </span><span class="c1">// telecom omitted despite being available</span>
<span class="p">};</span>

<span class="c1">// GOOD: Include available telecom data</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">patient</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">resourceType</span><span class="o">:</span><span class="w"> </span><span class="s2">"Patient"</span><span class="p">,</span>
<span class="w">  </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="p">[{</span><span class="nx">family</span><span class="o">:</span><span class="w"> </span><span class="s2">"Shaw"</span><span class="p">}],</span>
<span class="w">  </span><span class="nx">telecom</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span><span class="nx">system</span><span class="o">:</span><span class="w"> </span><span class="s2">"phone"</span><span class="p">,</span><span class="w"> </span><span class="nx">value</span><span class="o">:</span><span class="w"> </span><span class="s2">"555-555-5555"</span><span class="p">,</span><span class="w"> </span><span class="nx">use</span><span class="o">:</span><span class="w"> </span><span class="s2">"home"</span><span class="p">}</span>
<span class="w">  </span><span class="p">]</span>
<span class="p">};</span>
</code></pre></div>
<p><strong>Receiver obligations</strong>:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// BAD: Ignoring telecom entirely</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">displayPatient</span><span class="p">(</span><span class="nx">patient</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Name: </span><span class="si">${</span><span class="nx">patient</span><span class="p">.</span><span class="nx">name</span><span class="p">[</span><span class="mf">0</span><span class="p">].</span><span class="nx">family</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="w">  </span><span class="c1">// Phone number not processed</span>
<span class="p">}</span>

<span class="c1">// GOOD: Process telecom meaningfully</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">displayPatient</span><span class="p">(</span><span class="nx">patient</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Name: </span><span class="si">${</span><span class="nx">patient</span><span class="p">.</span><span class="nx">name</span><span class="p">[</span><span class="mf">0</span><span class="p">].</span><span class="nx">family</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">patient</span><span class="p">.</span><span class="nx">telecom</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">phone</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">patient</span><span class="p">.</span><span class="nx">telecom</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">t</span><span class="p">.</span><span class="nx">system</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">'phone'</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">phone</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Phone: </span><span class="si">${</span><span class="nx">phone</span><span class="p">.</span><span class="nx">value</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<hr/>
<h2 id="fhir-extensions-adding-custom-data">FHIR Extensions: Adding Custom Data</h2>
<p>Extensions let you add data elements not in base FHIR without breaking interoperability. Other systems that don't understand your extension can safely ignore it.</p>
<h3 id="extension-structure">Extension Structure</h3>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">"extension"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://example.org/fhir/StructureDefinition/patient-ethnicity"</span><span class="p">,</span>
<span class="w">      </span><span class="nt">"valueCodeableConcept"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">"coding"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span>
<span class="w">          </span><span class="nt">"system"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://terminology.hl7.org/CodeSystem/v3-Ethnicity"</span><span class="p">,</span>
<span class="w">          </span><span class="nt">"code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2135-2"</span><span class="p">,</span>
<span class="w">          </span><span class="nt">"display"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Hispanic or Latino"</span>
<span class="w">        </span><span class="p">}]</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">]</span>
<span class="p">}</span>
</code></pre></div>
<p><strong>Key elements</strong>:</p>
<ul>
<li><strong>url</strong>: Globally unique identifier for this extension (like a namespace)</li>
<li><strong>value[x]</strong>: The actual data (can be any FHIR data type)</li>
</ul>
<hr/>
<h2 id="types-of-extensions">Types of Extensions</h2>
<h3 id="simple-extensions-single-value">Simple Extensions (Single Value)</h3>
<p><strong>Example</strong>: Favorite color (not in base FHIR)</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">"resourceType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Patient"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="nt">"family"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Shaw"</span><span class="p">}],</span>
<span class="w">  </span><span class="nt">"extension"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://example.org/fhir/StructureDefinition/favorite-color"</span><span class="p">,</span>
<span class="w">      </span><span class="nt">"valueString"</span><span class="p">:</span><span class="w"> </span><span class="s2">"blue"</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">]</span>
<span class="p">}</span>
</code></pre></div>
<p><strong>Use case</strong>: Custom patient preferences for UI personalization</p>
<hr/>
<h3 id="complex-extensions-nested-structure">Complex Extensions (Nested Structure)</h3>
<p><strong>Example</strong>: Mother's maiden name with date range</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">"resourceType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Patient"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="nt">"family"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Shaw"</span><span class="p">}],</span>
<span class="w">  </span><span class="nt">"extension"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://example.org/fhir/StructureDefinition/mothers-maiden-name"</span><span class="p">,</span>
<span class="w">      </span><span class="nt">"extension"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="nt">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"name"</span><span class="p">,</span>
<span class="w">          </span><span class="nt">"valueString"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Johnson"</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="nt">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"period"</span><span class="p">,</span>
<span class="w">          </span><span class="nt">"valuePeriod"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nt">"start"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1960-05-15"</span><span class="p">,</span>
<span class="w">            </span><span class="nt">"end"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1985-06-20"</span>
<span class="w">          </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">]</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">]</span>
<span class="p">}</span>
</code></pre></div>
<p><strong>Structure</strong>: Outer extension with <code>url</code> but no <code>value[x]</code>, inner extensions with sub-elements.</p>
<p><strong>Use case</strong>: Identity verification (security question)</p>
<hr/>
<h3 id="modifier-extensions-change-meaning">Modifier Extensions (Change Meaning)</h3>
<p><strong>Regular extensions</strong> don't change the meaning of the resource. You can ignore them and still understand the data.</p>
<p><strong>Modifier extensions</strong> DO change meaning. Ignoring them could cause misinterpretation.</p>
<p><strong>Example</strong>: Negation extension</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">"resourceType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Procedure"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"code"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">"coding"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span>
<span class="w">      </span><span class="nt">"system"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://snomed.info/sct"</span><span class="p">,</span>
<span class="w">      </span><span class="nt">"code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"80146002"</span><span class="p">,</span>
<span class="w">      </span><span class="nt">"display"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Appendectomy"</span>
<span class="w">    </span><span class="p">}]</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">"subject"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"reference"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Patient/123"</span><span class="p">},</span>
<span class="w">  </span><span class="nt">"modifierExtension"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://example.org/fhir/StructureDefinition/procedure-not-performed"</span><span class="p">,</span>
<span class="w">      </span><span class="nt">"valueBoolean"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">]</span>
<span class="p">}</span>
</code></pre></div>
<p><strong>Meaning</strong>: This procedure was <strong>NOT</strong> performed (contrary to what the resource implies).</p>
<p><strong>Critical</strong>: Systems MUST reject resources with unrecognized modifierExtensions. You can't safely ignore them.</p>
<div class="highlight"><pre><span></span><code><span class="kd">function</span><span class="w"> </span><span class="nx">processProcedure</span><span class="p">(</span><span class="nx">procedure</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// Check for unknown modifier extensions</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">procedure</span><span class="p">.</span><span class="nx">modifierExtension</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">recognized</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s1">'http://example.org/fhir/StructureDefinition/procedure-not-performed'</span><span class="p">];</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">unknown</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">procedure</span><span class="p">.</span><span class="nx">modifierExtension</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span>
<span class="w">      </span><span class="nx">ext</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="o">!</span><span class="nx">recognized</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="nx">ext</span><span class="p">.</span><span class="nx">url</span><span class="p">)</span>
<span class="w">    </span><span class="p">);</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">unknown</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`Cannot process procedure with unknown modifier extensions: </span><span class="si">${</span><span class="nx">unknown</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">e</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">e</span><span class="p">.</span><span class="nx">url</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="s1">', '</span><span class="p">)</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="c1">// Process normally</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">notPerformed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">procedure</span><span class="p">.</span><span class="nx">modifierExtension</span><span class="o">?</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span>
<span class="w">    </span><span class="nx">ext</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">ext</span><span class="p">.</span><span class="nx">url</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">'http://example.org/fhir/StructureDefinition/procedure-not-performed'</span>
<span class="w">  </span><span class="p">)</span><span class="o">?</span><span class="p">.</span><span class="nx">valueBoolean</span><span class="p">;</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">notPerformed</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"Procedure was NOT performed"</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"Procedure was performed"</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<hr/>
<h2 id="common-us-core-extensions">Common US Core Extensions</h2>
<h3 id="race-extension">Race Extension</h3>
<p><strong>URL</strong>: <code>http://hl7.org/fhir/us/core/StructureDefinition/us-core-race</code></p>
<p><strong>Structure</strong>: Complex extension with OMB category + text</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">"resourceType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Patient"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"extension"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://hl7.org/fhir/us/core/StructureDefinition/us-core-race"</span><span class="p">,</span>
<span class="w">      </span><span class="nt">"extension"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="nt">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ombCategory"</span><span class="p">,</span>
<span class="w">          </span><span class="nt">"valueCoding"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nt">"system"</span><span class="p">:</span><span class="w"> </span><span class="s2">"urn:oid:2.16.840.1.113883.6.238"</span><span class="p">,</span>
<span class="w">            </span><span class="nt">"code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2106-3"</span><span class="p">,</span>
<span class="w">            </span><span class="nt">"display"</span><span class="p">:</span><span class="w"> </span><span class="s2">"White"</span>
<span class="w">          </span><span class="p">}</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="nt">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"text"</span><span class="p">,</span>
<span class="w">          </span><span class="nt">"valueString"</span><span class="p">:</span><span class="w"> </span><span class="s2">"White"</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">]</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">],</span>
<span class="w">  </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="nt">"family"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Shaw"</span><span class="p">}]</span>
<span class="p">}</span>
</code></pre></div>
<p><strong>OMB categories</strong> (US Office of Management and Budget):</p>
<ul>
<li>1002-5: American Indian or Alaska Native</li>
<li>2028-9: Asian</li>
<li>2054-5: Black or African American</li>
<li>2076-8: Native Hawaiian or Other Pacific Islander</li>
<li>2106-3: White</li>
</ul>
<p><strong>Why two fields?</strong>:</p>
<ul>
<li><strong>ombCategory</strong>: Standardized code for statistical reporting</li>
<li><strong>text</strong>: Patient's own description (may be more specific: "Irish-American")</li>
</ul>
<hr/>
<h3 id="ethnicity-extension">Ethnicity Extension</h3>
<p><strong>URL</strong>: <code>http://hl7.org/fhir/us/core/StructureDefinition/us-core-ethnicity</code></p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">"resourceType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Patient"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"extension"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://hl7.org/fhir/us/core/StructureDefinition/us-core-ethnicity"</span><span class="p">,</span>
<span class="w">      </span><span class="nt">"extension"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="nt">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ombCategory"</span><span class="p">,</span>
<span class="w">          </span><span class="nt">"valueCoding"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nt">"system"</span><span class="p">:</span><span class="w"> </span><span class="s2">"urn:oid:2.16.840.1.113883.6.238"</span><span class="p">,</span>
<span class="w">            </span><span class="nt">"code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2186-5"</span><span class="p">,</span>
<span class="w">            </span><span class="nt">"display"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Not Hispanic or Latino"</span>
<span class="w">          </span><span class="p">}</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="nt">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"text"</span><span class="p">,</span>
<span class="w">          </span><span class="nt">"valueString"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Not Hispanic or Latino"</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">]</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">],</span>
<span class="w">  </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="nt">"family"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Shaw"</span><span class="p">}]</span>
<span class="p">}</span>
</code></pre></div>
<p><strong>OMB categories</strong>:</p>
<ul>
<li>2135-2: Hispanic or Latino</li>
<li>2186-5: Not Hispanic or Latino</li>
</ul>
<hr/>
<h3 id="birth-sex-extension">Birth Sex Extension</h3>
<p><strong>URL</strong>: <code>http://hl7.org/fhir/us/core/StructureDefinition/us-core-birthsex</code></p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">"resourceType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Patient"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"extension"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://hl7.org/fhir/us/core/StructureDefinition/us-core-birthsex"</span><span class="p">,</span>
<span class="w">      </span><span class="nt">"valueCode"</span><span class="p">:</span><span class="w"> </span><span class="s2">"F"</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">],</span>
<span class="w">  </span><span class="nt">"gender"</span><span class="p">:</span><span class="w"> </span><span class="s2">"female"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="nt">"family"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Shaw"</span><span class="p">}]</span>
<span class="p">}</span>
</code></pre></div>
<p><strong>Values</strong>: M, F, UNK</p>
<p><strong>Why separate from gender?</strong>:</p>
<ul>
<li><strong>birthSex</strong>: Biological sex assigned at birth (medical relevance for dosing, risk factors)</li>
<li><strong>gender</strong>: Administrative/social gender (preferred pronouns, identity)</li>
</ul>
<p>A transgender man might have <code>birthSex: "F"</code> but <code>gender: "male"</code>.</p>
<hr/>
<h2 id="complete-example-us-core-patient-with-extensions">Complete Example: US Core Patient with Extensions</h2>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">"resourceType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Patient"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"meta"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">"profile"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">      </span><span class="s2">"http://hl7.org/fhir/us/core/StructureDefinition/us-core-patient"</span>
<span class="w">    </span><span class="p">]</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">"extension"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://hl7.org/fhir/us/core/StructureDefinition/us-core-race"</span><span class="p">,</span>
<span class="w">      </span><span class="nt">"extension"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="nt">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ombCategory"</span><span class="p">,</span>
<span class="w">          </span><span class="nt">"valueCoding"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nt">"system"</span><span class="p">:</span><span class="w"> </span><span class="s2">"urn:oid:2.16.840.1.113883.6.238"</span><span class="p">,</span>
<span class="w">            </span><span class="nt">"code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2106-3"</span><span class="p">,</span>
<span class="w">            </span><span class="nt">"display"</span><span class="p">:</span><span class="w"> </span><span class="s2">"White"</span>
<span class="w">          </span><span class="p">}</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="nt">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"detailed"</span><span class="p">,</span>
<span class="w">          </span><span class="nt">"valueCoding"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nt">"system"</span><span class="p">:</span><span class="w"> </span><span class="s2">"urn:oid:2.16.840.1.113883.6.238"</span><span class="p">,</span>
<span class="w">            </span><span class="nt">"code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2108-9"</span><span class="p">,</span>
<span class="w">            </span><span class="nt">"display"</span><span class="p">:</span><span class="w"> </span><span class="s2">"European"</span>
<span class="w">          </span><span class="p">}</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="nt">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"text"</span><span class="p">,</span>
<span class="w">          </span><span class="nt">"valueString"</span><span class="p">:</span><span class="w"> </span><span class="s2">"White, European ancestry"</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">]</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://hl7.org/fhir/us/core/StructureDefinition/us-core-ethnicity"</span><span class="p">,</span>
<span class="w">      </span><span class="nt">"extension"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="nt">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ombCategory"</span><span class="p">,</span>
<span class="w">          </span><span class="nt">"valueCoding"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nt">"system"</span><span class="p">:</span><span class="w"> </span><span class="s2">"urn:oid:2.16.840.1.113883.6.238"</span><span class="p">,</span>
<span class="w">            </span><span class="nt">"code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2186-5"</span><span class="p">,</span>
<span class="w">            </span><span class="nt">"display"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Not Hispanic or Latino"</span>
<span class="w">          </span><span class="p">}</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="nt">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"text"</span><span class="p">,</span>
<span class="w">          </span><span class="nt">"valueString"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Not Hispanic or Latino"</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">]</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://hl7.org/fhir/us/core/StructureDefinition/us-core-birthsex"</span><span class="p">,</span>
<span class="w">      </span><span class="nt">"valueCode"</span><span class="p">:</span><span class="w"> </span><span class="s2">"F"</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">],</span>
<span class="w">  </span><span class="nt">"identifier"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">"use"</span><span class="p">:</span><span class="w"> </span><span class="s2">"usual"</span><span class="p">,</span>
<span class="w">      </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">"coding"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span>
<span class="w">          </span><span class="nt">"system"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://terminology.hl7.org/CodeSystem/v2-0203"</span><span class="p">,</span>
<span class="w">          </span><span class="nt">"code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"MR"</span>
<span class="w">        </span><span class="p">}]</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="nt">"system"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://hospital.example.org"</span><span class="p">,</span>
<span class="w">      </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"MRN-123456"</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">"use"</span><span class="p">:</span><span class="w"> </span><span class="s2">"official"</span><span class="p">,</span>
<span class="w">      </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">"coding"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span>
<span class="w">          </span><span class="nt">"system"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://terminology.hl7.org/CodeSystem/v2-0203"</span><span class="p">,</span>
<span class="w">          </span><span class="nt">"code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"SS"</span>
<span class="w">        </span><span class="p">}]</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="nt">"system"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://hl7.org/fhir/sid/us-ssn"</span><span class="p">,</span>
<span class="w">      </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"123-45-6789"</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">],</span>
<span class="w">  </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">"use"</span><span class="p">:</span><span class="w"> </span><span class="s2">"official"</span><span class="p">,</span>
<span class="w">      </span><span class="nt">"family"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Shaw"</span><span class="p">,</span>
<span class="w">      </span><span class="nt">"given"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"Amy"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Victoria"</span><span class="p">]</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">],</span>
<span class="w">  </span><span class="nt">"telecom"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">"system"</span><span class="p">:</span><span class="w"> </span><span class="s2">"phone"</span><span class="p">,</span>
<span class="w">      </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"555-555-5555"</span><span class="p">,</span>
<span class="w">      </span><span class="nt">"use"</span><span class="p">:</span><span class="w"> </span><span class="s2">"home"</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">"system"</span><span class="p">:</span><span class="w"> </span><span class="s2">"email"</span><span class="p">,</span>
<span class="w">      </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"amy.shaw@example.com"</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">],</span>
<span class="w">  </span><span class="nt">"gender"</span><span class="p">:</span><span class="w"> </span><span class="s2">"female"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"birthDate"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1987-02-20"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"address"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">"use"</span><span class="p">:</span><span class="w"> </span><span class="s2">"home"</span><span class="p">,</span>
<span class="w">      </span><span class="nt">"line"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"123 Main St"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Apt 4B"</span><span class="p">],</span>
<span class="w">      </span><span class="nt">"city"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Boston"</span><span class="p">,</span>
<span class="w">      </span><span class="nt">"state"</span><span class="p">:</span><span class="w"> </span><span class="s2">"MA"</span><span class="p">,</span>
<span class="w">      </span><span class="nt">"postalCode"</span><span class="p">:</span><span class="w"> </span><span class="s2">"02101"</span><span class="p">,</span>
<span class="w">      </span><span class="nt">"country"</span><span class="p">:</span><span class="w"> </span><span class="s2">"US"</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">]</span>
<span class="p">}</span>
</code></pre></div>
<p><strong>What makes this US Core compliant</strong>:</p>
<p>✅ Declared profile in meta.profile<br/>
✅ At least one identifier (has two: MRN + SSN)<br/>
✅ At least one name<br/>
✅ Gender is present<br/>
✅ Race extension included (MustSupport)<br/>
✅ Ethnicity extension included (MustSupport)<br/>
✅ BirthSex extension included (MustSupport)  </p>
<hr/>
<h2 id="accessing-extensions-in-code">Accessing Extensions in Code</h2>
<h3 id="reading-extensions">Reading Extensions</h3>
<div class="highlight"><pre><span></span><code><span class="kd">function</span><span class="w"> </span><span class="nx">getExtensionValue</span><span class="p">(</span><span class="nx">resource</span><span class="p">,</span><span class="w"> </span><span class="nx">url</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">ext</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">resource</span><span class="p">.</span><span class="nx">extension</span><span class="o">?</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">e</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">e</span><span class="p">.</span><span class="nx">url</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">url</span><span class="p">);</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">ext</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>

<span class="w">  </span><span class="c1">// Find the value[x] field</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">valueKey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">ext</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="nx">k</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">k</span><span class="p">.</span><span class="nx">startsWith</span><span class="p">(</span><span class="s1">'value'</span><span class="p">));</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">ext</span><span class="p">[</span><span class="nx">valueKey</span><span class="p">];</span>
<span class="p">}</span>

<span class="c1">// Usage</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">patient</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="cm">/* ... fetch patient ... */</span><span class="p">;</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">birthSex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">getExtensionValue</span><span class="p">(</span>
<span class="w">  </span><span class="nx">patient</span><span class="p">,</span>
<span class="w">  </span><span class="s1">'http://hl7.org/fhir/us/core/StructureDefinition/us-core-birthsex'</span>
<span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Birth sex: </span><span class="si">${</span><span class="nx">birthSex</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span><span class="w"> </span><span class="c1">// "F"</span>
</code></pre></div>
<h3 id="reading-complex-extensions">Reading Complex Extensions</h3>
<div class="highlight"><pre><span></span><code><span class="kd">function</span><span class="w"> </span><span class="nx">getRaceText</span><span class="p">(</span><span class="nx">patient</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">raceExt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">patient</span><span class="p">.</span><span class="nx">extension</span><span class="o">?</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span>
<span class="w">    </span><span class="nx">e</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">e</span><span class="p">.</span><span class="nx">url</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">'http://hl7.org/fhir/us/core/StructureDefinition/us-core-race'</span>
<span class="w">  </span><span class="p">);</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">raceExt</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">textExt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">raceExt</span><span class="p">.</span><span class="nx">extension</span><span class="o">?</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">e</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">e</span><span class="p">.</span><span class="nx">url</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">'text'</span><span class="p">);</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">textExt</span><span class="o">?</span><span class="p">.</span><span class="nx">valueString</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Usage</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">raceText</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">getRaceText</span><span class="p">(</span><span class="nx">patient</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Race: </span><span class="si">${</span><span class="nx">raceText</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span><span class="w"> </span><span class="c1">// "White, European ancestry"</span>
</code></pre></div>
<h3 id="adding-extensions">Adding Extensions</h3>
<div class="highlight"><pre><span></span><code><span class="kd">function</span><span class="w"> </span><span class="nx">addBirthSexExtension</span><span class="p">(</span><span class="nx">patient</span><span class="p">,</span><span class="w"> </span><span class="nx">birthSex</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">patient</span><span class="p">.</span><span class="nx">extension</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">patient</span><span class="p">.</span><span class="nx">extension</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[];</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="c1">// Remove existing birthSex extension if present</span>
<span class="w">  </span><span class="nx">patient</span><span class="p">.</span><span class="nx">extension</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">patient</span><span class="p">.</span><span class="nx">extension</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span>
<span class="w">    </span><span class="nx">e</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">e</span><span class="p">.</span><span class="nx">url</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="s1">'http://hl7.org/fhir/us/core/StructureDefinition/us-core-birthsex'</span>
<span class="w">  </span><span class="p">);</span>

<span class="w">  </span><span class="c1">// Add new extension</span>
<span class="w">  </span><span class="nx">patient</span><span class="p">.</span><span class="nx">extension</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
<span class="w">    </span><span class="nx">url</span><span class="o">:</span><span class="w"> </span><span class="s1">'http://hl7.org/fhir/us/core/StructureDefinition/us-core-birthsex'</span><span class="p">,</span>
<span class="w">    </span><span class="nx">valueCode</span><span class="o">:</span><span class="w"> </span><span class="nx">birthSex</span>
<span class="w">  </span><span class="p">});</span>
<span class="p">}</span>

<span class="c1">// Usage</span>
<span class="nx">addBirthSexExtension</span><span class="p">(</span><span class="nx">patient</span><span class="p">,</span><span class="w"> </span><span class="s1">'F'</span><span class="p">);</span>
</code></pre></div>
<hr/>
<h2 id="slicing-dividing-arrays-into-constrained-subsets">Slicing: Dividing Arrays into Constrained Subsets</h2>
<p>Profiles can <strong>slice</strong> arrays to enforce structure on multi-valued elements.</p>
<p><strong>Example</strong>: Blood pressure Observation has two components (systolic and diastolic). A profile can define:</p>
<ul>
<li><strong>Slice 1 "systolic"</strong>: component where code = LOINC 8480-6, cardinality 1..1</li>
<li><strong>Slice 2 "diastolic"</strong>: component where code = LOINC 8462-4, cardinality 1..1</li>
</ul>
<p>This ensures every blood pressure Observation has exactly one systolic and one diastolic reading.</p>
<p><strong>Unsliced structure</strong> (base FHIR):</p>
<div class="highlight"><pre><span></span><code>Observation.component: 0..*
  code: 1..1
  value[x]: 0..1
</code></pre></div>
<p><strong>Sliced structure</strong> (Vitals profile):</p>
<div class="highlight"><pre><span></span><code>Observation.component: 2..2
  Slice "systolic": 1..1
    code: 1..1 (fixed to LOINC 8480-6)
    valueQuantity: 1..1
  Slice "diastolic": 1..1
    code: 1..1 (fixed to LOINC 8462-4)
    valueQuantity: 1..1
</code></pre></div>
<p><strong>Conformant resource</strong>:</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">"resourceType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Observation"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"final"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"code"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">"coding"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span>
<span class="w">      </span><span class="nt">"system"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://loinc.org"</span><span class="p">,</span>
<span class="w">      </span><span class="nt">"code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"85354-9"</span>
<span class="w">    </span><span class="p">}]</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">"subject"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"reference"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Patient/123"</span><span class="p">},</span>
<span class="w">  </span><span class="nt">"component"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">"code"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">"coding"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span>
<span class="w">          </span><span class="nt">"system"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://loinc.org"</span><span class="p">,</span>
<span class="w">          </span><span class="nt">"code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"8480-6"</span>
<span class="w">        </span><span class="p">}]</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="nt">"valueQuantity"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="mi">120</span><span class="p">,</span><span class="w"> </span><span class="nt">"unit"</span><span class="p">:</span><span class="w"> </span><span class="s2">"mmHg"</span><span class="p">}</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">"code"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">"coding"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span>
<span class="w">          </span><span class="nt">"system"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://loinc.org"</span><span class="p">,</span>
<span class="w">          </span><span class="nt">"code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"8462-4"</span>
<span class="w">        </span><span class="p">}]</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="nt">"valueQuantity"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="mi">80</span><span class="p">,</span><span class="w"> </span><span class="nt">"unit"</span><span class="p">:</span><span class="w"> </span><span class="s2">"mmHg"</span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">]</span>
<span class="p">}</span>
</code></pre></div>
<p><strong>Non-conformant</strong> (only systolic):</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">"component"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">"code"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">"coding"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span>
<span class="w">          </span><span class="nt">"system"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://loinc.org"</span><span class="p">,</span>
<span class="w">          </span><span class="nt">"code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"8480-6"</span>
<span class="w">        </span><span class="p">}]</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="nt">"valueQuantity"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="mi">120</span><span class="p">,</span><span class="w"> </span><span class="nt">"unit"</span><span class="p">:</span><span class="w"> </span><span class="s2">"mmHg"</span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// Missing diastolic slice - validation fails</span>
<span class="w">  </span><span class="p">]</span>
<span class="p">}</span>
</code></pre></div>
<hr/>
<h2 id="capabilitystatement-discovering-server-support">CapabilityStatement: Discovering Server Support</h2>
<p>Servers declare their profile support via CapabilityStatement:</p>
<div class="highlight"><pre><span></span><code><span class="err">GET /metadata</span>
</code></pre></div>
<p><strong>Response</strong> (excerpt):</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">"resourceType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"CapabilityStatement"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"rest"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span>
<span class="w">    </span><span class="nt">"mode"</span><span class="p">:</span><span class="w"> </span><span class="s2">"server"</span><span class="p">,</span>
<span class="w">    </span><span class="nt">"resource"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Patient"</span><span class="p">,</span>
<span class="w">        </span><span class="nt">"profile"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://hl7.org/fhir/us/core/StructureDefinition/us-core-patient"</span><span class="p">,</span>
<span class="w">        </span><span class="nt">"supportedProfile"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">          </span><span class="s2">"http://hl7.org/fhir/us/core/StructureDefinition/us-core-patient"</span><span class="p">,</span>
<span class="w">          </span><span class="s2">"http://hl7.org/fhir/uv/ips/StructureDefinition/Patient-uv-ips"</span>
<span class="w">        </span><span class="p">],</span>
<span class="w">        </span><span class="nt">"interaction"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">          </span><span class="p">{</span><span class="nt">"code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"read"</span><span class="p">},</span>
<span class="w">          </span><span class="p">{</span><span class="nt">"code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"search-type"</span><span class="p">},</span>
<span class="w">          </span><span class="p">{</span><span class="nt">"code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"create"</span><span class="p">},</span>
<span class="w">          </span><span class="p">{</span><span class="nt">"code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"update"</span><span class="p">}</span>
<span class="w">        </span><span class="p">],</span>
<span class="w">        </span><span class="nt">"searchParam"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">          </span><span class="p">{</span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"name"</span><span class="p">,</span><span class="w"> </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="p">},</span>
<span class="w">          </span><span class="p">{</span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"birthdate"</span><span class="p">,</span><span class="w"> </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"date"</span><span class="p">},</span>
<span class="w">          </span><span class="p">{</span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"identifier"</span><span class="p">,</span><span class="w"> </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"token"</span><span class="p">}</span>
<span class="w">        </span><span class="p">]</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="w">  </span><span class="p">}]</span>
<span class="p">}</span>
</code></pre></div>
<p><strong>What this tells you</strong>:</p>
<ul>
<li><strong>profile</strong>: Primary profile for validation (US Core Patient)</li>
<li><strong>supportedProfile</strong>: This server also accepts IPS patients</li>
<li>Resources submitted without profile declaration will be validated against US Core</li>
<li>Search parameters follow US Core requirements</li>
</ul>
<hr/>
<h2 id="validation-against-profiles">Validation Against Profiles</h2>
<h3 id="server-side-validation">Server-Side Validation</h3>
<p>When you POST a Patient:</p>
<div class="highlight"><pre><span></span><code><span class="err">POST /Patient</span>
<span class="err">Content-Type: application/fhir+json</span>
</code></pre></div>
<p><strong>Body</strong> (missing required identifier):</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">"resourceType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Patient"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"meta"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">"profile"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"http://hl7.org/fhir/us/core/StructureDefinition/us-core-patient"</span><span class="p">]</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="nt">"family"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Doe"</span><span class="p">}],</span>
<span class="w">  </span><span class="nt">"gender"</span><span class="p">:</span><span class="w"> </span><span class="s2">"male"</span>
<span class="p">}</span>
</code></pre></div>
<p><strong>Response</strong> (422 Unprocessable Entity):</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">"resourceType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"OperationOutcome"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"issue"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span>
<span class="w">    </span><span class="nt">"severity"</span><span class="p">:</span><span class="w"> </span><span class="s2">"error"</span><span class="p">,</span>
<span class="w">    </span><span class="nt">"code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"required"</span><span class="p">,</span>
<span class="w">    </span><span class="nt">"diagnostics"</span><span class="p">:</span><span class="w"> </span><span class="s2">"US Core Patient Profile: Patient.identifier: minimum cardinality is 1, but found 0"</span><span class="p">,</span>
<span class="w">    </span><span class="nt">"location"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"Patient.identifier"</span><span class="p">]</span>
<span class="w">  </span><span class="p">}]</span>
<span class="p">}</span>
</code></pre></div>
<hr/>
<h3 id="explicit-validation-with-validate">Explicit Validation with $validate</h3>
<p>Test profile conformance without creating resource:</p>
<div class="highlight"><pre><span></span><code><span class="err">POST /Patient/$validate</span>
<span class="err">Content-Type: application/fhir+json</span>
</code></pre></div>
<p><strong>Body</strong>:</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">"resourceType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Parameters"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"parameter"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"resource"</span><span class="p">,</span>
<span class="w">      </span><span class="nt">"resource"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">"resourceType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Patient"</span><span class="p">,</span>
<span class="w">        </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="nt">"family"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Doe"</span><span class="p">}],</span>
<span class="w">        </span><span class="nt">"gender"</span><span class="p">:</span><span class="w"> </span><span class="s2">"male"</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"profile"</span><span class="p">,</span>
<span class="w">      </span><span class="nt">"valueUri"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://hl7.org/fhir/us/core/StructureDefinition/us-core-patient"</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">]</span>
<span class="p">}</span>
</code></pre></div>
<p><strong>Response</strong>: OperationOutcome detailing all validation errors.</p>
<hr/>
<h2 id="best-practices">Best Practices</h2>
<h3 id="1-declare-profiles-explicitly">1. Declare Profiles Explicitly</h3>
<div class="highlight"><pre><span></span><code><span class="c1">// GOOD: Explicit profile declaration</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">patient</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">resourceType</span><span class="o">:</span><span class="w"> </span><span class="s2">"Patient"</span><span class="p">,</span>
<span class="w">  </span><span class="nx">meta</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">profile</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"http://hl7.org/fhir/us/core/StructureDefinition/us-core-patient"</span><span class="p">]</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nx">identifier</span><span class="o">:</span><span class="w"> </span><span class="p">[{</span><span class="nx">system</span><span class="o">:</span><span class="w"> </span><span class="s2">"http://hospital.org"</span><span class="p">,</span><span class="w"> </span><span class="nx">value</span><span class="o">:</span><span class="w"> </span><span class="s2">"MRN-123"</span><span class="p">}],</span>
<span class="w">  </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="p">[{</span><span class="nx">family</span><span class="o">:</span><span class="w"> </span><span class="s2">"Doe"</span><span class="p">}],</span>
<span class="w">  </span><span class="nx">gender</span><span class="o">:</span><span class="w"> </span><span class="s2">"male"</span>
<span class="p">};</span>

<span class="c1">// BAD: Relying on server defaults</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">patient</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">resourceType</span><span class="o">:</span><span class="w"> </span><span class="s2">"Patient"</span><span class="p">,</span>
<span class="w">  </span><span class="c1">// No profile declared - server may apply wrong validation</span>
<span class="w">  </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="p">[{</span><span class="nx">family</span><span class="o">:</span><span class="w"> </span><span class="s2">"Doe"</span><span class="p">}]</span>
<span class="p">};</span>
</code></pre></div>
<hr/>
<h3 id="2-check-capabilitystatement-before-submitting">2. Check CapabilityStatement Before Submitting</h3>
<div class="highlight"><pre><span></span><code><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">getSupportedProfiles</span><span class="p">(</span><span class="nx">resourceType</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">caps</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="s1">'/metadata'</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">json</span><span class="p">());</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">resourceDef</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">caps</span><span class="p">.</span><span class="nx">rest</span><span class="p">[</span><span class="mf">0</span><span class="p">].</span><span class="nx">resource</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">type</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">resourceType</span><span class="p">);</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">resourceDef</span><span class="o">?</span><span class="p">.</span><span class="nx">supportedProfile</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">[];</span>
<span class="p">}</span>

<span class="c1">// Usage</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">profiles</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">getSupportedProfiles</span><span class="p">(</span><span class="s1">'Patient'</span><span class="p">);</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">profiles</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="s1">'http://hl7.org/fhir/us/core/StructureDefinition/us-core-patient'</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// Safe to use US Core Patient</span>
<span class="w">  </span><span class="nx">patient</span><span class="p">.</span><span class="nx">meta</span><span class="p">.</span><span class="nx">profile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s1">'http://hl7.org/fhir/us/core/StructureDefinition/us-core-patient'</span><span class="p">];</span>
<span class="p">}</span>
</code></pre></div>
<hr/>
<h3 id="3-handle-mustsupport-gracefully">3. Handle MustSupport Gracefully</h3>
<div class="highlight"><pre><span></span><code><span class="kd">function</span><span class="w"> </span><span class="nx">prepareUSCorePatient</span><span class="p">(</span><span class="nx">rawPatient</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">patient</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">resourceType</span><span class="o">:</span><span class="w"> </span><span class="s2">"Patient"</span><span class="p">,</span>
<span class="w">    </span><span class="nx">meta</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">profile</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"http://hl7.org/fhir/us/core/StructureDefinition/us-core-patient"</span><span class="p">]</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nx">identifier</span><span class="o">:</span><span class="w"> </span><span class="nx">rawPatient</span><span class="p">.</span><span class="nx">identifier</span><span class="p">,</span><span class="w"> </span><span class="c1">// Required</span>
<span class="w">    </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="nx">rawPatient</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span><span class="w"> </span><span class="c1">// Required</span>
<span class="w">    </span><span class="nx">gender</span><span class="o">:</span><span class="w"> </span><span class="nx">rawPatient</span><span class="p">.</span><span class="nx">gender</span><span class="w"> </span><span class="c1">// Required</span>
<span class="w">  </span><span class="p">};</span>

<span class="w">  </span><span class="c1">// MustSupport elements: include if available</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">rawPatient</span><span class="p">.</span><span class="nx">telecom</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">patient</span><span class="p">.</span><span class="nx">telecom</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">rawPatient</span><span class="p">.</span><span class="nx">telecom</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">rawPatient</span><span class="p">.</span><span class="nx">address</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">patient</span><span class="p">.</span><span class="nx">address</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">rawPatient</span><span class="p">.</span><span class="nx">address</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">rawPatient</span><span class="p">.</span><span class="nx">birthDate</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">patient</span><span class="p">.</span><span class="nx">birthDate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">rawPatient</span><span class="p">.</span><span class="nx">birthDate</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="c1">// Extensions: include if available</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">rawPatient</span><span class="p">.</span><span class="nx">race</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">patient</span><span class="p">.</span><span class="nx">extension</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">patient</span><span class="p">.</span><span class="nx">extension</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">[];</span>
<span class="w">    </span><span class="nx">patient</span><span class="p">.</span><span class="nx">extension</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">buildRaceExtension</span><span class="p">(</span><span class="nx">rawPatient</span><span class="p">.</span><span class="nx">race</span><span class="p">));</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">patient</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<hr/>
<h3 id="4-use-standard-extensions-when-possible">4. Use Standard Extensions When Possible</h3>
<div class="highlight"><pre><span></span><code><span class="c1">// BAD: Custom extension for common concept</span>
<span class="p">{</span>
<span class="w">  </span><span class="s2">"extension"</span><span class="o">:</span><span class="w"> </span><span class="p">[{</span>
<span class="w">    </span><span class="s2">"url"</span><span class="o">:</span><span class="w"> </span><span class="s2">"http://myhospital.org/patient-race"</span><span class="p">,</span>
<span class="w">    </span><span class="s2">"valueString"</span><span class="o">:</span><span class="w"> </span><span class="s2">"White"</span>
<span class="w">  </span><span class="p">}]</span>
<span class="p">}</span>

<span class="c1">// GOOD: Use standard US Core extension</span>
<span class="p">{</span>
<span class="w">  </span><span class="s2">"extension"</span><span class="o">:</span><span class="w"> </span><span class="p">[{</span>
<span class="w">    </span><span class="s2">"url"</span><span class="o">:</span><span class="w"> </span><span class="s2">"http://hl7.org/fhir/us/core/StructureDefinition/us-core-race"</span><span class="p">,</span>
<span class="w">    </span><span class="s2">"extension"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="s2">"url"</span><span class="o">:</span><span class="w"> </span><span class="s2">"ombCategory"</span><span class="p">,</span>
<span class="w">        </span><span class="s2">"valueCoding"</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="s2">"system"</span><span class="o">:</span><span class="w"> </span><span class="s2">"urn:oid:2.16.840.1.113883.6.238"</span><span class="p">,</span>
<span class="w">          </span><span class="s2">"code"</span><span class="o">:</span><span class="w"> </span><span class="s2">"2106-3"</span><span class="p">,</span>
<span class="w">          </span><span class="s2">"display"</span><span class="o">:</span><span class="w"> </span><span class="s2">"White"</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="s2">"url"</span><span class="o">:</span><span class="w"> </span><span class="s2">"text"</span><span class="p">,</span>
<span class="w">        </span><span class="s2">"valueString"</span><span class="o">:</span><span class="w"> </span><span class="s2">"White"</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="w">  </span><span class="p">}]</span>
<span class="p">}</span>
</code></pre></div>
<hr/>
<h3 id="5-document-custom-extensions">5. Document Custom Extensions</h3>
<p>If creating custom extensions:</p>
<div class="highlight"><pre><span></span><code><span class="cm">/**</span>
<span class="cm"> * Extension: Preferred Pharmacy</span>
<span class="cm"> * URL: http://example.org/fhir/StructureDefinition/preferred-pharmacy</span>
<span class="cm"> * Type: Reference(Organization)</span>
<span class="cm"> * Context: Patient</span>
<span class="cm"> * Description: Patient's preferred pharmacy for prescription fulfillment</span>
<span class="cm"> * </span>
<span class="cm"> * Example:</span>
<span class="cm"> * {</span>
<span class="cm"> *   "extension": [{</span>
<span class="cm"> *     "url": "http://example.org/fhir/StructureDefinition/preferred-pharmacy",</span>
<span class="cm"> *     "valueReference": {</span>
<span class="cm"> *       "reference": "Organization/pharmacy-123",</span>
<span class="cm"> *       "display": "CVS Pharmacy #4567"</span>
<span class="cm"> *     }</span>
<span class="cm"> *   }]</span>
<span class="cm"> * }</span>
<span class="cm"> */</span>
</code></pre></div>
<p>Publish StructureDefinition resource documenting the extension formally.</p>
<hr/>
<h2 id="common-pitfalls">Common Pitfalls</h2>
<h3 id="pitfall-1-assuming-profiles-add-fields">Pitfall 1: Assuming Profiles Add Fields</h3>
<p><strong>Wrong assumption</strong>: "US Core adds race field to Patient"</p>
<p><strong>Reality</strong>: Race is an <strong>extension</strong>, not a base field. Base Patient structure is unchanged.</p>
<div class="highlight"><pre><span></span><code><span class="c1">// BAD: Looking for race as a top-level field</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">race</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">patient</span><span class="p">.</span><span class="nx">race</span><span class="p">;</span><span class="w"> </span><span class="c1">// undefined</span>

<span class="c1">// GOOD: Access via extension</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">raceExt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">patient</span><span class="p">.</span><span class="nx">extension</span><span class="o">?</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span>
<span class="w">  </span><span class="nx">e</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">e</span><span class="p">.</span><span class="nx">url</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">'http://hl7.org/fhir/us/core/StructureDefinition/us-core-race'</span>
<span class="p">);</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">race</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">raceExt</span><span class="o">?</span><span class="p">.</span><span class="nx">extension</span><span class="o">?</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">e</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">e</span><span class="p">.</span><span class="nx">url</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">'text'</span><span class="p">)</span><span class="o">?</span><span class="p">.</span><span class="nx">valueString</span><span class="p">;</span>
</code></pre></div>
<hr/>
<h3 id="pitfall-2-confusing-mustsupport-with-required">Pitfall 2: Confusing MustSupport with Required</h3>
<p><strong>Wrong assumption</strong>: "MustSupport = required field"</p>
<p><strong>Reality</strong>: MustSupport means "process if present" not "must exist"</p>
<div class="highlight"><pre><span></span><code><span class="c1">// This is VALID US Core Patient (telecom is MustSupport but 0..*)</span>
<span class="p">{</span>
<span class="w">  </span><span class="s2">"resourceType"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Patient"</span><span class="p">,</span>
<span class="w">  </span><span class="s2">"meta"</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="s2">"profile"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"http://hl7.org/fhir/us/core/StructureDefinition/us-core-patient"</span><span class="p">]</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="s2">"identifier"</span><span class="o">:</span><span class="w"> </span><span class="p">[{</span><span class="nx">system</span><span class="o">:</span><span class="w"> </span><span class="s2">"http://hospital.org"</span><span class="p">,</span><span class="w"> </span><span class="nx">value</span><span class="o">:</span><span class="w"> </span><span class="s2">"MRN-123"</span><span class="p">}],</span>
<span class="w">  </span><span class="s2">"name"</span><span class="o">:</span><span class="w"> </span><span class="p">[{</span><span class="nx">family</span><span class="o">:</span><span class="w"> </span><span class="s2">"Doe"</span><span class="p">}],</span>
<span class="w">  </span><span class="s2">"gender"</span><span class="o">:</span><span class="w"> </span><span class="s2">"male"</span>
<span class="w">  </span><span class="c1">// No telecom - still valid!</span>
<span class="p">}</span>

<span class="c1">// This is INVALID (identifier is 1..* - required)</span>
<span class="p">{</span>
<span class="w">  </span><span class="s2">"resourceType"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Patient"</span><span class="p">,</span>
<span class="w">  </span><span class="s2">"meta"</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="s2">"profile"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"http://hl7.org/fhir/us/core/StructureDefinition/us-core-patient"</span><span class="p">]</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="s2">"name"</span><span class="o">:</span><span class="w"> </span><span class="p">[{</span><span class="nx">family</span><span class="o">:</span><span class="w"> </span><span class="s2">"Doe"</span><span class="p">}],</span>
<span class="w">  </span><span class="s2">"gender"</span><span class="o">:</span><span class="w"> </span><span class="s2">"male"</span>
<span class="w">  </span><span class="c1">// Missing identifier - validation fails</span>
<span class="p">}</span>
</code></pre></div>
<hr/>
<h3 id="pitfall-3-using-wrong-profile-url">Pitfall 3: Using Wrong Profile URL</h3>
<p><strong>Wrong</strong>: Using base FHIR URL when you mean US Core</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">"meta"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">"profile"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"http://hl7.org/fhir/StructureDefinition/Patient"</span><span class="p">]</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>This declares conformance to <strong>base FHIR</strong>, not US Core (no identifier requirement).</p>
<p><strong>Right</strong>: Use specific profile URL</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">"meta"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">"profile"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"http://hl7.org/fhir/us/core/StructureDefinition/us-core-patient"</span><span class="p">]</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<hr/>
<h3 id="pitfall-4-ignoring-extension-urls">Pitfall 4: Ignoring Extension URLs</h3>
<p><strong>Wrong</strong>: Assuming all extensions with same structure are equivalent</p>
<div class="highlight"><pre><span></span><code><span class="c1">// These are DIFFERENT extensions</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">ext1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">url</span><span class="o">:</span><span class="w"> </span><span class="s2">"http://example.org/race"</span><span class="p">,</span>
<span class="w">  </span><span class="nx">valueString</span><span class="o">:</span><span class="w"> </span><span class="s2">"White"</span>
<span class="p">};</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">ext2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">url</span><span class="o">:</span><span class="w"> </span><span class="s2">"http://hl7.org/fhir/us/core/StructureDefinition/us-core-race"</span><span class="p">,</span>
<span class="w">  </span><span class="nx">extension</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span><span class="nx">url</span><span class="o">:</span><span class="w"> </span><span class="s2">"ombCategory"</span><span class="p">,</span><span class="w"> </span><span class="nx">valueCoding</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="nx">code</span><span class="o">:</span><span class="w"> </span><span class="s2">"2106-3"</span><span class="p">}}</span>
<span class="w">  </span><span class="p">]</span>
<span class="p">};</span>
</code></pre></div>
<p><strong>Right</strong>: Always check URL when processing extensions</p>
<div class="highlight"><pre><span></span><code><span class="kd">function</span><span class="w"> </span><span class="nx">findExtension</span><span class="p">(</span><span class="nx">resource</span><span class="p">,</span><span class="w"> </span><span class="nx">url</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">resource</span><span class="p">.</span><span class="nx">extension</span><span class="o">?</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">e</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">e</span><span class="p">.</span><span class="nx">url</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">url</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">usRace</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">findExtension</span><span class="p">(</span>
<span class="w">  </span><span class="nx">patient</span><span class="p">,</span>
<span class="w">  </span><span class="s1">'http://hl7.org/fhir/us/core/StructureDefinition/us-core-race'</span>
<span class="p">);</span>
</code></pre></div>
<hr/>
<h3 id="pitfall-5-not-validating-before-submission">Pitfall 5: Not Validating Before Submission</h3>
<p><strong>Wrong</strong>: Assume client-side validation is enough</p>
<div class="highlight"><pre><span></span><code><span class="c1">// BAD: Submit without validation</span>
<span class="k">await</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="s1">'/Patient'</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">method</span><span class="o">:</span><span class="w"> </span><span class="s1">'POST'</span><span class="p">,</span>
<span class="w">  </span><span class="nx">body</span><span class="o">:</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">patient</span><span class="p">)</span>
<span class="p">});</span>
<span class="c1">// Server rejects with cryptic error</span>
</code></pre></div>
<p><strong>Right</strong>: Use $validate first or handle errors gracefully</p>
<div class="highlight"><pre><span></span><code><span class="c1">// GOOD: Validate explicitly</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">validationResult</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="s1">'/Patient/$validate'</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">method</span><span class="o">:</span><span class="w"> </span><span class="s1">'POST'</span><span class="p">,</span>
<span class="w">  </span><span class="nx">body</span><span class="o">:</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span>
<span class="w">    </span><span class="nx">resourceType</span><span class="o">:</span><span class="w"> </span><span class="s2">"Parameters"</span><span class="p">,</span>
<span class="w">    </span><span class="nx">parameter</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">      </span><span class="p">{</span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">"resource"</span><span class="p">,</span><span class="w"> </span><span class="nx">resource</span><span class="o">:</span><span class="w"> </span><span class="nx">patient</span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">"profile"</span><span class="p">,</span><span class="w"> </span><span class="nx">valueUri</span><span class="o">:</span><span class="w"> </span><span class="s2">"http://hl7.org/fhir/us/core/StructureDefinition/us-core-patient"</span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="w">  </span><span class="p">})</span>
<span class="p">});</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">outcome</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">validationResult</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">outcome</span><span class="p">.</span><span class="nx">issue</span><span class="o">?</span><span class="p">.</span><span class="nx">some</span><span class="p">(</span><span class="nx">i</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">i</span><span class="p">.</span><span class="nx">severity</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">'error'</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">"Validation failed:"</span><span class="p">,</span><span class="w"> </span><span class="nx">outcome</span><span class="p">.</span><span class="nx">issue</span><span class="p">);</span>
<span class="w">  </span><span class="c1">// Fix errors before submitting</span>
<span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// Safe to create</span>
<span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="s1">'/Patient'</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">method</span><span class="o">:</span><span class="w"> </span><span class="s1">'POST'</span><span class="p">,</span>
<span class="w">    </span><span class="nx">body</span><span class="o">:</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">patient</span><span class="p">)</span>
<span class="w">  </span><span class="p">});</span>
<span class="p">}</span>
</code></pre></div>
<hr/>
<h2 id="real-world-extension-examples">Real-World Extension Examples</h2>
<h3 id="example-1-patients-preferred-pharmacy">Example 1: Patient's Preferred Pharmacy</h3>
<p><strong>Scenario</strong>: Hospital system needs to track patient's preferred pharmacy for e-prescribing.</p>
<p><strong>Extension definition</strong>:</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">"resourceType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"StructureDefinition"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://hospital.example.org/fhir/StructureDefinition/preferred-pharmacy"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PreferredPharmacy"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"active"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"kind"</span><span class="p">:</span><span class="w"> </span><span class="s2">"complex-type"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"abstract"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"context"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span>
<span class="w">    </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"element"</span><span class="p">,</span>
<span class="w">    </span><span class="nt">"expression"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Patient"</span>
<span class="w">  </span><span class="p">}],</span>
<span class="w">  </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Extension"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"baseDefinition"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://hl7.org/fhir/StructureDefinition/Extension"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"derivation"</span><span class="p">:</span><span class="w"> </span><span class="s2">"constraint"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"differential"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span>
<span class="w">      </span><span class="nt">"path"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Extension"</span><span class="p">,</span>
<span class="w">      </span><span class="nt">"short"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Preferred pharmacy for prescriptions"</span><span class="p">,</span>
<span class="w">      </span><span class="nt">"definition"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Reference to the Organization representing the patient's preferred pharmacy"</span>
<span class="w">    </span><span class="p">},</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">"path"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Extension.value[x]"</span><span class="p">,</span>
<span class="w">      </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span>
<span class="w">        </span><span class="nt">"code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Reference"</span><span class="p">,</span>
<span class="w">        </span><span class="nt">"targetProfile"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"http://hl7.org/fhir/StructureDefinition/Organization"</span><span class="p">]</span>
<span class="w">      </span><span class="p">}]</span>
<span class="w">    </span><span class="p">}]</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p><strong>Usage in Patient resource</strong>:</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">"resourceType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Patient"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"patient-123"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="kc">fa</span><span class="err">mily</span><span class="p">:</span><span class="w"> </span><span class="s2">"Shaw"</span><span class="p">,</span><span class="w"> </span><span class="err">give</span><span class="kc">n</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"Amy"</span><span class="p">]}],</span>
<span class="w">  </span><span class="nt">"extension"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://hospital.example.org/fhir/StructureDefinition/preferred-pharmacy"</span><span class="p">,</span>
<span class="w">      </span><span class="nt">"valueReference"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">"reference"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Organization/pharmacy-cvs-4567"</span><span class="p">,</span>
<span class="w">        </span><span class="nt">"display"</span><span class="p">:</span><span class="w"> </span><span class="s2">"CVS Pharmacy #4567 - Main Street"</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">]</span>
<span class="p">}</span>
</code></pre></div>
<p><strong>Application code</strong>:</p>
<div class="highlight"><pre><span></span><code><span class="kd">function</span><span class="w"> </span><span class="nx">getPreferredPharmacy</span><span class="p">(</span><span class="nx">patient</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">ext</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">patient</span><span class="p">.</span><span class="nx">extension</span><span class="o">?</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span>
<span class="w">    </span><span class="nx">e</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">e</span><span class="p">.</span><span class="nx">url</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">'http://hospital.example.org/fhir/StructureDefinition/preferred-pharmacy'</span>
<span class="w">  </span><span class="p">);</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">ext</span><span class="o">?</span><span class="p">.</span><span class="nx">valueReference</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Usage</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">pharmacy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">getPreferredPharmacy</span><span class="p">(</span><span class="nx">patient</span><span class="p">);</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">pharmacy</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Preferred pharmacy: </span><span class="si">${</span><span class="nx">pharmacy</span><span class="p">.</span><span class="nx">display</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="w">  </span><span class="c1">// Route prescription to this pharmacy</span>
<span class="p">}</span>
</code></pre></div>
<hr/>
<h3 id="example-2-observation-interpretation-comments">Example 2: Observation Interpretation Comments</h3>
<p><strong>Scenario</strong>: Lab wants to add free-text interpretation beyond coded interpretation field.</p>
<p><strong>Extension definition</strong> (simplified):</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://lab.example.org/fhir/StructureDefinition/interpretation-comment"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"InterpretationComment"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"context"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span>
<span class="w">    </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"element"</span><span class="p">,</span>
<span class="w">    </span><span class="nt">"expression"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Observation"</span>
<span class="w">  </span><span class="p">}],</span>
<span class="w">  </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Extension"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"differential"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span>
<span class="w">      </span><span class="nt">"path"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Extension.value[x]"</span><span class="p">,</span>
<span class="w">      </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span>
<span class="w">        </span><span class="nt">"code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span>
<span class="w">      </span><span class="p">}]</span>
<span class="w">    </span><span class="p">}]</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p><strong>Usage</strong>:</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">"resourceType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Observation"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"glucose-elevated"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"final"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"code"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">"coding"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span>
<span class="w">      </span><span class="nt">"system"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://loinc.org"</span><span class="p">,</span>
<span class="w">      </span><span class="nt">"code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2345-7"</span><span class="p">,</span>
<span class="w">      </span><span class="nt">"display"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Glucose"</span>
<span class="w">    </span><span class="p">}]</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">"subject"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"reference"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Patient/123"</span><span class="p">},</span>
<span class="w">  </span><span class="nt">"valueQuantity"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="mi">145</span><span class="p">,</span><span class="w"> </span><span class="nt">"unit"</span><span class="p">:</span><span class="w"> </span><span class="s2">"mg/dL"</span><span class="p">},</span>
<span class="w">  </span><span class="nt">"interpretation"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span>
<span class="w">    </span><span class="nt">"coding"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span>
<span class="w">      </span><span class="nt">"system"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://terminology.hl7.org/CodeSystem/v3-ObservationInterpretation"</span><span class="p">,</span>
<span class="w">      </span><span class="nt">"code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"H"</span><span class="p">,</span>
<span class="w">      </span><span class="nt">"display"</span><span class="p">:</span><span class="w"> </span><span class="s2">"High"</span>
<span class="w">    </span><span class="p">}]</span>
<span class="w">  </span><span class="p">}],</span>
<span class="w">  </span><span class="nt">"extension"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://lab.example.org/fhir/StructureDefinition/interpretation-comment"</span><span class="p">,</span>
<span class="w">      </span><span class="nt">"valueString"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Slightly elevated but within expected range for non-fasting sample. Recommend fasting glucose if persistent."</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">]</span>
<span class="p">}</span>
</code></pre></div>
<p><strong>Display in UI</strong>:</p>
<div class="highlight"><pre><span></span><code><span class="kd">function</span><span class="w"> </span><span class="nx">displayObservation</span><span class="p">(</span><span class="nx">obs</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`</span><span class="si">${</span><span class="nx">obs</span><span class="p">.</span><span class="nx">code</span><span class="p">.</span><span class="nx">text</span><span class="si">}</span><span class="sb">: </span><span class="si">${</span><span class="nx">obs</span><span class="p">.</span><span class="nx">valueQuantity</span><span class="p">.</span><span class="nx">value</span><span class="si">}</span><span class="sb"> </span><span class="si">${</span><span class="nx">obs</span><span class="p">.</span><span class="nx">valueQuantity</span><span class="p">.</span><span class="nx">unit</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>

<span class="w">  </span><span class="c1">// Show coded interpretation</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">obs</span><span class="p">.</span><span class="nx">interpretation</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">interp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">obs</span><span class="p">.</span><span class="nx">interpretation</span><span class="p">[</span><span class="mf">0</span><span class="p">].</span><span class="nx">coding</span><span class="p">[</span><span class="mf">0</span><span class="p">].</span><span class="nx">display</span><span class="p">;</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Interpretation: </span><span class="si">${</span><span class="nx">interp</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="c1">// Show extension comment if present</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">commentExt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">obs</span><span class="p">.</span><span class="nx">extension</span><span class="o">?</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span>
<span class="w">    </span><span class="nx">e</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">e</span><span class="p">.</span><span class="nx">url</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">'http://lab.example.org/fhir/StructureDefinition/interpretation-comment'</span>
<span class="w">  </span><span class="p">);</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">commentExt</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Lab comment: </span><span class="si">${</span><span class="nx">commentExt</span><span class="p">.</span><span class="nx">valueString</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Output:</span>
<span class="c1">// Glucose: 145 mg/dL</span>
<span class="c1">// Interpretation: High</span>
<span class="c1">// Lab comment: Slightly elevated but within expected range for non-fasting sample. Recommend fasting glucose if persistent.</span>
</code></pre></div>
<hr/>
<h3 id="example-3-specimen-collection-difficulty">Example 3: Specimen Collection Difficulty</h3>
<p><strong>Scenario</strong>: Document challenges during specimen collection for quality control.</p>
<p><strong>Extension</strong> (complex with sub-elements):</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">"resourceType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Specimen"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"blood-sample-difficult"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">"coding"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span>
<span class="w">      </span><span class="nt">"system"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://snomed.info/sct"</span><span class="p">,</span>
<span class="w">      </span><span class="nt">"code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"119297000"</span><span class="p">,</span>
<span class="w">      </span><span class="nt">"display"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Blood specimen"</span>
<span class="w">    </span><span class="p">}]</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">"subject"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"reference"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Patient/123"</span><span class="p">},</span>
<span class="w">  </span><span class="nt">"collection"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">"collectedDateTime"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2024-11-06T09:15:00Z"</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">"extension"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://hospital.example.org/fhir/StructureDefinition/collection-difficulty"</span><span class="p">,</span>
<span class="w">      </span><span class="nt">"extension"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="nt">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"encountered"</span><span class="p">,</span>
<span class="w">          </span><span class="nt">"valueBoolean"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="nt">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"description"</span><span class="p">,</span>
<span class="w">          </span><span class="nt">"valueString"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Patient has difficult venous access. Required 3 attempts."</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="nt">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"affectsQuality"</span><span class="p">,</span>
<span class="w">          </span><span class="nt">"valueBoolean"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">]</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">]</span>
<span class="p">}</span>
</code></pre></div>
<p><strong>Processing</strong>:</p>
<div class="highlight"><pre><span></span><code><span class="kd">function</span><span class="w"> </span><span class="nx">getCollectionDifficulty</span><span class="p">(</span><span class="nx">specimen</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">diffExt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">specimen</span><span class="p">.</span><span class="nx">extension</span><span class="o">?</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span>
<span class="w">    </span><span class="nx">e</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">e</span><span class="p">.</span><span class="nx">url</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">'http://hospital.example.org/fhir/StructureDefinition/collection-difficulty'</span>
<span class="w">  </span><span class="p">);</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">diffExt</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">encountered</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">diffExt</span><span class="p">.</span><span class="nx">extension</span><span class="o">?</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">e</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">e</span><span class="p">.</span><span class="nx">url</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">'encountered'</span><span class="p">)</span><span class="o">?</span><span class="p">.</span><span class="nx">valueBoolean</span><span class="p">;</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">diffExt</span><span class="p">.</span><span class="nx">extension</span><span class="o">?</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">e</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">e</span><span class="p">.</span><span class="nx">url</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">'description'</span><span class="p">)</span><span class="o">?</span><span class="p">.</span><span class="nx">valueString</span><span class="p">;</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">affectsQuality</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">diffExt</span><span class="p">.</span><span class="nx">extension</span><span class="o">?</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">e</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">e</span><span class="p">.</span><span class="nx">url</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">'affectsQuality'</span><span class="p">)</span><span class="o">?</span><span class="p">.</span><span class="nx">valueBoolean</span><span class="p">;</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="nx">encountered</span><span class="p">,</span><span class="w"> </span><span class="nx">description</span><span class="p">,</span><span class="w"> </span><span class="nx">affectsQuality</span><span class="p">};</span>
<span class="p">}</span>

<span class="c1">// Usage</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">difficulty</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">getCollectionDifficulty</span><span class="p">(</span><span class="nx">specimen</span><span class="p">);</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">difficulty</span><span class="o">?</span><span class="p">.</span><span class="nx">encountered</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">warn</span><span class="p">(</span><span class="sb">`Collection difficulty: </span><span class="si">${</span><span class="nx">difficulty</span><span class="p">.</span><span class="nx">description</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">difficulty</span><span class="p">.</span><span class="nx">affectsQuality</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">"Sample quality may be compromised!"</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<hr/>
<h2 id="profile-and-extension-discovery">Profile and Extension Discovery</h2>
<h3 id="finding-available-profiles">Finding Available Profiles</h3>
<p><strong>1. Check server's CapabilityStatement</strong>:</p>
<div class="highlight"><pre><span></span><code><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">discoverProfiles</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">caps</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="s1">'/metadata'</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">json</span><span class="p">());</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">profiles</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>

<span class="w">  </span><span class="nx">caps</span><span class="p">.</span><span class="nx">rest</span><span class="p">[</span><span class="mf">0</span><span class="p">].</span><span class="nx">resource</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">res</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">profiles</span><span class="p">[</span><span class="nx">res</span><span class="p">.</span><span class="nx">type</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">primary</span><span class="o">:</span><span class="w"> </span><span class="nx">res</span><span class="p">.</span><span class="nx">profile</span><span class="p">,</span>
<span class="w">      </span><span class="nx">supported</span><span class="o">:</span><span class="w"> </span><span class="nx">res</span><span class="p">.</span><span class="nx">supportedProfile</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">[]</span>
<span class="w">    </span><span class="p">};</span>
<span class="w">  </span><span class="p">});</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">profiles</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Usage</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">profiles</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">discoverProfiles</span><span class="p">();</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"Patient profiles:"</span><span class="p">,</span><span class="w"> </span><span class="nx">profiles</span><span class="p">.</span><span class="nx">Patient</span><span class="p">.</span><span class="nx">supported</span><span class="p">);</span>
<span class="c1">// ["http://hl7.org/fhir/us/core/StructureDefinition/us-core-patient",</span>
<span class="c1">//  "http://hl7.org/fhir/uv/ips/StructureDefinition/Patient-uv-ips"]</span>
</code></pre></div>
<hr/>
<p><strong>2. Query FHIR registries</strong>:</p>
<ul>
<li><strong>Simplifier.net</strong>: https://simplifier.net/</li>
<li><strong>FHIR Registry</strong>: http://fhir.org/guides/registry/</li>
<li><strong>National/regional registries</strong>: US Core (https://hl7.org/fhir/us/core/), AU Base, UK Core, etc.</li>
</ul>
<hr/>
<h3 id="finding-extensions-for-a-profile">Finding Extensions for a Profile</h3>
<p><strong>Query StructureDefinition resources</strong>:</p>
<div class="highlight"><pre><span></span><code><span class="err">GET /StructureDefinition?base=http://hl7.org/fhir/StructureDefinition/Patient&amp;type=Extension</span>
</code></pre></div>
<p>Returns all extensions defined for Patient.</p>
<p><strong>Parse StructureDefinition</strong>:</p>
<div class="highlight"><pre><span></span><code><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">getProfileExtensions</span><span class="p">(</span><span class="nx">profileUrl</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">structDef</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="sb">`/StructureDefinition?url=</span><span class="si">${</span><span class="nb">encodeURIComponent</span><span class="p">(</span><span class="nx">profileUrl</span><span class="p">)</span><span class="si">}</span><span class="sb">`</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">json</span><span class="p">());</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">structDef</span><span class="p">.</span><span class="nx">entry</span><span class="o">?</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"Profile not found"</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">[];</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">profile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">structDef</span><span class="p">.</span><span class="nx">entry</span><span class="p">[</span><span class="mf">0</span><span class="p">].</span><span class="nx">resource</span><span class="p">;</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">extensions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[];</span>

<span class="w">  </span><span class="nx">profile</span><span class="p">.</span><span class="nx">differential</span><span class="o">?</span><span class="p">.</span><span class="nx">element</span><span class="o">?</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">elem</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">elem</span><span class="p">.</span><span class="nx">path</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="s1">'.extension'</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">extUrl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">elem</span><span class="p">.</span><span class="nx">type</span><span class="o">?</span><span class="p">.[</span><span class="mf">0</span><span class="p">]</span><span class="o">?</span><span class="p">.</span><span class="nx">profile</span><span class="o">?</span><span class="p">.[</span><span class="mf">0</span><span class="p">];</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">extUrl</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">extensions</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
<span class="w">          </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="nx">elem</span><span class="p">.</span><span class="nx">sliceName</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">elem</span><span class="p">.</span><span class="nx">path</span><span class="p">,</span>
<span class="w">          </span><span class="nx">url</span><span class="o">:</span><span class="w"> </span><span class="nx">extUrl</span><span class="p">,</span>
<span class="w">          </span><span class="nx">cardinality</span><span class="o">:</span><span class="w"> </span><span class="sb">`</span><span class="si">${</span><span class="nx">elem</span><span class="p">.</span><span class="nx">min</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="mf">0</span><span class="si">}</span><span class="sb">..</span><span class="si">${</span><span class="nx">elem</span><span class="p">.</span><span class="nx">max</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s1">'*'</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span>
<span class="w">          </span><span class="nx">mustSupport</span><span class="o">:</span><span class="w"> </span><span class="nx">elem</span><span class="p">.</span><span class="nx">mustSupport</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="kc">false</span>
<span class="w">        </span><span class="p">});</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">});</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">extensions</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Usage</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">extensions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">getProfileExtensions</span><span class="p">(</span>
<span class="w">  </span><span class="s1">'http://hl7.org/fhir/us/core/StructureDefinition/us-core-patient'</span>
<span class="p">);</span>
<span class="nx">extensions</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">ext</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`</span><span class="si">${</span><span class="nx">ext</span><span class="p">.</span><span class="nx">name</span><span class="si">}</span><span class="sb">: </span><span class="si">${</span><span class="nx">ext</span><span class="p">.</span><span class="nx">url</span><span class="si">}</span><span class="sb"> (</span><span class="si">${</span><span class="nx">ext</span><span class="p">.</span><span class="nx">cardinality</span><span class="si">}</span><span class="sb">)</span><span class="si">${</span><span class="nx">ext</span><span class="p">.</span><span class="nx">mustSupport</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s1">' [MustSupport]'</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">''</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="p">});</span>
<span class="c1">// Output:</span>
<span class="c1">// race: http://hl7.org/fhir/us/core/StructureDefinition/us-core-race (0..1) [MustSupport]</span>
<span class="c1">// ethnicity: http://hl7.org/fhir/us/core/StructureDefinition/us-core-ethnicity (0..1) [MustSupport]</span>
<span class="c1">// birthsex: http://hl7.org/fhir/us/core/StructureDefinition/us-core-birthsex (0..1) [MustSupport]</span>
</code></pre></div>
<hr/>
<h2 id="testing-profile-conformance">Testing Profile Conformance</h2>
<h3 id="unit-testing-approach">Unit Testing Approach</h3>
<div class="highlight"><pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="nx">FhirValidator</span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">'fhir-validator'</span><span class="p">);</span>

<span class="nx">describe</span><span class="p">(</span><span class="s1">'US Core Patient Conformance'</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">validator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">FhirValidator</span><span class="p">();</span>

<span class="w">  </span><span class="nx">test</span><span class="p">(</span><span class="s1">'Valid US Core Patient passes validation'</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">patient</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">resourceType</span><span class="o">:</span><span class="w"> </span><span class="s2">"Patient"</span><span class="p">,</span>
<span class="w">      </span><span class="nx">meta</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">profile</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"http://hl7.org/fhir/us/core/StructureDefinition/us-core-patient"</span><span class="p">]</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="nx">identifier</span><span class="o">:</span><span class="w"> </span><span class="p">[{</span><span class="nx">system</span><span class="o">:</span><span class="w"> </span><span class="s2">"http://hospital.org"</span><span class="p">,</span><span class="w"> </span><span class="nx">value</span><span class="o">:</span><span class="w"> </span><span class="s2">"MRN-123"</span><span class="p">}],</span>
<span class="w">      </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="p">[{</span><span class="nx">family</span><span class="o">:</span><span class="w"> </span><span class="s2">"Doe"</span><span class="p">,</span><span class="w"> </span><span class="nx">given</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"John"</span><span class="p">]}],</span>
<span class="w">      </span><span class="nx">gender</span><span class="o">:</span><span class="w"> </span><span class="s2">"male"</span>
<span class="w">    </span><span class="p">};</span>

<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">validator</span><span class="p">.</span><span class="nx">validate</span><span class="p">(</span><span class="nx">patient</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">profile</span><span class="o">:</span><span class="w"> </span><span class="s1">'http://hl7.org/fhir/us/core/StructureDefinition/us-core-patient'</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="nx">expect</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">valid</span><span class="p">).</span><span class="nx">toBe</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">  </span><span class="p">});</span>

<span class="w">  </span><span class="nx">test</span><span class="p">(</span><span class="s1">'Patient without identifier fails US Core validation'</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">patient</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">resourceType</span><span class="o">:</span><span class="w"> </span><span class="s2">"Patient"</span><span class="p">,</span>
<span class="w">      </span><span class="nx">meta</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">profile</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"http://hl7.org/fhir/us/core/StructureDefinition/us-core-patient"</span><span class="p">]</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="p">[{</span><span class="nx">family</span><span class="o">:</span><span class="w"> </span><span class="s2">"Doe"</span><span class="p">,</span><span class="w"> </span><span class="nx">given</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"John"</span><span class="p">]}],</span>
<span class="w">      </span><span class="nx">gender</span><span class="o">:</span><span class="w"> </span><span class="s2">"male"</span>
<span class="w">    </span><span class="p">};</span>

<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">validator</span><span class="p">.</span><span class="nx">validate</span><span class="p">(</span><span class="nx">patient</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">profile</span><span class="o">:</span><span class="w"> </span><span class="s1">'http://hl7.org/fhir/us/core/StructureDefinition/us-core-patient'</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="nx">expect</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">valid</span><span class="p">).</span><span class="nx">toBe</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
<span class="w">    </span><span class="nx">expect</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">messages</span><span class="p">).</span><span class="nx">toContainEqual</span><span class="p">(</span>
<span class="w">      </span><span class="nx">expect</span><span class="p">.</span><span class="nx">objectContaining</span><span class="p">({</span>
<span class="w">        </span><span class="nx">severity</span><span class="o">:</span><span class="w"> </span><span class="s1">'error'</span><span class="p">,</span>
<span class="w">        </span><span class="nx">message</span><span class="o">:</span><span class="w"> </span><span class="nx">expect</span><span class="p">.</span><span class="nx">stringContaining</span><span class="p">(</span><span class="s1">'identifier'</span><span class="p">)</span>
<span class="w">      </span><span class="p">})</span>
<span class="w">    </span><span class="p">);</span>
<span class="w">  </span><span class="p">});</span>

<span class="w">  </span><span class="nx">test</span><span class="p">(</span><span class="s1">'Race extension is properly structured'</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">patient</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">resourceType</span><span class="o">:</span><span class="w"> </span><span class="s2">"Patient"</span><span class="p">,</span>
<span class="w">      </span><span class="nx">meta</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">profile</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"http://hl7.org/fhir/us/core/StructureDefinition/us-core-patient"</span><span class="p">]</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="nx">identifier</span><span class="o">:</span><span class="w"> </span><span class="p">[{</span><span class="nx">system</span><span class="o">:</span><span class="w"> </span><span class="s2">"http://hospital.org"</span><span class="p">,</span><span class="w"> </span><span class="nx">value</span><span class="o">:</span><span class="w"> </span><span class="s2">"MRN-123"</span><span class="p">}],</span>
<span class="w">      </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="p">[{</span><span class="nx">family</span><span class="o">:</span><span class="w"> </span><span class="s2">"Doe"</span><span class="p">}],</span>
<span class="w">      </span><span class="nx">gender</span><span class="o">:</span><span class="w"> </span><span class="s2">"male"</span><span class="p">,</span>
<span class="w">      </span><span class="nx">extension</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="nx">url</span><span class="o">:</span><span class="w"> </span><span class="s2">"http://hl7.org/fhir/us/core/StructureDefinition/us-core-race"</span><span class="p">,</span>
<span class="w">          </span><span class="nx">extension</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">              </span><span class="nx">url</span><span class="o">:</span><span class="w"> </span><span class="s2">"ombCategory"</span><span class="p">,</span>
<span class="w">              </span><span class="nx">valueCoding</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">system</span><span class="o">:</span><span class="w"> </span><span class="s2">"urn:oid:2.16.840.1.113883.6.238"</span><span class="p">,</span>
<span class="w">                </span><span class="nx">code</span><span class="o">:</span><span class="w"> </span><span class="s2">"2106-3"</span><span class="p">,</span>
<span class="w">                </span><span class="nx">display</span><span class="o">:</span><span class="w"> </span><span class="s2">"White"</span>
<span class="w">              </span><span class="p">}</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">              </span><span class="nx">url</span><span class="o">:</span><span class="w"> </span><span class="s2">"text"</span><span class="p">,</span>
<span class="w">              </span><span class="nx">valueString</span><span class="o">:</span><span class="w"> </span><span class="s2">"White"</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">          </span><span class="p">]</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">]</span>
<span class="w">    </span><span class="p">};</span>

<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">validator</span><span class="p">.</span><span class="nx">validate</span><span class="p">(</span><span class="nx">patient</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">profile</span><span class="o">:</span><span class="w"> </span><span class="s1">'http://hl7.org/fhir/us/core/StructureDefinition/us-core-patient'</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="nx">expect</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">valid</span><span class="p">).</span><span class="nx">toBe</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">  </span><span class="p">});</span>
<span class="p">});</span>
</code></pre></div>
<hr/>
<h3 id="integration-testing-with-live-server">Integration Testing with Live Server</h3>
<div class="highlight"><pre><span></span><code><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">testProfileSupport</span><span class="p">(</span><span class="nx">baseUrl</span><span class="p">,</span><span class="w"> </span><span class="nx">profile</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// Create minimal conformant resource</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">patient</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">resourceType</span><span class="o">:</span><span class="w"> </span><span class="s2">"Patient"</span><span class="p">,</span>
<span class="w">    </span><span class="nx">meta</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="nx">profile</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="nx">profile</span><span class="p">]},</span>
<span class="w">    </span><span class="nx">identifier</span><span class="o">:</span><span class="w"> </span><span class="p">[{</span><span class="nx">system</span><span class="o">:</span><span class="w"> </span><span class="s2">"http://test.org"</span><span class="p">,</span><span class="w"> </span><span class="nx">value</span><span class="o">:</span><span class="w"> </span><span class="s2">"TEST-123"</span><span class="p">}],</span>
<span class="w">    </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="p">[{</span><span class="nx">family</span><span class="o">:</span><span class="w"> </span><span class="s2">"TestPatient"</span><span class="p">}],</span>
<span class="w">    </span><span class="nx">gender</span><span class="o">:</span><span class="w"> </span><span class="s2">"unknown"</span>
<span class="w">  </span><span class="p">};</span>

<span class="w">  </span><span class="c1">// Validate against server</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">validateResponse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="sb">`</span><span class="si">${</span><span class="nx">baseUrl</span><span class="si">}</span><span class="sb">/Patient/$validate`</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">method</span><span class="o">:</span><span class="w"> </span><span class="s1">'POST'</span><span class="p">,</span>
<span class="w">    </span><span class="nx">headers</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="s1">'Content-Type'</span><span class="o">:</span><span class="w"> </span><span class="s1">'application/fhir+json'</span><span class="p">},</span>
<span class="w">    </span><span class="nx">body</span><span class="o">:</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span>
<span class="w">      </span><span class="nx">resourceType</span><span class="o">:</span><span class="w"> </span><span class="s2">"Parameters"</span><span class="p">,</span>
<span class="w">      </span><span class="nx">parameter</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">"resource"</span><span class="p">,</span><span class="w"> </span><span class="nx">resource</span><span class="o">:</span><span class="w"> </span><span class="nx">patient</span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">"profile"</span><span class="p">,</span><span class="w"> </span><span class="nx">valueUri</span><span class="o">:</span><span class="w"> </span><span class="nx">profile</span><span class="p">}</span>
<span class="w">      </span><span class="p">]</span>
<span class="w">    </span><span class="p">})</span>
<span class="w">  </span><span class="p">});</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">outcome</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">validateResponse</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">errors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">outcome</span><span class="p">.</span><span class="nx">issue</span><span class="o">?</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">i</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">i</span><span class="p">.</span><span class="nx">severity</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">'error'</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">[];</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">errors</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`✓ Server supports </span><span class="si">${</span><span class="nx">profile</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`✗ Server does not fully support </span><span class="si">${</span><span class="nx">profile</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="w">    </span><span class="nx">errors</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">err</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`  - </span><span class="si">${</span><span class="nx">err</span><span class="p">.</span><span class="nx">diagnostics</span><span class="si">}</span><span class="sb">`</span><span class="p">));</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Usage</span>
<span class="k">await</span><span class="w"> </span><span class="nx">testProfileSupport</span><span class="p">(</span>
<span class="w">  </span><span class="s1">'https://launch.smarthealthit.org/v/r4/fhir'</span><span class="p">,</span>
<span class="w">  </span><span class="s1">'http://hl7.org/fhir/us/core/StructureDefinition/us-core-patient'</span>
<span class="p">);</span>
</code></pre></div>
<hr/>
<h2 id="summary-profiles-vs-extensions">Summary: Profiles vs. Extensions</h2>
<table>
<thead>
<tr>
<th>Aspect</th>
<th>Profiles</th>
<th>Extensions</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Purpose</strong></td>
<td>Constrain existing resources</td>
<td>Add new data elements</td>
</tr>
<tr>
<td><strong>Scope</strong></td>
<td>Entire resource structure</td>
<td>Individual fields</td>
</tr>
<tr>
<td><strong>Cardinality</strong></td>
<td>Can tighten (0..<em> → 1..</em>)</td>
<td>Defines own cardinality</td>
</tr>
<tr>
<td><strong>Location</strong></td>
<td>Declared in meta.profile</td>
<td>Appear in extension array</td>
</tr>
<tr>
<td><strong>Validation</strong></td>
<td>Server validates against profile</td>
<td>Server validates extension structure</td>
</tr>
<tr>
<td><strong>Interop impact</strong></td>
<td>Must match profile for conformance</td>
<td>Can be ignored if not understood</td>
</tr>
<tr>
<td><strong>Examples</strong></td>
<td>US Core Patient, IPS AllergyIntolerance</td>
<td>Race, ethnicity, custom identifiers</td>
</tr>
</tbody>
</table>
<hr/>
<h2 id="key-takeaways">Key Takeaways</h2>
<p><strong>Profiles</strong>:</p>
<ul>
<li>✅ Use established profiles (US Core, IPS) when possible</li>
<li>✅ Declare profile in meta.profile for clarity</li>
<li>✅ Validate resources against profiles before submission</li>
<li>✅ Check server's CapabilityStatement for supported profiles</li>
<li>❌ Don't assume profile compliance without validation</li>
</ul>
<p><strong>Extensions</strong>:</p>
<ul>
<li>✅ Use standard extensions when available (US Core race/ethnicity)</li>
<li>✅ Document custom extensions thoroughly</li>
<li>✅ Check extension URL exactly (namespace matters)</li>
<li>✅ Handle missing extensions gracefully (they're often optional)</li>
<li>❌ Don't ignore modifierExtensions (they change meaning)</li>
<li>❌ Don't create custom extensions for data already in base FHIR</li>
</ul>
<p><strong>MustSupport</strong>:</p>
<ul>
<li>✅ Include MustSupport elements if data is available</li>
<li>✅ Build apps that can process MustSupport elements</li>
<li>❌ Don't confuse MustSupport with required (check cardinality)</li>
</ul>
<hr/>
<h2 id="next-steps">Next Steps</h2>
<p>This completes the Advanced FHIR Concepts section. We've now covered:</p>
<ul>
<li>✅ How profiles constrain resources for specific use cases</li>
<li>✅ MustSupport semantics and obligations</li>
<li>✅ Extension structure (simple, complex, modifier)</li>
<li>✅ Common US Core extensions (race, ethnicity, birthsex)</li>
<li>✅ Profile validation and conformance testing</li>
</ul>
<p>Next, we'll explore SMART authorization—how apps obtain secure access to FHIR data.</p>
</article>
</div>
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
</div>
<button class="md-top md-icon" data-md-component="top" hidden="" type="button">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"></path></svg>
  Back to top
</button>
</main>
<footer class="md-footer">
<nav aria-label="Footer" class="md-footer__inner md-grid">
<a aria-label="Previous: Handling Variation — Overview" class="md-footer__link md-footer__link--prev" href="../eh-dd-05-advanced-intro/">
<div class="md-footer__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
</div>
<div class="md-footer__title">
<span class="md-footer__direction">
                Previous
              </span>
<div class="md-ellipsis">
                Handling Variation — Overview
              </div>
</div>
</a>
<a aria-label="Next: SMART Authorization" class="md-footer__link md-footer__link--next" href="../../eh-dd-06-smart-auth/">
<div class="md-footer__title">
<span class="md-footer__direction">
                Next
              </span>
<div class="md-ellipsis">
                SMART Authorization
              </div>
</div>
<div class="md-footer__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"></path></svg>
</div>
</a>
</nav>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<div class="md-consent" data-md-component="consent" hidden="" id="__consent">
<div class="md-consent__overlay"></div>
<aside class="md-consent__inner">
<form class="md-consent__form md-grid md-typeset" name="consent">
<h4>Cookie consent</h4>
<p>We use cookies to recognize your repeated visits and preferences, as well as to measure the effectiveness of our documentation and whether users find what they're searching for. With your consent, you're helping us to make our documentation better.
</p>
<input class="md-toggle" id="__settings" type="checkbox"/>
<div class="md-consent__settings">
<ul class="task-list">
<li class="task-list-item">
<label class="task-list-control">
<input checked="" name="analytics" type="checkbox"/>
<span class="task-list-indicator"></span>
          Google Analytics
        </label>
</li>
</ul>
</div>
<div class="md-consent__controls">
<button class="md-button md-button--primary">Accept</button>
<label class="md-button" for="__settings">Manage settings</label>
</div>
</form>
</aside>
</div>
<script>var consent=__md_get("__consent");if(consent)for(var input of document.forms.consent.elements)input.name&&(input.checked=consent[input.name]||!1);else"file:"!==location.protocol&&setTimeout((function(){document.querySelector("[data-md-component=consent]").hidden=!1}),250);var form=document.forms.consent;for(var action of["submit","reset"])form.addEventListener(action,(function(e){if(e.preventDefault(),"reset"===e.type)for(var n of document.forms.consent.elements)n.name&&(n.checked=!1);__md_set("__consent",Object.fromEntries(Array.from(new FormData(form).keys()).map((function(e){return[e,!0]})))),location.hash="",location.reload()}))</script>
<script id="__config" type="application/json">{"base": "../../../..", "features": ["navigation.top", "navigation.footer", "navigation.indexes", "search.highlight", "search.suggest", "search.share", "content.code.copy", "content.code.select"], "search": "../../../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
<script src="../../../../assets/javascripts/bundle.525ec568.min.js"></script>
<script src="../../../../js/diagram-utils.js"></script>
<script src="../../../../js/seamaiden.js"></script>
<script src="../../../../js/diagram-theme-switcher.js"></script>
<script src="../../../../js/diagram-zoom.js"></script>
<script src="../../../../js/alphabet-auto.js"></script>
<script src="../../../../js/open_in_new_tab.js"></script>
<script src="../../../../assets/mkdocs_puml/puml.js"></script>
<script src="https://unpkg.com/@panzoom/panzoom@4.5.1/dist/panzoom.min.js"></script>
<script src="../../../../assets/mkdocs_puml/interaction.js"></script>
</body>
</html>